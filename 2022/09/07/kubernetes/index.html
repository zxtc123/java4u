<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta 
    http-equiv="X-UA-Compatible" 
    content="ie=edge">
  <meta 
    name="theme-color" 
    content="#fff" 
    id="theme-color">
  <meta 
    name="description" 
    content="Snail">
  <link 
    rel="icon" 
    href="/java4u/img/snail.png">
  <title>kubernetes</title>
  
    
      <meta 
        property="og:title" 
        content="kubernetes">
    
    
      <meta 
        property="og:url" 
        content="https://zxtc123.github.io/java4u/2022/09/07/kubernetes/index.html">
    
    
      <meta 
        property="og:img" 
        content="/java4u/img/1.e3a1f41f.gif">
    
    
    
      <meta 
        property="og:type" 
        content="article">
      <meta 
        property="og:article:published_time" 
        content="2022-09-07">
      <meta 
        property="og:article:modified_time" 
        content="2023-01-19">
      <meta 
        property="og:article:author" 
        content="Zhao Xin">
      
        
          <meta 
            property="og:article:tag" 
            content="学习">
        
          <meta 
            property="og:article:tag" 
            content="kubernetes">
        
      
    
  
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    function loadCSS(href, data, attr) {
      var sheet = document.createElement('link');
      sheet.ref = 'stylesheet';
      sheet.href = href;
      sheet.dataset[data] = attr;
      document.head.appendChild(sheet);
    }
    function changeCSS(cssFile, data, attr) {
      var oldlink = document.querySelector(data);
      var newlink = document.createElement("link");
      newlink.setAttribute("rel", "stylesheet");
      newlink.setAttribute("href", cssFile);
      newlink.dataset.prism = attr;
      document.head.replaceChild(newlink, oldlink);
    }
  </script>
  
    
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
  </script>
  
    <script>
      var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
        document.getElementById('theme-color').dataset.mode = getCssMediaQuery();
      }
    };
    setDarkmode();
    </script>
  
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  
    <link rel="preload" href="/java4u/js/lib/lightbox/baguetteBox.min.js" as="script">
    <link rel="preload" href="/java4u/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
    <link rel="preload" href="/java4u/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  
  
  <link rel="stylesheet" href="/java4u/css/main.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">
  
    <link rel="stylesheet" href="/java4u/js/lib/lightbox/baguetteBox.min.css">
  
<meta name="generator" content="Hexo 6.1.0"></head>

  <body>
    <div class="wrapper">
       
      <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
        <img 
          class="navbar-logo-img"
          width="32"
          height="32"
          src="/java4u/img/snail.png" 
          alt="blog logo">
      
      <span class="navbar-logo-dsc">Snail</span>
    </span>
  </div>
  <div class="navbar-menu">
    
      <a 
        href="/java4u/" 
        class="navbar-menu-item">
        
          首页
        
      </a>
    
      <a 
        href="/java4u/archives" 
        class="navbar-menu-item">
        
          归档
        
      </a>
    
      <a 
        href="/java4u/tags" 
        class="navbar-menu-item">
        
          标签
        
      </a>
    
      <a 
        href="/java4u/categories" 
        class="navbar-menu-item">
        
          分类
        
      </a>
    
      <a 
        href="/java4u/about" 
        class="navbar-menu-item">
        
          关于
        
      </a>
    
      <a 
        href="/java4u/links" 
        class="navbar-menu-item">
        
          友链
        
      </a>
    
    <a 
      class="navbar-menu-item darknavbar" 
      id="dark">
      <i class="iconfont icon-weather"></i>
    </a>
    <a 
      class="navbar-menu-item searchnavbar" 
      id="search">
      <i 
        class="iconfont icon-search" 
        style="font-size: 1.2rem; font-weight: 400;">
      </i>
    </a>
  </div>
</nav> 
      
      <div 
        id="local-search" 
        style="display: none">
        <input
          class="navbar-menu-item"
          id="search-input"
          placeholder="请输入搜索内容..." />
        <div id="search-content"></div>
      </div>
      
      <div class="section-wrap">
        <div class="container">
          <div class="columns">
            <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      kubernetes
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2022-09-06T16:00:00.000Z">
      <i 
        class="iconfont icon-calendar" 
        style="margin-right: 2px;">
      </i>
      <span>2022-09-07</span>
    </time>
    
      <span class="dot"></span>
      
        <a 
          href="/java4u/categories/%E5%AE%B9%E5%99%A8/" 
          class="post-meta-link">
          容器
        </a>
      
    
    
      <span class="dot"></span>
      <span>3.9k 字</span>
    
  </div>
  
    <div 
      class="post-meta post-show-meta" 
      style="margin-top: -10px;">
      <div style="display: flex; align-items: center;">
        <i 
          class="iconfont icon-biaoqian" 
          style="margin-right: 2px; font-size: 1.15rem;">
        </i>
        
          
          <a 
            href="/java4u/tags/%E5%AD%A6%E4%B9%A0/" 
            class="post-meta-link">
            学习
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/java4u/tags/kubernetes/" 
            class="post-meta-link">
            kubernetes
          </a>
        
      </div>
    </div>
  
  </header>
  <div 
    id="section" 
    class="post-content">
    <h2 id="kubernetes介绍"><a href="#kubernetes介绍" class="headerlink" title="kubernetes介绍"></a>kubernetes介绍</h2><p>kubernetes本质是一组服务器集群，主要提供：</p>
<ul>
<li>自我修复</li>
<li>弹性伸缩</li>
<li>服务发现</li>
<li>负载均衡</li>
<li>版本回退</li>
<li>存储编排</li>
</ul>
<h3 id="kubernetes组件"><a href="#kubernetes组件" class="headerlink" title="kubernetes组件"></a>kubernetes组件</h3><p>master:集群控制平面，负责集群的决策(管理)</p>
<pre class="highlight"><span class="line">Apiserver:资源操作唯一入口，接收用户命令</span><br><span class="line">Scheduler:集群资源调度</span><br><span class="line">ControllerManager:负责维护集群的状态，比如程序部署安排</span><br><span class="line">Etcd:负责储存集群各种资源对象的信息</span><br></pre>

<p>node:集群数据平面，负责为容器提供运行环境(干活)</p>
<pre class="highlight"><span class="line">Kuberlet:维护容器生命周期，通过docker来创建、更新、销毁容器</span><br><span class="line">KuberProxy:负责提供集群内部的服务发现和负载均衡</span><br><span class="line">Docker:负责节点上容器的各种操作</span><br></pre>

<h3 id="kubernetes概念"><a href="#kubernetes概念" class="headerlink" title="kubernetes概念"></a>kubernetes概念</h3><p>Master: 集群控制节点<br>Node: 工作负载节点<br>Pod: k8s最小控制单元，容器运行在pod中，一个pod可以有1个或多个容器<br>deployment: pod控制器，确保pod资源符合预期的状态，当pod资源出现故障，会尝试进行重启或重建<br>Controller: 控制器，通过它实现对pod的管理，启停&#x2F;伸缩pod<br>Service: pod对外服务的统一入口，可以维护同一类多个pod<br>Label: 标签，用对pod进行分类<br>NameSpace: 命名空间，用来隔离pod的运行环境</p>
<h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><p>资源一级属性</p>
<ul>
<li>apiVersion</li>
<li>kind  资源类型  [kubectl api-resource]</li>
<li>metadata  元数据</li>
<li>spec   描述，资源配置的详细描述</li>
<li>status   状态信息，k8s自动生成</li>
</ul>
<p>spec主要配置，查看它的常见子属性：</p>
<p>containers  容器列表，定义容器详细信息</p>
<pre class="highlight"><span class="line"><span class="attr">containers:</span></span><br><span class="line">    <span class="string">name</span> <span class="string">&lt;string&gt;</span>  <span class="comment">#容器名称</span></span><br><span class="line">    <span class="string">image</span> <span class="string">&lt;string&gt;</span> <span class="comment">#容器需要的镜像地址</span></span><br><span class="line">    <span class="string">imagePullPolicy</span> <span class="string">&lt;string&gt;</span> <span class="comment">#镜像拉去策略 Always总是从远程仓库拉取 IfNotPresent 本地有则使用本地的，本地没有远程下载  Never 只使用本地镜像</span></span><br><span class="line">    <span class="string">command</span> <span class="string">&lt;[]string&gt;</span> <span class="comment">#容器启动命令</span></span><br><span class="line">    <span class="string">args</span> <span class="string">&lt;[]string&gt;</span>  <span class="comment">#容器启动命令需要的参数列表</span></span><br><span class="line">    <span class="string">env</span> <span class="string">&lt;[]string&gt;</span>  <span class="comment">#容器环境变量的配置</span></span><br><span class="line">    <span class="string">ports</span>      <span class="comment">#容器需要暴露的端口列表</span></span><br><span class="line">    <span class="string">resources</span> <span class="string">&lt;Object&gt;</span> <span class="comment">#资源限制和资源请求的设置，他有2个子选项 limits:限制运行时容器最大占用资源  requests:用于设置容器需要的最小资源</span></span><br></pre>

<p>containers的ports选项</p>
<pre class="highlight"><span class="line"><span class="attr">KIND:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">VERSION:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">RESOURCE:</span> <span class="string">ports</span> <span class="string">&lt;[]object&gt;</span></span><br><span class="line"><span class="attr">FIELDS:</span></span><br><span class="line">  <span class="string">name</span>  <span class="string">&lt;string&gt;</span>  <span class="comment">#端口名称，如果指定必须保证唯一</span></span><br><span class="line">  <span class="string">containerPort&lt;integer&gt;</span> <span class="comment">#容器要监听的端口</span></span><br><span class="line">  <span class="string">hostPort</span>  <span class="string">&lt;integer&gt;</span>  <span class="comment">#容器在主机上公开的端口,如果设置，主机只能运行容器一个副本</span></span><br><span class="line">  <span class="string">hostIP</span>  <span class="string">&lt;string&gt;</span>  <span class="comment">#外部端口绑定到主机IP</span></span><br><span class="line">  <span class="string">protocol</span> <span class="string">&lt;string&gt;</span> <span class="comment">#端口协议，必须是UDP/TCP或SCTP,默认TCP</span></span><br></pre>

<p>测试样例</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">podname</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br></pre>

<p>详细样例</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-base</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">heima</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">volumeMounts:</span>  <span class="comment">#将logs-volume挂载到nginx容器，对应目录为/var/log/nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/var/log/nginx</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;10Gi&quot;</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;10Mi&quot;</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">exec:</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/bin/cat&quot;</span>,<span class="string">&quot;/tmp/hello.txt&quot;</span>]</span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">30</span>  <span class="comment"># 容器启动后30s开始探测</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">5</span>  <span class="comment"># 探测超时时间5s</span></span><br><span class="line">  <span class="comment"># nodeName: node1  # 指定调度到node1节点</span></span><br><span class="line">  <span class="comment"># nodeSelector:</span></span><br><span class="line">  <span class="comment">#   nodeenv: pro  # 指定调度到具有nodeenv=pro标签的节点上</span></span><br><span class="line">  <span class="attr">affinity:</span>  <span class="comment"># 亲和性设置</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span>  <span class="comment"># 设置node亲和性</span></span><br><span class="line">      <span class="attr">requireDuringSchedulingIgnoreDuringExecution:</span>  <span class="comment"># 硬限制</span></span><br><span class="line">        <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span>  <span class="comment"># 匹配env的值在[&quot;xxx&quot;,&quot;yyy&quot;]中的标签</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">nodeenv</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">value:</span> [<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;yyy&quot;</span>]</span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoreDuringExecution:</span>  <span class="comment"># 软限制</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">preference:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">nodeenv</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">value:</span> [<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;yyy&quot;</span>]</span><br><span class="line">    <span class="attr">podAffinity:</span>  <span class="comment"># 设置pod亲和性</span></span><br><span class="line">      <span class="attr">requireDuringSchedulingIgnoreDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">podenv</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">value:</span> [<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;yyy&quot;</span>]</span><br><span class="line">        <span class="attr">topologyKey:</span> <span class="string">kubernetes.io/hostname</span>   <span class="comment"># 作用域 调度到一个目标节点</span></span><br><span class="line">  <span class="attr">tolerations:</span>  <span class="comment"># 添加容忍</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;tag&quot;</span>  <span class="comment"># 要容忍的污点的key</span></span><br><span class="line">    <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span>  <span class="comment"># 操作符</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;heima&quot;</span>     <span class="comment"># 容忍的污点的value</span></span><br><span class="line">    <span class="attr">effect:</span> <span class="string">&quot;NoExecute&quot;</span> <span class="comment"># 添加容忍的规则，这里必须和标记的污点规则相同</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span>  <span class="comment"># 重启策略  Always,自动重启  OnFailure,异常时重启  Never不重启</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt;sleep 3;done;&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/logs</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;username&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;password&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line">    <span class="attr">lifecycle:</span></span><br><span class="line">      <span class="attr">postStart:</span></span><br><span class="line">        <span class="attr">exec:</span>  <span class="comment"># 容器启动前执行命令，修改nginx默认页面</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo postStart... &gt; /usr/share/nginx/html/index/html&quot;</span>]</span><br><span class="line">      <span class="attr">preStop:</span></span><br><span class="line">        <span class="attr">exec:</span>  <span class="comment"># 容器停止前停止nginx服务</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/usr/sbin/nginx&quot;</span>,<span class="string">&quot;-s&quot;</span>,<span class="string">&quot;quit&quot;</span>]</span><br><span class="line">  <span class="attr">initContainers:</span>  <span class="comment"># 初始化容器，能连接上mysql和redis才会启动容器</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-mysql</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;until ping 192.168.109.201 -c 1 ; do echo waiting for mysql...; sleep 2;done;&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;until ping 192.168.109.202 -c 1 ;do echo waiting for redis...; sleep 2; done;&#x27;</span>]</span><br><span class="line">  <span class="attr">volumes:</span>  <span class="comment">#声明volume,name为logs-volume,类型为emptyDir</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre>

<h4 id="pod生命周期"><a href="#pod生命周期" class="headerlink" title="pod生命周期"></a>pod生命周期</h4><ul>
<li>pod创建过程</li>
<li>运行初始化容器过程</li>
<li>运行主容器过程<ul>
<li>容器启动后钩子(post start)&#x2F;容器终止前钩子（pre stop）</li>
<li>容器存活性探测&#x2F;就绪探测</li>
</ul>
</li>
<li>pod终止过程</li>
</ul>
<p>钩子处理器支持下面三种方式定义动作：</p>
<ul>
<li>Exec命令：在容器中执行一次命令</li>
</ul>
<pre class="highlight"><span class="line"><span class="attr">lifecycle:</span></span><br><span class="line">  <span class="attr">postStart:</span></span><br><span class="line">    <span class="attr">exec:</span></span><br><span class="line">      <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp/healthy</span></span><br></pre>

<ul>
<li>TCPSocket:将会尝试访问一个用户容器的端口，如果能够建立这条连接，则认为程序正常</li>
</ul>
<pre class="highlight"><span class="line"><span class="attr">lifecycle:</span></span><br><span class="line">  <span class="attr">postStart:</span></span><br><span class="line">    <span class="attr">tcpSocket:</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br></pre>

<ul>
<li>HTTPGet:在当前容器中向某url发起http请求</li>
</ul>
<pre class="highlight"><span class="line"><span class="attr">lifecycle:</span></span><br><span class="line">  <span class="attr">postStart:</span></span><br><span class="line">    <span class="attr">httpGet:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.109</span><span class="number">.100</span></span><br><span class="line">      <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br></pre>

<h4 id="容器探测"><a href="#容器探测" class="headerlink" title="容器探测"></a>容器探测</h4><p>liveness probes:存活性探针，检测应用实例是否处于正常运行状态<br>readiness probes:就绪性探针，检测应用实例是否可以接受请求</p>
<h4 id="pod调度"><a href="#pod调度" class="headerlink" title="pod调度"></a>pod调度</h4><p>kubernetes提供四大类调度方式：</p>
<ul>
<li>自动调度</li>
<li>定向调度:NodeName,NodeSelector</li>
<li>亲和性调度：NodeAffinity,PodAffinity,PodAntAffinity</li>
<li>污点（容忍）调度：Taints,Toleration</li>
</ul>
<p>亲和性调度分为三类：</p>
<ul>
<li>NodeAffinity(node亲和性):以node为目标，将Pod调度到目标node上</li>
<li>PodAffinity(pod亲和性)：以pod为目标，解决pod可以和哪些已存在的pod部署在同一个拓扑域中</li>
<li>PodAntAffinity(pod反亲和性):以pod为目标，解决pod不能和哪些已存在pod部署在同一个拓扑域中的问题</li>
</ul>
<p>亲和性使用场景：<br>亲和性：如果2个应用频繁交互，有必要让2个应用尽可能靠近，减少网络通信带来的性能损耗<br>反亲和性：当应用采用多副本部署时，有必要采用反亲和性让应用实例打散分布在各个node上。可以提供服务的高可用性</p>
<h4 id="Pod控制器"><a href="#Pod控制器" class="headerlink" title="Pod控制器"></a>Pod控制器</h4><p>常见的pod控制器：</p>
<ul>
<li>ReplicationController:比较原始的pod控制器</li>
<li>ReplicaSet: 保证指定数量的pod运行，并支持pod数量变更，镜像版本变更</li>
<li>Deployment:通过控制ReplicaSet来控制pod，并支持滚动升级，版本回退</li>
<li>Horizontal Pod Autoscaler:可以根据集群负载自动调整pod数量，实现削峰填谷</li>
<li>DaemonSet: 在集群中指定NODE上都运行一个副本，一般用于守护进程类的任务</li>
<li>job: 它创建出来的pod只要完成任务就立即退出，用于执行一次性任务</li>
<li>Cronjob:它创建的pod会周期性的执行，用于执行周期性任务</li>
<li>StatefulSet:管理有状态应用</li>
</ul>
<h5 id="ReplicaSet-rs"><a href="#ReplicaSet-rs" class="headerlink" title="ReplicaSet(rs)"></a>ReplicaSet(rs)</h5><p>保证一定数量的pod能正常运行，一旦pod发生故障就会重启或重建</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>  <span class="comment">#版本号</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span>  <span class="comment">#类型</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span></span><br><span class="line">  <span class="string">namespace</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">rs</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span> <span class="comment">#副本数量</span></span><br><span class="line">  <span class="attr">selector:</span>   <span class="comment">#选择器，通过它指定该控制器管理哪些pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>   <span class="comment">#labels匹配规则</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">matchExpressions:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">nginx-pod</span>]&#125;</span><br><span class="line">  <span class="attr">template:</span> <span class="comment">#模板，当副本数量不足时，会根据下面的模板创建pod副本</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre>

<h5 id="Deployment-deploy"><a href="#Deployment-deploy" class="headerlink" title="Deployment(deploy)"></a>Deployment(deploy)</h5><p>通过管理ReplicaSet来间接管理pod，功能更强大，主要功能：</p>
<ul>
<li>支持ReplicaSet所有功能</li>
<li>支持发布的停止&#x2F;继续</li>
<li>支持版本滚动更新和版本回退</li>
</ul>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>  <span class="comment">#版本号</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>  <span class="comment">#类型</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span></span><br><span class="line">  <span class="attr">namespace:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span> <span class="comment">#副本数量</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">3</span>  <span class="comment">#保留历史版本,默认是10</span></span><br><span class="line">  <span class="attr">paused:</span> <span class="literal">false</span>  <span class="comment">#暂停部署，默认是false</span></span><br><span class="line">  <span class="attr">progressDeadlineSecond:</span> <span class="number">600</span>  <span class="comment">#部署超时时间，默认600</span></span><br><span class="line">  <span class="attr">strategy:</span>  <span class="comment">#策略 Recreate 重建更新  RollingUpdate 滚动更新</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span>   <span class="comment">#滚动更新策略</span></span><br><span class="line">    <span class="attr">RollingUpdate:</span>  <span class="comment">#滚动更新</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">30</span><span class="string">%</span>  <span class="comment">#最大额外可以存在的副本数，可以为百分比或整数</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">30</span><span class="string">%</span>  <span class="comment">#最大不可用状态的pod最大值,可以为百分比或整数</span></span><br><span class="line">  <span class="attr">selector:</span>   <span class="comment">#选择器，通过它指定该控制器管理哪些pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>   <span class="comment">#labels匹配规则</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">matchExpressions:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">nginx-pod</span>]&#125;</span><br><span class="line">  <span class="attr">template:</span> <span class="comment">#模板，当副本数量不足时，会根据下面的模板创建pod副本</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre>

<p>kubectl rollout:版本升级相关功能：</p>
<ul>
<li>status：显示当前升级状态</li>
<li>history：显示升级历史记录</li>
<li>pause：暂停版本升级过程</li>
<li>resume：继续已经暂停的版本升级过程</li>
<li>restart：重启版本升级过程</li>
<li>undo：回滚到上一级版本（可以使用–to-revision回滚到指定版本）</li>
</ul>
<h6 id="金丝雀发布"><a href="#金丝雀发布" class="headerlink" title="金丝雀发布"></a>金丝雀发布</h6><p>deploy支持更新过程中的控制，如暂停和继续更新操作<br>比如有一批新的pod资源创建完成后立即暂停更新过程，此时仅存在一部分新版本的应用，主体部分还是旧版本。然后筛选一小部分用户请求路由到新的pod应用，继续观察能否稳定运行。确定没问题后在继续完成余下的pod滚动更新，否则立即回滚更新操作。这就是金丝雀发布</p>
<pre class="highlight"><span class="line">kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deploy pc-deployment -n dev</span><br></pre>

<h5 id="Horizontal-Pod-Autoscaler"><a href="#Horizontal-Pod-Autoscaler" class="headerlink" title="Horizontal Pod Autoscaler"></a>Horizontal Pod Autoscaler</h5><p>HPA可以获取每个pod的利用率，然后和定义的指标进行对比，最后实现pod的数量调整</p>
<p><code>metrics-server可以用来收集集群中资源使用情况</code></p>
<p>部署HPA</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-hpa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">1</span>  <span class="comment">#最小pod数量</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span> <span class="comment">#最大pod数量</span></span><br><span class="line">  <span class="attr">targetCPUUtilizationPercentage:</span> <span class="number">3</span>   <span class="comment">#cpu使用率指标</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span>   <span class="comment">#指定要控制的nginx信息</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre>

<h5 id="job"><a href="#job" class="headerlink" title="job"></a>job</h5><p>job主要负责批量处理短暂的一次性任务，job特点：</p>
<ul>
<li>当job创建的pod执行成功时，job将记录成功结束的pod数量</li>
<li>当成功结束的pod到达指定的数量，job将完成执行</li>
</ul>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span></span><br><span class="line">  <span class="attr">namespace:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">job</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">completions:</span> <span class="number">1</span> <span class="comment">#指定job需要成功运行pods的次数，默认1</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">1</span> <span class="comment">#指定job在任一时刻应该并发运行的pods数量，默认1</span></span><br><span class="line">  <span class="attr">activeDeadlineSecond:</span> <span class="number">30</span> <span class="comment">#指定job可运行的时间期限，超过时间还未结束，系统会尝试终止</span></span><br><span class="line">  <span class="attr">backoffLimit:</span> <span class="number">6</span>  <span class="comment">#指定job失败后进行重试的次数，默认6</span></span><br><span class="line">  <span class="attr">manualSelector:</span> <span class="literal">true</span>  <span class="comment"># 是否可以使用selector选择器选择pod,默认false</span></span><br><span class="line">  <span class="attr">selector:</span>  </span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">    <span class="attr">matchExpressions:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">counter-pod</span>]&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span> <span class="comment">#重启策略只能设置为Never或OnFailure</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">counter</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br></pre>

<h5 id="CronJob-cj"><a href="#CronJob-cj" class="headerlink" title="CronJob(cj)"></a>CronJob(cj)</h5><p>CronJob以job控制器为其管控对象，并借助它管理pod资源对象，CronJob可以在特点时间点反复运行job任务</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span></span><br><span class="line">  <span class="attr">namespace:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">cronjob</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span>      <span class="comment">#crom格式的作业调度运行时间点</span></span><br><span class="line">  <span class="attr">concurrencyPolicy:</span>  <span class="comment">#并发执行策略，用于定义前一次作业运行尚未完成时是否以及如何运行后一次作业  Allow 允许jobs并发运行（默认） Forbid 禁止并发运行，上一次尚未完成，则跳过下一次运行   Replace 替换，取消当前作业并用新作业替换它</span></span><br><span class="line">  <span class="attr">failedJobHistoryLimit:</span>  <span class="comment">#为失败的任务执行保留的历史记录数，默认1</span></span><br><span class="line">  <span class="attr">successfulJobHistoryLimit:</span>  <span class="comment">#为成功的任务执行保留的历史记录数，默认3</span></span><br><span class="line">  <span class="attr">startingDeadlineSecond:</span> <span class="comment">#启动作业错误的超时时长</span></span><br><span class="line">  <span class="attr">jobTemplate:</span>  <span class="comment">#job控制器</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">completions:</span> <span class="number">1</span> <span class="comment">#指定job需要成功运行pods的次数，默认1</span></span><br><span class="line">      <span class="attr">parallelism:</span> <span class="number">1</span> <span class="comment">#指定job在任一时刻应该并发运行的pods数量，默认1</span></span><br><span class="line">      <span class="attr">activeDeadlineSecond:</span> <span class="number">30</span> <span class="comment">#指定job可运行的时间期限，超过时间还未结束，系统会尝试终止</span></span><br><span class="line">      <span class="attr">backoffLimit:</span> <span class="number">6</span>  <span class="comment">#指定job失败后进行重试的次数，默认6</span></span><br><span class="line">      <span class="attr">manualSelector:</span> <span class="literal">true</span>  <span class="comment"># 是否可以使用selector选择器选择pod,默认false</span></span><br><span class="line">      <span class="attr">selector:</span>  </span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">        <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">counter-pod</span>]&#125;</span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">metadata:</span></span><br><span class="line">          <span class="attr">labels:</span></span><br><span class="line">            <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span> <span class="comment">#重启策略只能设置为Never或OnFailure</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">counter</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br></pre>

<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>service很多情况下只是一个概念，真正起作用的是kube-proxy,kube-proxy会将最新的service信息转换成对应的访问规则</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span></span><br><span class="line">  <span class="attr">namespace:</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span>   <span class="comment">#确定当前service代理哪些pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">type:</span>  <span class="comment">#service类型</span></span><br><span class="line">  <span class="attr">clusterIP:</span>  <span class="comment">#虚拟服务的ip地址</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span>  <span class="comment">#session亲和性，支持clusterIP/None2个选项</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3017</span>        <span class="comment">#service端口</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5003</span>  <span class="comment">#pod端口</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31122</span>   <span class="comment">#主机端口</span></span><br></pre>

<p>service类型</p>
<ul>
<li>clusterIP：默认值，k8s系统自动分配的虚拟IP，只能在集群内部访问</li>
<li>HeadLiness:这类service不会分配ClusterIP，如果想要访问service,只能通过service的域名进行查询</li>
<li>NodePort: 将service通过指定node上的端口暴露给外部</li>
<li>LoadBalancer: 使用外接负载均衡器(集群外)完成服务的负载分发，此模式需要外部云环境支持</li>
<li>ExternalName: 把集群外部的服务引入集群内部，直接使用</li>
</ul>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">service-clusterip</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.97</span><span class="number">.97</span><span class="number">.97</span>   <span class="comment">#service的ip地址，设为None可以启动HeadLinessService</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre>

<p>查看ipvs的映射规则<br>ipvsadm -Ln</p>
<h4 id="NodePort类型的Service"><a href="#NodePort类型的Service" class="headerlink" title="NodePort类型的Service"></a>NodePort类型的Service</h4><p>NodePort工作原理就是将service的端口映射到Node的一个端口上，通过NodeIp:NodePort来访问service</p>
<h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><p>Volume是pod中能够被多个容器访问的共享目录，它被定义在Pod上，然后被一个pod的多个容器挂载到具体文件目录下，Volume支持多种类型：</p>
<ul>
<li>简单存储：EmptyDir&#x2F;HostPath&#x2F;NFS</li>
<li>高级存储：PV&#x2F;PVC</li>
<li>配置存储：ConfigMap&#x2F;Secret</li>
</ul>
<h4 id="简单存储"><a href="#简单存储" class="headerlink" title="简单存储"></a>简单存储</h4><h5 id="EmptyDir"><a href="#EmptyDir" class="headerlink" title="EmptyDir"></a>EmptyDir</h5><p>EmptyDir就是宿主机上的空目录，当pod被分配到Node时创建，当pod销毁，EmptyDir中的数据也会被永久删除，它的用途：</p>
<ul>
<li>临时空间，某应用程序运行时的临时目录</li>
<li>一个容器需要从另一个容器获取数据（同一个pod多容器共享目录）</li>
</ul>
<h5 id="HostPath"><a href="#HostPath" class="headerlink" title="HostPath"></a>HostPath</h5><p>HostPath将node主机中实际的目录挂在Pod中，这样pod销毁了，数据依据可以存在主机上</p>
<h5 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h5><p>HostPath可以解决数据持久化的问题，但一旦node节点故障了，pod如果转移到别的节点，又会出现问题，此时需要单独的网络存储系统，比较常用的NFS&#x2F;CIFS</p>
<h4 id="高级存储"><a href="#高级存储" class="headerlink" title="高级存储"></a>高级存储</h4><p>存储系统有很多，要求用户全部掌握不现实，为了屏蔽底层实现，k8s引入PV和PVC2种资源对象</p>
<p>PV（Persistent Volume）是对底层共享的抽象</p>
<p>PVC（Persistent Volume Claim）持久化卷声明，用户对存储需求的声明，即用户向系统发起资源需求申请</p>
<h5 id="PV"><a href="#PV" class="headerlink" title="PV"></a>PV</h5><p>PV是存储资源的抽象</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span>   <span class="comment">#存储类型，与底层存储对应</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">  	<span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span>	  <span class="comment">#访问模式</span></span><br><span class="line">  <span class="attr">storageClassName:</span>   <span class="comment">#存储类型</span></span><br><span class="line">  <span class="attr">PersistentVolumeReclaimPolicy:</span>  <span class="comment">#回收策略</span></span><br></pre>

<h5 id="PVC"><a href="#PVC" class="headerlink" title="PVC"></a>PVC</h5><p>PVC是资源的申请，用来声明对存储空间&#x2F;访问方式&#x2F;存储类别需求信息</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span>	  <span class="comment">#访问模式</span></span><br><span class="line">  <span class="attr">storageClassName:</span>   <span class="comment">#存储类型</span></span><br><span class="line">  <span class="attr">selector:</span>    <span class="comment">#采用标签对PV选择</span></span><br><span class="line">  <span class="attr">resources:</span>   <span class="comment">#请求空间</span></span><br><span class="line">  	<span class="attr">requests:</span></span><br><span class="line">  	  <span class="attr">storage:</span> <span class="string">5Gi</span></span><br></pre>

<h5 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h5><p>ConfigMap主要用来存储配置信息</p>
<pre class="highlight"><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">info:</span></span><br><span class="line">  	<span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">  	<span class="attr">password:</span> <span class="number">123456</span></span><br></pre>

<h5 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h5><p>Secret主要用来存储敏感信息，例如：密码&#x2F;密匙&#x2F;证书</p>

  </div>
  <div>
    
      <div 
        class="post-note note-warning copyright" 
        style="margin-top: 42px">
        <p>
          <span style="font-weight: bold;">作者：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="/java4u/about">
            Zhao Xin
          </a>
        </p>
        <p>
          <span style="font-weight: bold;">文章链接：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="https://zxtc123.github.io/java4u/2022/09/07/kubernetes/">
            https://zxtc123.github.io/java4u/2022/09/07/kubernetes/
          </a>
        </p>
        <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
      </div>
    
  </div>
</article>
<div class="nav">
  
    <div class="nav-item-prev">
      <a 
        href="/java4u/2022/09/07/docker/" 
        class="nav-link">
        <i class="iconfont icon-left nav-prev-icon"></i>
        <div>
          <div class="nav-label">上一篇</div>
          
            <div class="nav-title">docker </div>
          
        </div>
      </a>
    </div>
  
  
    <div class="nav-item-next">
      <a 
        href="/java4u/2022/08/12/Reactor%203%20Guide/" 
        class="nav-link">
        <div>
          <div class="nav-label">下一篇</div>
          
            <div class="nav-title">Reactor 3 Guide </div>
          
        </div>
        <i class="iconfont icon-right nav-next-icon"></i>
      </a>
    </div>
  
</div>

<div 
  class="card card-content toc-card" 
  id="mobiletoc">
  <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#kubernetes%E4%BB%8B%E7%BB%8D"><span class="toc-text">kubernetes介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes%E7%BB%84%E4%BB%B6"><span class="toc-text">kubernetes组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes%E6%A6%82%E5%BF%B5"><span class="toc-text">kubernetes概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pod"><span class="toc-text">Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">pod生命周期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%8E%A2%E6%B5%8B"><span class="toc-text">容器探测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pod%E8%B0%83%E5%BA%A6"><span class="toc-text">pod调度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pod%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">Pod控制器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ReplicaSet-rs"><span class="toc-text">ReplicaSet(rs)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Deployment-deploy"><span class="toc-text">Deployment(deploy)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83"><span class="toc-text">金丝雀发布</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Horizontal-Pod-Autoscaler"><span class="toc-text">Horizontal Pod Autoscaler</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#job"><span class="toc-text">job</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CronJob-cj"><span class="toc-text">CronJob(cj)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NodePort%E7%B1%BB%E5%9E%8B%E7%9A%84Service"><span class="toc-text">NodePort类型的Service</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-text">数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%AD%98%E5%82%A8"><span class="toc-text">简单存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#EmptyDir"><span class="toc-text">EmptyDir</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HostPath"><span class="toc-text">HostPath</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NFS"><span class="toc-text">NFS</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%AD%98%E5%82%A8"><span class="toc-text">高级存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PV"><span class="toc-text">PV</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PVC"><span class="toc-text">PVC</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigMap"><span class="toc-text">ConfigMap</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Secret"><span class="toc-text">Secret</span></a></li></ol></li></ol></li></ol></li></ol>
</div></main>
            <aside class="left-column">
              
              <div class="card card-author">
                
  <img 
    src="/java4u/img/1.e3a1f41f.gif" 
    class="author-img"
    width="88"
    height="88"
    alt="author avatar">

<p class="author-name">Zhao Xin</p>
<p class="author-description">5年工作经验，不秃头的java萌新。</p>
<div class="author-message">
  <a 
    class="author-posts-count" 
    href="/java4u/archives">
    <span>118</span>
    <span>文章</span>
  </a>
  <a 
    class="author-categories-count" 
    href="/java4u/categories">
    <span>28</span>
    <span>分类</span>
  </a>
  <a 
    class="author-tags-count" 
    href="/java4u/tags">
    <span>37</span>
    <span>标签</span>
  </a>
</div>

              </div>
               <div class="sticky-tablet">
  
  
    <article class="display-when-two-columns spacer">
      <div class="card card-content toc-card">
        <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#kubernetes%E4%BB%8B%E7%BB%8D"><span class="toc-text">kubernetes介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes%E7%BB%84%E4%BB%B6"><span class="toc-text">kubernetes组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes%E6%A6%82%E5%BF%B5"><span class="toc-text">kubernetes概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pod"><span class="toc-text">Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">pod生命周期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%8E%A2%E6%B5%8B"><span class="toc-text">容器探测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pod%E8%B0%83%E5%BA%A6"><span class="toc-text">pod调度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pod%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">Pod控制器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ReplicaSet-rs"><span class="toc-text">ReplicaSet(rs)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Deployment-deploy"><span class="toc-text">Deployment(deploy)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83"><span class="toc-text">金丝雀发布</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Horizontal-Pod-Autoscaler"><span class="toc-text">Horizontal Pod Autoscaler</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#job"><span class="toc-text">job</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CronJob-cj"><span class="toc-text">CronJob(cj)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NodePort%E7%B1%BB%E5%9E%8B%E7%9A%84Service"><span class="toc-text">NodePort类型的Service</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-text">数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%AD%98%E5%82%A8"><span class="toc-text">简单存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#EmptyDir"><span class="toc-text">EmptyDir</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HostPath"><span class="toc-text">HostPath</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NFS"><span class="toc-text">NFS</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%AD%98%E5%82%A8"><span class="toc-text">高级存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PV"><span class="toc-text">PV</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PVC"><span class="toc-text">PVC</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigMap"><span class="toc-text">ConfigMap</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Secret"><span class="toc-text">Secret</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
    </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header">
    <i 
      class="iconfont icon-fenlei" 
      style="padding-right: 2px;">
    </i>分类
  </div>
  <div class="categories-list">
    
      <a href="/java4u/categories/%E6%A1%86%E6%9E%B6/">
        <div class="categories-list-item">
          框架
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">
        <div class="categories-list-item">
          编程语言
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/AI/">
        <div class="categories-list-item">
          AI
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">
        <div class="categories-list-item">
          数据结构与算法
          <span class="categories-list-item-badge">55</span>
        </div>
      </a>
    
      <a href="/java4u/categories/linux/">
        <div class="categories-list-item">
          linux
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E7%BD%91%E7%BB%9C/">
        <div class="categories-list-item">
          网络
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E7%BA%BF%E7%A8%8B%E6%B1%A0/">
        <div class="categories-list-item">
          线程池
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/webservice/">
        <div class="categories-list-item">
          webservice
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E5%8A%A0%E5%AF%86%E8%A7%A3%E7%A0%81/">
        <div class="categories-list-item">
          加密解码
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E9%9D%A2%E8%AF%95/">
        <div class="categories-list-item">
          面试
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/java4u/categories/security/">
        <div class="categories-list-item">
          security
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">
        <div class="categories-list-item">
          分布式
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E6%96%B9%E6%A1%88/">
        <div class="categories-list-item">
          方案
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/java4u/categories/JVM/">
        <div class="categories-list-item">
          JVM
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/SQL/">
        <div class="categories-list-item">
          SQL
          <span class="categories-list-item-badge">20</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E8%B0%83%E4%BC%98/">
        <div class="categories-list-item">
          调优
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">
        <div class="categories-list-item">
          中间件
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E6%96%87%E6%A1%A3%E6%80%BB%E7%BB%93/">
        <div class="categories-list-item">
          文档总结
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E5%AE%B9%E5%99%A8/">
        <div class="categories-list-item">
          容器
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E8%A7%84%E8%8C%83/">
        <div class="categories-list-item">
          规范
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E8%AF%AD%E8%A8%80/">
        <div class="categories-list-item">
          语言
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B/">
        <div class="categories-list-item">
          项目流程
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E4%BA%8B%E5%8A%A1/">
        <div class="categories-list-item">
          事务
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E7%BC%93%E5%AD%98/">
        <div class="categories-list-item">
          缓存
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">
        <div class="categories-list-item">
          数据库
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/">
        <div class="categories-list-item">
          微服务保护
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E8%BF%9B%E7%A8%8B/">
        <div class="categories-list-item">
          进程
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/java4u/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2/">
        <div class="categories-list-item">
          分布式搜索
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header">
    <i 
      class="iconfont icon-biaoqian" 
      style="padding-right: 2px;">
    </i>热门标签
  </div>
  <div class="tags-list">
    
      <a 
        href="/java4u/tags/%E5%AD%A6%E4%B9%A0/" 
        title="学习">
        <div class="tags-list-item">学习</div>
      </a>
    
      <a 
        href="/java4u/tags/leetcode/" 
        title="leetcode">
        <div class="tags-list-item">leetcode</div>
      </a>
    
      <a 
        href="/java4u/tags/%E6%95%B0%E7%BB%84/" 
        title="数组">
        <div class="tags-list-item">数组</div>
      </a>
    
      <a 
        href="/java4u/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" 
        title="二叉树">
        <div class="tags-list-item">二叉树</div>
      </a>
    
      <a 
        href="/java4u/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" 
        title="字符串">
        <div class="tags-list-item">字符串</div>
      </a>
    
      <a 
        href="/java4u/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" 
        title="动态规划">
        <div class="tags-list-item">动态规划</div>
      </a>
    
      <a 
        href="/java4u/tags/%E9%93%BE%E8%A1%A8/" 
        title="链表">
        <div class="tags-list-item">链表</div>
      </a>
    
      <a 
        href="/java4u/tags/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/" 
        title="滑动窗口">
        <div class="tags-list-item">滑动窗口</div>
      </a>
    
      <a 
        href="/java4u/tags/TPC-IP/" 
        title="TPC/IP">
        <div class="tags-list-item">TPC/IP</div>
      </a>
    
      <a 
        href="/java4u/tags/WSDL/" 
        title="WSDL">
        <div class="tags-list-item">WSDL</div>
      </a>
    
      <a 
        href="/java4u/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/" 
        title="位运算">
        <div class="tags-list-item">位运算</div>
      </a>
    
      <a 
        href="/java4u/tags/%E4%BA%8C%E5%88%86%E6%B3%95/" 
        title="二分法">
        <div class="tags-list-item">二分法</div>
      </a>
    
      <a 
        href="/java4u/tags/%E5%9B%9E%E6%BA%AF/" 
        title="回溯">
        <div class="tags-list-item">回溯</div>
      </a>
    
      <a 
        href="/java4u/tags/OAuth/" 
        title="OAuth">
        <div class="tags-list-item">OAuth</div>
      </a>
    
      <a 
        href="/java4u/tags/%E6%BA%90%E7%A0%81/" 
        title="源码">
        <div class="tags-list-item">源码</div>
      </a>
    
      <a 
        href="/java4u/tags/RPC/" 
        title="RPC">
        <div class="tags-list-item">RPC</div>
      </a>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
            <aside class="right-column">
              <div class="sticky-widescreen">
  
  
    <article class="card card-content toc-card">
      <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#kubernetes%E4%BB%8B%E7%BB%8D"><span class="toc-text">kubernetes介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes%E7%BB%84%E4%BB%B6"><span class="toc-text">kubernetes组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes%E6%A6%82%E5%BF%B5"><span class="toc-text">kubernetes概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pod"><span class="toc-text">Pod</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">pod生命周期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%8E%A2%E6%B5%8B"><span class="toc-text">容器探测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pod%E8%B0%83%E5%BA%A6"><span class="toc-text">pod调度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pod%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">Pod控制器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ReplicaSet-rs"><span class="toc-text">ReplicaSet(rs)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Deployment-deploy"><span class="toc-text">Deployment(deploy)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83"><span class="toc-text">金丝雀发布</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Horizontal-Pod-Autoscaler"><span class="toc-text">Horizontal Pod Autoscaler</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#job"><span class="toc-text">job</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CronJob-cj"><span class="toc-text">CronJob(cj)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NodePort%E7%B1%BB%E5%9E%8B%E7%9A%84Service"><span class="toc-text">NodePort类型的Service</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-text">数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%AD%98%E5%82%A8"><span class="toc-text">简单存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#EmptyDir"><span class="toc-text">EmptyDir</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HostPath"><span class="toc-text">HostPath</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NFS"><span class="toc-text">NFS</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%AD%98%E5%82%A8"><span class="toc-text">高级存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PV"><span class="toc-text">PV</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PVC"><span class="toc-text">PVC</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigMap"><span class="toc-text">ConfigMap</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Secret"><span class="toc-text">Secret</span></a></li></ol></li></ol></li></ol></li></ol>
    </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header">
    <i 
      class="iconfont icon-wenzhang_huaban" 
      style="padding-right: 2px;">
    </i>最近文章
  </div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2023-05-16</div>
        <a href="/java4u/2023/05/16/RUST%E5%85%A5%E9%97%A8/"><div class="recent-posts-item-content">RUST入门</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2023-04-25</div>
        <a href="/java4u/2023/04/25/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%85%A5%E9%97%A8/"><div class="recent-posts-item-content">人工智能入门</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2023-02-01</div>
        <a href="/java4u/2023/02/01/linux%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3/"><div class="recent-posts-item-content">linux深入了解</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2023-01-22</div>
        <a href="/java4u/2023/01/22/FastAPI/"><div class="recent-posts-item-content">FastAPI</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
          </div>
        </div>
      </div>
    </div>
     
    <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>
          Copyright ©
          
            2020
          
          
                - 
                2023
          
        </span>
        &nbsp;
        <a 
          href="/java4u/" 
          class="footer-link">
          Snail
        </a>
      </div>
    </div>

    
      <div class="footer-dsc">
        
          Powered by
          <a 
            href="https://hexo.io/" 
            class="footer-link" 
            target="_blank" 
            rel="nofollow noopener noreferrer">
            &nbsp;Hexo
          </a>
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          Theme -
          <a 
            href="https://github.com/theme-kaze" 
            class="footer-link" 
            target="_blank"
            rel="nofollow noopener noreferrer">
            &nbsp;Kaze
          </a>
        
      </div>
    
    
    
    
</footer>
 
    
  <a 
    role="button" 
    id="scrollbutton" 
    class="basebutton" 
    aria-label="回到顶部">
    <i class="iconfont icon-arrowleft button-icon"></i>
  </a>

<a 
  role="button" 
  id="menubutton"
  aria-label="menu button"
  class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a 
  role="button" 
  id="popbutton" 
  class="basebutton" 
  aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a 
  role="button" 
  id="darkbutton" 
  class="basebutton darkwidget" 
  aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a 
  role="button" 
  id="searchbutton" 
  class="basebutton searchwidget" 
  aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a> 
     
     
     
      <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img')
    var i
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a')
      wrapper.setAttribute('href', img[i].getAttribute('data-src'))
      wrapper.setAttribute('aria-label', 'illustration')
      wrapper.style.cssText =
        'width: 100%; display: flex; justify-content: center;'
      if (img[i].alt) wrapper.dataset.caption = img[i].alt
      wrapper.dataset.nolink = true
      img[i].before(wrapper)
      wrapper.append(img[i])
      var divWrap = document.createElement('div')
      divWrap.classList.add('gallery')
      wrapper.before(divWrap)
      divWrap.append(wrapper)
    }
    baguetteBox.run('.gallery')
  }
</script>
<script>
  loadScript(
    "/java4u/js/lib/lightbox/baguetteBox.min.js",
    addImgLayout
  )
</script>
 
     
     
    <script src="/java4u/js/main.js"></script> 
     
    
      <script>
        var addLazyload = function () {
          var observer = lozad('.lozad', {
            load: function (el) {
              el.srcset = el.getAttribute('data-src')
            },
            loaded: function (el) {
              el.classList.add('loaded')
            },
          })
          observer.observe()
        }
      </script>
      <script>
        loadScript('/java4u/js/lib/lozad.min.js', addLazyload)
      </script>
     
    
    
      <script>
        setTimeout(() => {localSearch("search.json")}, 0)
      </script>
    
  </body>
</html>
