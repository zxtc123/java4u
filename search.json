[{"title":"RUSTå…¥é—¨ï¼ˆäºŒï¼‰","url":"/java4u/2023/06/04/RUST%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89/","content":"RUSTå…¥é—¨ï¼ˆäºŒï¼‰1. é—­åŒ…ä»€ä¹ˆæ˜¯é—­åŒ…\n\næ˜¯åŒ¿åå‡½æ•°\nä¿å­˜ä¸ºå˜é‡&#x2F;ä½œä¸ºå‚æ•°\nå¯åœ¨ä¸€ä¸ªåœ°æ–¹åˆ›å»ºé—­åŒ…ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è°ƒç”¨é—­åŒ…æ¥å®Œæˆè¿ç®—\nå¯ä»å…¶å®šä¹‰çš„ä½œç”¨åŸŸæ•è·å€¼\n\nfn generate_workout(intensity: u32, random_number: u32) &#123;    let expensive_closure = |num| &#123;        println!(&quot;calculating slowly ...&quot;);        thread::sleep(Duration::from_secs(2));        num    &#125;;    if intensity &lt; 25 &#123;        println!(&quot;Today, do &#123;&#125; pushups!&quot;, expensive_closure(intensity));        println!(&quot;Next, do &#123;&#125; situps!&quot;, expensive_closure(intensity));    &#125;else &#123;        if random_number == 3 &#123;            println!(&quot;Take a break today! Remember to stay hydrated!&quot;);        &#125;else &#123;            println!(&quot;Today, run for &#123;&#125; minutes!&quot;, expensive_closure(intensity));        &#125;    &#125;&#125;\n\né—­åŒ…çš„å®šä¹‰æœ€ç»ˆåªä¼šä¸ºå‚æ•°&#x2F;è¿”å›å€¼æ¨æ–­å‡ºå”¯ä¸€å…·ä½“çš„ç±»å‹\nä¸ºäº†ä½¿é—­åŒ…åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªstructï¼Œå®ƒæŒæœ‰é—­åŒ…åŠå…¶è°ƒç”¨ç»“æœã€‚åªä¼šåœ¨éœ€è¦ç»“æœæ—¶æ‰æ‰§è¡Œè¯¥é—­åŒ…ï¼›å¯ç¼“å­˜ç»“æœ\n// Tå°±æ˜¯é—­åŒ…çš„ç±»å‹struct Cacher&lt;T&gt;where T: Fn(u32) -&gt; u32&#123;    calculation: T,    value: Option&lt;u32&gt;,&#125;impl&lt;T&gt; Cacher&lt;T&gt; where T: Fn(u32) -&gt; u32,&#123;    fn new(calculation: T) -&gt; Cacher&lt;T&gt; &#123;        Cacher &#123;            calculation,            value: None,        &#125;    &#125;    // valueä¸ä¸ºNoneï¼Œç›´æ¥è¿”å›valueçš„å€¼    // valueä¸ºNone,è®¡ç®—valueçš„å€¼è¿”å›    fn value(&amp;mut self, arg: u32) -&gt; u32 &#123;        match self.value &#123;            Some(v) =&gt; v,            None =&gt; &#123;                let v = (self.calculation)(arg);                self.value = Some(v);                v            &#125;        &#125;    &#125;&#125;\n\né—­åŒ…å¯ä»¥æ•è·ä»–ä»¬æ‰€åœ¨çš„ç¯å¢ƒï¼š\n\né—­åŒ…å¯ä»¥è®¿é—®å®šä¹‰å®ƒä½œç”¨åŸŸå†…çš„å˜é‡ï¼Œè€Œæ™®é€šå‡½æ•°åˆ™ä¸èƒ½\nä¼šäº§ç”Ÿå†…å­˜å¼€é”€\nå–å¾—æ‰€æœ‰æƒ FnOnce\nå¯å˜å€Ÿç”¨ FnMut\nä¸å¯å˜å€Ÿç”¨ Fn\n\n2. è¿­ä»£å™¨å‡ ä¸ªè¿­ä»£æ–¹æ³•\n\niter åœ¨ä¸å¯å˜å¼•ç”¨ä¸Šåˆ›å»ºè¿­ä»£å™¨\ninto_iter åˆ›å»ºçš„è¿­ä»£å™¨ä¼šè·å¾—æ‰€æœ‰æƒ\niter_mut è¿­ä»£å¯å˜çš„å¼•ç”¨\n\nè¿­ä»£å™¨é€‚é…å™¨ï¼šæŠŠè¿­ä»£å™¨è½¬æ¢ä¸ºä¸åŒç§ç±»çš„è¿­ä»£å™¨\nlet v1 = vec![1,2,3];let v2: Vec&lt;_&gt; =v1.iter().map(|x| x+1).collect();assert_eq!(vec![2,3,4], v2);\n\nä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ\nfn shoes_in_my_size(shoes: Vec&lt;Shoe&gt;, shoe_size: u32) -&gt; Vec&lt;Shoe&gt; &#123;    shoes.into_iter().filter(|x| x.size == shoe_size).collect()&#125;\n\n3. æ™ºèƒ½æŒ‡é’ˆåˆ©ç”¨ç±»æ¥ç®¡ç†èµ„æºï¼Œå°†èµ„æºä¸ç±»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œå³åœ¨å¯¹è±¡åˆ›å»ºæ—¶è·å–å¯¹åº”çš„èµ„æºï¼Œåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå†…æ§åˆ¶å¯¹èµ„æºçš„è®¿é—®ï¼Œä½¿ä¹‹å§‹ç»ˆä¿æŒæœ‰æ•ˆï¼Œæœ€ååœ¨å¯¹è±¡ææ„æ—¶ï¼Œé‡Šæ”¾æ‰€è·å–çš„èµ„æº\nå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆé€šè¿‡è®°å½•æ‰€æœ‰è€…çš„æ•°é‡ï¼Œä½¿ä¸€ä»½æ•°æ®è¢«å¤šä¸ªæ‰€æœ‰è€…åŒæ—¶æŒæœ‰ï¼Œå¹¶åœ¨æ²¡æœ‰ä»»ä½•æ‰€æœ‰è€…æ—¶è‡ªåŠ¨æ¸…ç†æ•°æ®\n3.1 ä½¿ç”¨Boxæ¥æŒ‡å‘Heapä¸Šçš„æ•°æ®\nåªæä¾›äº†é—´æ¥å­˜å‚¨å’Œheapå†…å­˜åˆ†é…çš„åŠŸèƒ½\næ²¡æœ‰å…¶ä»–é¢å¤–åŠŸèƒ½\næ²¡æœ‰æ€§èƒ½å¼€é”€\né€‚ç”¨äºéœ€è¦â€œé—´æ¥â€å­˜å‚¨çš„åœºæ™¯ï¼ˆä¾‹å¦‚é“¾è¡¨ï¼‰\nå®ç°äº†Deref Traitå’ŒDrop Trait\n\n3.2 Deref Traitå®ç°Deref Trait ä½¿æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è§£å¼•ç”¨è¿ç®—ç¬¦*çš„è¡Œä¸ºï¼Œé€šè¿‡å®ç°Derefæ™ºèƒ½æŒ‡é’ˆåƒå¸¸è§„å¼•ç”¨ä¸€æ ·æ¥å¤„ç†\nstruct MyBox&lt;T&gt;(T);impl&lt;T&gt; MyBox&lt;T&gt; &#123;    fn new(x: T) -&gt; MyBox&lt;T&gt; &#123;        MyBox(x)    &#125;&#125;impl&lt;T&gt; Deref for MyBox&lt;T&gt; &#123;    type Target = T;    fn deref(&amp;self) -&gt; &amp;T &#123;        &amp;self.0    &#125;&#125;\n\n3.3 Drop Traitå®ç°Drop Traitï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰å½“å€¼å°†è¦ç¦»å¼€ä½œç”¨åŸŸæ—¶å‘ç”Ÿçš„åŠ¨ä½œ\n\nä¾‹å¦‚ï¼šæ–‡ä»¶&#x2F;ç½‘ç»œèµ„æºé‡Šæ”¾\nä»»ä½•ç±»å‹éƒ½å¯ä»¥å®ç°Drop Trait\n\n3.4 Rcreference couting(å¼•ç”¨è®¡æ•°)\nRcé€šè¿‡ä¸å¯å˜å¼•ç”¨ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸åŒéƒ¨åˆ†ä¹‹é—´å…±äº«åªè¯»æ•°æ®\nenum List &#123;    Cons(i32, Rc&lt;List&gt;),    Nil,&#125;use crate::List::&#123;Cons, Nil&#125;;use std::rc::Rc;fn main() &#123;    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));    let b = Cons(3, Rc::clone(&amp;a));    let c = Cons(4, Rc::clone(&amp;a));&#125;\n\n3.5 RefCellå†…éƒ¨å¯å˜æ€§\nç»“åˆ Rc å’Œ RefCell æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…\n#[derive(Debug)]enum List &#123;    Cons(Rc&lt;RefCell&lt;i32&gt;&gt;, Rc&lt;List&gt;),    Nil,&#125;use crate::List::&#123;Cons, Nil&#125;;use std::rc::Rc;use std::cell::RefCell;fn main() &#123;    let value = Rc::new(RefCell::new(5));    let a = Rc::new(Cons(Rc::clone(&amp;value), Rc::new(Nil)));    let b = Cons(Rc::new(RefCell::new(6)), Rc::clone(&amp;a));    let c = Cons(Rc::new(RefCell::new(10)), Rc::clone(&amp;a));    *value.borrow_mut() += 10;    println!(&quot;a after = &#123;:?&#125;&quot;, a);    println!(&quot;b after = &#123;:?&#125;&quot;, b);    println!(&quot;c after = &#123;:?&#125;&quot;, c);&#125;\n\n","categories":["ç¼–ç¨‹è¯­è¨€"],"tags":["å­¦ä¹ "]},{"title":"RUSTå…¥é—¨","url":"/java4u/2023/05/16/RUST%E5%85%A5%E9%97%A8/","content":"RUSTå…¥é—¨1. ç®€ä»‹\nrustæ˜¯ä¸€ç§ä»¤äººå…´å¥‹çš„æ–°ç¼–ç¨‹è¯­éŸ³ï¼Œå®ƒå¯ä»¥è®©æ¯ä¸ªäººç¼–å†™å¯é ä¸”é«˜æ•ˆçš„è½¯ä»¶ã€‚\nå®ƒå¯ä»¥ç”¨æ¥æ›¿æ¢C&#x2F;C++ï¼Œrustå’Œå®ƒä»¬å…·æœ‰ç›¸åŒçš„æ€§èƒ½ï¼Œä½†æ˜¯å¾ˆå¤šå¸¸è§çš„bugåœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥è¢«æ¶ˆç­ã€‚\n\n2. åŸºç¡€å‘½ä»¤# ç¼–è¯‘æ‰§è¡Œcargo run   # æ£€æŸ¥ä»£ç cargo check# ä¸ºå‘å¸ƒæ„å»ºcargo build --release\n\n3. é€šç”¨çš„ç¼–ç¨‹æ¦‚å¿µ3.1 å˜é‡ä¸å¯å˜æ€§shadowing\nå¯ä»¥ä½¿ç”¨ç›¸åŒçš„åå­—å£°æ˜æ–°çš„å˜é‡ï¼Œæ–°çš„å˜é‡å°±ä¼šshadow(éšè—)ä¹‹å‰å£°æ˜çš„åŒåå˜é‡\n3.2 æ•°æ®ç±»å‹ï¼šæ ‡é‡ç±»å‹æ ‡é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„å€¼ï¼Œä¸»è¦æ ‡é‡ç±»å‹ï¼š\n\næ•´æ•°ç±»å‹  Signed i32 Unsigned  u32\næµ®ç‚¹ç±»å‹  f32 å•ç²¾åº¦  f64 åŒç²¾åº¦\nå¸ƒå°”ç±»å‹  true  false\nå­—ç¬¦ç±»å‹  char\n\n3.3 æ•°æ®ç±»å‹ï¼šå¤åˆç±»å‹å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œã€‚rustæä¾›ä¸¤ç§åŸºç¡€çš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆTupleï¼‰ã€æ•°ç»„\nTupletupleå¯ä»¥å°†å¤šä¸ªç±»å‹çš„å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œï¼›tupleé•¿åº¦å›ºå®šï¼Œä¸€æ—¦å£°æ˜æ— æ³•æ”¹å˜\nlet tup: (i32, f64, u8) = (500, 6.4, 1);\n\næ•°ç»„æ•°ç»„å¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œï¼›æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ç±»å‹å¿…é¡»iç›¸åŒï¼›æ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯å›ºå®šçš„ã€‚\næ•°ç»„çš„ç±»å‹è¡¨è¾¾å½¢å¼ï¼š[ç±»å‹ï¼›é•¿åº¦]\nlet a: [i32;5]=[1,2,3,4,5];\n\n3.4 å‡½æ•°å‡½æ•°ç­¾åé‡Œï¼Œå¿…é¡»å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹ã€‚\nåœ¨ -&gt;ç¬¦å·åé¢å£°æ˜å‡½æ•°è¿”å›å€¼çš„ç±»å‹ï¼Œä½†ä¸å¯ä»¥ä¸ºè¿”å›å€¼å‘½åã€‚\nåœ¨rusté‡Œé¢ï¼Œè¿”å›å€¼å°±æ˜¯å‡½æ•°é‡Œé¢æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚\n3.5 æ§åˆ¶æµå¦‚æœä½¿ç”¨å¤šäºä¸€ä¸ªelse if,é‚£ä¹ˆæœ€å¥½ä½¿ç”¨matchæ¥é‡æ„ä»£ç ã€‚\nå› ä¸ºifæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ‰€æœ‰å¯ä»¥å°†å®ƒæ”¾åœ¨letè¯­å¥ä¸­ç­‰å·çš„å³è¾¹\n3.6 æ§åˆ¶æµï¼šå¾ªç¯rustæä¾›3ç§å¾ªç¯ï¼šloop,while,for\n\nloopå‘Šè¯‰ruståå¤æ‰§è¡Œä¸€å—ä»£ç ï¼Œç›´åˆ°å–Šåœ\nwhileå¾ªç¯æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“ä¹‹å‰éƒ½åˆ¤æ–­ä¸€æ¬¡æ¡ä»¶\n\n4. æ‰€æœ‰æƒ4.1 stack vs heapå­˜å‚¨æ•°æ®\n\næŠŠå€¼å‹åˆ°stackä¸Šä¸å«åˆ†é…ï¼Œå› ä¸ºæŒ‡é’ˆæ˜¯å·²çŸ¥å›ºå®šå¤§å°çš„ï¼Œå¯ä»¥æŠŠæŒ‡é’ˆå­˜æ”¾åœ¨stackä¸Šï¼ˆå¦‚æœæƒ³è¦å®é™…æ•°æ®ï¼Œå¿…é¡»ä½¿ç”¨æŒ‡é’ˆæ¥å®šä½ï¼‰\næŠŠæ•°æ®å‹åˆ°stackä¸Šæ¯”heapä¸Šåˆ†é…å¿«çš„å¤šï¼ˆæ“ä½œç³»ç»Ÿä¸éœ€è¦å¯»æ‰¾æ–°æ•°æ®çš„ç©ºé—´ï¼Œé‚£ä¸ªä½ç½®æ°¸è¿œåœ¨stacké¡¶ç«¯ï¼‰\nåœ¨heapä¸Šåˆ†é…ç©ºé—´éœ€è¦æ›´å¤šå·¥ä½œï¼ˆæ“ä½œç³»ç»Ÿéœ€è¦æ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—´æ¥å­˜æ”¾æ•°æ®ï¼Œç„¶åè¦åšå¥½è®°å½•æ–¹ä¾¿ä¸‹æ¬¡åˆ†é…ï¼‰\n\næ‰€æœ‰æƒå­˜åœ¨åŸå› ï¼š\n\nè·Ÿè¸ªä»£ç çš„å“ªäº›éƒ¨åˆ†æ­£åœ¨ä½¿ç”¨heapçš„å“ªäº›æ•°æ®\næœ€å°åŒ–heapä¸Šé‡å¤æ•°æ®é‡\næ¸…ç†heapä¸Šæœªä½¿ç”¨çš„æ•°æ®ä»¥é¿å…ç©ºé—´ä¸è¶³\n\n4.2 æ‰€æœ‰æƒè§„åˆ™\næ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯è¯¥å€¼çš„æ‰€æœ‰è€…\næ¯ä¸ªå€¼åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…\nå½“æ‰€æœ‰è€…è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œè¯¥å€¼å°†è¢«åˆ é™¤\n\nå˜é‡å’Œæ•°æ®äº¤äº’æ–¹å¼ï¼šç§»åŠ¨\n    let s1 = String::from(&quot;hello&quot;);    let s2 = s1;    println!(&quot;&#123;&#125;&quot;, s1);# value moved here# move occurs because `s1` has type `String`, which does not implement the `Copy` trait\n\nrustæ²¡æœ‰å°è¯•å¤åˆ¶è¢«åˆ†é…çš„å†…å­˜\nrustè®©s1å¤±æ•ˆã€‚ï¼ˆå½“s1ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œrustä¸éœ€è¦é‡Šæ”¾ä»»ä½•ä¸œè¥¿ï¼‰\nstackä¸Šçš„æ•°æ®ï¼šå¤åˆ¶\nlet x = 5;let y = x;println!(&quot;&#123;&#125;,&#123;&#125;&quot;, x,y);\n\nä¸€ä¸ªç±»å‹å®ç°äº†Copyè¿™ä¸ªtraitï¼Œé‚£ä¹ˆæ—§çš„å˜é‡åœ¨èµ‹å€¼åä»»ç„¶å¯ç”¨\n4.3 æ‰€æœ‰æƒä¸å‡½æ•°åœ¨è¯­ä¹‰ä¸Šå°†å€¼ä¼ é€’ç»™å‡½æ•°å’ŒæŠŠå€¼èµ‹ç»™å˜é‡æ˜¯ç±»ä¼¼ï¼šå°†å€¼ä¼ é€’ç»™å‡½æ•°å°†å‘ç”Ÿç§»åŠ¨æˆ–å¤åˆ¶\nå‡½æ•°åœ¨è¿”å›å€¼çš„è¿‡ç¨‹åŒæ ·ä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»\n4.4 å¼•ç”¨ä¸å€Ÿç”¨fn main() &#123;    let s1 = String::from(&quot;Hello&quot;);    let len = calculate_length(&amp;s1);    println!(&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;, s1, len);&#125;fn calculate_length(s: &amp;String) -&gt; usize &#123;    s.len()&#125;\n\n&amp;ç¬¦å·è¡¨ç¤ºå¼•ç”¨ï¼šå…è®¸ä½ å¼•ç”¨æŸäº›å€¼è€Œä¸å–å¾—å…¶æ‰€æœ‰æƒ\nä¸å¯ä»¥ä¿®æ”¹å€Ÿç”¨çš„å€¼ï¼Œå’Œå˜é‡ä¸€æ ·ï¼Œå¼•ç”¨é»˜è®¤ä¹Ÿæ˜¯ä¸å¯å˜çš„\nå…è®¸å¯å˜çš„å¼•ç”¨ï¼Œä½†ä¼šæœ‰é™åˆ¶ï¼šåœ¨ç‰¹å®šä½œç”¨åŸŸå†…ï¼Œå¯¹æŸå—æ•°æ®ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼›ä¸å¯ä»¥åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨å’Œä¸€ä¸ªä¸å˜çš„å¼•ç”¨ï¼›å¤šä¸ªä¸å˜å¼•ç”¨æ˜¯å¯ä»¥çš„\nå¼•ç”¨çš„è§„åˆ™\nåœ¨ä»»ä½•ç»™å®šçš„æ—¶åˆ»ï¼Œåªèƒ½æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¹‹ä¸€ï¼š\nä¸€ä¸ªå¯å˜çš„å¼•ç”¨\nä»»æ„æ•°é‡ä¸å¯å˜çš„å¼•ç”¨\n\n\nå¼•ç”¨å¿…é¡»ä¸€ç›´æœ‰æ•ˆ\n\n4.5 åˆ‡ç‰‡å­—ç¬¦ä¸²åˆ‡ç‰‡æ˜¯æŒ‡å‘å­—ç¬¦ä¸²ä¸­ä¸€éƒ¨åˆ†å†…å®¹çš„å¼•ç”¨  [å¼€å§‹ç´¢å¼•..ç»“æŸç´¢å¼•]\nlet s = String::from(&quot;Hello world&quot;);let hello = &amp;s[0..5];let world = &amp;s[6..11];\n\nå®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡æ¥ä»£æ›¿å­—ç¬¦ä¸²å¼•ç”¨ä¼šä½¿æˆ‘ä»¬çš„APIæ›´åŠ é€šç”¨ï¼Œä¸”ä¸ä¼šæŸå¤±ä»»ä½•åŠŸèƒ½ã€‚\nå­—ç¬¦ä¸²å­—é¢å€¼æ˜¯åˆ‡ç‰‡ let s &#x3D; â€œhello worldâ€\n5. structstruct User &#123;    username: String,    email: String,    sign_in_count: u64,    active: bool,&#125;// è¯¥structå®ä¾‹æ‹¥æœ‰å…¶æ‰€æœ‰çš„æ•°æ®// åªè¦structå®ä¾‹æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆé‡Œé¢çš„å­—æ®µæ•°æ®ä¹Ÿæ˜¯æœ‰æ•ˆçš„\n\nä¸€æ—¦structçš„å®ä¾‹æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå®ä¾‹ä¸­æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯å¯å˜çš„\ntuple structtuple structæ•´ä½“æœ‰ä¸ªåï¼Œä½†é‡Œé¢çš„å…ƒç´ æ²¡æœ‰å\nstruct Color(i32,i32,i32);let black = Color(0,0,0);\n\nstructæ–¹æ³•#[derive(Debug)]struct Rectangle &#123;    width : u32,    length: u32,&#125;impl Rectangle &#123;    // æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯self,è¡¨ç¤ºæ–¹æ³•è¢«è°ƒç”¨çš„structå®ä¾‹    fn area(&amp;self) -&gt; u32 &#123;        self.width * self.length    &#125;    // ä¸æŠŠselfä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå®ƒä»¬å«å…³è”å‡½æ•°    fn square(size: u32) -&gt; Rectangle &#123;        Rectangle &#123; width: size, length: size &#125;    &#125;&#125;fn main() &#123;    let sq = Rectangle::square(20);    let rect = Rectangle &#123;        width: 30,        length: 50,    &#125;;    println!(&quot;&#123;&#125;&quot;, rect.area());    println!(&quot;&#123;:#?&#125;&quot;, rect);&#125;\n\nå…³è”å‡½æ•°å¯ä»¥åœ¨implå—é‡Œå®šä¹‰ä¸æŠŠselfä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå®ƒä»¬å«å…³è”å‡½æ•°ã€‚å…³è”å‡½æ•°é€šå¸¸ç”¨äºæ„é€ å™¨ ::ç¬¦å·å…³è”å‡½æ•°\n6. æšä¸¾6.1 å®šä¹‰æšä¸¾enum IpAddrKind &#123;    V4,    V6,&#125;fn main() &#123;    let four = IpAddrKind::V4;    let six = IpAddrKind::V6;    route(four);    route(six);&#125;fn route(ip_kind: IpAddrKind)&#123;&#125;\n\nå¯ä»¥å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­\nenum IpAddr &#123;    V4(u8,u8,u8,u8),    V6(String),&#125;// ä¸éœ€è¦é¢å¤–ä½¿ç”¨struct// æ¯ä¸ªå˜ä½“å¯ä»¥æ‹¥æœ‰ä¸åŒç±»å‹ä»¥åŠå…³è”çš„æ•°æ®é‡\n\n6.2 Optionæšä¸¾let some_number = Some(5);let some_string = Some(&quot;A String&quot;);let absent_number: Option&lt;i32&gt; = None;\n\n6.3 æ§åˆ¶æµè¿ç®—ç¬¦ - match#[derive(Debug)]enum UsState &#123;    Alabama,    Alaska,&#125;enum Coin &#123;    Penny,    Nickel,    Dime,    Quarter(UsState),&#125;fn value_in_cents(coin: Coin) -&gt; u8 &#123;    match coin &#123;        Coin::Penny =&gt; 1,        Coin::Nickel =&gt; 5,        Coin::Dime =&gt; 10,        Coin::Quarter(state) =&gt; &#123;            println!(&quot;State quarter from &#123;:?&#125;!&quot;, state);            25        &#125;,    &#125;&#125;fn main()&#123;    let c = Coin::Quarter(UsState::Alaska);    println!(&quot;&#123;&#125;&quot;, value_in_cents(c));&#125;\n\nmatchåŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½ï¼Œæˆ–è€…ä½¿ç”¨_é€šé…ç¬¦æ›¿ä»£å…¶ä½™æ²¡åˆ—å‡ºçš„å€¼\n    let v = Some(0u8);    match v &#123;        Some(3) =&gt; println!(&quot;three&quot;),        _ =&gt; (),    &#125;    if let Some(3) = v &#123;        println!(&quot;three&quot;);    &#125;// åªå…³å¿ƒä¸€ç§åŒ¹é…è€Œå¿½ç•¥å…¶ä»–åŒ¹é…æƒ…å†µ\n\n7. Package,Crate,ModulePackage(åŒ…)ï¼šcargoç‰¹æ€§ï¼Œè®©ä½ æ„å»º&#x2F;æµ‹è¯•&#x2F;å…±äº«crate\nCrate(å•å…ƒåŒ…)ï¼šä¸€ä¸ªæ¨¡å—æ ‘ï¼Œå®ƒå¯ä»¥äº§ç”Ÿä¸€ä¸ªlibraryæˆ–å¯æ‰§è¡Œæ–‡ä»¶\n\nbinary\nlibrary\n\nModule(æ¨¡å—)ï¼šè®©ä½ æ§åˆ¶ä»£ç çš„ç»„ç»‡&#x2F;ä½œç”¨åŸŸ&#x2F;ç§æœ‰è·¯å¾„\nPath(è·¯å¾„)ï¼šä¸ºstruct&#x2F;functionæˆ–moduleç­‰é¡¹å‘½åçš„æ–¹å¼\nuseçš„ä¹ æƒ¯ç”¨æ³•\nå‡½æ•°ï¼šå°†å‡½æ•°çš„çˆ¶çº§æ¨¡å—å¼•å…¥ä½œç”¨åŸŸï¼ˆæŒ‡å®šåˆ°çˆ¶çº§ï¼‰\nstruct,enum,å…¶å®ƒï¼šæŒ‡å®šå®Œæ•´è·¯å¾„ï¼ˆæŒ‡å®šåˆ°æœ¬èº«ï¼‰\n\npub use:é‡å¯¼å‡ºï¼š\n\nå°†æ¡ç›®å¼•å…¥ä½œç”¨åŸŸ\nè¯¥æ¡ç›®å¯ä»¥è¢«å¤–éƒ¨ä»£ç å¼•å…¥åˆ°å®ƒä»¬çš„ä½œç”¨åŸŸ\n\n8. å¸¸ç”¨çš„é›†åˆ8.1 Vectorvectoråªèƒ½å­˜å‚¨ç›¸åŒç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨enumæ¥å­˜å‚¨å¤šç§æ•°æ®ç±»å‹ï¼ˆå¤šä¸ªå˜ä½“åœ¨ä¸€ä¸ªenumä¸‹ï¼‰\nfn main() &#123;    let row = vec![        SpreadsheetCell::Int(3),        SpreadsheetCell::Float(10.12),        SpreadsheetCell::Text(String::from(&quot;blue&quot;)),    ];&#125;enum SpreadsheetCell &#123;    Int(i32),    Float(f64),    Text(String),&#125;\n\n8.2 Stringpush_str()ï¼šæŠŠä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡é™„åŠ åˆ°String\npush()ï¼šæŠŠå•ä¸ªå­—ç¬¦é™„åŠ åˆ°String\n***+***è¿æ¥å­—ç¬¦ä¸²\nformat!ï¼šè¿æ¥å¤šä¸ªå­—ç¬¦ä¸²\nlet s1 = String::from(&quot;tic&quot;);let s2 = String::from(&quot;tac&quot;);let s3 = String::from(&quot;toe&quot;);let s = format!(&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;, s1,s2,s3);println!(&quot;&#123;&#125;&quot;,s);\n\néå†Stringçš„æ–¹æ³•\nå¯¹äºæ ‡é‡å€¼ï¼šchars()\nå¯¹äºå­—èŠ‚ï¼šbytes()\n\n8.3 HashMapåœ¨å…ƒç´ ç±»å‹ä¸ºtupleçš„vectorä¸Šä½¿ç”¨collectå¯ä»¥ç»„å»ºä¸€ä¸ªhashmap\nlet teams = vec![String::from(&quot;Blue&quot;), String::from(&quot;Yellow&quot;)];let intial_scores = vec![10,50];let scores: HashMap&lt;_,_&gt;=teams.iter().zip(intial_scores.iter()).collect();\n\nentryæ–¹æ³•ï¼šæ£€æŸ¥æŒ‡å®šçš„Kæ˜¯å¦å¯¹åº”ä¸€ä¸ªV\nEntryçš„or_insert()æ–¹æ³•ï¼šå¦‚æœKå­˜åœ¨ï¼Œè¿”å›ä¸€ä¸ªå¯¹åº”Vçš„å¯å˜å¼•ç”¨ï¼›å¦‚æœKä¸å­˜åœ¨ï¼Œå°†æ–¹æ³•å‚æ•°ä½œä¸ºKçš„æ–°å€¼æ’å…¥ï¼Œè¿”å›è¿™ä¸ªå€¼çš„å¯å˜å¼•ç”¨\nlet mut scores = HashMap::new();scores.insert(String::from(&quot;Blue&quot;), 10);scores.entry(String::from(&quot;Yellow&quot;)).or_insert(50);scores.entry(String::from(&quot;Blue&quot;)).or_insert(50);println!(&quot;&#123;:?&#125;&quot;, scores);\n\n9. é”™è¯¯å¤„ç†9.1 panic!å½“panic!æ‰§è¡Œæ—¶ï¼Œç¨‹åºä¼šæ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œå±•å¼€&#x2F;æ¸…ç†è°ƒç”¨æ ˆï¼Œå¹¶é€€å‡ºç¨‹åº\n9.2 resultå¤„ç†resultçš„ä¸€ç§æ–¹å¼ï¼šmatch\nlet f = File::open(&quot;hello.txt&quot;);let _f = match f &#123;    Ok(file) =&gt; file,    Err(error) =&gt; match error.kind() &#123;        ErrorKind::NotFound =&gt; match File::create(&quot;hello.txt&quot;)&#123;            Ok(fc) =&gt; fc,            Err(e) =&gt; panic!(&quot;Error creating file: &#123;:?&#125;&quot;, e),        &#125;,        other_error =&gt; panic!(&quot;Error opening file: &#123;:?&#125;&quot;, other_error),    &#125;,&#125;;\n\nunwarpunwarpæ˜¯matchè¡¨è¾¾å¼çš„ä¸€ä¸ªå¿«æ·æ–¹æ³•ï¼Œå¦‚æœResultç»“æœæ˜¯Ok,è¿”å›oké‡Œé¢çš„å€¼ï¼Œå¦‚æœresultç»“æœæ˜¯err,è°ƒç”¨panic!å®\nexpectexpectä½œç”¨å’Œunwarpç±»ä¼¼ï¼Œä½†å¯ä»¥è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯\nä¼ æ’­é”™è¯¯å‡½æ•°ä¸å¤„ç†é”™è¯¯ï¼Œå°†é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…\nfn read_username_from_file() -&gt; Result&lt;String, std::io::Error&gt;&#123;    let f = File::open(&quot;hello.txt&quot;);    let mut f = match f &#123;        Ok(file) =&gt; file,        Err(e) =&gt; return Err(e),    &#125;;    let mut s = String::new();    match f.read_to_string(&amp;mut s)&#123;        Ok(_) =&gt; Ok(s),        Err(e) =&gt; Err(e),    &#125;&#125;\n\n***?***ä¼ æ’­é”™è¯¯çš„ä¸€ç§å¿«æ·æ–¹å¼\nå¦‚æœresultæ˜¯okï¼Œé‚£okä¸­çš„å€¼å°±æ˜¯è¡¨è¾¾å¼çš„ç»“æœï¼Œç„¶åç»§ç»­æ‰§è¡Œï¼Œ\nå¦‚æœresultæ˜¯err,errå°±æ˜¯æ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œå°±åƒä½¿ç”¨äº†return\nfn read_username_from_file() -&gt; Result&lt;String, std::io::Error&gt;&#123;    // ä½¿ç”¨ï¼Ÿå’Œé“¾å¼è°ƒç”¨ç®€åŒ–ä»£ç     let mut s = String::new();    File::open(&quot;hello.txt&quot;)?.read_to_string(&amp;mut s)?;    Ok(s)&#125;\n\n10. æ³›å‹ï¼ŒTraitï¼Œ ç”Ÿå‘½å‘¨æœŸ10.1 æ³›å‹æ³›å‹æ˜¯å…·ä½“ç±»å‹æˆ–å…¶ä»–å±æ€§çš„æŠ½è±¡ä»£æ›¿ï¼Œç¼–å†™æ¨¡æ¿ï¼Œåœ¨ç¼–è¯‘æ—¶è¢«æ›¿æ¢æˆå…·ä½“ç±»å‹\nfn largest&lt;T&gt;(list:&amp;[T]) -&gt; T &#123;&#125;\n\nstructé‡Œçš„æ³›å‹ç±»å‹å‚æ•°å¯ä»¥å’Œæ–¹æ³•çš„æ³›å‹ç±»å‹å‚æ•°ä¸åŒ\nstruct Point&lt;T, U&gt; &#123;    x: T,    y: U,&#125;impl&lt;T, U&gt; Point&lt;T, U&gt; &#123;    fn mixup&lt;V, W&gt;(self, other: Point&lt;V, W&gt;) -&gt; Point&lt;T, W&gt; &#123;        Point &#123;            x: self.x,            y: other.y,        &#125;    &#125;&#125;fn main() &#123;    let p1 = Point&#123;x:5,y:4&#125;;    let p2 = Point&#123;x:&quot;hello&quot;, y:&#x27;c&#x27;&#125;;    let p3 = p1.mixup(p2);    println!(&quot;p3.x=&#123;&#125;,p3.y=&#123;&#125;&quot;,p3.x, p3.y);&#125;\n\n10.2 Traittrait:æŠ½è±¡çš„å®šä¹‰å…±äº«è¡Œä¸º\ntrait bounds:æ³›å‹ç±»å‹å‚æ•°æŒ‡å®šä¸ºå®ç°äº†ç‰¹å®šè¡Œä¸ºçš„ç±»å‹\ntraitå’Œæ¥å£æœ‰ç‚¹ç±»ä¼¼\nå®šä¹‰traitæŠŠæ–¹æ³•ç­¾åæ”¾åœ¨ä¸€èµ·ï¼Œæ¥å®šä¹‰å®ç°æŸç§ç›®çš„æ‰€å¿…éœ€çš„ä¸€ç»„è¡Œä¸º\n\nå…³é”®å­—trait\nåªæœ‰æ–¹æ³•ç­¾åï¼Œæ²¡æœ‰å…·ä½“å®ç°\ntraitå¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•\nå®ç°è¯¥traitçš„ç±»å‹å¿…é¡»æä¾›å…·ä½“çš„æ–¹æ³•å®ç°\n\nåœ¨ç±»å‹ä¸Šå®ç°traitimpl xxxx for Tweet {}\npub trait Summary &#123;    fn summarize(&amp;self) -&gt; String;&#125;pub struct NewsArticle &#123;    pub headline: String,    pub location: String,    pub author: String,    pub content: String,&#125;impl Summary for NewsArticle &#123;    fn summarize(&amp;self) -&gt; String &#123;        format!(&quot;&#123;&#125;, by &#123;&#125; (&#123;&#125;)&quot;, self.headline, self.author, self.location)    &#125;&#125;\n\né»˜è®¤å®ç°å¯ä»¥åœ¨traitä¸Šæ·»åŠ é»˜è®¤çš„å®ç°\né»˜è®¤å®ç°çš„æ–¹æ³•å¯ä»¥è°ƒç”¨traitä¸­çš„å…¶ä»–æ–¹æ³•ï¼Œå³ä½¿è¿™äº›æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°\npub trait Summary &#123;    fn summarize_author(&amp;self) -&gt; String;    fn summarize(&amp;self) -&gt; String &#123;        format!(&quot;(Read more from &#123;&#125; ...)&quot;, self.summarize_author())    &#125;&#125;\n\ntraitä½œä¸ºå‚æ•°\nimpl Traitè¯­æ³•ï¼šé€‚ç”¨äºç®€å•æƒ…å†µ\nTrait boundè¯­æ³•ï¼šå¯ç”¨äºå¤æ‚æƒ…å†µ\nä½¿ç”¨***+***æŒ‡å®šå¤šä¸ªtrait bound\n\ntraitä½œä¸ºè¿”å›å€¼\nimpl traitï¼šåªèƒ½è¿”å›ç¡®å®šçš„åŒä¸€ç§ç±»å‹\nä½¿ç”¨trait boundå¯ä»¥æœ‰æ¡ä»¶çš„ä¸ºå®ç°äº†ç‰¹å®štraitçš„ç±»å‹å®ç°æ–¹æ³•\nä¸ºå®ç°å…¶ä»–traitçš„ä»»æ„ç±»å‹æœ‰æ¡ä»¶çš„å®ç°æŸä¸ªtrait\n\n10.3 ç”Ÿå‘½å‘¨æœŸ\nrustæ¯ä¸ªå¼•ç”¨éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ\nç”Ÿå‘½å‘¨æœŸï¼šå¼•ç”¨ä¿æŒæœ‰æ•ˆçš„ä½œç”¨åŸŸ\nå¤§å¤šæ•°æƒ…å†µï¼šç”Ÿå‘½å‘¨æœŸæ˜¯éšå¼çš„&#x2F;å¯è¢«æ¨æ–­çš„\nå½“å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼ç›¸äº’å…³è”æ—¶ï¼šæ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ\n\nå‡½æ•°çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ\nfn longest&lt;&#x27;a&gt;(x: &amp;&#x27;a str, y: &amp;&#x27;a str) -&gt; &amp;&#x27;a str &#123;    if x.len() &gt; y.len() &#123;        x    &#125; else &#123;        y    &#125;&#125;\n\nç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ä¸ä¼šæ”¹å˜ç”Ÿå‘½å‘¨æœŸçš„é•¿åº¦ã€‚\nç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨æè¿°äº†å¤šä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸé—´çš„å…³ç³»\næ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°å£°æ˜åœ¨å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ä¹‹é—´ã€‚\nç”Ÿå‘½å‘¨æœŸâ€™açš„å®é™…ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼šxå’Œyä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸä¸­è¾ƒå°çš„é‚£ä¸ª\nstructå®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨struct ImportantExcerpt&lt;&#x27;a&gt; &#123;    part: &amp;&#x27;a str,&#125;\n\nç”Ÿå‘½å‘¨æœŸçš„çœç•¥\næ¯ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ\nå¦‚æœåªæœ‰1ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸè¢«èµ‹äºˆç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°\nå¦‚æœæœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯&amp;selfæˆ–&amp;mut selfï¼ˆæ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆselfçš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°\n\né™æ€ç”Ÿå‘½å‘¨æœŸâ€˜staticæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸï¼šæ•´ä¸ªç¨‹åºçš„æŒç»­æ—¶é—´\n","categories":["ç¼–ç¨‹è¯­è¨€"],"tags":["å­¦ä¹ "]},{"title":"äººå·¥æ™ºèƒ½å…¥é—¨","url":"/java4u/2023/04/25/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%85%A5%E9%97%A8/","content":"äººå·¥æ™ºèƒ½å…¥é—¨æœºå™¨å­¦ä¹ åŸºç¡€æœºå™¨å­¦ä¹ æ˜¯ä¸€é—¨ä¸“é—¨ç ”ç©¶è®¡ç®—æœºæ€æ ·æ¨¡æ‹Ÿæˆ–å®ç°äººç±»çš„å­¦ä¹ è¡Œä¸ºï¼Œä»¥è·å–æ–°çš„çŸ¥è¯†æˆ–æŠ€èƒ½ï¼Œé‡æ–°ç»„ç»‡å·²æœ‰çš„çŸ¥è¯†ç»“æ„ä½¿ä¹‹ä¸æ–­æ”¹å–„è‡ªèº«æ€§èƒ½çš„å­¦ç§‘ã€‚åˆ—ä¸¾ä¸€äº›æœºå™¨å­¦ä¹ ç»å…¸çš„åœºæ™¯ï¼š\n\næœç´¢å¼•æ“ï¼šæ ¹æ®æœç´¢å’Œä½¿ç”¨ä¹ æƒ¯ï¼Œä¼˜åŒ–ä¸‹ä¸€æ¬¡æœç´¢çš„ç»“æœã€‚\nç”µå•†ç½‘ç«™ï¼šè‡ªåŠ¨æ¨èä½ å¯èƒ½æ„Ÿå…´è¶£çš„å•†å“ã€‚\nè´·æ¬¾ç”³è¯·ï¼šé€šè¿‡ä½ æœ€è¿‘çš„é‡‘èæ´»åŠ¨ä¿¡æ¯è¿›è¡Œç»¼åˆè¯„å®šã€‚\nå›¾åƒè¯†åˆ«ï¼šè‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ä¸­æœ‰æ²¡æœ‰ä¸å’Œè°çš„å†…å®¹ã€‚\n\næœºå™¨å­¦ä¹ å¯ä»¥åˆ†ä¸ºç›‘ç£å­¦ä¹ å’Œéç›‘ç£å­¦ä¹ ã€‚ç›‘ç£å­¦ä¹ æ˜¯ä»ç»™å®šçš„è®­ç»ƒæ•°æ®é›†ä¸­å­¦ä¹ å¾—åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œå½“æ–°çš„æ•°æ®åˆ°æ¥æ—¶ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ªå‡½æ•°é¢„æµ‹ç»“æœï¼Œç›‘ç£å­¦ä¹ çš„è®­ç»ƒé›†åŒ…æ‹¬è¾“å…¥å’Œè¾“å‡ºï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ç‰¹å¾å’Œç›®æ ‡ã€‚ç›‘ç£å­¦ä¹ çš„ç›®æ ‡æ˜¯ç”±äººæ¥æ ‡æ³¨çš„ï¼Œè€Œéç›‘ç£å­¦ä¹ çš„æ•°æ®æ²¡æœ‰ç±»åˆ«ä¿¡æ¯ï¼Œè®­ç»ƒé›†ä¹Ÿæ²¡æœ‰äººä¸ºæ ‡æ³¨ç»“æœï¼Œé€šè¿‡æ— ç›‘ç£å­¦ä¹ å¯ä»¥å‡å°‘æ•°æ®ç‰¹å¾çš„ç»´åº¦ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒç»´æˆ–ä¸‰ç»´å›¾å½¢æ›´åŠ ç›´è§‚åœ°å±•ç¤ºæ•°æ®ä¿¡æ¯ ã€‚\nå®ç°æœºå™¨å­¦ä¹ çš„ä¸€èˆ¬æ­¥éª¤ï¼š\n\næ•°æ®æ”¶é›†\næ•°æ®å‡†å¤‡\næ•°æ®åˆ†æ\nè®­ç»ƒç®—æ³•\næµ‹è¯•ç®—æ³•\nåº”ç”¨ç®—æ³•\n\nä¸€. å¼•è¨€æ—¥å¸¸ç”Ÿæ´»æœºå™¨å­¦ä¹ é€šè¿‡è¯­éŸ³å”¤é†’Siriã€‚æ”¶é›†ä¸€ä¸ªåŒ…å«å¤§é‡éŸ³é¢‘æ ·æœ¬çš„æ•°æ®é›†ï¼ˆdatasetï¼‰ï¼Œå®šä¹‰ä¸€ä¸ªçµæ´»çš„ç¨‹åºç®—æ³•ï¼Œå…¶è¾“å‡ºç”±è®¸å¤šå‚æ•°å†³å®šã€‚ ä»»ä¸€è°ƒæ•´å‚æ•°åçš„ç¨‹åºè¢«ç§°ä¸ºæ¨¡å‹ï¼ˆmodelï¼‰ã€‚é€šè¿‡æ“ä½œå‚æ•°è€Œç”Ÿæˆçš„æ‰€æœ‰ä¸åŒç¨‹åºï¼ˆè¾“å…¥-è¾“å‡ºæ˜ å°„ï¼‰çš„é›†åˆç§°ä¸ºâ€œæ¨¡å‹æ—â€ã€‚ä½¿ç”¨æ•°æ®é›†æ¥é€‰æ‹©å‚æ•°çš„å…ƒç¨‹åºè¢«ç§°ä¸ºå­¦ä¹ ç®—æ³•ï¼ˆlearning algorithmï¼‰ã€‚\n1. ç›‘ç£å­¦ä¹ ç›‘ç£å­¦ä¹ ä¸€èˆ¬åˆ†ä¸º3æ­¥ï¼š\n\nä»å·²çŸ¥å¤§é‡æ•°æ®æ ·æœ¬ä¸­éšæœºé€‰å–ä¸€ä¸ªå­é›†ï¼Œä¸ºæ¯ä¸ªæ ·æœ¬è·å–çœŸå®æ ‡ç­¾ã€‚æœ‰æ—¶ï¼Œè¿™äº›æ ·æœ¬å·²æœ‰æ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼Œæ‚£è€…æ˜¯å¦åœ¨ä¸‹ä¸€å¹´å†…åº·å¤ï¼Ÿï¼‰ï¼›æœ‰æ—¶ï¼Œè¿™äº›æ ·æœ¬å¯èƒ½éœ€è¦è¢«äººå·¥æ ‡è®°ï¼ˆä¾‹å¦‚ï¼Œå›¾åƒåˆ†ç±»ï¼‰ã€‚è¿™äº›è¾“å…¥å’Œç›¸åº”çš„æ ‡ç­¾ä¸€èµ·æ„æˆäº†è®­ç»ƒæ•°æ®é›†ï¼›\né€‰æ‹©æœ‰ç›‘ç£çš„å­¦ä¹ ç®—æ³•ï¼Œå®ƒå°†è®­ç»ƒæ•°æ®é›†ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªâ€œå·²å®Œæˆå­¦ä¹ çš„æ¨¡å‹â€ï¼›\nå°†ä¹‹å‰æ²¡æœ‰è§è¿‡çš„æ ·æœ¬ç‰¹å¾æ”¾åˆ°è¿™ä¸ªâ€œå·²å®Œæˆå­¦ä¹ çš„æ¨¡å‹â€ä¸­ï¼Œä½¿ç”¨æ¨¡å‹çš„è¾“å‡ºä½œä¸ºç›¸åº”æ ‡ç­¾çš„é¢„æµ‹ã€‚\n\n\n1.1 å›å½’å½“æ ‡ç­¾å–ä»»æ„æ•°å€¼æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå›å½’é—®é¢˜ï¼Œæ­¤æ—¶çš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªæ¨¡å‹ï¼Œä½¿å®ƒçš„é¢„æµ‹éå¸¸æ¥è¿‘å®é™…æ ‡ç­¾å€¼ã€‚ä»»ä½•æœ‰å…³â€œæœ‰å¤šå°‘â€çš„é—®é¢˜å¾ˆå¯èƒ½å°±æ˜¯å›å½’é—®é¢˜ã€‚æ¯”å¦‚ï¼š\n\nè¿™ä¸ªæ‰‹æœ¯éœ€è¦å¤šå°‘å°æ—¶ï¼›\nåœ¨æœªæ¥6å°æ—¶ï¼Œè¿™ä¸ªé•‡ä¼šæœ‰å¤šå°‘é™é›¨é‡ã€‚\n\n1.2 åˆ†ç±»åˆ†ç±»é—®é¢˜å¸Œæœ›æ¨¡å‹èƒ½å¤Ÿé¢„æµ‹æ ·æœ¬å±äºå“ªä¸ªç±»åˆ«ï¼ˆcategoryï¼Œæ­£å¼ç§°ä¸ºç±»ï¼ˆclassï¼‰ï¼‰ã€‚ ä¾‹å¦‚ï¼Œæ‰‹å†™æ•°å­—å¯èƒ½æœ‰10ç±»ï¼Œæ ‡ç­¾è¢«è®¾ç½®ä¸ºæ•°å­—0ï½9ã€‚ æœ€ç®€å•çš„åˆ†ç±»é—®é¢˜æ˜¯åªæœ‰ä¸¤ç±»ï¼Œè¿™è¢«ç§°ä¹‹ä¸ºäºŒé¡¹åˆ†ç±»ï¼ˆbinomial classificationï¼‰ã€‚ ä¾‹å¦‚ï¼Œæ•°æ®é›†å¯èƒ½ç”±åŠ¨ç‰©å›¾åƒç»„æˆï¼Œæ ‡ç­¾å¯èƒ½æ˜¯çŒ«ç‹—{çŒ«,ç‹—}ä¸¤ç±»ã€‚ å›å½’æ˜¯è®­ç»ƒä¸€ä¸ªå›å½’å‡½æ•°æ¥è¾“å‡ºä¸€ä¸ªæ•°å€¼ï¼› åˆ†ç±»æ˜¯è®­ç»ƒä¸€ä¸ªåˆ†ç±»å™¨æ¥è¾“å‡ºé¢„æµ‹çš„ç±»åˆ«ã€‚\n1.3 æ ‡è®°é—®é¢˜å­¦ä¹ é¢„æµ‹ä¸ç›¸äº’æ’æ–¥çš„ç±»åˆ«çš„é—®é¢˜ç§°ä¸ºå¤šæ ‡ç­¾åˆ†ç±»ï¼ˆmulti-label classificationï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œäººä»¬åœ¨æŠ€æœ¯åšå®¢ä¸Šè´´çš„æ ‡ç­¾ï¼Œæ¯”å¦‚â€œæœºå™¨å­¦ä¹ â€â€œæŠ€æœ¯â€â€œå°å·¥å…·â€â€œç¼–ç¨‹è¯­è¨€â€â€œLinuxâ€â€œäº‘è®¡ç®—â€â€œAWSâ€ã€‚ ä¸€ç¯‡å…¸å‹çš„æ–‡ç« å¯èƒ½ä¼šç”¨5ï½10ä¸ªæ ‡ç­¾ï¼Œå› ä¸ºè¿™äº›æ¦‚å¿µæ˜¯ç›¸äº’å…³è”çš„ã€‚ å…³äºâ€œäº‘è®¡ç®—â€çš„å¸–å­å¯èƒ½ä¼šæåˆ°â€œAWSâ€ï¼Œè€Œå…³äºâ€œæœºå™¨å­¦ä¹ â€çš„å¸–å­ä¹Ÿå¯èƒ½æ¶‰åŠâ€œç¼–ç¨‹è¯­è¨€â€ã€‚\n\n1.4 æœç´¢æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…ä»…å¸Œæœ›è¾“å‡ºä¸€ä¸ªç±»åˆ«æˆ–ä¸€ä¸ªå®å€¼ã€‚ åœ¨ä¿¡æ¯æ£€ç´¢é¢†åŸŸï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹ä¸€ç»„é¡¹ç›®è¿›è¡Œæ’åºã€‚ ä»¥ç½‘ç»œæœç´¢ä¸ºä¾‹ï¼Œç›®æ ‡ä¸æ˜¯ç®€å•çš„â€œæŸ¥è¯¢ï¼ˆqueryï¼‰-ç½‘é¡µï¼ˆpageï¼‰â€åˆ†ç±»ï¼Œè€Œæ˜¯åœ¨æµ·é‡æœç´¢ç»“æœä¸­æ‰¾åˆ°ç”¨æˆ·æœ€éœ€è¦çš„é‚£éƒ¨åˆ†ã€‚\n1.5 æ¨èç³»ç»Ÿå®ƒçš„ç›®æ ‡æ˜¯å‘ç‰¹å®šç”¨æˆ·è¿›è¡Œâ€œä¸ªæ€§åŒ–â€æ¨èã€‚ ä¾‹å¦‚ï¼Œå¯¹äºç”µå½±æ¨èï¼Œç§‘å¹»è¿·å’Œå–œå‰§çˆ±å¥½è€…çš„æ¨èç»“æœé¡µé¢å¯èƒ½ä¼šæœ‰å¾ˆå¤§ä¸åŒã€‚ ç±»ä¼¼çš„åº”ç”¨ä¹Ÿä¼šå‡ºç°åœ¨é›¶å”®äº§å“ã€éŸ³ä¹å’Œæ–°é—»æ¨èç­‰ç­‰ã€‚\n\n1.6 åºåˆ—å­¦ä¹ å¦‚æœè¾“å…¥æ˜¯è¿ç»­çš„ï¼Œæ¨¡å‹å¯èƒ½å°±éœ€è¦æ‹¥æœ‰â€œè®°å¿†â€åŠŸèƒ½ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†è§†é¢‘ç‰‡æ®µå‘¢ï¼Ÿ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè§†é¢‘ç‰‡æ®µå¯èƒ½ç”±ä¸åŒæ•°é‡çš„å¸§ç»„æˆã€‚ é€šè¿‡å‰ä¸€å¸§çš„å›¾åƒï¼Œæˆ‘ä»¬å¯èƒ½å¯¹åä¸€å¸§ä¸­å‘ç”Ÿçš„äº‹æƒ…æ›´æœ‰æŠŠæ¡ã€‚ è¯­è¨€ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæœºå™¨ç¿»è¯‘çš„è¾“å…¥å’Œè¾“å‡ºéƒ½ä¸ºæ–‡å­—åºåˆ—ã€‚\n2. æ— ç›‘ç£å­¦ä¹ å¦‚æœå·¥ä½œæ²¡æœ‰ååˆ†å…·ä½“çš„ç›®æ ‡ï¼Œå°±éœ€è¦â€œè‡ªå‘â€åœ°å»å­¦ä¹ äº†ã€‚ æ¯”å¦‚ï¼Œè€æ¿å¯èƒ½ä¼šç»™æˆ‘ä»¬ä¸€å¤§å †æ•°æ®ï¼Œç„¶åè¦æ±‚ç”¨å®ƒåšä¸€äº›æ•°æ®ç§‘å­¦ç ”ç©¶ï¼Œå´æ²¡æœ‰å¯¹ç»“æœæœ‰è¦æ±‚ã€‚ è¿™ç±»æ•°æ®ä¸­ä¸å«æœ‰â€œç›®æ ‡â€çš„æœºå™¨å­¦ä¹ é—®é¢˜é€šå¸¸è¢«ä¸ºæ— ç›‘ç£å­¦ä¹ ï¼ˆunsupervised learningï¼‰\n3. ä¸ç¯å¢ƒäº’åŠ¨ä¸ç®¡æ˜¯ç›‘ç£å­¦ä¹ è¿˜æ˜¯æ— ç›‘ç£å­¦ä¹ ï¼Œæˆ‘ä»¬éƒ½ä¼šé¢„å…ˆè·å–å¤§é‡æ•°æ®ï¼Œç„¶åå¯åŠ¨æ¨¡å‹ï¼Œä¸å†ä¸ç¯å¢ƒäº¤äº’ã€‚ è¿™é‡Œæ‰€æœ‰å­¦ä¹ éƒ½æ˜¯åœ¨ç®—æ³•ä¸ç¯å¢ƒæ–­å¼€åè¿›è¡Œçš„ï¼Œè¢«ç§°ä¸ºç¦»çº¿å­¦ä¹ ï¼ˆoffline learningï¼‰ã€‚è¿™ç§ç®€å•çš„ç¦»çº¿å­¦ä¹ æœ‰å®ƒçš„é­…åŠ›ã€‚ å¥½çš„ä¸€é¢æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å­¤ç«‹åœ°è¿›è¡Œæ¨¡å¼è¯†åˆ«ï¼Œè€Œä¸å¿…åˆ†å¿ƒäºå…¶ä»–é—®é¢˜ã€‚ ä½†ç¼ºç‚¹æ˜¯ï¼Œè§£å†³çš„é—®é¢˜ç›¸å½“æœ‰é™ã€‚ è¿™æ—¶æˆ‘ä»¬å¯èƒ½ä¼šæœŸæœ›äººå·¥æ™ºèƒ½ä¸ä»…èƒ½å¤Ÿåšå‡ºé¢„æµ‹ï¼Œè€Œä¸”èƒ½å¤Ÿä¸çœŸå®ç¯å¢ƒäº’åŠ¨ã€‚ \n4. å¼ºåŒ–å­¦ä¹ åœ¨å¼ºåŒ–å­¦ä¹ é—®é¢˜ä¸­ï¼Œæ™ºèƒ½ä½“ï¼ˆagentï¼‰åœ¨ä¸€ç³»åˆ—çš„æ—¶é—´æ­¥éª¤ä¸Šä¸ç¯å¢ƒäº¤äº’ã€‚ åœ¨æ¯ä¸ªç‰¹å®šæ—¶é—´ç‚¹ï¼Œæ™ºèƒ½ä½“ä»ç¯å¢ƒæ¥æ”¶ä¸€äº›è§‚å¯Ÿï¼ˆobservationï¼‰ï¼Œå¹¶ä¸”å¿…é¡»é€‰æ‹©ä¸€ä¸ªåŠ¨ä½œï¼ˆactionï¼‰ï¼Œç„¶åé€šè¿‡æŸç§æœºåˆ¶ï¼ˆæœ‰æ—¶ç§°ä¸ºæ‰§è¡Œå™¨ï¼‰å°†å…¶ä¼ è¾“å›ç¯å¢ƒï¼Œæœ€åæ™ºèƒ½ä½“ä»ç¯å¢ƒä¸­è·å¾—å¥–åŠ±ï¼ˆrewardï¼‰ã€‚ æ­¤åæ–°ä¸€è½®å¾ªç¯å¼€å§‹ï¼Œæ™ºèƒ½ä½“æ¥æ”¶åç»­è§‚å¯Ÿï¼Œå¹¶é€‰æ‹©åç»­æ“ä½œï¼Œä¾æ­¤ç±»æ¨ã€‚ \n\nå°ç»“\næœºå™¨å­¦ä¹ ç ”ç©¶è®¡ç®—æœºç³»ç»Ÿå¦‚ä½•åˆ©ç”¨ç»éªŒï¼ˆé€šå¸¸æ˜¯æ•°æ®ï¼‰æ¥æé«˜ç‰¹å®šä»»åŠ¡çš„æ€§èƒ½ã€‚å®ƒç»“åˆäº†ç»Ÿè®¡å­¦ã€æ•°æ®æŒ–æ˜å’Œä¼˜åŒ–çš„æ€æƒ³ã€‚é€šå¸¸ï¼Œå®ƒæ˜¯è¢«ç”¨ä½œå®ç°äººå·¥æ™ºèƒ½è§£å†³æ–¹æ¡ˆçš„ä¸€ç§æ‰‹æ®µã€‚\nè¡¨ç¤ºå­¦ä¹ ä½œä¸ºæœºå™¨å­¦ä¹ çš„ä¸€ç±»ï¼Œå…¶ç ”ç©¶çš„é‡ç‚¹æ˜¯å¦‚ä½•è‡ªåŠ¨æ‰¾åˆ°åˆé€‚çš„æ•°æ®è¡¨ç¤ºæ–¹å¼ã€‚æ·±åº¦å­¦ä¹ æ˜¯é€šè¿‡å­¦ä¹ å¤šå±‚æ¬¡çš„è½¬æ¢æ¥è¿›è¡Œçš„å¤šå±‚æ¬¡çš„è¡¨ç¤ºå­¦ä¹ ã€‚\næ·±åº¦å­¦ä¹ ä¸ä»…å–ä»£äº†ä¼ ç»Ÿæœºå™¨å­¦ä¹ çš„æµ…å±‚æ¨¡å‹ï¼Œè€Œä¸”å–ä»£äº†åŠ³åŠ¨å¯†é›†å‹çš„ç‰¹å¾å·¥ç¨‹ã€‚\næœ€è¿‘åœ¨æ·±åº¦å­¦ä¹ æ–¹é¢å–å¾—çš„è®¸å¤šè¿›å±•ï¼Œå¤§éƒ½æ˜¯ç”±å»‰ä»·ä¼ æ„Ÿå™¨å’Œäº’è”ç½‘è§„æ¨¡åº”ç”¨æ‰€äº§ç”Ÿçš„å¤§é‡æ•°æ®ï¼Œä»¥åŠï¼ˆé€šè¿‡GPUï¼‰ç®—åŠ›çš„çªç ´æ¥è§¦å‘çš„ã€‚\næ•´ä¸ªç³»ç»Ÿä¼˜åŒ–æ˜¯è·å¾—é«˜æ€§èƒ½çš„å…³é”®ç¯èŠ‚ã€‚æœ‰æ•ˆçš„æ·±åº¦å­¦ä¹ æ¡†æ¶çš„å¼€æºä½¿å¾—è¿™ä¸€ç‚¹çš„è®¾è®¡å’Œå®ç°å˜å¾—éå¸¸å®¹æ˜“ã€‚\n\näºŒ. é¢„å¤‡çŸ¥è¯†2.1 æ•°æ®æ“ä½œimport tensorflow as tf# åˆ›å»ºä¸€ä¸ªè¡Œå‘é‡xx = tf.range(12)&lt;tf.Tensor: shape=(12,), dtype=int32, numpy=array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])&gt;# é€šè¿‡shapeè®¿é—®å¼ é‡çš„å½¢çŠ¶x.shape# å½¢çŠ¶çš„æ‰€æœ‰å…ƒç´ ä¹˜ç§¯tf.size(x)# æ”¹å˜ä¸€ä¸ªå¼ é‡çš„å½¢çŠ¶è€Œä¸æ”¹å˜å…ƒç´ æ•°é‡å’Œå…ƒç´ å€¼X = tf.reshape(x, (3, 4))# é€šè¿‡æä¾›åŒ…å«æ•°å€¼çš„Pythonåˆ—è¡¨ï¼ˆæˆ–åµŒå¥—åˆ—è¡¨ï¼‰ï¼Œæ¥ä¸ºæ‰€éœ€å¼ é‡ä¸­çš„æ¯ä¸ªå…ƒç´ èµ‹äºˆç¡®å®šå€¼tf.constant([[2, 1, 4, 3], [1, 2, 3, 4], [4, 3, 2, 1]])&lt;tf.Tensor: shape=(3, 4), dtype=int32, numpy=array([[2, 1, 4, 3],       [1, 2, 3, 4],       [4, 3, 2, 1]], dtype=int32)&gt;\n\nè¿ç®—ç¬¦åœ¨æ•°å­¦è¡¨ç¤ºæ³•ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ç¬¦å· ğ‘“:â„â†’â„æ¥è¡¨ç¤ºä¸€å…ƒæ ‡é‡è¿ç®—ç¬¦ï¼ˆåªæ¥æ”¶ä¸€ä¸ªè¾“å…¥ï¼‰ã€‚ è¿™æ„å‘³ç€è¯¥å‡½æ•°ä»ä»»ä½•å®æ•°ï¼ˆâ„ï¼‰æ˜ å°„åˆ°å¦ä¸€ä¸ªå®æ•°ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬é€šè¿‡ç¬¦å· ğ‘“:â„,â„â†’â„è¡¨ç¤ºäºŒå…ƒæ ‡é‡è¿ç®—ç¬¦ï¼Œè¿™æ„å‘³ç€è¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªè¾“å…¥ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè¾“å‡ºã€‚ ç»™å®šåŒä¸€å½¢çŠ¶çš„ä»»æ„ä¸¤ä¸ªå‘é‡ ğ® å’Œ ğ¯ å’ŒäºŒå…ƒè¿ç®—ç¬¦ ğ‘“ï¼Œ æˆ‘ä»¬å¯ä»¥å¾—åˆ°å‘é‡ ğœ=ğ¹(ğ®,ğ¯)ã€‚ å…·ä½“è®¡ç®—æ–¹æ³•æ˜¯ ğ‘ğ‘–â†ğ‘“(ğ‘¢ğ‘–,ğ‘£ğ‘–)ï¼Œ å…¶ä¸­ ğ‘ğ‘–ã€ ğ‘¢ğ‘– å’Œ ğ‘£ğ‘– åˆ†åˆ«æ˜¯å‘é‡ ğœã€ ğ® å’Œ ğ¯ä¸­çš„å…ƒç´ ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡å°†æ ‡é‡å‡½æ•°å‡çº§ä¸ºæŒ‰å…ƒç´ å‘é‡è¿ç®—æ¥ç”Ÿæˆå‘é‡å€¼  ğ¹:â„ğ‘‘,â„ğ‘‘â†’â„ğ‘‘ã€‚\n\nx = tf.constant([1.0, 2, 4, 8])y = tf.constant([2.0, 2, 2, 2])x + y, x - y, x * y, x / y, x ** y  # **è¿ç®—ç¬¦æ˜¯æ±‚å¹‚è¿ç®—(&lt;tf.Tensor: shape=(4,), dtype=float32, numpy=array([ 3.,  4.,  6., 10.], dtype=float32)&gt;, &lt;tf.Tensor: shape=(4,), dtype=float32, numpy=array([-1.,  0.,  2.,  6.], dtype=float32)&gt;, &lt;tf.Tensor: shape=(4,), dtype=float32, numpy=array([ 2.,  4.,  8., 16.], dtype=float32)&gt;, &lt;tf.Tensor: shape=(4,), dtype=float32, numpy=array([0.5, 1. , 2. , 4. ], dtype=float32)&gt;, &lt;tf.Tensor: shape=(4,), dtype=float32, numpy=array([ 1.,  4., 16., 64.], dtype=float32)&gt;)\n\nå¯ä»¥æŠŠå¤šä¸ªå¼ é‡è¿ç»“ï¼ˆconcatenateï¼‰åœ¨ä¸€èµ·ï¼Œ æŠŠå®ƒä»¬ç«¯å¯¹ç«¯åœ°å èµ·æ¥å½¢æˆä¸€ä¸ªæ›´å¤§çš„å¼ é‡ã€‚\nX = tf.reshape(tf.range(12, dtype=tf.float32), (3, 4))Y = tf.constant([[2.0, 1, 4, 3], [1, 2, 3, 4], [4, 3, 2, 1]])tf.concat([X, Y], axis=0), tf.concat([X, Y], axis=1)(&lt;tf.Tensor: shape=(6, 4), dtype=float32, numpy= array([[ 0.,  1.,  2.,  3.],        [ 4.,  5.,  6.,  7.],        [ 8.,  9., 10., 11.],        [ 2.,  1.,  4.,  3.],        [ 1.,  2.,  3.,  4.],        [ 4.,  3.,  2.,  1.]], dtype=float32)&gt;, &lt;tf.Tensor: shape=(3, 8), dtype=float32, numpy= array([[ 0.,  1.,  2.,  3.,  2.,  1.,  4.,  3.],        [ 4.,  5.,  6.,  7.,  1.,  2.,  3.,  4.],        [ 8.,  9., 10., 11.,  4.,  3.,  2.,  1.]], dtype=float32)&gt;)\n\nå¹¿æ’­æœºåˆ¶å¹¿æ’­æœºåˆ¶å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š\n\né€šè¿‡é€‚å½“å¤åˆ¶å…ƒç´ æ¥æ‰©å±•ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°ç»„ï¼Œä»¥ä¾¿åœ¨è½¬æ¢ä¹‹åï¼Œä¸¤ä¸ªå¼ é‡å…·æœ‰ç›¸åŒçš„å½¢çŠ¶ï¼›\nå¯¹ç”Ÿæˆçš„æ•°ç»„æ‰§è¡ŒæŒ‰å…ƒç´ æ“ä½œã€‚\n\na = tf.reshape(tf.range(3), (3, 1))b = tf.reshape(tf.range(2), (1, 2))a, b(&lt;tf.Tensor: shape=(3, 1), dtype=int32, numpy= array([[0],        [1],        [2]], dtype=int32)&gt;, &lt;tf.Tensor: shape=(1, 2), dtype=int32, numpy=array([[0, 1]], dtype=int32)&gt;)a + b&lt;tf.Tensor: shape=(3, 2), dtype=int32, numpy=array([[0, 1],       [1, 2],       [2, 3]], dtype=int32)&gt;\n\nç´¢å¼•å’Œåˆ‡ç‰‡å¼ é‡ä¸­çš„å…ƒç´ å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚\nX[-1], X[1:3](&lt;tf.Tensor: shape=(4,), dtype=float32, numpy=array([ 8.,  9., 10., 11.], dtype=float32)&gt;, &lt;tf.Tensor: shape=(2, 4), dtype=float32, numpy= array([[ 4.,  5.,  6.,  7.],        [ 8.,  9., 10., 11.]], dtype=float32)&gt;)\n\nTensorFlowä¸­çš„Tensorsæ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿä¸èƒ½è¢«èµ‹å€¼ã€‚ TensorFlowä¸­çš„Variablesæ˜¯æ”¯æŒèµ‹å€¼çš„å¯å˜å®¹å™¨ã€‚\nX_var = tf.Variable(X)X_var[1, 2].assign(9)X_var&lt;tf.Variable &#x27;Variable:0&#x27; shape=(3, 4) dtype=float32, numpy=array([[ 0.,  1.,  2.,  3.],       [ 4.,  5.,  9.,  7.],       [ 8.,  9., 10., 11.]], dtype=float32)&gt;\n\n2.2 æ•°æ®é¢„å¤„ç†pandasé¢„å¤„ç†åŸå§‹æ•°æ®ï¼Œå¹¶å°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºå¼ é‡æ ¼å¼\nimport pandas as pddata = pd.read_csv(data_file)print(data)   NumRooms Alley   Price0       NaN  Pave  1275001       2.0   NaN  1060002       4.0   NaN  1781003       NaN   NaN  140000\n\né€šè¿‡ä½ç½®ç´¢å¼•ilocï¼Œæˆ‘ä»¬å°†dataåˆ†æˆinputså’Œoutputsï¼Œ å…¶ä¸­å‰è€…ä¸ºdataçš„å‰ä¸¤åˆ—ï¼Œè€Œåè€…ä¸ºdataçš„æœ€åä¸€åˆ—ã€‚ å¯¹äºinputsä¸­ç¼ºå°‘çš„æ•°å€¼ï¼Œæˆ‘ä»¬ç”¨åŒä¸€åˆ—çš„å‡å€¼æ›¿æ¢â€œNaNâ€é¡¹ã€‚\ninputs, outputs = data.iloc[:, 0:2], data.iloc[:, 2]inputs = inputs.fillna(inputs.mean())print(inputs)   NumRooms Alley0       3.0  Pave1       2.0   NaN2       4.0   NaN3       3.0   NaN\n\n[å¯¹äºinputsä¸­çš„ç±»åˆ«å€¼æˆ–ç¦»æ•£å€¼ï¼Œæˆ‘ä»¬å°†â€œNaNâ€è§†ä¸ºä¸€ä¸ªç±»åˆ«ã€‚] ç”±äºâ€œå··å­ç±»å‹â€ï¼ˆâ€œAlleyâ€ï¼‰åˆ—åªæ¥å—ä¸¤ç§ç±»å‹çš„ç±»åˆ«å€¼â€œPaveâ€å’Œâ€œNaNâ€ï¼Œ pandaså¯ä»¥è‡ªåŠ¨å°†æ­¤åˆ—è½¬æ¢ä¸ºä¸¤åˆ—â€œAlley_Paveâ€å’Œâ€œAlley_nanâ€ã€‚ å··å­ç±»å‹ä¸ºâ€œPaveâ€çš„è¡Œä¼šå°†â€œAlley_Paveâ€çš„å€¼è®¾ç½®ä¸º1ï¼Œâ€œAlley_nanâ€çš„å€¼è®¾ç½®ä¸º0ã€‚ ç¼ºå°‘å··å­ç±»å‹çš„è¡Œä¼šå°†â€œAlley_Paveâ€å’Œâ€œAlley_nanâ€åˆ†åˆ«è®¾ç½®ä¸º0å’Œ1ã€‚\ninputs = pd.get_dummies(inputs, dummy_na=True)print(inputs)  NumRooms  Alley_Pave  Alley_nan0       3.0           1          01       2.0           0          12       4.0           0          13       3.0           0          1\n\n2.3 çº¿æ€§ä»£æ•°2.3.1 æ ‡é‡ä»…åŒ…å«ä¸€ä¸ªæ•°å€¼è¢«ç§°ä¸ºæ ‡é‡ï¼ˆscalarï¼‰, å¦‚æœè¦å°†æ­¤åæ°åº¦å€¼è½¬æ¢ä¸ºæ›´å¸¸ç”¨çš„æ‘„æ°åº¦ï¼Œ åˆ™å¯ä»¥è®¡ç®—è¡¨è¾¾å¼ $c &#x3D; \\frac{5}{9}(f-32)$$\\mathbb{R}$è¡¨ç¤ºæ‰€æœ‰å®æ•°æ ‡é‡çš„ç©ºé—´ï¼Œè¡¨è¾¾å¼ $x \\in \\mathbb{R}$ è¡¨ç¤ºxæ˜¯ä¸€ä¸ªå®å€¼æ ‡é‡çš„æ­£å¼å½¢å¼\n2.3.2 å‘é‡å‘é‡ï¼ˆvectorï¼‰å¯ä»¥è¢«è§†ä¸ºæ ‡é‡å€¼ç»„æˆçš„åˆ—è¡¨ã€‚ä¸€ä¸ªå‘é‡Xç”±nä¸ªå®å€¼æ ‡é‡ç»„æˆï¼Œå¯ä»¥å°†å…¶è¡¨ç¤ºä¸º $x \\in \\mathbb{R}^n$ å‘é‡çš„é•¿åº¦é€šå¸¸ç§°ä¸ºå‘é‡çš„ç»´åº¦ã€‚å½¢çŠ¶ï¼ˆshapeï¼‰æ˜¯ä¸€ä¸ªå…ƒç´ ç»„ï¼Œåˆ—å‡ºäº†å¼ é‡æ²¿æ¯ä¸ªè½´çš„é•¿åº¦ï¼ˆç»´æ•°ï¼‰\n2.3.3 çŸ©é˜µæ­£å¦‚å‘é‡å°†æ ‡é‡ä»é›¶é˜¶æ¨å¹¿åˆ°ä¸€é˜¶ï¼ŒçŸ©é˜µå°†å‘é‡ä»ä¸€é˜¶æ¨å¹¿åˆ°äºŒé˜¶ï¼Œæ•°å­¦è¡¨ç¤ºæ³•ä½¿ç”¨ $A \\in \\mathbb{R}^{m \\times n}$ æ¥è¡¨ç¤ºçŸ©é˜µAã€‚å½“æˆ‘ä»¬äº¤æ¢çŸ©é˜µçš„è¡Œå’Œåˆ—æ—¶ï¼Œç»“æœç§°ä¸ºçŸ©é˜µçš„è½¬ç½®ï¼Œé€šå¸¸ç”¨$a^{\\top}$è¡¨ç¤ºçŸ©é˜µçš„è½¬ç½®\n2.3.4 å¼ é‡å¼ é‡æ˜¯æè¿°å…·æœ‰ä»»æ„æ•°é‡è½´çš„nç»´æ•°ç»„çš„é€šç”¨æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå‘é‡æ˜¯ä¸€é˜¶å¼ é‡ï¼ŒçŸ©é˜µæ˜¯äºŒé˜¶å¼ é‡ã€‚\n2.3.5 å¼ é‡ç®—æ³•çš„åŸºæœ¬æ€§è´¨ç»™å®šå…·æœ‰ç›¸åŒå½¢çŠ¶çš„ä»»æ„ä¸¤ä¸ªå¼ é‡ï¼Œä»»ä½•æŒ‰å…ƒç´ äºŒå…ƒè¿ç®—çš„ç»“æœéƒ½å°†æ˜¯ç›¸åŒå½¢çŠ¶çš„å¼ é‡ã€‚ä¸¤ä¸ªçŸ©é˜µçš„æŒ‰å…ƒç´ ä¹˜æ³•ç§°ä¸ºHadamardç§¯ï¼ˆHadamard productï¼‰æ•°å­¦ç¬¦å· $\\bigodot$\nA * B&lt;tf.Tensor: shape=(5, 4), dtype=float32, numpy=array([[  0.,   1.,   4.,   9.],       [ 16.,  25.,  36.,  49.],       [ 64.,  81., 100., 121.],       [144., 169., 196., 225.],       [256., 289., 324., 361.]], dtype=float32)&gt;\n\nå°†å¼ é‡ä¹˜ä»¥æˆ–åŠ ä¸Šä¸€ä¸ªæ ‡é‡ä¸ä¼šæ”¹å˜å¼ é‡çš„å½¢çŠ¶ï¼Œå…¶ä¸­å¼ é‡çš„æ¯ä¸ªå…ƒç´ éƒ½å°†ä¸æ ‡é‡ç›¸åŠ æˆ–ç›¸ä¹˜ã€‚\n2.3.6 é™ç»´æˆ‘ä»¬å¯ä»¥å¯¹ä»»æ„å¼ é‡è¿›è¡Œçš„ä¸€ä¸ªæœ‰ç”¨çš„æ“ä½œæ˜¯è®¡ç®—å…¶å…ƒç´ çš„å’Œã€‚ æ•°å­¦è¡¨ç¤ºæ³•ä½¿ç”¨ $\\sum$ ç¬¦å·è¡¨ç¤ºæ±‚å’Œã€‚ä¸ºäº†è¡¨ç¤ºé•¿åº¦ä¸ºdçš„å‘é‡ä¸­å…ƒç´ çš„æ€»å’Œï¼Œå¯ä»¥è®°ä¸º $\\sum^d_{i&#x3D;1}x_i$ ä»£ç é‡Œçš„æ±‚å’Œå‡½æ•°\nx = tf.range(4, dtype=tf.float32)x, tf.reduce_sum(x)(&lt;tf.Tensor: shape=(4,), dtype=float32, numpy=array([0., 1., 2., 3.], dtype=float32)&gt;, &lt;tf.Tensor: shape=(), dtype=float32, numpy=6.0&gt;)\n\næˆ‘ä»¬å¯ä»¥è¡¨ç¤ºä»»æ„å½¢çŠ¶å¼ é‡çš„å…ƒç´ å’Œã€‚ä¾‹å¦‚çŸ©é˜µAä¸­å…ƒç´ çš„å’Œå¯ä»¥è®°ä¸º $\\sum^m_{i&#x3D;1}\\sum^n_{j&#x3D;1}a_{ij}$\né»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ±‚å’Œå‡½æ•°ä¼šæ²¿æ‰€æœ‰çš„è½´é™ä½å¼ é‡çš„ç»´åº¦ï¼Œä½¿å®ƒå˜ä¸ºä¸€ä¸ªæ ‡é‡ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šå¼ é‡æ²¿å“ªä¸€ä¸ªè½´æ¥é€šè¿‡æ±‚å’Œé™ä½ç»´åº¦ã€‚ä»¥çŸ©é˜µä¸ºä¾‹ï¼Œä¸ºäº†é€šè¿‡æ±‚å’Œæ‰€æœ‰è¡Œçš„å…ƒç´ æ¥é™ç»´ï¼ˆè½´0 çºµè½´ï¼‰ï¼Œå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶æŒ‡å®šaxis=0ã€‚ ç”±äºè¾“å…¥çŸ©é˜µæ²¿0è½´é™ç»´ä»¥ç”Ÿæˆè¾“å‡ºå‘é‡ï¼Œå› æ­¤è¾“å…¥è½´0çš„ç»´æ•°åœ¨è¾“å‡ºå½¢çŠ¶ä¸­æ¶ˆå¤±ã€‚\nA_sum_axis0 = A.sum(axis=0)A_sum_axis0, A_sum_axis0.shape(array([40., 45., 50., 55.]), (4,))\n\nä¸æ±‚å’Œç›¸å…³çš„é‡æ˜¯å¹³å‡å€¼ï¼ˆmeanæˆ–averageï¼‰\næœ‰æ—¶åœ¨è°ƒç”¨å‡½æ•°æ¥è®¡ç®—æ€»å’Œæˆ–å‡å€¼æ—¶ä¿æŒè½´æ•°ä¸å˜ä¼šå¾ˆæœ‰ç”¨\nsum_A = A.sum(axis=1, keepdims=True)sum_Aarray([[ 6.],       [22.],       [38.],       [54.],       [70.]])\n\n2.3.7 ç‚¹ç§¯ç»™å®šä¸¤ä¸ªå‘é‡x,yï¼Œä»–ä»¬çš„ç‚¹ç§¯æ˜¯ç›¸åŒä½ç½®çš„æŒ‰å…ƒç´ ä¹˜ç§¯çš„å’Œ $x^{\\Tau}y&#x3D;\\sum^d_{i&#x3D;1}x_iy_i$\ny = np.ones(4)x, y, np.dot(x, y)(array([0., 1., 2., 3.]), array([1., 1., 1., 1.]), array(6.))\n\n2.3.8 çŸ©é˜µ-å‘é‡ç§¯å®šä¹‰çŸ©é˜µ $A \\in \\mathbb{R}^{m \\times n}$ å’Œå‘é‡ $x \\in \\mathbb{R}^n$ æˆ‘ä»¬è®©çŸ©é˜µAç”¨å®ƒçš„è¡Œå‘é‡è¡¨ç¤ºï¼š$$A &#x3D; \\begin{bmatrix}  a^{\\Tau}_1\\  a^{\\Tau}_2\\  \\vdots\\  a^{\\Tau}_m\\end{bmatrix}$$å…¶ä¸­æ¯ä¸ª $a^{\\Tau}_i \\in \\mathbb{R}^n$ éƒ½æ˜¯è¡Œå‘é‡ï¼Œè¡¨ç¤ºçŸ©é˜µçš„ç¬¬iè¡Œã€‚çŸ©é˜µå‘é‡ç§¯Axæ˜¯ä¸€ä¸ªé•¿åº¦ä¸ºmçš„åˆ—å‘é‡ï¼Œå…¶ç¬¬iä¸ªå…ƒç´ æ˜¯ç‚¹ç§¯ $a^{\\Tau}_ix$$$Ax &#x3D; \\begin{bmatrix}  a^{\\Tau}_1\\  a^{\\Tau}_2\\  \\vdots\\  a^{\\Tau}_m\\end{bmatrix}x&#x3D;\\begin{bmatrix}  a^{\\Tau}_1x\\  a^{\\Tau}_2x\\  \\vdots\\  a^{\\Tau}_mx\\end{bmatrix}$$æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨çŸ©é˜µ-å‘é‡ç§¯æ¥æè¿°åœ¨ç»™å®šå‰ä¸€å±‚çš„å€¼æ—¶ï¼Œ æ±‚è§£ç¥ç»ç½‘ç»œæ¯ä¸€å±‚æ‰€éœ€çš„å¤æ‚è®¡ç®—\nA.shape, x.shape, tf.linalg.matvec(A, x)(TensorShape([5, 4]), TensorShape([4]), &lt;tf.Tensor: shape=(5,), dtype=float32, numpy=array([ 14.,  38.,  62.,  86., 110.], dtype=float32)&gt;)\n\n2.3.9 çŸ©é˜µ-çŸ©é˜µä¹˜æ³•å‡è®¾æœ‰ä¸¤ä¸ªçŸ©é˜µ $A \\in \\mathbb{R}^{n \\times k}$ å’Œ $B \\in \\mathbb{R}^{k \\times m}$ ç”¨è¡Œå‘é‡ $a^{\\Tau}_i \\in \\mathbb{R}^k$ è¡¨ç¤ºçŸ©é˜µAçš„ç¬¬iè¡Œï¼Œå¹¶è®©åˆ—å‘é‡ $b_j \\in \\mathbb{R}^k$ ä½œä¸ºçŸ©é˜µBçš„ç¬¬jåˆ—ã€‚è¦ç”ŸæˆçŸ©é˜µç§¯ $C &#x3D; B \\times A$ ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯è€ƒè™‘Açš„è¡Œå‘é‡å’ŒBçš„åˆ—å‘é‡:$$C&#x3D;A \\times B&#x3D;\\begin{bmatrix}  a^{\\Tau}_1\\  a^{\\Tau}_2\\  \\vdots\\  a^{\\Tau}_m\\end{bmatrix}\\begin{bmatrix}b_1&amp;b_2&amp;\\cdots&amp; b_m\\end{bmatrix}&#x3D;\\begin{bmatrix}  a^{\\Tau}_1b_1&amp;a^{\\Tau}_1b_2&amp;\\cdots&amp;a^{\\Tau}_1b_m\\  a^{\\Tau}_2b_1&amp;a^{\\Tau}_2b_2&amp;\\cdots&amp;a^{\\Tau}_2b_m\\  {\\vdots}&amp;{\\vdots}&amp;{\\ddots}&amp;{\\vdots}\\  a^{\\Tau}_nb_1&amp;a^{\\Tau}_nb_2&amp;\\cdots&amp;a^{\\Tau}_nb_m\\end{bmatrix}$$\n2.3.10 èŒƒæ•°å‘é‡çš„èŒƒæ•°æ˜¯è¡¨ç¤ºä¸€ä¸ªå‘é‡æœ‰å¤šå¤§ã€‚\nåœ¨çº¿æ€§ä»£æ•°ä¸­ï¼Œå‘é‡èŒƒæ•°æ˜¯å°†å‘é‡æ˜ å°„åˆ°æ ‡é‡çš„å‡½æ•° $f$ ã€‚ ç»™å®šä»»æ„å‘é‡xï¼Œå‘é‡èŒƒæ•°è¦æ»¡è¶³ä¸€äº›å±æ€§ã€‚ ç¬¬ä¸€ä¸ªæ€§è´¨æ˜¯ï¼šå¦‚æœæˆ‘ä»¬æŒ‰å¸¸æ•°å› å­ $\\alpha$ ç¼©æ”¾å‘é‡çš„æ‰€æœ‰å…ƒç´ ï¼Œ å…¶èŒƒæ•°ä¹Ÿä¼šæŒ‰ç›¸åŒå¸¸æ•°å› å­çš„ç»å¯¹å€¼ç¼©æ”¾ï¼š$$f(\\alpha x)&#x3D;|\\alpha|f(x)$$ç¬¬äºŒä¸ªæ€§è´¨æ˜¯ç†Ÿæ‚‰çš„ä¸‰è§’ä¸ç­‰å¼:$$f(x+y) \\leq f(x) + f(y)$$ç¬¬ä¸‰ä¸ªæ€§è´¨ç®€å•åœ°è¯´èŒƒæ•°å¿…é¡»æ˜¯éè´Ÿçš„:$$f(x) \\geq 0$$è¿™æ˜¯æœ‰é“ç†çš„ã€‚å› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»»ä½•ä¸œè¥¿çš„æœ€å°çš„å¤§å°æ˜¯0ã€‚ æœ€åä¸€ä¸ªæ€§è´¨è¦æ±‚èŒƒæ•°æœ€å°ä¸º0ï¼Œå½“ä¸”ä»…å½“å‘é‡å…¨ç”±0ç»„æˆã€‚ $\\forall$ è¡¨ç¤ºä»»ä½•ä¸€ä¸ª$$\\forall i,\\begin{bmatrix}  x\\end{bmatrix}_i&#x3D;0 \\Leftrightarrow f(x)&#x3D;0$$æ¬§å‡ é‡Œå¾—è·ç¦»æ˜¯ä¸€ä¸ª $L_2$ èŒƒæ•°ï¼š å‡è®¾nç»´å‘é‡xä¸­çš„å…ƒç´ æ˜¯ $x_1,\\cdots x_n$ ï¼Œå…¶ $L_2$ èŒƒæ•°æ˜¯å‘é‡å…ƒç´ å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ï¼š$$||x||2&#x3D;\\sqrt{\\sum^n{i&#x3D;1}x^2_i}$$è®¡ç®—æ–¹å¼ä¸ºï¼š\nu = tf.constant([3.0, -4.0])tf.norm(u)&lt;tf.Tensor: shape=(), dtype=float32, numpy=5.0&gt;\n\nçŸ©é˜µ $X \\in \\mathbb{R}^{m \\times n}$ çš„ FrobeniusèŒƒæ•°æ˜¯çŸ©é˜µå…ƒç´ å¹³æ–¹å’Œå’Œå¹³æ–¹æ ¹ï¼š$$||x||F&#x3D;\\sqrt{\\sum^m{i&#x3D;1}\\sum^n_{j&#x3D;1}x^2_{ij}}$$\n2.4 å¾®ç§¯åˆ†2.4.1 å¯¼æ•°å’Œå¾®åˆ†åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©å¯¹äºæ¨¡å‹å‚æ•°å¯å¾®çš„æŸå¤±å‡½æ•°ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå¯¹äºæ¯ä¸ªå‚æ•°ï¼Œ å¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªå‚æ•°å¢åŠ æˆ–å‡å°‘ä¸€ä¸ªæ— ç©·å°çš„é‡ï¼Œå¯ä»¥çŸ¥é“æŸå¤±ä¼šä»¥å¤šå¿«çš„é€Ÿåº¦å¢åŠ æˆ–å‡å°‘ï¼Œ\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°$f$ ï¼š$\\mathbb{R}\\rightarrow\\mathbb{R}$ï¼Œå…¶è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯æ ‡é‡ã€‚å¦‚æœ$f$çš„å¯¼æ•°å­˜åœ¨ï¼Œè¿™ä¸ªæé™è¢«å®šä¹‰ä¸º$$f^{\\prime}(x)&#x3D;\\lim_{h\\rightarrow0}\\frac{f(x+h)-f(x)}{h}$$å¦‚æœ$f^{\\prime}(a)$å­˜åœ¨ï¼Œåˆ™ç§°fåœ¨aå¤„æ˜¯å¯å¾®çš„ï¼Œå°†$f^{\\prime}(x)$è§£é‡Šä¸ºf(x)ç›¸å¯¹äºxçš„ç¬æ—¶ï¼ˆinstantaneousï¼‰å˜åŒ–ç‡\nç†Ÿæ‚‰ä¸€ä¸‹å¯¼æ•°çš„å‡ ä¸ªç­‰ä»·ç¬¦å·ã€‚ç»™å®šy&#x3D;f(x)ï¼Œå…¶ä¸­xå’Œyåˆ†åˆ«æ˜¯å‡½æ•°$f$çš„è‡ªå˜é‡å’Œå› å˜é‡ã€‚ä»¥ä¸‹è¡¨è¾¾å¼æ˜¯ç­‰ä»·çš„ï¼š$$f^{\\prime}(x)&#x3D;y^{\\prime}&#x3D;\\frac{\\mathrm{d}y}{\\mathrm{d}x}&#x3D;\\frac{\\mathrm{d}f}{\\mathrm{d}x}&#x3D;\\frac{\\mathrm{d}}{\\mathrm{d}x}f(x)&#x3D;Df(x)&#x3D;D_xf(x)$$å…¶ä¸­ç¬¦å·$\\frac{\\mathrm{d}}{\\mathrm{d}x}$å’ŒDæ˜¯å¾®åˆ†è¿ç®—ç¬¦ï¼Œè¡¨ç¤ºå¾®åˆ†æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è§„åˆ™æ¥å¯¹å¸¸è§å‡½æ•°æ±‚å¾®åˆ†ï¼š\n\n$DC&#x3D;0$ï¼ˆCæ˜¯ä¸€ä¸ªå¸¸æ•°ï¼‰\n$Dx^n&#x3D;nx^n-1$ï¼ˆpower rule,næ˜¯ä»»æ„å®æ•°ï¼‰\n$De^x&#x3D;e^e$\n$D\\ln(x)&#x3D;1&#x2F;x$\n\nä¸ºäº†å¾®åˆ†ä¸€ä¸ªç”±å¸¸è§å‡½æ•°ç»„æˆçš„å‡½æ•°ï¼Œä¸‹é¢ä¸€äº›æ³•åˆ™æ–¹ä¾¿ä½¿ç”¨ã€‚å‡è®¾$f$å’Œ$g$éƒ½æ˜¯å¯å¾®çš„ï¼ŒCæ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œåˆ™å¸¸æ•°ç›¸ä¹˜æ³•åˆ™ï¼š$$\\frac{\\mathrm{d}}{\\mathrm{d}x}[Cf(x)]&#x3D;C\\frac{\\mathrm{d}}{\\mathrm{d}x}f(x)$$åŠ æ³•æ³•åˆ™ï¼š$$\\frac{\\mathrm{d}}{\\mathrm{d}x}[f(x)+g(x)]&#x3D;\\frac{\\mathrm{d}}{\\mathrm{d}x}f(x)+\\frac{\\mathrm{d}}{\\mathrm{d}x}g(x)$$ä¹˜æ³•æ³•åˆ™ï¼š$$\\frac{\\mathrm{d}}{\\mathrm{d}x}[f(x)g(x)]&#x3D;f(x)\\frac{\\mathrm{d}}{\\mathrm{d}x}[g(x)]+g(x)\\frac{\\mathrm{d}}{\\mathrm{d}x}[f(x)]$$é™¤æ³•æ³•åˆ™ï¼š$$\\frac{\\mathrm{d}}{\\mathrm{d}x}[\\frac{f(x)}{g(x)}]&#x3D;\\frac{g(x)\\frac{\\mathrm{d}}{\\mathrm{d}x}[f(x)]-f(x)\\frac{\\mathrm{d}}{\\mathrm{d}x}[g(x)]}{[g(x)]^2}$$\n2.4.2 åå¯¼æ•°æ·±åº¦å­¦ä¹ ä¸­ï¼Œå‡½æ•°é€šå¸¸ä¾èµ–è®¸å¤šå˜é‡ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å°†å¾®åˆ†æ€æƒ³æ¨å¹¿åˆ°å¤šå…ƒå‡½æ•°\nè®¾$y&#x3D;f(x_1,x_2,\\ldots,x_n)$æ˜¯ä¸€ä¸ªå…·æœ‰nä¸ªå˜é‡çš„å‡½æ•°ã€‚yå…³äºç¬¬iä¸ªå‚æ•°$x_i$çš„åå¯¼æ•°ä¸ºï¼ˆpartial derivativeï¼‰ï¼š$$\\frac{\\partial{y}}{\\partial{x_i}}&#x3D;\\lim_{h\\rightarrow0}\\frac{f(x_1,\\ldots,x_{i-1},x_i+h,x_{i+1},\\ldots,x_n)}{h}$$å¯¹äºåå¯¼æ•°çš„è¡¨ç¤ºï¼Œä»¥ä¸‹æ˜¯ç­‰ä»·çš„ï¼š$$\\frac{\\partial{y}}{\\partial{x_i}}&#x3D;\\frac{\\partial{f}}{\\partial{x_i}}&#x3D;f_{xi}&#x3D;f_i&#x3D;D_if&#x3D;D_{xi}f$$\n2.4.3 æ¢¯åº¦æˆ‘ä»¬å¯ä»¥è¿ç»“ä¸€ä¸ªå¤šå…ƒå‡½æ•°å¯¹å…¶æ‰€æœ‰å˜é‡çš„åå¯¼æ•°ï¼Œä»¥å¾—åˆ°è¯¥å‡½æ•°çš„æ¢¯åº¦å‘é‡ï¼Œè®¾å‡½æ•°$f:\\mathbb{R}^n\\rightarrow\\mathbb{R}$çš„è¾“å…¥æ˜¯ä¸€ä¸ªnç»´å‘é‡$X&#x3D;[x_1,x_2,\\ldots,x_n]\\top$,å¹¶ä¸”è¾“å‡ºæ˜¯ä¸€ä¸ªæ ‡é‡ã€‚å‡½æ•°f(X)ç›¸å¯¹äºXçš„æ¢¯åº¦æ˜¯ä¸€ä¸ªåŒ…å«nä¸ªåå¯¼æ•°çš„å‘é‡ï¼š$$\\nabla{x} f(X)&#x3D;[\\frac{\\partial{f(x)}}{\\partial{x_1}},\\frac{\\partial{f(x)}}{\\partial{x_2}},\\ldots,\\frac{\\partial{f(x)}}{\\partial{x_n}}]\\top$$å‡è®¾Xä¸ºnç»´å‘é‡ï¼Œåœ¨å¾®åˆ†å¤šå…ƒå‡½æ•°æ—¶ç»å¸¸ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ï¼š\n\nå¯¹äºæ‰€æœ‰$A\\in\\mathbb{R}^{m \\times n}$,éƒ½æœ‰$\\nabla{x} AX&#x3D;A^\\top$\nå¯¹äºæ‰€æœ‰çš„$A\\in\\mathbb{R}^{m \\times n}$,éƒ½æœ‰$\\nabla{x} X^{\\top}A&#x3D;A$\nå¯¹äºæ‰€æœ‰çš„$A\\in\\mathbb{R}^{m \\times n}$,éƒ½æœ‰$\\nabla{x} X^{\\top}AX&#x3D;(A+A^{\\top})X$\n$\\nabla{x} \\left|x\\right|^2&#x3D;\\nabla{x}X^{\\top}X&#x3D;2X$\n\n2.4.4 é“¾å¼æ³•åˆ™å¤šå…ƒå‡½æ•°æ˜¯å¤åˆçš„ï¼Œé“¾å¼æ³•åˆ™å¯ä»¥è¢«ç”¨æ¥å¾®åˆ†å¤åˆå‡½æ•°ã€‚\nå…ˆè€ƒè™‘å•å˜é‡å‡½æ•°ã€‚å‡è®¾å‡½æ•°y&#x3D;f(u)å’Œu&#x3D;g(x)éƒ½æ˜¯å¯å¾®çš„ï¼Œæ ¹æ®é“¾å¼æ³•åˆ™ï¼š$$\\frac{\\mathrm{d}y}{\\mathrm{d}x}&#x3D;\\frac{\\mathrm{d}y}{\\mathrm{d}u}\\frac{\\mathrm{d}u}{\\mathrm{d}x}$$ç°åœ¨è€ƒè™‘ä¸€ä¸ªæ›´ä¸€èˆ¬çš„åœºæ™¯ï¼Œå³å‡½æ•°å…·æœ‰ä»»æ„æ•°é‡çš„å˜é‡çš„æƒ…å†µã€‚ å‡è®¾å¯å¾®åˆ†å‡½æ•°$y$æœ‰å˜é‡$u_1,u_2,\\ldots,u_m$ï¼Œå…¶ä¸­æ¯ä¸ªå¯å¾®åˆ†å‡½æ•°$u_i$éƒ½æœ‰å˜é‡$x_1,x_2,\\ldots,x_n$ã€‚ æ³¨æ„ï¼Œ$y$æ˜¯$u_1,u_2,\\ldots,u_m$çš„å‡½æ•°ã€‚ å¯¹äºä»»æ„$i&#x3D;1,2,\\ldots,n$ï¼Œé“¾å¼æ³•åˆ™ç»™å‡ºï¼š$$\\frac{\\partial{y}}{\\partial{x_i}}&#x3D;\\frac{\\partial{y}}{\\partial{u_i}}\\frac{\\partial{u_1}}{\\partial{x_i}}+\\frac{\\partial{y}}{\\partial{u_2}}\\frac{\\partial{u_2}}{\\partial{x_i}}+\\ldots+\\frac{\\partial{y}}{\\partial{u_m}}\\frac{\\partial{u_m}}{\\partial{x_i}}$$\n","categories":["AI"],"tags":["å­¦ä¹ "]},{"title":"linuxæ·±å…¥äº†è§£","url":"/java4u/2023/02/01/linux%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3/","content":"å¸¸ç”¨æŒ‡ä»¤æ–‡ä»¶ç›®å½•\ncat æŸ¥çœ‹æ–‡ä»¶å†…å®¹\nmore æ–‡æœ¬è¿‡æ»¤å™¨\nless ä¸moreç›¸ä¼¼ï¼Œå¤§å‹æ–‡ä»¶å…·æœ‰è¾ƒé«˜æ•ˆç‡\n**&gt;**è¦†ç›– **&gt;&gt;**è¿½åŠ \nln è½¯é“¾æ¥ target linkname\nhistory æŸ¥çœ‹å·²ç»æ‰§è¡Œçš„å†å²å‘½ä»¤ history 10 æœ€è¿‘10ä¸ªæŒ‡ä»¤  !10 æ‰§è¡Œç¬¬10æ¡æŒ‡ä»¤\n\næ—¶é—´æ—¥æœŸ\ndate å±•ç¤ºæ—¶é—´  date â€œ+%Y-%m-%d %H:%M:%Sâ€  å®šä¹‰æ ¼å¼\ndate -s â€œ2022-02-04 11:19:20â€ ä¿®æ”¹ç³»ç»Ÿæ—¶é—´\ncal æŸ¥çœ‹æ—¥å† [2023] å±•ç¤ºæ•´å¹´æ—¥å†\n\næŸ¥æ‰¾\nfind [æœç´¢èŒƒå›´] [é€‰é¡¹] ä»æŒ‡å®šç›®å½•å‘ä¸‹é€’å½’æœç´¢\n-name æŒ‰ç…§æ–‡ä»¶åæŸ¥æ‰¾\n-user  æŸ¥æ‰¾å±äºæŒ‡å®šç”¨æˆ·çš„æ–‡ä»¶\n-size æŒ‡å®šæ–‡ä»¶å¤§å°æŸ¥æ‰¾ (+nå¤§äº -nå°äº nç­‰äº)\n\n\nlocate å¯ä»¥å¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œå¿…é¡»ä½¿ç”¨updatedbåˆ›å»ºlocateæ•°æ®åº“\ngrep [é€‰é¡¹] æŸ¥æ‰¾å†…å®¹ æºæ–‡ä»¶, è¿‡æ»¤æŸ¥è¯¢\n\nå‹ç¼©å’Œè§£å‹\ngzip&#x2F;gunzip   å‹ç¼©æˆ*.gzæ–‡ä»¶\n\nzip&#x2F;unzip   å‹ç¼©æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æˆ*.zip\n\ntar  æ‰“åŒ…æŒ‡ä»¤ï¼Œæ‰“åŒ…æ–‡ä»¶æ˜¯.tar.gz\n\n-c äº§ç”Ÿ.taræ‰“åŒ…æ–‡ä»¶\n-v æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\n-f æŒ‡å®šå‹ç¼©åæ–‡ä»¶å\n-z æ‰“åŒ…åŒæ—¶å‹ç¼©\n-x è§£åŒ….taræ–‡ä»¶\n\nå‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œå°†a.txtå’Œbå‹ç¼©æˆab.tar.gz\ntar -zcvf ab.tar.gz a.txt b\n\nè§£å‹ab.tar.gz\ntar -zxvf ab.tar.gz\n\nç»„ç®¡ç†å’Œæƒé™ç®¡ç†\nchown ç”¨æˆ·å æ–‡ä»¶å    ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…\n\nchgrp ç»„å æ–‡ä»¶å  ä¿®æ”¹æ–‡ä»¶æ‰€åœ¨ç»„\n\nusermod -g æ–°ç»„å ç”¨æˆ·å   æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„\n\nchmod ä¿®æ”¹æƒé™\n\n+&#x2F;-&#x2F;&#x3D;å˜æ›´æƒé™\nuæ‰€æœ‰è€… gæ‰€æœ‰ç»„ oå…¶ä»–äºº aæ‰€æœ‰äºº\nchmod u&#x3D;rwx,g&#x3D;rx,o&#x3D;x æ–‡ä»¶&#x2F;ç›®å½•å\nchmod o+w æ–‡ä»¶&#x2F;ç›®å½•å  ç»™å…¶ä»–äººèµ‹äºˆå†™çš„æƒé™\nchmod a-x æ–‡ä»¶&#x2F;ç›®å½•å æ‰€æœ‰äººå»é™¤æ‰§è¡Œçš„æƒé™\n\né€šè¿‡æ•°å­—å˜æ›´æƒé™\nr&#x3D;4,w&#x3D;2,x&#x3D;1ï¼ˆ1x,2w,3wx,4r,5rx,6rw,7rwxï¼‰\nchmod u&#x3D;rwx,g&#x3D;rx,o&#x3D;x æ–‡ä»¶&#x2F;ç›®å½•å\nç›¸å½“äº chmod 751 æ–‡ä»¶&#x2F;ç›®å½•å\n\n\n\n\næƒé™è¯´æ˜drwxr-xr-x01234567891.ç¬¬0ä½ç¡®è®¤æ–‡ä»¶ç±»å‹(d,-,l,c,b)\tlé“¾æ¥\tdç›®å½•\tcå­—ç¬¦è®¾å¤‡ï¼Œé¼ æ ‡ï¼Œé”®ç›˜\tbå—è®¾å¤‡ï¼Œç¡¬ç›˜\t-æ–‡ä»¶2.ç¬¬1-3ç¡®è®¤æ–‡ä»¶æ‰€æœ‰è€…æ‹¥æœ‰è¯¥æ–‡ä»¶çš„æƒé™ --User3.ç¬¬4-6ç¡®è®¤æ–‡ä»¶æ‰€å±ç»„æ‹¥æœ‰è¯¥æ–‡ä»¶çš„æƒé™ --Group4.ç¬¬7-9ç¡®è®¤å…¶ä»–ç”¨æˆ·æ‹¥æœ‰è¯¥æ–‡ä»¶çš„æƒé™ --Otherrwxä½œç”¨åˆ°æ–‡ä»¶1.[r]å¯è¯»2.[w]å¯å†™ï¼Œä¸ä»£è¡¨å¯åˆ ï¼Œåˆ é™¤æ–‡ä»¶éœ€è¦å¯¹æ‰€åœ¨ç›®å½•æœ‰å†™çš„æƒé™3.[x]å¯æ‰§è¡Œrwxä½œç”¨åˆ°ç›®å½•1.[r]å¯è¯»ï¼Œå¯ä»¥åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶2.[w]å¯å†™ï¼Œå¯¹ç›®å½•å†…åˆ›å»ºï¼Œåˆ é™¤ï¼Œé‡å‘½å3.[x]å¯æ‰§è¡Œï¼Œå¯ä»¥è¿›å…¥è¯¥ç›®å½•\n\nå®šæ—¶ä»»åŠ¡è°ƒåº¦\ncrontab [-e]ç¼–è¾‘crontabå®šæ—¶ä»»åŠ¡ [-l]æŸ¥è¯¢crontab ä»»åŠ¡ [-r]åˆ é™¤å½“å‰ç”¨æˆ·æ‰€æœ‰çš„crontab ä»»åŠ¡\n\ncronè¡¨è¾¾å¼ç¬¬ä¸€ä¸ª*  ä¸€å°æ—¶ä¸­ç¬¬å‡ åˆ†é’Ÿ  0-59ç¬¬äºŒä¸ª*  ä¸€å¤©ä¸­ç¬¬å‡ å°æ—¶    0-23ç¬¬ä¸‰ä¸ª*  ä¸€ä¸ªæœˆä¸­ç¬¬å‡ å¤©    1-31ç¬¬å››ä¸ª*  ä¸€å¹´ä¸­ç¬¬å‡ æœˆ      1-12ç¬¬äº”ä¸ª*  ä¸€å‘¨ä¸­æ˜ŸæœŸå‡       0-7ï¼ˆ0/7éƒ½ä»£è¡¨æ˜ŸæœŸæ—¥ï¼‰* ä»£è¡¨ä»»ä½•æ—¶é—´ï¼Œä»£è¡¨ä¸è¿ç»­çš„æ—¶é—´- ä»£è¡¨è¿ç»­çš„æ—¶é—´*/n  ä»£è¡¨æ¯éš”å¤šä¹…æ‰§è¡Œä¸€æ¬¡\n\n\nat [é€‰é¡¹] [æ—¶é—´] ä¸€æ¬¡æ€§å®šæ—¶ä»»åŠ¡\n1.æ¥å—å½“å¤©çš„hh:mmï¼ˆå°æ—¶ï¼šåˆ†é’Ÿï¼‰ï¼Œå¦‚æœæ—¶é—´è¿‡å»ï¼Œæ˜å¤©æ‰§è¡Œ2.midenight,non,teatimeç­‰æ¨¡ç³Šæ—¶é—´3.12å°æ—¶åˆ¶ 12pm4.å‘½ä»¤æ‰§è¡Œå…·ä½“æ—¶é—´ 5.ç›¸å¯¹è®¡æ—¶ 2å¤©åä¸‹åˆ5ç‚¹  \tat 5pm + 2 days6.ç›´æ¥ä½¿ç”¨today/tomorrow   æ˜å¤©ä¸‹åˆ5ç‚¹\tat 5pm tomorrow\n\nç£ç›˜åˆ†åŒº\nlsblk [-f] æŸ¥çœ‹è®¾å¤‡æŒ‚è½½æƒ…å†µ\n\nfdisk &#x2F;dev&#x2F;sdb   åˆ†åŒºå‘½ä»¤\n\nmkfs -t ext4 &#x2F;dev&#x2F;sdb1   æ ¼å¼åŒ–ç£ç›˜\n\nmount &#x2F;dev&#x2F;sdb1 &#x2F;newdisk  æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ\n\ndf -h ç£ç›˜æƒ…å†µæŸ¥è¯¢\n\ndu æŸ¥è¯¢æŒ‡å®šç›®å½•ç£ç›˜å ç”¨æƒ…å†µ\n\n-s æŒ‡å®šç›®å½•\n-h å¸¦è®¡é‡å•ä½\n-a å¸¦ä¸Šæ–‡ä»¶\n-c æ±‡æ€»\nâ€“max-depth&#x3D;1 å­ç›®å½•æ·±åº¦\n\næŸ¥è¯¢/optä¸‹æ–‡ä»¶çš„ä¸ªæ•°(è¿‡æ»¤å‡ºä»¥â€œ-â€å¼€å¤´çš„å°±æ˜¯æ–‡ä»¶)ls -l /opt | grep &quot;^-&quot; | wc -læŸ¥è¯¢/optæ–‡ä»¶ä¸ªæ•°åŒ…æ‹¬å­ç›®å½•ls -lR /opt | grep &quot;^-&quot; | wc -læ ‘å‹å±•ç¤ºç›®å½•ç»“æ„tree /opt\n\nè¿›ç¨‹ç®¡ç†\nps æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹\n-a æ˜¾ç¤ºå½“å‰ç»ˆç«¯æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯\n-u ä»¥ç”¨æˆ·æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯\n-x æ˜¾ç¤ºåå°è¿›ç¨‹è¿è¡Œçš„å‚æ•°\n-eæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ -f å…¨æ ¼å¼ã€‚æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹è¿›ç¨‹çš„çˆ¶è¿›ç¨‹\n\n\nkill [é€‰é¡¹] è¿›ç¨‹å·  ç»ˆæ­¢è¿›ç¨‹ -9 å¼ºåˆ¶è¿›ç¨‹ç»ˆæ­¢\nkillall  è¿›ç¨‹å  é€šè¿‡è¿›ç¨‹åæ€æ­»è¿›ç¨‹ï¼Œæ”¯æŒé€šé…ï¼Œä¹Ÿä¼šæ€æ­»å­è¿›ç¨‹\npstree æ›´åŠ ç›´è§‚å±•ç¤ºè¿›ç¨‹\n-p å±•ç¤ºpid\n-u æ˜¾ç¤ºè¿›ç¨‹æ‰€å±ç”¨æˆ·\n\n\n\næœåŠ¡ç®¡ç†\nservice [start|stop|restart|reload|status] æœåŠ¡å\nsystemctl get-default è·å–è¿è¡Œçº§åˆ«\nsystemctl [start|stop|restart|reload|status] æœåŠ¡å\nç®¡ç†çš„æœåŠ¡åœ¨&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;systemæŸ¥çœ‹\nsystemctl list-unit-filessystemctl  æŸ¥çœ‹æœåŠ¡è‡ªå¯åŠ¨çŠ¶æ€\nsystemctl enable(disable)  å¼€å¯æˆ–å…³é—­æœåŠ¡è‡ªå¯åŠ¨\nsystemctl is-enabled æœåŠ¡å   æŸ¥çœ‹æœåŠ¡è‡ªå¯åŠ¨çŠ¶æ€\n\n\nfirewall é˜²ç«å¢™\næ‰“å¼€ç«¯å£ firewall-cmd â€“permanent â€“add-port&#x3D;ç«¯å£å·&#x2F;åè®®\nå…³é—­ç«¯å£ firewall-cmd â€“permanent â€“remove-port&#x3D;ç«¯å£å·&#x2F;åè®®\né‡æ–°è½½å…¥æ‰èƒ½ç”Ÿæ•ˆ firewall-cmd â€“reload\næŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾  firewall-cmd â€“query-port&#x3D;ç«¯å£å·&#x2F;åè®®\n\n\ntop åŠ¨æ€ç›‘æ§ [-p ç›‘æ§æŒ‡å®šè¿›ç¨‹ID] [-d åˆ·æ–°é—´éš”]\nP ä»¥CPUä½¿ç”¨ç‡æ’åº\nM ä»¥å†…å­˜ä½¿ç”¨ç‡æ’åº\nu ç›‘æ§æŒ‡å®šç”¨æˆ·\nk ç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹\n\n\nnetstat ç›‘æ§ç½‘ç»œçŠ¶æ€ [-p å±•ç¤ºé‚£ä¸ªè¿›ç¨‹åœ¨è°ƒç”¨] [-an æŒ‰ä¸€å®šé¡ºåºæ’åˆ—]\n\nè½¯ä»¶åŒ…ç®¡ç†\nrpm\n\næŸ¥è¯¢å·²å®‰è£…çš„rpm  rpm -qa | grep xx\nfirefox-60.2.2-1.el7.centos.x86_64\nfirefox åç§°\n60.2.2-1 ç‰ˆæœ¬å·\nel7.centos.x86_64  é€‚ç”¨æ“ä½œç³»ç»Ÿ noarché€‚ç”¨é€šç”¨ç‰ˆæœ¬\n\n\nrpm -q è½¯ä»¶åŒ…  æŸ¥è¯¢è½¯ä»¶åŒ…æ˜¯å¦å®‰è£…\nrpm -e è½¯ä»¶åŒ…   å¸è½½\nrpm -ivh RPMåŒ…å…¨è·¯å¾„åç§°\n\n\nyum èƒ½å¤Ÿä»æŒ‡å®šæœåŠ¡å™¨è‡ªåŠ¨ä¸‹è½½RPMåŒ…å¹¶å®‰è£…\n\nyum list | grep xxè½¯ä»¶åˆ—è¡¨   æŸ¥è¯¢yumæœåŠ¡å™¨æ˜¯å¦æœ‰éœ€è¦å®‰è£…çš„è½¯ä»¶\nyum install xxx   ä¸‹è½½å®‰è£…\n\n\napt \n\n&#x2F;etc&#x2F;apt&#x2F;sources.list  æœåŠ¡å™¨åœ°å€\n\naptè½¯ä»¶æ“ä½œ\nsudo apt-get update æ›´æ–°æºsudo apt-get install package  å®‰è£…åŒ…sudo apt-get remove package åˆ é™¤åŒ…sudo apt-cache show package è·å–åŒ…ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¯´æ˜/å¤§å°/ç‰ˆæœ¬ç­‰sudo apt-get source package ä¸‹è½½è¯¥åŒ…çš„æºä»£ç \n\n\n\nshell\nä½ç½®å‚æ•°\n\n$n $0å‘½ä»¤æœ¬èº«ï¼Œ$1-$9ä»£è¡¨ç¬¬ä¸€åˆ°ç¬¬ä¹ä¸ªå‚æ•°ï¼Œåä»¥ä¸Š${10}\n$* ä»£è¡¨å‘½ä»¤è¡Œä¸­æ‰€æœ‰å‚æ•°æ•´ä½“å¯¹å¾…\ns@ å‘½ä»¤è¡Œä¸­æ‰€æœ‰å‚æ•°åˆ†åˆ«å¯¹å¾…\ns# å‘½ä»¤è¡Œä¸­å‚æ•°ä¸ªæ•°\n\n\né¢„å®šä¹‰å˜é‡\n\n$$  å½“å‰è¿›ç¨‹çš„è¿›ç¨‹å·\n$!   åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·\n$?  æœ€åä¸€æ¬¡æ‰§è¡Œå‘½ä»¤è¿”å›çŠ¶æ€ï¼Œè¿”å›0è¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ­£ç¡®æ‰§è¡Œ\n\n\nè¿ç®—ç¬¦\n\n$((è¿ç®—ç¬¦)) æˆ– $[è¿ç®—ç¬¦] expr m + n\n\n\næ¡ä»¶åˆ¤æ–­\n\nåˆ¤æ–­è¯­å¥ [ condition ] (conditionå‰åè¦æœ‰ç©ºæ ¼)\n&#x3D; å­—ç¬¦ä¸²æ¯”è¾ƒ\n2ä¸ªæ•´æ•°æ¯”è¾ƒ\n-lt å°äº\nle å°äºç­‰äº\neq ç­‰äº\ngt å¤§äº\nge å¤§äºç­‰äº \nne ä¸ç­‰äº\n\n\næŒ‰ç…§æ–‡ä»¶æƒé™è¿›è¡Œåˆ¤æ–­\n-r æœ‰è¯»çš„æƒé™\n-w æœ‰å†™çš„æƒé™\n-x æœ‰æ‰§è¡Œçš„æƒé™\n\n\næŒ‰ç…§æ–‡ä»¶ç±»å‹è¿›ç¨‹åˆ¤æ–­\n-f æ–‡ä»¶å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªå¸¸è§„æ–‡ä»¶\n-e æ–‡ä»¶å­˜åœ¨\n-d æ–‡ä»¶å­˜åœ¨å¹¶æ˜¯ä¸€ä¸ªç›®å½•\n\n\n\n\ncase\n#!/bin/bashcase $1 in&quot;1&quot;)        echo &quot;monday&quot;;;&quot;2&quot;)        echo &quot;tusday&quot;;;*)        echo &quot;other&quot;;;esac\n\nforå¾ªç¯\n\nåŸºæœ¬è¯­æ³•1\nfor å˜é‡ in å€¼1 å€¼2 å€¼3\ndo\nç¨‹åº\ndone\n\nåŸºæœ¬è¯­æ³•2\nfor (( åˆå§‹å€¼;å¾ªç¯æ§åˆ¶æ¡ä»¶;å˜é‡å˜åŒ– ))\ndo\nç¨‹åº\ndone\n\n\n\nwhileå¾ªç¯\nwhile [ condition ]\ndo\nç¨‹åº\ndone\n\nread è¯»å–æ§åˆ¶å°è¾“å…¥\n-p æŒ‡å®šè¯»å–å€¼æ—¶çš„æç¤ºç¬¦\n-t æŒ‡å®šè¯»å–æ—¶ç­‰å¾…çš„æ—¶é—´\n\nå‡½æ•°\n\nç³»ç»Ÿå‡½æ•° basename\nè¿”å›å®Œæ•´è·¯å¾„æœ€å&#x2F;çš„éƒ¨åˆ†ï¼Œå¸¸ç”¨äºè·å–æ–‡ä»¶å\ndirname è¿”å›å®Œæ•´è·¯å¾„æœ€å&#x2F;å‰é¢çš„éƒ¨åˆ†ï¼Œç”¨äºè¿”å›è·¯å¾„\n\nè‡ªå®šä¹‰å‡½æ•°\n#!/bin/bashfunction getSum()&#123;        SUM=$[$num1+$num2]        echo &quot;sum=$SUM&quot;&#125;read -p &quot;è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°num1=&quot; num1read -p &quot;è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°num2=&quot; num2getSum $num1 $num2\n\n\n\næ—¥å¿—\næŸ¥çœ‹å†…å­˜æ—¥å¿—\njournalctl -n 3 æŸ¥çœ‹æœ€æ–°3æ¡\njournalctl â€“since 19:00 â€“until 19:10:10 æŸ¥çœ‹æ—¶é—´åŒºé—´\njournalctl -p err æŠ¥é”™æ—¥å¿—\njournalctl -o verbose æ—¥å¿—è¯¦ç»†å†…å®¹\njournalctl _PID&#x3D;1245 _COMM&#x3D;sshd  æŸ¥çœ‹åŒ…å«è¿™äº›å‚æ•°çš„æ—¥å¿—\n\n\nå¤‡ä»½ä¸æ¢å¤\ndump å¯¹åˆ†åŒºæ”¯æŒå¢é‡å¤‡ä»½\ndump -0j -f &#x2F;opt&#x2F;etc.bak.bz2 &#x2F;etc\n\nrestore ç”¨æ¥æ¢å¤å·²å¤‡ä»½çš„æ–‡ä»¶\nrestore [æ¨¡å¼é€‰é¡¹] [é€‰é¡¹]\nå››ç§æ¨¡å¼ä¸èƒ½æ··ç”¨\n\n-C å¯¹æ¯”æ¨¡å¼ï¼Œå°†å¤‡ä»½æ–‡ä»¶ä¸å·²å­˜åœ¨æ–‡ä»¶ç›¸äº’å¯¹æ¯”\n-i ä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œè¿›è¡Œè¿˜åŸæ—¶ï¼Œrestore æŒ‡ä»¤ä¾åºè¯¢é—®ç”¨æˆ·\n-r è¿˜åŸæ¨¡å¼ï¼šå¦‚æœæœ‰å¢é‡å¤‡ä»½ï¼Œéœ€è¦æŠŠå¢é‡æ–‡ä»¶ä¹ŸæŒ‰ç…§é¡ºåºè¿›è¡Œæ¢å¤\n-t æŸ¥çœ‹æ¨¡å¼ï¼Œçœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ–‡ä»¶\n\né€‰é¡¹\n\n-f ä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–å¤‡ä»½æ•°æ®è¿›è¡Œè¿˜åŸ\n\n\n\n","categories":["linux"],"tags":["å­¦ä¹ "]},{"title":"FastAPI","url":"/java4u/2023/01/22/FastAPI/","content":"FastAPIé«˜æ€§èƒ½çš„å¼‚æ­¥webæ¡†æ¶ï¼Œä½¿ç”¨Pydanticä½œä¸ºæ•°æ®æ¨¡å‹ï¼ŒUvicornä½œä¸ºASGIæœåŠ¡å™¨\nè¯·æ±‚å‚æ•°çš„è§£æä¸éªŒè¯è·¯å¾„å‚æ•°ä¸æ•°å­—éªŒè¯@app03.get(&quot;/path/&#123;parameters&#125;&quot;)  # å‡½æ•°çš„é¡ºåºå°±æ˜¯è·¯ç”±çš„é¡ºåºdef path_prams02(parameters: str):    return &#123;&quot;message&quot;: parameters&#125;\n\næ”¯æŒæšä¸¾ç±»ï¼Œä½¿ç”¨Pathä½œä¸ºè·¯å¾„å‚æ•°çš„æ ¡éªŒ\næŸ¥è¯¢å‚æ•°å’Œå­—ç¬¦ä¸²éªŒè¯@app03.get(&quot;/query/validations&quot;)  # é•¿åº¦+æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ï¼Œæ¯”å¦‚é•¿åº¦8-16ä½ï¼Œä»¥aå¼€å¤´ã€‚å…¶å®ƒæ ¡éªŒæ–¹æ³•çœ‹Queryç±»çš„æºç def query_params_validate(    value: str = Query(..., min_length=8, max_length=16, regex=&quot;^a&quot;),  # ...æ¢æˆNoneå°±å˜æˆé€‰å¡«çš„å‚æ•°    values: List[str] = Query([&quot;v1&quot;, &quot;v2&quot;], alias=&quot;alias_name&quot;)):  # å¤šä¸ªæŸ¥è¯¢å‚æ•°çš„åˆ—è¡¨ã€‚å‚æ•°åˆ«å    return value, values\n\nGETè¯·æ±‚ä¸­ä¸å±äºè·¯å¾„å‚æ•°çš„å°±æ˜¯æŸ¥è¯¢å‚æ•°ï¼Œä½¿ç”¨Queryä½œä¸ºæŸ¥è¯¢å‚æ•°æ ¡éªŒ\nè¯·æ±‚ä½“å’Œå­—æ®µclass CityInfo(BaseModel):    name: str = Field(..., example=&quot;Beijing&quot;)  # exampleæ˜¯æ³¨è§£çš„ä½œç”¨ï¼Œå€¼ä¸ä¼šè¢«éªŒè¯    country: str    country_code: str = None  # ç»™ä¸€ä¸ªé»˜è®¤å€¼    country_population: int = Field(default=800, title=&quot;äººå£æ•°é‡&quot;, description=&quot;å›½å®¶çš„äººå£æ•°é‡&quot;, ge=800)    class Config:        schema_extra = &#123;            &quot;example&quot;: &#123;                &quot;name&quot;: &quot;Shanghai&quot;,                &quot;country&quot;: &quot;China&quot;,                &quot;country_code&quot;: &quot;CN&quot;,                &quot;country_population&quot;: 1400000000,            &#125;        &#125;@app03.post(&quot;/request_body/city&quot;)def city_info(city: CityInfo):    print(city.name, city.country)  # å½“åœ¨IDEä¸­è¾“å…¥city.çš„æ—¶å€™ï¼Œå±æ€§ä¼šè‡ªåŠ¨å¼¹å‡º    return city.dict()\n\npost&#x2F;putè¯·æ±‚ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®ä¼ å…¥çš„æ¨¡å‹ï¼ŒPydanticæ¨¡å‹çš„å­—æ®µä½¿ç”¨Fieldæ ¡éªŒ\nå“åº”åŠæ•°æ®å¤„ç†å“åº”æ¨¡å‹@app04.post(&quot;/response_model/&quot;, response_model=UserOut, response_model_exclude_unset=True)async def response_model(user: UserIn):    &quot;&quot;&quot;response_model_exclude_unset=Trueè¡¨ç¤ºé»˜è®¤å€¼ä¸åŒ…å«åœ¨å“åº”ä¸­ï¼Œä»…åŒ…å«å®é™…ç»™çš„å€¼ï¼Œå¦‚æœå®é™…ç»™çš„å€¼ä¸é»˜è®¤å€¼ç›¸åŒä¹Ÿä¼šåŒ…å«åœ¨å“åº”ä¸­&quot;&quot;&quot;    print(user.password)  # passwordä¸ä¼šè¢«è¿”å›    # return user    return users[&quot;user01&quot;]\n\né€šè¿‡response_modelè®¾ç½®å“åº”æ¨¡å‹\nå“åº”çŠ¶æ€ç @app04.post(&quot;/status_attribute&quot;, status_code=status.HTTP_200_OK)async def status_attribute():    print(type(status.HTTP_200_OK))    return &#123;&quot;status_code&quot;: status.HTTP_200_OK&#125;\n\nå•æ–‡ä»¶&#x2F;å¤šæ–‡ä»¶ä¸Šä¼ åŠå‚æ•°è¯¦è§£@app04.post(&quot;/upload_files&quot;)async def upload_files(files: List[UploadFile] = File(...)):  # å¦‚æœè¦ä¸Šä¼ å•ä¸ªæ–‡ä»¶ file: UploadFile = File(...)    &quot;&quot;&quot;    ä½¿ç”¨UploadFileç±»çš„ä¼˜åŠ¿:    1.æ–‡ä»¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä½¿ç”¨çš„å†…å­˜è¾¾åˆ°é˜ˆå€¼åï¼Œå°†è¢«ä¿å­˜åœ¨ç£ç›˜ä¸­    2.é€‚åˆäºå›¾ç‰‡ã€è§†é¢‘å¤§æ–‡ä»¶    3.å¯ä»¥è·å–ä¸Šä¼ çš„æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå¦‚æ–‡ä»¶åï¼Œåˆ›å»ºæ—¶é—´ç­‰    4.æœ‰æ–‡ä»¶å¯¹è±¡çš„å¼‚æ­¥æ¥å£    5.ä¸Šä¼ çš„æ–‡ä»¶æ˜¯Pythonæ–‡ä»¶å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨write(), read(), seek(), close()æ“ä½œ    &quot;&quot;&quot;    for file in files:        contents = await file.read()        print(contents)    return &#123;&quot;filename&quot;: files[0].filename, &quot;content_type&quot;: files[0].content_type&#125;\n\né”™è¯¯å¤„ç†@app04.get(&quot;/http_exception&quot;)async def http_exception(city: str):    if city != &quot;Beijing&quot;:        raise HTTPException(status_code=404, detail=&quot;City not found!&quot;, headers=&#123;&quot;X-Error&quot;: &quot;Error&quot;&#125;)    return &#123;&quot;city&quot;: city&#125;\n\nä¾èµ–æ³¨å…¥ä½œç”¨ï¼šä»£ç å¤ç”¨ï¼Œå…±ç”¨æ•°æ®åº“è¿æ¥\nå‡½æ•°ä½œä¸ºä¾èµ–async def common_parameters(q: Optional[str] = None, page: int = 1, limit: int = 100):    return &#123;&quot;q&quot;: q, &quot;page&quot;: page, &quot;limit&quot;: limit&#125;@app05.get(&quot;/dependency01&quot;)async def dependency01(commons: dict = Depends(common_parameters)):    return commons\n\nç±»ä½œä¸ºä¾èµ–class CommonQueryParams:    def __init__(self, q: Optional[str] = None, page: int = 1, limit: int = 100):        self.q = q        self.page = page        self.limit = limit@app05.get(&quot;/classes_as_dependencies&quot;)# async def classes_as_dependencies(commons: CommonQueryParams = Depends(CommonQueryParams)):# async def classes_as_dependencies(commons: CommonQueryParams = Depends()):async def classes_as_dependencies(commons=Depends(CommonQueryParams)):    response = &#123;&#125;    if commons.q:        response.update(&#123;&quot;q&quot;: commons.q&#125;)    items = fake_items_db[commons.page: commons.page + commons.limit]    response.update(&#123;&quot;items&quot;: items&#125;)    return response\n\nå¸¦yieldçš„ä¾èµ–async def get_db():    db = DBSession()    try:        yield db    finally:        db.close()\n\nyieldåœ¨å‘é€å“åº”ä¹‹å‰ï¼Œåªæ‰§è¡ŒåŒ…å«è¯¥è¯­å¥ä¹‹å‰çš„ä»£ç ,è·å–æ•°æ®åº“è¿æ¥,yieldå“åº”ä¼ é€’åæ‰§è¡Œè¯­å¥åé¢çš„ä»£ç ï¼Œä½¿ç”¨finallyç¡®ä¿æ‰§è¡Œé€€å‡ºæ­¥éª¤\n","categories":["æ¡†æ¶"],"tags":["å­¦ä¹ "]},{"title":"django Rest Framework","url":"/java4u/2022/12/17/DRF/","content":"Serializerå°†djangoçš„æ•°æ®ç»“æ„è½¬åŒ–æˆjsonå’Œxmlï¼Œæˆ–å°†å‰ç«¯ä¼ æ¥çš„jsonè½¬åŒ–æˆdjangoæ•°æ®ç»“æ„\nä½œç”¨ï¼š\n\nå¯¹æ•°æ®è¿›è¡Œè½¬æ¢\nè¿›è¡Œæ•°æ®çš„æ ¡éªŒ\nåŒæ—¶åºåˆ—åŒ–å¤šä¸ªå¯¹è±¡\nåºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­æ·»åŠ ä¸Šä¸‹æ–‡\næ— æ•ˆçš„æ•°æ®å¼‚å¸¸å¤„ç†\n\nåºåˆ—åŒ–å°†æ¨¡å‹è½¬æ¢æˆå­—å…¸\nSerializerï¼šserializers.PrimaryKeyRelatedField  å°†å…³è”æ¨¡å‹çš„idåºåˆ—åŒ–serializers.StringRelatedField      å°†å…³è”æ¨¡å‹çš„__str__æ–¹æ³•è¿”å›å€¼åºåˆ—åŒ–UserSerializer                      å°†å…³è”æ¨¡å‹å¯¹è±¡çš„åºåˆ—åŒ–å™¨ä¸­æ‰€æœ‰å­—æ®µåºåˆ—åŒ–å‡ºæ¥ä¸€å…³è”åºåˆ—åŒ–å¤š  user_set &#x3D; UserSerializer(many &#x3D; true)  ä¸€å…³è”å¤šæ—¶ï¼Œéœ€è¦è®¾å®šmany&#x3D;true,å¤šçš„æ•°æ®é»˜è®¤æ”¾åœ¨ æ¨¡å‹åå°å†™_set è¿™ä¸ªéšè—å­—æ®µ\nååºåˆ—åŒ–æ‹¿åˆ°å‰ç«¯ä¼ å…¥çš„æ•°æ®â€“ã€‹è°ƒç”¨åºåˆ—åŒ–å™¨çš„is_valid()è¿›è¡Œæ ¡éªŒâ€“ã€‹è°ƒç”¨åºåˆ—åŒ–å™¨çš„save(),è°ƒç”¨save()æ–¹æ³•æ—¶ä¼šåˆ¤æ–­å½“åˆåˆ›å»ºåºåˆ—åŒ–å™¨æ—¶æ˜¯å¦ä¼ å…¥instanceâ€“ã€‹ååºåˆ—åŒ–æœ€åä¼šè‡ªåŠ¨å®Œæˆåºåˆ—åŒ–ï¼ˆè¿”å›æ–°å¢å’Œä¿®æ”¹æ“ä½œçš„æ•°æ®ï¼‰\ns.is_valid(raise_exception&#x3D;True) æ ¡éªŒå¤±è´¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸\nå®šä¹‰è‡ªå®šä¹‰æ ¡éªŒé€»è¾‘validate_å­—æ®µåç§°(self, value)  å•ç‹¬æ ¡éªŒå­—æ®µvaluevalidate(self, attrs)          å¯¹å¤šä¸ªå­—æ®µè”åˆæ ¡éªŒ\nåºåˆ—åŒ–å™¨çš„createå’Œupdateæ–¹æ³•serializer.save()   #å½“è°ƒç”¨åºåˆ—åŒ–å™¨çš„save()æ–¹æ³•ï¼Œä¼šæ‰§è¡Œåºåˆ—åŒ–å™¨ä¸­çš„createæˆ–updateæ–¹æ³•\ndef create(self, validated_date):    book &#x3D; BookInfo.objects.create(**validated_date)     #å°†å­—å…¸å˜æˆå…³é”®å­—å‚æ•°    return book\nå½“è°ƒç”¨åºåˆ—åŒ–å™¨çš„saveæ–¹æ³•æ—¶ï¼Œæ²¡æœ‰ç»™instanceä¼ å‚æ•°ï¼Œè°ƒç”¨åºåˆ—åŒ–å™¨çš„create\ndef update(self, instance, validated_date):    instance.btitle &#x3D; validated_date.get(â€˜btitleâ€™)    instance.bpub_date &#x3D; validated_date.get(â€˜bpub_dateâ€™)    instance.save()    return instance\nå½“è°ƒç”¨åºåˆ—åŒ–å™¨çš„saveæ–¹æ³•æ—¶ï¼Œç»™instanceä¼ å‚æ•°ï¼Œè°ƒç”¨åºåˆ—åŒ–å™¨çš„update\nModelSerializer æ¨¡å‹åºåˆ—åŒ–å™¨\nåºåˆ—åŒ–çš„å­—æ®µä¸€èˆ¬ä¸æ¨¡å‹å­—æ®µç›¸å¯¹åº”ï¼Œä½¿ç”¨æ¨¡å‹åºåˆ—åŒ–å™¨å¯ä»¥ä¸å†™å­—æ®µï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ\nModelSerializerå·²ç»å®ç°äº†createå’Œupdateæ–¹æ³•\n\nclass Meta:  model &#x3D; BookInfo  # æŒ‡å®šåºåˆ—åŒ–å™¨å­—æ®µä»é‚£ä¸ªæ¨¡å‹å»æ˜ å°„  fields &#x3D; â€˜allâ€˜  # æŒ‡å®šæ˜ å°„æ‰€æœ‰å­—æ®µ  fields &#x3D; [â€˜idâ€™,â€™btitleâ€™] # æŒ‡å®šæ˜ å°„æŒ‡å®šå­—æ®µ  exclude &#x3D; [â€˜imageâ€™]  # æŒ‡å®šæ’é™¤æ˜ å°„å­—æ®µ  extra_kwargs &#x3D; {  # ä¿®æ”¹ç”Ÿæˆå­—æ®µçš„é€‰é¡¹å‚æ•°    â€˜breadâ€™: {â€˜min_valueâ€™: 0, â€˜write_onlyâ€™: True}  }  read_only_fields &#x3D; [â€˜idâ€™, â€˜breadâ€™] # æŒ‡å®šå“ªäº›å­—æ®µåªä½œåºåˆ—åŒ–\nHyperlinkedModelSerializer  è¶…é“¾æ¥æ¨¡å‹åºåˆ—åŒ–å™¨è¿”å›æ•°æ®å¸¦ä¸Šè¯·æ±‚è¯¥èµ„æºçš„url\nè§†å›¾å‡½æ•°å¼ç¼–ç¨‹ Function Based Viewç±»è§†å›¾ Classed Based View ï¼ˆAPIViewï¼Œè§†å›¾çš„viewçš„åŸºç±»ï¼Œä½¿ç”¨æ–¹æ³•å®šä¹‰ä¸åŒè¯·æ±‚ï¼‰é€šç”¨ç±»è§†å›¾ Generic Classed Based View  æä¾›åºåˆ—åŒ–å™¨ä½¿ç”¨çš„å±æ€§ä¸æ–¹æ³•    serializer_class æŒ‡æ˜è§†å›¾ä½¿ç”¨çš„åºåˆ—åŒ–å™¨    get_serializer_class()  è¿”å›åºåˆ—åŒ–å™¨ç±»    get_serializerï¼ˆï¼‰       è·å–åºåˆ—åŒ–å™¨å¯¹è±¡  æä¾›å…³äºæ•°æ®åº“æŸ¥è¯¢çš„å±æ€§ä¸æ–¹æ³•    queryset   è¿”å›è§†å›¾ä½¿ç”¨çš„æŸ¥è¯¢é›†    get_object()  è¿”å›è¯¦æƒ…è§†å›¾æ‰€éœ€çš„æ¨¡å‹ç±»å‹æ•°æ®å¯¹è±¡  å…¶ä»–å¯ä»¥è®¾ç½®çš„å±æ€§    pagination_class  åˆ†é¡µæ§åˆ¶ç±»    filter_backends   æŸ¥è¯¢é›†è¿‡æ»¤DRFçš„è§†å›¾é›† viewsets  å¯ä»¥å°†ä¸€ç³»åˆ—é€»è¾‘ç›¸å…³çš„åŠ¨ä½œæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼š    - list()æä¾›ä¸€ç»„æ•°æ®    - retrieve()æä¾›å•ä¸ªæ•°æ®    - create()åˆ›å»ºæ•°æ®    - update()ä¿å­˜æ•°æ®    - destory()åˆ é™¤æ•°æ®\nå‰é¢3ä¸ªè§†å›¾éƒ½éœ€è¦å°†listå’Œå®ä½“ç±»åŒºåˆ†ï¼Œè§†å›¾é›†å¯ä»¥å°†Listå’Œå®ä½“ç±»åˆåœ¨ä¸€å—ç¼–å†™1.å°†æ‰€æœ‰æ¥å£å†™åœ¨ä¸€ä¸ªç±»è§†å›¾ä¸­ï¼ˆç±»è¯•å›¾ä¸­æ–¹æ³•ä¸å†ç”¨è¯·æ±‚æ–¹æ³•å°å†™ ç”¨è¡Œä¸º&#x2F;åŠ¨ä½œä»£æ›¿ï¼‰2.é‡å†™as_view({â€˜getâ€™:â€™listâ€™, â€˜postâ€™:â€™createâ€™})\nä½¿ç”¨routerå¯ä»¥ç®€å†™è§†å›¾é›†çš„è·¯ç”±è§„åˆ™DefaultRouterä¼šç”Ÿæˆæ ¹è·¯ç”±\nå…¶ä»–åŠŸèƒ½è¿‡æ»¤filter_fields &#x3D; [â€˜breadâ€™]  é…ç½®è¿‡æ»¤å­—æ®µ\nå‰ç«¯è°ƒç”¨   xxxxxx?bread&#x3D;aaaa\næ’åºfilter_backends &#x3D; [OrderingFilter]ordering_fields &#x3D; [â€˜idâ€™,â€™breadâ€™]\nå‰ç«¯è°ƒç”¨   xxxxxx?ordering&#x3D;-bread\nåˆ†é¡µé…ç½®åˆ†é¡µç±»ï¼Œpagination_classå¼•ç”¨åˆ†é¡µç±»\n","categories":["æ¡†æ¶"],"tags":["å­¦ä¹ ","django"]},{"title":"django","url":"/java4u/2022/10/25/django/","content":"é¡¹ç›®æ–‡ä»¶ä»‹ç»mysite|- app01    |- __init__.py     |- admin.py    ã€é»˜è®¤æä¾›äº†adminåå°ç®¡ç†ã€‘    |- apps.py     ã€appå¯åŠ¨ç±»ã€‘    |- migrations  ã€æ•°æ®åº“å­—æ®µå˜æ›´è®°å½•ã€‘    |- models.py   ã€**é‡è¦**å¯¹æ•°æ®åº“æ“ä½œã€‘    |- tests.py    |- views.py    ã€**é‡è¦**è§†å›¾ã€‘|- manage.py       ã€é¡¹ç›®çš„ç®¡ç†ï¼Œå¯åŠ¨é¡¹ç›®/åˆ›å»ºapp/æ•°æ®ç®¡ç†ã€‘|- mysite    |- __init__.py    |- settings.py ã€é¡¹ç›®é…ç½®ã€‘    |- urls.py     ã€URLå’Œå‡½æ•°çš„å¯¹åº”å…³ç³»ã€‘    |- asgi.py     ã€æ¥å—ç½‘ç»œè¯·æ±‚ã€‘    |- wsgi.py     ã€æ¥å—ç½‘ç»œè¯·æ±‚ã€‘\n\nåˆ›å»ºAPPpython3.9 manage.py startapp app01\nå¿«é€Ÿå…¥é—¨\nç¡®ä¿APPæ³¨å†ŒINSTALLED_APPS &#x3D; [  â€˜django.contrib.adminâ€™,  â€˜django.contrib.authâ€™,  â€˜django.contrib.contenttypesâ€™,  â€˜django.contrib.sessionsâ€™,  â€˜django.contrib.messagesâ€™,  â€˜django.contrib.staticfilesâ€™,  â€˜app01.apps.App01Configâ€™]\nç¼–å†™URLå’Œå‡½æ•°å¯¹åº”å…³ç³»urlpatterns &#x3D; [  path(â€˜index&#x2F;â€˜, views.index)]\nç¼–å†™è§†å›¾å‡½æ•°\nå¯åŠ¨django\npython3.9 manage.py runserver\n\n\n\nè§†å›¾requestå¯¹è±¡GET  è·å–ï¼Ÿå‚æ•°POST è·å–postæäº¤çš„æ•°æ®path è¯·æ±‚è·¯å¾„method è¯·æ±‚æ–¹æ³•COOKIES è¯·æ±‚è¿‡æ¥çš„cookiesuser  è¯·æ±‚çš„ç”¨æˆ·å¯¹è±¡ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•session å½“å‰ä¼šè¯META  åŒ…å«æ‰€æœ‰HTTPé¦–éƒ¨\næ•°æ®åº“æ“ä½œ1.djangoè¿æ¥æ•°æ®åº“åœ¨settings.pyæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®å’Œä¿®æ”¹\nDATABASES &#x3D; {    â€˜defaultâ€™: {        â€˜ENGINEâ€™: â€˜django.db.backends.mysqlâ€™,        â€˜NAMEâ€™: â€˜my_schemaâ€™,        â€˜USERâ€™: â€˜rootâ€™,        â€˜PASSWORDâ€™: â€˜rootâ€™,        â€˜HOSTâ€™: â€˜127.0.0.1â€™,        â€˜PORTâ€™: â€˜3306â€™,    }}\n2.djangoæ“ä½œè¡¨class UserInfo(models.Model):    name = models.CharField(max_length=32)    password = models.CharField(max_length=64)    age = models.IntegerField(default=2)  # è®¾ç½®é»˜è®¤å€¼    data = models.IntegerField(null=true,blank=true)  # å…è®¸ä¸ºç©º    &quot;&quot;&quot;create table app01_userinfo(    id bigint auto_increment primary key,    name varchar(32),    password varchar(64),    age int)&quot;&quot;&quot;\n\næ‰§è¡Œå‘½ä»¤ï¼špython manage.py makemigrationspython manage.py migrate\n3.djangoæ“ä½œè¡¨ä¸­çš„æ•°æ®# æ–°å»ºæ•°æ® insert into app01.department(title) values(&quot;é”€å”®éƒ¨&quot;)Department.objects.create(title=&quot;é”€å”®éƒ¨&quot;)\n\nåˆ—å±æ€§\nå­—ç¬¦ä¸²ä¸æ•°å­—ç±»å‹\næ—¶é—´ç±»å‹\næ–‡ä»¶ç±»å‹\nç‰¹æ®Šç±»å‹å±æ€§\nå…¬å…±å±æ€§\nè¡¨å…³è”æ–¹æ³•\n\nå¤šå¯¹å¤šä¼šåˆ›å»ºä¸­é—´è¡¨è®°å½•2å¼ è¡¨çš„å¯¹åº”å…³ç³»\næ•°æ®åº“æŸ¥è¯¢åŸºäºORMå¸¸ç”¨æŸ¥è¯¢æ–¹æ³•\nall()           æ‰€æœ‰æ•°æ®get(**filter)   æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„æ•°æ®(å•æ¡)filter(**filter)æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„æ•°æ®(å¤šæ¡)exists()        è¿”å›æ˜¯å¦æœ‰å¯¹è±¡count()         è¿”å›å¯¹è±¡çš„æ•°é‡exclude(**filter) è¿”å›æ•°æ®æ’é™¤distinct(&#x27;&#x27;)      å»é‡\n","categories":["æ¡†æ¶"],"tags":["å­¦ä¹ ","django"]},{"title":"openscenario","url":"/java4u/2022/10/15/openscenario/","content":"StandardScalar types and units\nlibrary-physical-length[] type length is SI(m: 1)  é•¿åº¦\nlibrary-physical-time[] type time is SI(s: 1)   æ—¶é—´\nlibrary-physical-speed[] type speed is SI(m: 1, s: -1)   é€Ÿåº¦\nlibrary-physical-acceleration[] type acceleration is SI(m: 1, s: -2)  åŠ é€Ÿåº¦\nlibrary-physical-jerk[] type jerk is SI(m: 1, s: -3) æ¯å•ä½æ—¶é—´çš„åŠ é€Ÿåº¦å˜åŒ–ç‡\nlibrary-physical-angle[]  type angle is SI(rad: 1)   è§’åº¦\nlibrary-physical-angular_rate[] type angular_rate is SI(rad: 1, s: -1)  è§’é€Ÿåº¦\nlibrary-physical-angular_acceleration[]  type angular_acceleration is SI(rad: 1, s: -2)  è§’åŠ é€Ÿåº¦\nlibrary-physical-mass[]  type mass is SI(kg: 1)  é‡é‡\nlibrary-physical-temperature[]  type temperature is SI(K: 1)  æ¸©åº¦\nlibrary-physical-pressure[]  type pressure is SI(kg: 1, m: -1, s: -2) å‹åŠ›\nlibrary-physical-luminous_intensity[]  type luminous_intensity is SI(cd: 1) å‘å…‰å¼ºåº¦ï¼ˆå…‰æºåœ¨ç‰¹å®šæ–¹å‘ä¸Šæ¯å•ä½ç«‹ä½“è§’å‘å°„çš„æ³¢é•¿åŠ æƒåŠŸç‡çš„é‡åº¦ï¼‰\nlibrary-physical-luminous_flux[]  type luminous_flux is SI(cd: 1, rad: 2)  å…‰é€šé‡ï¼ˆè¡¨ç¤ºå…‰åŠŸç‡çš„ç‰©ç†é‡ï¼Œæ˜¯è¡¨ç¤ºå…‰æºæ•´ä½“äº®åº¦çš„æŒ‡æ ‡ï¼‰\nlibrary-physical-illuminance[]  type illuminance is SI(cd: 1, rad: 2, m: -2)  ç…§åº¦ï¼ˆå•ä½é¢ç§¯ä¸Šå…¥å°„åœ¨è¡¨é¢ä¸Šçš„æ€»å…‰é€šé‡ï¼‰\nlibrary-physical-electrical_current[]  type electrical_current is SI(A: 1) ç”µæµ\nlibrary-physical-amount_of_substance[] type amount_of_substance is SI(mol: 1)  ç‰©è´¨çš„é‡(mole)\n\nStructs\nlibrary-position_3d[]\nlibrary-celestial_position_2d[]  å¤©èˆªstruct celestial_position_2d:  azimuth: angle     æ–¹ä½è§’  elevation: angle   æµ·æ‹”ï¼ˆä»°è§’ï¼‰\nlibrary-geodetic_position_2d[]  åœ°ç†åæ ‡struct geodetic_position_2d:  latitude: angle  longitude: angle\nlibrary-orientation_3d[]  ç‰©ç†ç©ºé—´å®šä½struct orientation_3d:  roll: angle  pitch: angle  yaw: angle\nlibrary-pose_3d[]struct pose_3d:  position: position_3d  orientation: orientation_3d\n\n","categories":["è§„èŒƒ"],"tags":["å­¦ä¹ ","openscenario"]},{"title":"python","url":"/java4u/2022/10/01/python/","content":"åŸºç¡€è¯­æ³•\nå­—é¢é‡ï¼šå›ºå®šå€¼\næ³¨é‡Š\nå˜é‡\næ•°æ®ç±»å‹ type()\næ•°æ®ç±»å‹è½¬æ¢ int() float() str()\næ ‡è¯†ç¬¦ å‘½å\nè¿ç®—ç¬¦\nå­—ç¬¦ä¸²æ‰©å±•\nä½¿ç”¨å•å¼•å·ã€åŒå¼•å·ã€ä¸‰å¼•å·å®šä¹‰å­—ç¬¦ä¸²\nå­—ç¬¦ä¸²æ‹¼æ¥\nå­—ç¬¦ä¸²æ ¼å¼åŒ– å ä½ç¬¦ï¼ˆ%s %d %fï¼‰ å¿«é€Ÿæ ¼å¼åŒ– fâ€{å˜é‡}â€\næ ¼å¼åŒ–ç²¾åº¦æ§åˆ¶\nå¯¹è¡¨è¾¾å¼è¿›è¡Œæ ¼å¼åŒ–\n\n\næ•°æ®è¾“å…¥ input()\n\nåˆ¤æ–­è¯­å¥\nå¸ƒå°”ç±»å‹å’Œæ¯”è¾ƒè¿ç®—ç¬¦\nifè¯­å¥åŸºæœ¬æ ¼å¼if age &gt;&#x3D; 18:  print(â€œæˆ‘å·²ç»æˆå¹´äº†â€)\nif elseè¯­å¥\nif elif elseè¯­å¥\nåˆ¤æ–­è¯­å¥åµŒå¥—\n\nå¾ªç¯è¯­å¥\nwhileå¾ªç¯\nforå¾ªç¯\nåŸºç¡€è¯­æ³• for ä¸´æ—¶å˜é‡ in å¾…å¤„ç†æ•°æ®é›†\nrangeè¯­å¥ è·å–æ•°å­—åºåˆ— range(n1, n2, n3) ä»n1å¼€å§‹åˆ°n2ç»“æŸï¼ˆä¸åŒ…å«n2ï¼‰,æ­¥é•¿ä¸ºn3\nå˜é‡åŸŸ éœ€è¦è®¿é—®ä¸´æ—¶å˜é‡ï¼Œå¯ä»¥åœ¨å¾ªç¯å¤–å®šä¹‰å®ƒ\n\n\nå¾ªç¯ä¸­æ–­\n\nå‡½æ•°\nå‡½æ•°åŸºç¡€å®šä¹‰ def å‡½æ•°å(ä¼ å…¥å‚æ•°): å‡½æ•°ä½“ return è¿”å›å€¼\nå‡½æ•°çš„ä¼ å…¥å‚æ•°\nå‡½æ•°çš„è¿”å›å€¼ åœ¨ifåˆ¤æ–­ä¸­ï¼ŒNoneç­‰åŒäºFalse\nå‡½æ•°è¯´æ˜æ–‡æ¡£\nå‡½æ•°ä½œç”¨åŸŸ ä½¿ç”¨globalå…³é”®å­—å¯ä»¥å°†å‡½æ•°å†…éƒ¨å˜é‡å˜æˆå…¨å±€å˜é‡\n\næ•°æ®å®¹å™¨\nåˆ—è¡¨list [å…ƒç´ 1ï¼Œå…ƒç´ 2ï¼Œâ€¦]\nåˆ—è¡¨çš„ä¸‹æ ‡ç´¢å¼• å¯ä»¥åå‘ç´¢å¼•\nåˆ—è¡¨çš„å¸¸ç”¨æ“ä½œ\næŸ¥æ‰¾æŸå…ƒç´ ä¸‹æ ‡ åˆ—è¡¨.index(å…ƒç´ )\nä¿®æ”¹ç‰¹å®šä½ç½®çš„å…ƒç´ å€¼  åˆ—è¡¨[ä¸‹æ ‡]&#x3D;å€¼\næ’å…¥å…ƒç´   åˆ—è¡¨.insert(ä¸‹æ ‡ï¼Œå…ƒç´ )\nè¿½åŠ å…ƒç´   åˆ—è¡¨.append(å…ƒç´ )\nè¿½åŠ å…ƒç´ 2 åˆ—è¡¨.extend(å…¶ä»–æ•°æ®å®¹å™¨)\nåˆ é™¤å…ƒç´   del åˆ—è¡¨[ä¸‹æ ‡]  åˆ—è¡¨.pop(ä¸‹æ ‡)\nåˆ é™¤æŸå…ƒç´ åœ¨åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹   åˆ—è¡¨.remove()\nåˆ—è¡¨æ¸…ç©º  åˆ—è¡¨.clear()\nç»Ÿè®¡æŸå…ƒç´ åœ¨åˆ—è¡¨å†…æ•°é‡  åˆ—è¡¨.count(å…ƒç´ )\nç»Ÿè®¡åˆ—è¡¨å…ƒç´ æ•°é‡  len(åˆ—è¡¨)\n\n\nåˆ—è¡¨çš„éå†\nå…ƒç»„  å…ƒç»„ä¸€æ—¦å®šä¹‰å®Œæˆï¼Œå°±ä¸å¯ä¿®æ”¹ ï¼ˆå…ƒç´ ï¼Œå…ƒç´ â€¦â€¦ï¼‰  å®šä¹‰å•ä¸ªå…ƒç´ åé¢éœ€è¦æ·»åŠ ,  index  count  len\nå­—ç¬¦ä¸²\né€šè¿‡ä¸‹æ ‡ç´¢å¼•å–å€¼\nindexæ–¹æ³•\nreplace(å­—ç¬¦ä¸²1ï¼Œå­—ç¬¦ä¸²2)\nsplitæ–¹æ³•\nstrip()   å»å‰åç©ºæ ¼\nstrip(å­—ç¬¦ä¸²) å»å‰åæŒ‡å®šå­—ç¬¦ä¸²ï¼ŒæŒ‰å•ä¸ªå­—ç¬¦å»ç§»é™¤\ncount\nlen(å­—ç¬¦ä¸²)\n\n\nåºåˆ—çš„åˆ‡ç‰‡ åºåˆ—[èµ·å§‹ä¸‹æ ‡:ç»“æŸä¸‹æ ‡:æ­¥é•¿]\nset é›†åˆ {å…ƒç´ ï¼Œå…ƒç´ â€¦}\næ·»åŠ å…ƒç´  add\nç§»é™¤å…ƒç´  remove\néšæœºå–å…ƒç´ ,åŒæ—¶åˆ é™¤å…ƒç´  pop\næ¸…ç©ºé›†åˆ\nå–2ä¸ªé›†åˆçš„å·®é›†  é›†åˆ1.difference(é›†åˆ2)  é›†åˆ1æœ‰é›†åˆ2æ²¡æœ‰\næ¶ˆé™¤2ä¸ªé›†åˆçš„å·®é›†  é›†åˆ1.difference_update(é›†åˆ2)  åˆ é™¤å’Œé›†åˆ2ç›¸åŒçš„å…ƒç´ \nåˆå¹¶é›†åˆ   é›†åˆ1.union(é›†åˆ2)\n\n\nå­—å…¸ {key:value, key:value, â€¦â€¦.}\næ–°å¢å…ƒç´  å­—å…¸[key]&#x3D;value\næ›´æ–°å…ƒç´  å­—å…¸[key]&#x3D;value\nåˆ é™¤å…ƒç´  å­—å…¸.pop(key)\næ¸…ç©ºå…ƒç´ \nè·å–å…¨éƒ¨key  å­—å…¸.keys()\néå†å­—å…¸\nè®¡ç®—å­—å…¸é‡Œå…ƒç´ æ•°é‡\né€šè¿‡inæˆ–not in åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨\n\n\né€šç”¨æ“ä½œ  \néå†\nlen ç»Ÿè®¡å®¹å™¨å…ƒç´ ä¸ªæ•°\nmax æœ€å¤§å…ƒç´ \nmin æœ€å°å…ƒç´ \nlist()  å®¹å™¨è½¬åˆ—è¡¨\ntuple() å®¹å™¨è½¬å…ƒç»„\nstr()   å®¹å™¨è½¬å­—ç¬¦ä¸²\nset()   å®¹å™¨è½¬é›†åˆ\næ’åº   sorted(å®¹å™¨,[reverse&#x3D;True]) æ’åºç»“æœä¼šæ”¾å…¥åˆ—è¡¨ï¼Œä¼šè¿”å›åˆ—è¡¨\nsort(key&#x3D;é€‰æ‹©æ’åºä¾æ®çš„å‡½æ•°,reverse&#x3D;True|False)   è‡ªå®šä¹‰æ’åºè§„åˆ™\n\n\n\n\n\nå‡½æ•°è¿›é˜¶å‡½æ•°å¤šè¿”å›å€¼def test_return():  return 1,2x,y = test_return()\n\næŒ‰ç…§è¿”å›å€¼é¡ºåºï¼Œå†™å¯¹åº”é¡ºåºçš„å¤šä¸ªå˜é‡æ¥å—å³å¯\nå‡½æ•°å¤šç§ä¼ å‚æ–¹å¼\nä½ç½®å‚æ•°    æ ¹æ®å‚æ•°ä½ç½®æ¥ä¼ é€’å‚æ•°\nå…³é”®å­—å‚æ•°  é€šè¿‡â€œé”®&#x3D;å€¼â€å½¢å¼ä¼ é€’å‚æ•°ï¼Œå¯ä»¥ä¸æŒ‰ç…§å‚æ•°å®šä¹‰é¡ºåºä¼ å‚\nç¼ºçœå‚æ•°    å®šä¹‰çš„å‡½æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œé»˜è®¤å‚æ•°å¿…é¡»æ”¾åœ¨æœ€å\nä¸å®šé•¿å‚æ•°  ä¸ç¡®å®šè°ƒç”¨æ—¶ä¼ é€’å¤šå°‘ä¸ªå‚æ•° ä½ç½®ä¸å®šé•¿* å…³é”®å­—ä¸å®šé•¿ **\n\nåŒ¿åå‡½æ•°\nå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’  å°†è®¡ç®—é€»è¾‘è¿›è¡Œä¼ é€’\nlambdaåŒ¿åå‡½æ•°   lambda ä¼ å…¥å‚æ•°ï¼šå‡½æ•°ä½“ï¼ˆä¸€è¡Œä»£ç ï¼‰\n\næ–‡ä»¶æ“ä½œ\næ–‡ä»¶ç¼–ç \næ–‡ä»¶çš„è¯»å–\nopen(name,mode,encoding) æ‰“å¼€å‡½æ•° name è¦æ‰“å¼€ç›®æ ‡æ–‡ä»¶åçš„å­—ç¬¦ä¸² mode è®¾ç½®æ‰“å¼€æ–‡ä»¶æ¨¡å¼ï¼ˆr åªè¯» w å†™å…¥ a è¿½åŠ ï¼‰ encoding ç¼–ç æ ¼å¼\nread()  è¯»å–æ•°æ®é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰\nreadlines() æŒ‰ç…§è¡ŒæŠŠæ•´ä¸ªæ–‡ä»¶å†…å®¹ä¸€æ¬¡æ€§è¯»å–\nreadline()  ä¸€æ¬¡è¯»å–ä¸€è¡Œå†…å®¹\nforå¾ªç¯è¯»å–æ–‡ä»¶\næ–‡ä»¶å…³é—­\nwith openè¯­æ³• æ“ä½œå®Œæˆè‡ªåŠ¨å…³é—­æµ\n\n\næ–‡ä»¶çš„å†™å…¥\næ–‡ä»¶çš„è¿½åŠ \n\nå¼‚å¸¸try:  å¯èƒ½å‘ç”Ÿé”™è¯¯çš„ä»£ç except:  å¦‚æœå‡ºç°å¼‚å¸¸æ‰§è¡Œçš„ä»£ç else:  æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸æ‰§è¡Œçš„ä»£ç finally:  æœ€ç»ˆæ‰§è¡Œçš„ä»£ç \næ¨¡å—\nå¯¼å…¥æ¨¡å— [from æ¨¡å—å] import [æ¨¡å—|ç±»|å˜é‡|å‡½æ•°|*] [as åˆ«å]\nè‡ªå®šä¹‰æ¨¡å—  if name &#x3D;&#x3D; â€˜mainâ€˜:   å³é”®è¿è¡Œå¯ä»¥è¿è¡Œï¼Œå¯¼å…¥ä¸ä¼šè¿è¡Œ  all åªèƒ½å¯¼å…¥allå˜é‡è®¾ç½®çš„\n\nåŒ…åŒ…å°±æ˜¯æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹åŒ…å«ä¸€ä¸ª__init__.pyæ–‡ä»¶\nç±»æˆå‘˜æ–¹æ³•å®šä¹‰ï¼šdef æ–¹æ³•å(self,â€¦â€¦â€¦):  æ–¹æ³•ä½“\nselfå¿…é¡»å¡«å†™ï¼ˆä¼ å‚çš„æ—¶å€™å¯ä»¥å¿½ç•¥ï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºç±»å¯¹è±¡è‡ªèº«ï¼Œè®¿é—®ç±»çš„æˆå‘˜å˜é‡å¿…é¡»ä½¿ç”¨self\næ„é€ æ–¹æ³•init()æ–¹æ³•ï¼Œç§°ä¹‹ä¸ºæ„é€ æ–¹æ³•ï¼ŒåŒæ—¶æˆå‘˜å˜é‡å¯ä»¥çœç•¥\né­”æœ¯æ–¹æ³•Pythonç±»å†…ç½®æ–¹æ³•ï¼š\n\ninit æ„é€ æ–¹æ³•\nstr  å­—ç¬¦ä¸²æ–¹æ³•ï¼ˆç›¸å½“äºtoString()ï¼‰\nlt   å°äºã€å¤§äºç¬¦å·æ¯”è¾ƒ(ç›¸å½“äºComparator)\nle   å°äºç­‰äºã€å¤§äºç­‰äºç¬¦å·æ¯”è¾ƒ\neq   &#x3D;&#x3D;ç¬¦å·æ¯”è¾ƒ\n\nå°è£…ç§æœ‰æˆå‘˜ï¼šå®šä¹‰ç§æœ‰æˆå‘˜åªéœ€å˜é‡å’Œæ–¹æ³•ä»¥__å¼€å¤´\nç±»å‹æ³¨è§£1.å˜é‡çš„ç±»å‹æ³¨è§£åŸºç¡€è¯­æ³•ï¼š  å˜é‡ï¼šç±»å‹  æ³¨é‡Š #type:ç±»å‹å®¹å™¨ç±»å‹è¯¦ç»†æ³¨è§£my_list: list[int] &#x3D; [1,2,3]my_tuple: tuple[str, int, bool] &#x3D; (â€œâ€, 666, True)my_dict: dict[str, int] &#x3D; {â€œâ€: 666}\n2.å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰å½¢å‚å’Œè¿”å›å€¼ç±»å‹æ³¨è§£\ndef å‡½æ•°æ–¹æ³•(å½¢å‚ï¼šç±»å‹ï¼Œ å½¢å‚ï¼šç±»å‹)-&gt;è¿”å›å€¼ç±»å‹:\n3.unionç±»å‹è¿›è¡Œè”åˆæ³¨è§£\nmyList: list[Union[int, str]] &#x3D; [1, 2, â€œitmaâ€, â€œitcastâ€]def func2(data: Union[int, str]) -&gt; Union[int, str]:\nè£…é¥°å™¨æ€»ç»“æ— å‚è£…é¥°å™¨æ¨¡æ¿\ndef outter(func):    def wrapper(*args, **kwargs):        # 1ã€è°ƒç”¨åŸå‡½æ•°        # 2ã€ä¸ºå…¶å¢åŠ æ–°åŠŸèƒ½        res = func(*args, **kwargs)        return res    return wrapper\n\néœ€æ±‚ ï¼šå†™ä¸ªè®¤è¯åŠŸèƒ½ï¼ˆè¾“å…¥è´¦å·å¯†ç ï¼Œè¿›è¡Œè®¤è¯ï¼‰ï¼Œå½“ç„¶è´¦å·å¯†ç æ˜¯è¦ä»æ–‡ä»¶ä¸­å–å‡º\ndef auth(func):    def wrapper(*args, **kwargs):        # 1ã€è°ƒç”¨åŸå‡½æ•°        # 2ã€ä¸ºå…¶å¢åŠ æ–°åŠŸèƒ½        name = input(&#x27;your name&gt;&gt;: &#x27;).strip()        pwd = input(&#x27;your password&gt;&gt;: &#x27;).strip()        if name == &#x27;egon&#x27; and pwd == &#x27;123&#x27;:            res = func(*args, **kwargs)            return res        else:            print(&#x27;è´¦å·å¯†ç é”™è¯¯&#x27;)    return wrapper@authdef index():    print(&#x27;from index&#x27;)\n\nåç¨‹åç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æŠ€æœ¯ï¼Œå°±æ˜¯é€šè¿‡çº¿ç¨‹å®ç°ä»£ç å—ç›¸äº’åˆ‡æ¢æ‰§è¡Œã€‚\n1.å¼‚æ­¥ç¼–ç¨‹1.1 äº‹ä»¶å¾ªç¯ç†è§£æˆä¸ºä¸€ä¸ªæ­»å¾ªç¯ï¼Œå»æ£€æµ‹å¹¶æ‰§è¡ŒæŸäº›ä»£ç \n# ä¼ªä»£ç ä»»åŠ¡åˆ—è¡¨ = [ä»»åŠ¡1ï¼Œ ä»»åŠ¡2ï¼Œ ä»»åŠ¡3...]while True:\tå¯æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼Œå·²å®Œæˆçš„ä»»åŠ¡åˆ—è¡¨ = å»ä»»åŠ¡åˆ—è¡¨ä¸­æ£€æŸ¥æ‰€æœ‰ä»»åŠ¡ï¼Œå°†â€˜å¯æ‰§è¡Œâ€™å’Œâ€˜å·²å®Œæˆâ€™ä»»åŠ¡è¿”å›\tfor å°±ç»ªä»»åŠ¡ in å¯æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨:\t\tæ‰§è¡Œå·²å°±ç»ªä»»åŠ¡\tfor å·²å®Œæˆä»»åŠ¡ in å·²å®Œæˆçš„ä»»åŠ¡åˆ—è¡¨:\t\tä»»åŠ¡åˆ—è¡¨ä¸­ç§»é™¤ å·²å®Œæˆä»»åŠ¡\tå¦‚æœä»»åŠ¡åˆ—è¡¨ä¸­ä»»åŠ¡å·²å®Œæˆï¼Œåˆ™ç»ˆæ­¢å¾ªç¯\n\nimport asyncio# å»ç”Ÿæˆæˆ–è·å–ä¸€ä¸ªäº‹ä»¶å¾ªç¯loop = asyncio.get_event_loop()# å°†ä»»åŠ¡æ”¾åˆ°ä»»åŠ¡åˆ—è¡¨loop.run_until_complete(ä»»åŠ¡)\n\n1.2 å¿«é€Ÿä¸Šæ‰‹åç¨‹å‡½æ•°ï¼Œå®šä¹‰å‡½æ•° async def å‡½æ•°å\nåç¨‹å¯¹è±¡ï¼Œæ‰§è¡Œ åç¨‹å‡½æ•°() å¾—åˆ°çš„åç¨‹å¯¹è±¡\næ‰§è¡Œåç¨‹å‡½æ•°åˆ›å»ºåç¨‹å¯¹è±¡ï¼Œå‡½æ•°å†…éƒ¨ä»£ç ä¸ä¼šæ‰§è¡Œã€‚\nå¦‚æœæƒ³è¦è¿è¡Œåç¨‹å‡½æ•°å†…éƒ¨ä»£ç ï¼Œå¿…é¡»å°†åç¨‹å¯¹è±¡äº¤ç»™äº‹ä»¶å¾ªç¯æ¥å¤„ç†\nimport asyncioasync def func():    print(&quot;play with me!&quot;)result = func()# loop = asyncio.get_event_loop()# loop.run_until_complete(result)asyncio.run(result) # python3.7 æœ¬è´¨ä¸Šåšä¸Šé¢çš„äº‹\n\n1.3 awaitawait + å¯ç­‰å¾…çš„å¯¹è±¡ï¼ˆåç¨‹å¯¹è±¡ï¼ŒFutureï¼ŒTaskå¯¹è±¡ï¼‰\nç¤ºä¾‹1ï¼š\nimport asyncioasync def other():    print(&quot;start&quot;)    await asyncio.sleep(2)    print(&quot;end&quot;)    return &#x27;è¿”å›å€¼&#x27;async def func():    print(&quot;æ‰§è¡Œåç¨‹å‡½æ•°å†…éƒ¨ä»£ç &quot;)    # é‡åˆ°IOæ“ä½œæŒ‚èµ·å½“å‰åç¨‹ï¼Œç­‰IOæ“ä½œå®Œæˆä¹‹åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œ    # å½“å‰åç¨‹æŒ‚èµ·æ—¶ï¼Œäº‹ä»¶å¾ªç¯å¯ä»¥å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡    response = await other()    print(&quot;IOè¯·æ±‚ç»“æŸï¼Œç»“æœä¸ºï¼š&quot;, response)asyncio.run(func())\n\nç¤ºä¾‹2ï¼š\nimport asyncioasync def other():    print(&quot;start&quot;)    await asyncio.sleep(2)    print(&quot;end&quot;)    return &#x27;è¿”å›å€¼&#x27;async def func():    print(&quot;æ‰§è¡Œåç¨‹å‡½æ•°å†…éƒ¨ä»£ç &quot;)    # é‡åˆ°IOæ“ä½œæŒ‚èµ·å½“å‰åç¨‹ï¼Œç­‰IOæ“ä½œå®Œæˆä¹‹åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œ    # å½“å‰åç¨‹æŒ‚èµ·æ—¶ï¼Œäº‹ä»¶å¾ªç¯å¯ä»¥å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡    response1 = await other()    print(&quot;IOè¯·æ±‚ç»“æŸï¼Œç»“æœä¸ºï¼š&quot;, response1)    response2 = await other()    print(&quot;IOè¯·æ±‚ç»“æŸï¼Œç»“æœä¸ºï¼š&quot;, response2)asyncio.run(func())\n\nawaitå°±æ˜¯ç­‰å¾…å¯¹è±¡çš„å€¼å¾—åˆ°ç»“æœä¹‹åå†ç»§ç»­å¾€ä¸‹èµ°\n1.4 taskå¯¹è±¡åœ¨äº‹ä»¶å¾ªç¯ä¸­æ·»åŠ å¤šä¸ªä»»åŠ¡\ntaskç”¨äºå¹¶å‘è°ƒåº¦åç¨‹ï¼Œé€šè¿‡asyncio.create_task(åç¨‹å¯¹è±¡)çš„æ–¹å¼åˆ›å»ºtaskå¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥è®©åç¨‹åŠ å…¥äº‹ä»¶å¾ªç¯ä¸­ç­‰å¾…è¢«è°ƒåº¦æ‰§è¡Œã€‚\nç¤ºä¾‹1ï¼š\nimport asyncioasync def func():    print(1)    await asyncio.sleep(2)    print(2)    return &quot;è¿”å›å€¼&quot;async def main():    print(&quot;mainå¼€å§‹&quot;)    # åˆ›å»ºtaskå¯¹è±¡ï¼Œå°†å½“å‰æ‰§è¡Œfuncå‡½æ•°ä»»åŠ¡æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯    task1 = asyncio.create_task(func())    task2 = asyncio.create_task(func())    print(&quot;mainç»“æŸ&quot;)    # å½“æ‰§è¡ŒæŸåç¨‹é‡åˆ°IOæ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨åŒ–åˆ‡æ¢æ‰§è¡Œå…¶ä»–ä»»åŠ¡    # æ­¤æ—¶çš„awaitæ˜¯ç­‰å¾…ç›¸åº”çš„åç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•å¹¶è·å–ç»“æœ    ret1 = await task1    ret2 = await task2    print(ret1, ret2)asyncio.run(main())\n\nç¤ºä¾‹2ï¼š\nimport asyncioasync def func():    print(1)    await asyncio.sleep(2)    print(2)    return &quot;è¿”å›å€¼&quot;async def main():    print(&quot;mainå¼€å§‹&quot;)    task_list = [        asyncio.create_task(func()),        asyncio.create_task(func())    ]    print(&quot;mainç»“æŸ&quot;)    done, pending = await asyncio.wait(task_list)    print(done)asyncio.run(main())\n\nç¤ºä¾‹3ï¼š\nimport asyncioasync def func():    print(1)    await asyncio.sleep(2)    print(2)    return &quot;è¿”å›å€¼&quot;# task_list = [#     asyncio.create_task(func()),#     asyncio.create_task(func())# ]# ç›´æ¥æ”¾taskåˆ—è¡¨ä¼šæŠ¥é”™ï¼Œcreate_taskå°†taskæ”¾åˆ°äº‹ä»¶å¾ªç¯åˆ—è¡¨ä¸­ï¼Œè€Œäº‹ä»¶å¾ªç¯è¿˜æ²¡æœ‰è¢«åˆ›å»º# asyncio.run(asyncio.wait(task_list))task_list = [func(), func()]done, pending = asyncio.run(asyncio.wait(task_list))print(done)\n\n1.5 asyncio.Futureå¯¹è±¡taskç»§æ‰¿futureï¼Œtaskå¯¹è±¡å†…éƒ¨awaitç»“æœçš„å¤„ç†åŸºäºfutureå¯¹è±¡æ¥çš„\n1.6 concurrent.futures.Futureå½“å‡ºç°ç¬¬ä¸‰æ–¹ä¾èµ–ä¸æ”¯æŒå¼‚æ­¥çš„æ—¶å€™\nimport timeimport asynciodef func():    time.sleep(2)    return &quot;xxx&quot;async def main():    loop = asyncio.get_running_loop()    # ç¬¬ä¸€æ­¥å†…éƒ¨è°ƒç”¨ThreadPoolExecutorçš„submitæ–¹æ³•å»çº¿ç¨‹æ± ç”³è¯·ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œfuncå‡½æ•°ï¼Œ    # å¹¶è¿”å›concurrent.futures.Futureå¯¹è±¡    # ç¬¬äºŒæ­¥è°ƒç”¨wrap_futureå°†concurrent.futures.FutureåŒ…è£…ä¸ºasyncio.Futureå¯¹è±¡    # è¿›è¡Œä½¿ç”¨    fut = loop.run_in_executor(None, func)    result = await fut\n\n1.7 å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ­¤å¯¹è±¡é€šè¿‡å®šä¹‰__aenter__()å’Œ__aexit____()æ–¹æ³•æ¥å¯¹async withè¯­å¥ä¸­çš„ç¯å¢ƒè¿›è¡Œæ§åˆ¶\nimport asyncioclass AsyncContextManager:    def __init__(self):        self.conn = conn    async def do_something(self):        # å¼‚æ­¥æ“ä½œæ•°æ®åº“        return 666    async def __aenter__(self):        # å¼‚æ­¥é“¾æ¥æ•°æ®åº“        self.conn = await asyncio.sleep(1)        return self    async def __aexit__(self, exc_type, exc_val, exc_tb):        # å¼‚æ­¥å…³é—­æ•°æ®åº“é“¾æ¥        await asyncio.sleep(1)async def fun():    async with AsyncContextManager() as f:        result = await f.do_something()        print(result)asyncio.run(fun())\n\nuvloopæ˜¯asyncioçš„äº‹ä»¶å¾ªç¯æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒçš„æ€§èƒ½å¤§äºé»˜è®¤çš„asyncio\n#pip install uvloopimport asyncioimport uvloopasyncio.set_event_loop_policy(uvloop.EventLoopPolicy())# ä¹‹åç¼–å†™ä»£ç ä¸ä¹‹å‰çš„ä»£ç ä¸€è‡´\n\nä¸€ä¸ªasgiï¼ˆå¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼‰ -&gt; uvicornå†…éƒ¨ä½¿ç”¨äº†uvloop\npytest1. pytest.mark.parametrizeåŸºæœ¬ä½¿ç”¨import pytestclass TestApi:    @pytest.mark.parametrize(&#x27;args&#x27;, [&#x27;ç™¾é‡Œ&#x27;, &#x27;åƒé‡Œ&#x27;, &#x27;è®®æ¡ˆ&#x27;])    def test_01_baili(self, args):        print(args)\n\nimport pytestclass TestApi:    @pytest.mark.parametrize(&#x27;name,age&#x27;, [[&#x27;ç™¾é‡Œ&#x27;, &#x27;38&#x27;], [&#x27;åƒé‡Œ&#x27;, &#x27;18&#x27;]])    def test_02_baili(self, name, age):        print(name, age)\n\n2. pytest-mockä½¿ç”¨def test_buy_product_success(mocker):    &quot;&quot;&quot;    è´­ä¹°æˆåŠŸMock    :param mocker:    :return:    &quot;&quot;&quot;    # å®ä¾‹åŒ–ä¸€ä¸ªäº§å“å¯¹è±¡    product = Product()    # å¯¹Productä¸­çš„æ–¹æ³•çš„è¿”å›å€¼è¿›è¡ŒMock    mock_value = &#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;è‹¹æœ&quot;, &quot;num&quot;: 23&#125;    # Mockæ–¹æ³•    # æ³¨æ„ï¼šéœ€è¦æŒ‡å®šæ–¹æ³•çš„å®Œæ•´è·¯å¾„    # mocker.patch çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯æ¨¡æ‹Ÿå¯¹è±¡çš„å…·ä½“è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šè¿”å›å€¼    product.get_product_status_by_id = mocker.patch(&quot;testcase.test_product.Product.get_product_status_by_id&quot;,                                                    return_value=mock_value)    # è°ƒç”¨è´­ä¹°äº§å“çš„æ–¹æ³•    result = product.buy_product(1)    assert result.get(&quot;status&quot;) == 0\n\n","categories":["è¯­è¨€"],"tags":["å­¦ä¹ ","python"]},{"title":"docker","url":"/java4u/2022/09/07/docker/","content":"dockeræ¶æ„\né•œåƒï¼šdockeré•œåƒå°±ç›¸å½“äºä¸€ä¸ªrootæ–‡ä»¶ç³»ç»Ÿï¼Œç›¸å½“å®¹å™¨çš„â€œæºä»£ç â€\nå®¹å™¨ï¼šé•œåƒå’Œå®¹å™¨çš„å…³ç³»å°±æ˜¯ç±»å’Œå¯¹è±¡çš„å…³ç³»ï¼Œç”¨é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹\nä»“åº“ï¼šå­˜æ”¾é•œåƒ\n\nå‘½ä»¤é•œåƒdocker â€“helpdocker images æŸ¥çœ‹æœ¬åœ°é•œåƒdocker search redis  æœç´¢é•œåƒdocker pull redis æ‹‰å–é•œåƒdocker rmi images_id  åˆ é™¤é•œåƒ\nREPOSITORYå’ŒTAGéƒ½æ˜¯noneï¼Œè™šæ‚¬é•œåƒ\nå®¹å™¨å¯åŠ¨å®¹å™¨    ä¿æŒè¿è¡Œï¼ˆidåå°è¿è¡Œï¼‰       é€‰æ‹©é•œåƒdocker run -it â€“name&#x3D;c1 centos:7 &#x2F;bin&#x2F;bashexit   é€€å‡ºå®¹å™¨ï¼ˆå®¹å™¨ä¼šåœæ­¢ï¼‰ctrl+p+q   é€€å‡ºå®¹å™¨ï¼ˆå®¹å™¨ä¸åœæ­¢ï¼‰docker ps [-a]  æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨(å†å²å®¹å™¨)docker exec -it c2 &#x2F;bin&#x2F;bash  è¿›å…¥å®¹å™¨docker attach å®¹å™¨IDdocker stop name  åœæ­¢å®¹å™¨docker rm c1   åˆ é™¤å®¹å™¨docker top [imageid]docker inspect c2   æŸ¥çœ‹å®¹å™¨ä¿¡æ¯docker cp å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„docker export å®¹å™¨ID &gt; æ–‡ä»¶å.tar     å¯¼å‡ºå®¹å™¨å†…å®¹ä½œä¸ºtarå½’æ¡£æ–‡ä»¶cat xxx.tar | docker import  é•œåƒåç§°&#x2F;é•œåƒç‰ˆæœ¬ï¼šé•œåƒç‰ˆæœ¬\næ•°æ®å·\næ•°æ®å·æ˜¯å®¿ä¸»æœºçš„ä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶\nå½“å®¹å™¨ç›®å½•å’Œæ•°æ®å·ç›®å½•ç»‘å®šåï¼Œå¯¹æ–¹çš„ä¿®æ”¹ä¼šç«‹å³åŒæ­¥\nä¸€ä¸ªæ•°æ®å·å¯ä»¥è¢«å¤šä¸ªå®¹å™¨åŒæ—¶æŒ‚è½½\nä¸€ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥æŒ‚è½½å¤šä¸ªæ•°æ®å·\nâ€“privileged&#x3D;true,æ‰©å¤§å®¹å™¨æƒé™\né»˜è®¤åˆ›å»ºçš„æŒ‚è½½æœ‰è¯»å†™æƒé™ï¼Œæ·»åŠ roï¼Œç»™åªè¯»æƒé™ï¼Œé™åˆ¶å®¹å™¨å†…å»å†™\n\ndocker run .. -v å®¿ä¸»æœºç›®å½•ï¼ˆæ–‡ä»¶ï¼‰:å®¹å™¨å†…ç›®å½•ï¼ˆæ–‡ä»¶ï¼‰docker run -it â€“name&#x3D;c1 -v &#x2F;home&#x2F;dave_cc&#x2F;data:&#x2F;root&#x2F;data_container centos:7:ro &#x2F;bin&#x2F;bash\nåˆ›å»ºæ•°æ®å·å®¹å™¨docker run -it â€“name&#x3D;c3 -v &#x2F;volume centos:7æŒ‚è½½æ•°æ®å·å®¹å™¨ï¼ˆç»§æ‰¿æ•°æ®å·æŒ‚è½½è§„åˆ™ï¼‰docker run -it â€“name&#x3D;c1 â€“volumes-from c3 centos:7\nå¸¸è§„è½¯ä»¶å®‰è£…éƒ¨ç½²mysqldocker run -d -p 3307:3306 â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;home&#x2F;dave_cc&#x2F;mysql&#x2F;logs:&#x2F;var&#x2F;log&#x2F;mysql -v &#x2F;home&#x2F;dave_cc&#x2F;mysql&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 â€“name&#x3D;c_mysql mysql:5.6\nè¿›å…¥mysqlmysql -uroot -p\næŸ¥çœ‹mysqlç¼–ç show variables like â€˜character%â€™;\néƒ¨ç½²tomcatdocker run -id â€“name&#x3D;c_tomcat -p 8080:8080 tomcat\nå°†ä¹‹å‰çš„webappsåˆ é™¤ï¼Œå°†webapps.distæ”¹åæˆwebappså³å¯çœ‹åˆ°é¦–é¡µ\néƒ¨ç½²nginxuser  nginx;worker_processes  1;error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn;pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;events {    worker_connections  1024;}http {    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;    default_type  application&#x2F;octet-stream;    log_format  main  â€˜$remote_addr - $remote_user [$time_local] â€œ$requestâ€ â€˜                      â€˜$status $body_bytes_sent â€œ$http_refererâ€ â€˜                      â€˜â€œ$http_user_agentâ€ â€œ$http_x_forwarded_forâ€â€˜;    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;    sendfile        on;    # tcp_nopush     on;    keepalive_timeout  65;\ninclude /etc/nginx/conf.d/*.conf;\n\n}\ndocker run -id â€“name&#x3D;c_nginx \\\n\n-p 80:80 -v $PWD&#x2F;conf&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf -v $PWD&#x2F;logs:&#x2F;var&#x2F;log&#x2F;nginx -v $PWD&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx\n\néƒ¨ç½²redisé›†ç¾¤docker run -d â€“name&#x3D;redis-node-1 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-1:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6381docker run -d â€“name&#x3D;redis-node-2 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-2:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6382docker run -d â€“name&#x3D;redis-node-3 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-3:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6383docker run -d â€“name&#x3D;redis-node-4 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-4:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6384docker run -d â€“name&#x3D;redis-node-5 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-5:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6385docker run -d â€“name&#x3D;redis-node-6 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-6:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6386\næ„å»ºä¸»ä»å…³ç³»\nredis-cli â€“cluster create 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383 127.0.0.1:6384 127.0.0.1:6385 127.0.0.1:6386 â€“cluster-replicas 1\næŸ¥çœ‹é›†ç¾¤çŠ¶æ€redis-cli -p 6381cluster infocluster nodes\nè¿æ¥redisé›†ç¾¤æ–¹å¼redis-cli -p 6381 -c\né›†ç¾¤æ£€æŸ¥redis-cli â€“cluster check 127.0.0.1:6381\nredisé›†ç¾¤æ‰©å®¹1.æ–°å»º6387 6388 ä¸¤ä¸ªèŠ‚ç‚¹docker run -d â€“name&#x3D;redis-node-7 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-7:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6387docker run -d â€“name&#x3D;redis-node-8 â€“net host â€“privileged&#x3D;true -v &#x2F;home&#x2F;dave_cc&#x2F;redis&#x2F;share&#x2F;redis-node-8:&#x2F;data redis â€“cluster-enabled yes â€“appendonly yes â€“port 6388\n2.å°†æ–°å¢çš„6387èŠ‚ç‚¹ä½œä¸ºmasterèŠ‚ç‚¹åŠ å…¥åŸé›†ç¾¤è¿›å…¥6387å®¹å™¨redis-cli â€“cluster add-node 127.0.0.1:6387 127.0.0.1:6381\n3.é‡æ–°åˆ†é…æ§½å·redis-cli â€“cluster reshard 127.0.0.1:6381\n4.ä¸º6387åˆ†é…6388çš„ä»èŠ‚ç‚¹redis-cli â€“cluster add-node 127.0.0.1:6388 127.0.0.1:6387 â€“cluster-slave â€“cluster-master-id 4a15b5abc41f3a73baa1fd5875007ad9405a4b6a\nredisé›†ç¾¤ç¼©å®¹1.å°†6388ï¼ˆä»èŠ‚ç‚¹ï¼‰ä»é›†ç¾¤ä¸­åˆ é™¤redis-cli â€“cluster del-node 127.0.0.1:6388 6c1cf259c2eb0b06bf7f4dafe2470c0d383bd98d\n2.å°†6387çš„æ§½å·æ¸…ç©ºï¼Œé‡æ–°åˆ†é…ï¼ˆé€‰æ‹©éœ€è¦åˆ†é…æ§½çš„æ•°é‡ï¼Œç›®æ ‡èŠ‚ç‚¹å’Œæ¥æºèŠ‚ç‚¹ï¼‰redis-cli â€“cluster reshard 127.0.0.1:6381\n3.å°†6387ä»é›†ç¾¤ä¸­åˆ é™¤redis-cli â€“cluster del-node 127.0.0.1:6387 4a15b5abc41f3a73baa1fd5875007ad9405a4b6a\ndockerfiledockeré•œåƒåŸç†\ndockeré•œåƒæ˜¯ç”±ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿå åŠ è€Œæˆ\næœ€åº•ç«¯æ˜¯bootfs,å¹¶ä½¿ç”¨å®¿ä¸»æœºçš„bootfs\nç¬¬äºŒå±‚æ˜¯rootæ–‡ä»¶ç³»ç»Ÿrootfs\nç„¶åå¯ä»¥å¾€ä¸Šå åŠ å…¶ä»–çš„é•œåƒæ–‡ä»¶\nç»Ÿä¸€æ–‡ä»¶ç³»ç»ŸæŠ€æœ¯èƒ½å¤Ÿå°†ä¸åŒå±‚æ•´åˆæˆä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºè¿™äº›å±‚æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è§†è§’\nä¸€ä¸ªé•œåƒå¯ä»¥æ”¾åœ¨å¦ä¸€ä¸ªé•œåƒä¸Šé¢\n\né•œåƒåˆ¶ä½œ1.å®¹å™¨è½¬ä¸ºé•œåƒdocker commit -m&#x3D;â€æ³¨é‡Šâ€ -a&#x3D;â€ä½œè€…â€ å®¹å™¨id é•œåƒåç§°ï¼šç‰ˆæœ¬å·docker save -o å‹ç¼©æ–‡ä»¶åç§° é•œåƒåç§°ï¼šç‰ˆæœ¬å·docker load -i å‹ç¼©æ–‡ä»¶åç§°  (è¿˜åŸæˆé•œåƒ)\n2.dockerfile\n\ndockerfileæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶\nåŒ…å«äº†ä¸€æ¡æ¡æŒ‡ä»¤\næ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼Œæœ€ç»ˆæ„å»ºä¸€ä¸ªæ–°çš„é•œåƒ\nå¯¹äºå¼€å‘äººå‘˜ï¼šå¯ä»¥ä¸ºå¼€å‘å›¢ä½“æä¾›ä¸€ä¸ªå®Œå…¨ä¸€è‡´çš„å¼€å‘ç¯å¢ƒ\nå¯¹äºæµ‹è¯•äººå‘˜ï¼šå¯ä»¥ç›´æ¥æ‹¿å¼€å‘æ—¶æ„å»ºçš„é•œåƒæˆ–è€…é€šè¿‡dockerfileæ„å»ºä¸€ä¸ªæ–°çš„é•œåƒ\nå¯¹äºè¿ç»´äººå‘˜ï¼šåœ¨éƒ¨ç½²æ—¶ï¼Œå¯ä»¥å®ç°åº”ç”¨çš„æ— ç¼ç§»æ¤\n\ndockerfileå…³é”®å­—\n\n\n\nå…³é”®å­—\nä½œç”¨\nå¤‡æ³¨\n\n\n\nFROM\næŒ‡å®šçˆ¶é•œåƒ\næŒ‡å®šdockerfileåŸºäºé‚£ä¸ªimageæ„å»º\n\n\nMAINTAINER\nä½œè€…ä¿¡æ¯\nç”¨æ¥æ ‡æ˜è¿™ä¸ªdockerfileè°å†™çš„\n\n\nLABEL\næ ‡ç­¾\næ ‡æ˜dockerfileæ ‡ç­¾\n\n\nRUN\næ‰§è¡Œå‘½ä»¤\næ‰§è¡Œä¸€æ®µå‘½ä»¤é»˜è®¤æ˜¯&#x2F;bin&#x2F;shï¼ŒRUNåœ¨æ„å»ºæ—¶è¿è¡Œ\n\n\nCMD\nå®¹å™¨å¯åŠ¨å‘½ä»¤\næä¾›å®¹å™¨å¯åŠ¨æ—¶çš„é»˜è®¤å‘½ä»¤ï¼ŒCMDä¼šè¢«docker runä¹‹åçš„å‚æ•°æ›¿æ¢\n\n\nENTRYPOINT\nå…¥å£\næŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œä½†ENTRYPOINTä¸ä¼šè¢«docker runåé¢çš„å‘½ä»¤è¦†ç›–\n\n\nCOPY\nå¤åˆ¶æ–‡ä»¶\nbuildçš„æ—¶å€™å¤åˆ¶æ–‡ä»¶åˆ°imageä¸­\n\n\nADD\næ·»åŠ æ–‡ä»¶\nå°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…\n\n\nENV\nç¯å¢ƒå˜é‡\næŒ‡å®šbuildæ—¶å€™çš„ç¯å¢ƒå˜é‡ å¯ä»¥åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™é€šè¿‡-eè¦†ç›–\n\n\nARG\næ„å»ºå‚æ•°\næ„å»ºå‚æ•°åªåœ¨æ„å»ºçš„æ—¶å€™ä½¿ç”¨çš„å‚æ•°\n\n\nVOLUME\nå®šä¹‰å¤–éƒ¨å¯ä»¥æŒ‚è½½çš„æ•°æ®å·\n\n\n\nEXPOSE\næš´éœ²ç«¯å£\n\n\n\nWORKDIR\nå·¥ä½œç›®å½•\næŒ‡å®šå®¹å™¨å†…éƒ¨çš„å·¥ä½œç›®å½•\n\n\nUSER\næŒ‡å®šæ‰§è¡Œç”¨æˆ·\n\n\n\nENTRYPOINTå’ŒCMDä¸€èµ·ä½¿ç”¨ï¼Œå®é™…è¿è¡ŒENTRYPOINT,CMDå°±æ˜¯ç»™ENTRYPOINTä¼ é€’å‚æ•°ç›¸å½“äºï¼š â€œâ€œ\næ„å»ºé•œåƒdocker build -f Dockerfile -t centos:1.5 .\næ²¡æœ‰ä»“åº“åå’ŒTAGæ˜¯è™šæ‚¬é•œåƒï¼ŒæŸ¥çœ‹è™šæ‚¬é•œåƒdocker image ls -f dangling&#x3D;trueåˆ é™¤è™šæ‚¬é•œåƒdocker image prune\nç§æœ‰ä»“åº“ç§æœ‰ä»“åº“æ­å»º1.æ‹‰å–ç§æœ‰ä»“åº“é•œåƒdocker pull registry2.å¯åŠ¨ç§æœ‰ä»“åº“å®¹å™¨docker run -d â€“name&#x3D;registry -p 5000:5000 -v &#x2F;home&#x2F;dave_cc&#x2F;myregistry:&#x2F;tmp&#x2F;registry â€“privileged&#x3D;true registryhttp://localhost:5000/v2/_catalog çœ‹åˆ°{â€œrepositoriesâ€:[]}è¡¨ç¤ºæ­å»ºæˆåŠŸ3.ä¿®æ”¹daemon.json å–æ¶ˆdockerä¸å…è®¸httpçš„æ¨é€æ–¹å¼vim &#x2F;etc&#x2F;docker&#x2F;daemon.json{â€œinsecure-registriesâ€:[â€œ127.0.0.1:5000â€]}4.é‡å¯dockersystemctl restart docker\nå°†é•œåƒä¸Šä¼ è‡³ç§æœ‰ä»“åº“1.æ ‡è®°é•œåƒä¸ºç§æœ‰ä»“åº“é•œåƒdocker tag  é•œåƒ:Tag Host:Port&#x2F;Repository:Tagdocker tag centos:7 127.0.0.1:5000&#x2F;centos:72.ä¸Šä¼ æ ‡è®°çš„é•œåƒdocker push 127.0.0.1:5000&#x2F;centos:7\nä»ç§æœ‰ä»“åº“æ‹‰å–é•œåƒdocker pull 127.0.0.1:5000&#x2F;myubuntu:1.3\nåˆ†å¸ƒå¼å­˜å‚¨å“ˆå¸Œå–ä½™é€šè¿‡hashç®—æ³•å’Œè®¡ç®—å°æ•°ï¼Œè®¡ç®—å‡ºæ•°æ®è½åœ¨å“ªå°æœºå™¨ hash(key)%n\nä¼˜ç‚¹ï¼šç®€ç­”æœ‰æ•ˆç¼ºç‚¹ï¼šé›†ç¾¤æ‰©å®¹æˆ–ç¼©å®¹éƒ½ä¼šå¯¼è‡´æ•°æ®æ··æ·†\nä¸€è‡´æ€§å“ˆå¸Œ\nç®—æ³•æ„å»ºä¸€è‡´æ€§å“ˆå¸Œç¯\næœåŠ¡å™¨IPèŠ‚ç‚¹æ˜ å°„æ ¹æ®æœåŠ¡å™¨IPå°†æ¯å°æœåŠ¡å™¨æ˜ å°„åˆ°ç¯ä¸Š\nkeyè½åˆ°æœåŠ¡å™¨çš„è½é”®è§„åˆ™keyä½¿ç”¨ç›¸åŒçš„hashè§„åˆ™è®¡ç®—å‡ºç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®å»¶ç¯é¡ºæ—¶é’ˆç§»åŠ¨ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨\n\nä¼˜ç‚¹ï¼šè§£å†³äº†å“ˆå¸Œå–ä½™çš„ä¸€è‡´æ€§å’Œæ‰©ç¼©çš„é—®é¢˜ç¼ºç‚¹ï¼šä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„æ•°æ®å€¾æ–œé—®é¢˜ï¼ˆå¤§éƒ¨åˆ†æ•°æ®å¯èƒ½ä¼šè¢«åˆ†é…åˆ°ä¸€å°æˆ–æŸå‡ å°æœºå™¨ä¸Šï¼‰\nå“ˆå¸Œæ§½åˆ†åŒºè§£å†³å‡åŒ€åˆ†é…çš„é—®é¢˜ï¼Œåœ¨æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´åŠ å…¥äº†ä¸€å±‚ï¼ˆå¢å¤§æ•°æ®åˆ†é…çš„ç²’åº¦ï¼‰ï¼ŒæŠŠè¿™å±‚ç§°ä¹‹å“ˆå¸Œæ§½ï¼Œç”¨äºç®¡ç†æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œç›¸å½“äºèŠ‚ç‚¹ä¸Šæ”¾çš„æ˜¯æ§½ï¼Œæ§½é‡Œæ”¾çš„æ˜¯æ•°æ®\ndockerç½‘ç»œç½‘ç»œæ¨¡å¼ï¼š\n\nbridge:ä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…&#x2F;è®¾ç½®IPç­‰ï¼Œå¹¶å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªdocker0è™šæ‹Ÿç½‘æ¡¥,é»˜è®¤ä¸ºè¯¥æ¨¡å¼\nhost:ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£\nnone:å®¹å™¨æœ‰ç‹¬ç«‹çš„networkï¼Œä½†å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œä»»ä½•ç½‘ç»œè®¾ç½®\ncontainer:å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IP&#x2F;ç«¯å£èŒƒå›´\nè‡ªå®šä¹‰ç½‘ç»œï¼Œç»´æŠ¤å¥½ä¸»æœºåå’ŒIPçš„å¯¹åº”å…³ç³»ï¼Œè®©IPå’ŒæœåŠ¡åéƒ½å¯ä»¥PINGé€š\n\ndocker-composeå¯¹æœåŠ¡è¿›è¡Œç¼–æ’ï¼Œå¯ä»¥åŒæ—¶æ‰¹é‡è¿›è¡ŒæœåŠ¡å¯åŠ¨\nå¸¸ç”¨å‘½ä»¤ï¼š\n\n-h å¸®åŠ©\nup å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡\nup -d å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡å¹¶åå°è¿è¡Œ\ndown åœæ­¢å¹¶åˆ é™¤å®¹å™¨&#x2F;ç½‘ç»œ&#x2F;å·&#x2F;é•œåƒ\nexec æœåŠ¡id  è¿›å…¥å®¹å™¨å†…éƒ¨\nps  å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨\nconfig æ£€æŸ¥é…ç½®\n\nPortainerdockerç®¡ç†å›¾å½¢åŒ–å·¥å…·\ndocker run -d -p 8000:8000 -p 9000:9000 â€“name portainer â€“restart&#x3D;always -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v portainer_data:&#x2F;data portainer&#x2F;portainer-ce:latest\nCIGé‡é‡çº§ç›‘æ§ç³»ç»ŸCAdvisorç›‘æ§æ”¶é›†+InfluxDBå­˜å‚¨æ•°æ®+Granfanaå±•ç¤ºå›¾è¡¨\nCAdvisoræ˜¯å®¹å™¨èµ„æºç›‘æ§å·¥å…·ï¼Œé’ˆå¯¹å•ç‰©ç†æœºï¼Œæä¾›æ•°æ®é›†æ¥å£ï¼Œå°†æ•°æ®å‘å¾€æ•°æ®åº“å‚¨å­˜åŠŸèƒ½ï¼šå±•ç¤ºHOSTå’Œå®¹å™¨çš„ç›‘æ§æ•°æ®ï¼›å±•ç¤ºå†å²å˜åŒ–æ•°æ®InfluxDBå¼€æºåˆ†å¸ƒå¼æ—¶åº&#x2F;äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“åŠŸèƒ½ï¼šåŸºäºæ—¶é—´åºåˆ—ï¼›å¯åº¦é‡æ€§ï¼Œå¯ä»¥å®æ—¶å¯¹å¤§é‡æ•°æ®è¿›è¡Œè®¡ç®—ï¼›åŸºäºäº‹ä»¶Granfanaå¼€æºæ•°æ®ç›‘æ§åˆ†æå¯è§†åŒ–å¹³å°\n","categories":["å®¹å™¨"],"tags":["å­¦ä¹ ","docker"]},{"title":"kubernetes","url":"/java4u/2022/09/07/kubernetes/","content":"kubernetesä»‹ç»kubernetesæœ¬è´¨æ˜¯ä¸€ç»„æœåŠ¡å™¨é›†ç¾¤ï¼Œä¸»è¦æä¾›ï¼š\n\nè‡ªæˆ‘ä¿®å¤\nå¼¹æ€§ä¼¸ç¼©\næœåŠ¡å‘ç°\nè´Ÿè½½å‡è¡¡\nç‰ˆæœ¬å›é€€\nå­˜å‚¨ç¼–æ’\n\nkubernetesç»„ä»¶master:é›†ç¾¤æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­–(ç®¡ç†)\nApiserver:èµ„æºæ“ä½œå”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·å‘½ä»¤Scheduler:é›†ç¾¤èµ„æºè°ƒåº¦ControllerManager:è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’Etcd:è´Ÿè´£å‚¨å­˜é›†ç¾¤å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯\n\nnode:é›†ç¾¤æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ(å¹²æ´»)\nKuberlet:ç»´æŠ¤å®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼Œé€šè¿‡dockeræ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨KuberProxy:è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡Docker:è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ\n\nkubernetesæ¦‚å¿µMaster: é›†ç¾¤æ§åˆ¶èŠ‚ç‚¹Node: å·¥ä½œè´Ÿè½½èŠ‚ç‚¹Pod: k8sæœ€å°æ§åˆ¶å•å…ƒï¼Œå®¹å™¨è¿è¡Œåœ¨podä¸­ï¼Œä¸€ä¸ªpodå¯ä»¥æœ‰1ä¸ªæˆ–å¤šä¸ªå®¹å™¨deployment: podæ§åˆ¶å™¨ï¼Œç¡®ä¿podèµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€ï¼Œå½“podèµ„æºå‡ºç°æ•…éšœï¼Œä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–é‡å»ºController: æ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒå®ç°å¯¹podçš„ç®¡ç†ï¼Œå¯åœ&#x2F;ä¼¸ç¼©podService: podå¯¹å¤–æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œå¯ä»¥ç»´æŠ¤åŒä¸€ç±»å¤šä¸ªpodLabel: æ ‡ç­¾ï¼Œç”¨å¯¹podè¿›è¡Œåˆ†ç±»NameSpace: å‘½åç©ºé—´ï¼Œç”¨æ¥éš”ç¦»podçš„è¿è¡Œç¯å¢ƒ\nPodèµ„æºä¸€çº§å±æ€§\n\napiVersion\nkind  èµ„æºç±»å‹  [kubectl api-resource]\nmetadata  å…ƒæ•°æ®\nspec   æè¿°ï¼Œèµ„æºé…ç½®çš„è¯¦ç»†æè¿°\nstatus   çŠ¶æ€ä¿¡æ¯ï¼Œk8sè‡ªåŠ¨ç”Ÿæˆ\n\nspecä¸»è¦é…ç½®ï¼ŒæŸ¥çœ‹å®ƒçš„å¸¸è§å­å±æ€§ï¼š\ncontainers  å®¹å™¨åˆ—è¡¨ï¼Œå®šä¹‰å®¹å™¨è¯¦ç»†ä¿¡æ¯\ncontainers:    name &lt;string&gt;  #å®¹å™¨åç§°    image &lt;string&gt; #å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€    imagePullPolicy &lt;string&gt; #é•œåƒæ‹‰å»ç­–ç•¥ Alwaysæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å– IfNotPresent æœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°çš„ï¼Œæœ¬åœ°æ²¡æœ‰è¿œç¨‹ä¸‹è½½  Never åªä½¿ç”¨æœ¬åœ°é•œåƒ    command &lt;[]string&gt; #å®¹å™¨å¯åŠ¨å‘½ä»¤    args &lt;[]string&gt;  #å®¹å™¨å¯åŠ¨å‘½ä»¤éœ€è¦çš„å‚æ•°åˆ—è¡¨    env &lt;[]string&gt;  #å®¹å™¨ç¯å¢ƒå˜é‡çš„é…ç½®    ports      #å®¹å™¨éœ€è¦æš´éœ²çš„ç«¯å£åˆ—è¡¨    resources &lt;Object&gt; #èµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„è®¾ç½®ï¼Œä»–æœ‰2ä¸ªå­é€‰é¡¹ limits:é™åˆ¶è¿è¡Œæ—¶å®¹å™¨æœ€å¤§å ç”¨èµ„æº  requests:ç”¨äºè®¾ç½®å®¹å™¨éœ€è¦çš„æœ€å°èµ„æº\n\ncontainersçš„portsé€‰é¡¹\nKIND: PodVERSION: v1RESOURCE: ports &lt;[]object&gt;FIELDS:  name  &lt;string&gt;  #ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šå¿…é¡»ä¿è¯å”¯ä¸€  containerPort&lt;integer&gt; #å®¹å™¨è¦ç›‘å¬çš„ç«¯å£  hostPort  &lt;integer&gt;  #å®¹å™¨åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£,å¦‚æœè®¾ç½®ï¼Œä¸»æœºåªèƒ½è¿è¡Œå®¹å™¨ä¸€ä¸ªå‰¯æœ¬  hostIP  &lt;string&gt;  #å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°ä¸»æœºIP  protocol &lt;string&gt; #ç«¯å£åè®®ï¼Œå¿…é¡»æ˜¯UDP/TCPæˆ–SCTP,é»˜è®¤TCP\n\næµ‹è¯•æ ·ä¾‹\napiVersion: v1kind: Podmetadata:  name: podname  namespace: devspec:  containers:  - name: nginx    image: nginx:1.17.1\n\nè¯¦ç»†æ ·ä¾‹\napiVersion: v1kind: Podmetadata:  name: pod-base  namespace: dev  labels:    user: heimaspec:  containers:  - name: nginx    image: nginx:1.17.1    imagePullPolicy: Always    ports:    - name: nginx-port      containerPort: 80      protocol: TCP    volumeMounts:  #å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ï¼Œå¯¹åº”ç›®å½•ä¸º/var/log/nginx    - name: logs-volume      mountPath: /var/log/nginx    resources:      limits:        cpu: &quot;2&quot;        memory: &quot;10Gi&quot;      requests:        cpu: &quot;1&quot;        memory: &quot;10Mi&quot;    livenessProbe:      exec:        command: [&quot;/bin/cat&quot;,&quot;/tmp/hello.txt&quot;]      initialDelaySeconds: 30  # å®¹å™¨å¯åŠ¨å30så¼€å§‹æ¢æµ‹      timeoutSeconds: 5  # æ¢æµ‹è¶…æ—¶æ—¶é—´5s  # nodeName: node1  # æŒ‡å®šè°ƒåº¦åˆ°node1èŠ‚ç‚¹  # nodeSelector:  #   nodeenv: pro  # æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰nodeenv=proæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š  affinity:  # äº²å’Œæ€§è®¾ç½®    nodeAffinity:  # è®¾ç½®nodeäº²å’Œæ€§      requireDuringSchedulingIgnoreDuringExecution:  # ç¡¬é™åˆ¶        nodeSelectorTerms:        - matchExpressions:  # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾          - key: nodeenv            operator: In            value: [&quot;xxx&quot;,&quot;yyy&quot;]      preferredDuringSchedulingIgnoreDuringExecution:  # è½¯é™åˆ¶      - weight: 1        preference:          matchExpressions:          - key: nodeenv            operator: In            value: [&quot;xxx&quot;,&quot;yyy&quot;]    podAffinity:  # è®¾ç½®podäº²å’Œæ€§      requireDuringSchedulingIgnoreDuringExecution:      - labelSelector:          matchExpressions:          - key: podenv            operator: In            value: [&quot;xxx&quot;,&quot;yyy&quot;]        topologyKey: kubernetes.io/hostname   # ä½œç”¨åŸŸ è°ƒåº¦åˆ°ä¸€ä¸ªç›®æ ‡èŠ‚ç‚¹  tolerations:  # æ·»åŠ å®¹å¿  - key: &quot;tag&quot;  # è¦å®¹å¿çš„æ±¡ç‚¹çš„key    operator: &quot;Equal&quot;  # æ“ä½œç¬¦    value: &quot;heima&quot;     # å®¹å¿çš„æ±¡ç‚¹çš„value    effect: &quot;NoExecute&quot; # æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ  restartPolicy: Never  # é‡å¯ç­–ç•¥  Always,è‡ªåŠ¨é‡å¯  OnFailure,å¼‚å¸¸æ—¶é‡å¯  Neverä¸é‡å¯  - name: busybox    image: busybox:1.30    command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt;sleep 3;done;&quot;]    volumeMounts:    - name: logs-volume      mountPath: /logs    env:    - name: &quot;username&quot;      value: &quot;admin&quot;    - name: &quot;password&quot;      value: &quot;123456&quot;    lifecycle:      postStart:        exec:  # å®¹å™¨å¯åŠ¨å‰æ‰§è¡Œå‘½ä»¤ï¼Œä¿®æ”¹nginxé»˜è®¤é¡µé¢          command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;echo postStart... &gt; /usr/share/nginx/html/index/html&quot;]      preStop:        exec:  # å®¹å™¨åœæ­¢å‰åœæ­¢nginxæœåŠ¡          command: [&quot;/usr/sbin/nginx&quot;,&quot;-s&quot;,&quot;quit&quot;]  initContainers:  # åˆå§‹åŒ–å®¹å™¨ï¼Œèƒ½è¿æ¥ä¸Šmysqlå’Œredisæ‰ä¼šå¯åŠ¨å®¹å™¨  - name: test-mysql    image: busybox:1.30    command: [&#x27;sh&#x27;,&#x27;-c&#x27;,&#x27;until ping 192.168.109.201 -c 1 ; do echo waiting for mysql...; sleep 2;done;&#x27;]  - name: test-redis    image: busybox:1.30    command: [&#x27;sh&#x27;,&#x27;-c&#x27;,&#x27;until ping 192.168.109.202 -c 1 ;do echo waiting for redis...; sleep 2; done;&#x27;]  volumes:  #å£°æ˜volume,nameä¸ºlogs-volume,ç±»å‹ä¸ºemptyDir  - name: logs-volume    emptyDir: &#123;&#125;\n\npodç”Ÿå‘½å‘¨æœŸ\npodåˆ›å»ºè¿‡ç¨‹\nè¿è¡Œåˆå§‹åŒ–å®¹å™¨è¿‡ç¨‹\nè¿è¡Œä¸»å®¹å™¨è¿‡ç¨‹\nå®¹å™¨å¯åŠ¨åé’©å­(post start)&#x2F;å®¹å™¨ç»ˆæ­¢å‰é’©å­ï¼ˆpre stopï¼‰\nå®¹å™¨å­˜æ´»æ€§æ¢æµ‹&#x2F;å°±ç»ªæ¢æµ‹\n\n\npodç»ˆæ­¢è¿‡ç¨‹\n\né’©å­å¤„ç†å™¨æ”¯æŒä¸‹é¢ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š\n\nExecå‘½ä»¤ï¼šåœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸€æ¬¡å‘½ä»¤\n\nlifecycle:  postStart:    exec:      command:      - cat      - /tmp/healthy\n\n\nTCPSocket:å°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸\n\nlifecycle:  postStart:    tcpSocket:      port: 8080\n\n\nHTTPGet:åœ¨å½“å‰å®¹å™¨ä¸­å‘æŸurlå‘èµ·httpè¯·æ±‚\n\nlifecycle:  postStart:    httpGet:      path: /      port: 80      host: 192.168.109.100      scheme: HTTP\n\nå®¹å™¨æ¢æµ‹liveness probes:å­˜æ´»æ€§æ¢é’ˆï¼Œæ£€æµ‹åº”ç”¨å®ä¾‹æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€readiness probes:å°±ç»ªæ€§æ¢é’ˆï¼Œæ£€æµ‹åº”ç”¨å®ä¾‹æ˜¯å¦å¯ä»¥æ¥å—è¯·æ±‚\npodè°ƒåº¦kubernetesæä¾›å››å¤§ç±»è°ƒåº¦æ–¹å¼ï¼š\n\nè‡ªåŠ¨è°ƒåº¦\nå®šå‘è°ƒåº¦:NodeName,NodeSelector\näº²å’Œæ€§è°ƒåº¦ï¼šNodeAffinity,PodAffinity,PodAntAffinity\næ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼šTaints,Toleration\n\näº²å’Œæ€§è°ƒåº¦åˆ†ä¸ºä¸‰ç±»ï¼š\n\nNodeAffinity(nodeäº²å’Œæ€§):ä»¥nodeä¸ºç›®æ ‡ï¼Œå°†Podè°ƒåº¦åˆ°ç›®æ ‡nodeä¸Š\nPodAffinity(podäº²å’Œæ€§)ï¼šä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥å’Œå“ªäº›å·²å­˜åœ¨çš„podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­\nPodAntAffinity(podåäº²å’Œæ€§):ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podä¸èƒ½å’Œå“ªäº›å·²å­˜åœ¨podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜\n\näº²å’Œæ€§ä½¿ç”¨åœºæ™¯ï¼šäº²å’Œæ€§ï¼šå¦‚æœ2ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œæœ‰å¿…è¦è®©2ä¸ªåº”ç”¨å°½å¯èƒ½é è¿‘ï¼Œå‡å°‘ç½‘ç»œé€šä¿¡å¸¦æ¥çš„æ€§èƒ½æŸè€—åäº²å’Œæ€§ï¼šå½“åº”ç”¨é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²æ—¶ï¼Œæœ‰å¿…è¦é‡‡ç”¨åäº²å’Œæ€§è®©åº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ªnodeä¸Šã€‚å¯ä»¥æä¾›æœåŠ¡çš„é«˜å¯ç”¨æ€§\nPodæ§åˆ¶å™¨å¸¸è§çš„podæ§åˆ¶å™¨ï¼š\n\nReplicationController:æ¯”è¾ƒåŸå§‹çš„podæ§åˆ¶å™¨\nReplicaSet: ä¿è¯æŒ‡å®šæ•°é‡çš„podè¿è¡Œï¼Œå¹¶æ”¯æŒpodæ•°é‡å˜æ›´ï¼Œé•œåƒç‰ˆæœ¬å˜æ›´\nDeployment:é€šè¿‡æ§åˆ¶ReplicaSetæ¥æ§åˆ¶podï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ï¼Œç‰ˆæœ¬å›é€€\nHorizontal Pod Autoscaler:å¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨è°ƒæ•´podæ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·\nDaemonSet: åœ¨é›†ç¾¤ä¸­æŒ‡å®šNODEä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡\njob: å®ƒåˆ›å»ºå‡ºæ¥çš„podåªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡\nCronjob:å®ƒåˆ›å»ºçš„podä¼šå‘¨æœŸæ€§çš„æ‰§è¡Œï¼Œç”¨äºæ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡\nStatefulSet:ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨\n\nReplicaSet(rs)ä¿è¯ä¸€å®šæ•°é‡çš„podèƒ½æ­£å¸¸è¿è¡Œï¼Œä¸€æ—¦podå‘ç”Ÿæ•…éšœå°±ä¼šé‡å¯æˆ–é‡å»º\napiVersion: apps/v1  #ç‰ˆæœ¬å·kind: ReplicaSet  #ç±»å‹metadata:  name:  namespace  labels:    controller: rsspec:  replicas: 3 #å‰¯æœ¬æ•°é‡  selector:   #é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod    matchLabels:   #labelsåŒ¹é…è§„åˆ™      app: nginx-pod    matchExpressions:      - &#123;key: app, operator: In, values: [nginx-pod]&#125;  template: #æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬    metadata:      labels:        app: nginx-pod    spec:      containers:      - name: nginx        image: nginx:1.17.1        ports:        - containerPort: 80\n\nDeployment(deploy)é€šè¿‡ç®¡ç†ReplicaSetæ¥é—´æ¥ç®¡ç†podï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œä¸»è¦åŠŸèƒ½ï¼š\n\næ”¯æŒReplicaSetæ‰€æœ‰åŠŸèƒ½\næ”¯æŒå‘å¸ƒçš„åœæ­¢&#x2F;ç»§ç»­\næ”¯æŒç‰ˆæœ¬æ»šåŠ¨æ›´æ–°å’Œç‰ˆæœ¬å›é€€\n\napiVersion: apps/v1  #ç‰ˆæœ¬å·kind: Deployment  #ç±»å‹metadata:  name:  namespace:  labels:    controller: deployspec:  replicas: 3 #å‰¯æœ¬æ•°é‡  revisionHistoryLimit: 3  #ä¿ç•™å†å²ç‰ˆæœ¬,é»˜è®¤æ˜¯10  paused: false  #æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false  progressDeadlineSecond: 600  #éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤600  strategy:  #ç­–ç•¥ Recreate é‡å»ºæ›´æ–°  RollingUpdate æ»šåŠ¨æ›´æ–°    type: RollingUpdate   #æ»šåŠ¨æ›´æ–°ç­–ç•¥    RollingUpdate:  #æ»šåŠ¨æ›´æ–°      maxSurge: 30%  #æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”æˆ–æ•´æ•°      maxUnavailable: 30%  #æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„podæœ€å¤§å€¼,å¯ä»¥ä¸ºç™¾åˆ†æ¯”æˆ–æ•´æ•°  selector:   #é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod    matchLabels:   #labelsåŒ¹é…è§„åˆ™      app: nginx-pod    matchExpressions:      - &#123;key: app, operator: In, values: [nginx-pod]&#125;  template: #æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬    metadata:      labels:        app: nginx-pod    spec:      containers:      - name: nginx        image: nginx:1.17.1        ports:        - containerPort: 80\n\nkubectl rollout:ç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼š\n\nstatusï¼šæ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€\nhistoryï¼šæ˜¾ç¤ºå‡çº§å†å²è®°å½•\npauseï¼šæš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹\nresumeï¼šç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹\nrestartï¼šé‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹\nundoï¼šå›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨â€“to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰\n\né‡‘ä¸é›€å‘å¸ƒdeployæ”¯æŒæ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚æš‚åœå’Œç»§ç»­æ›´æ–°æ“ä½œæ¯”å¦‚æœ‰ä¸€æ‰¹æ–°çš„podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§ç‰ˆæœ¬ã€‚ç„¶åç­›é€‰ä¸€å°éƒ¨åˆ†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°çš„podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šè¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ååœ¨ç»§ç»­å®Œæˆä½™ä¸‹çš„podæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚è¿™å°±æ˜¯é‡‘ä¸é›€å‘å¸ƒ\nkubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deploy pc-deployment -n dev\n\nHorizontal Pod AutoscalerHPAå¯ä»¥è·å–æ¯ä¸ªpodçš„åˆ©ç”¨ç‡ï¼Œç„¶åå’Œå®šä¹‰çš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ï¼Œæœ€åå®ç°podçš„æ•°é‡è°ƒæ•´\nmetrics-serverå¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­èµ„æºä½¿ç”¨æƒ…å†µ\néƒ¨ç½²HPA\napiVersion: autoscaling/v1kind: HorizontalPodAutoscalermetadata:  name: pc-hpa  namespace: devspec:  minReplicas: 1  #æœ€å°podæ•°é‡  maxReplicas: 10 #æœ€å¤§podæ•°é‡  targetCPUUtilizationPercentage: 3   #cpuä½¿ç”¨ç‡æŒ‡æ ‡  scaleTargetRef:   #æŒ‡å®šè¦æ§åˆ¶çš„nginxä¿¡æ¯    apiVersion: apps/v1    kind: Deployment    name: nginx\n\njobjobä¸»è¦è´Ÿè´£æ‰¹é‡å¤„ç†çŸ­æš‚çš„ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œjobç‰¹ç‚¹ï¼š\n\nå½“jobåˆ›å»ºçš„podæ‰§è¡ŒæˆåŠŸæ—¶ï¼Œjobå°†è®°å½•æˆåŠŸç»“æŸçš„podæ•°é‡\nå½“æˆåŠŸç»“æŸçš„podåˆ°è¾¾æŒ‡å®šçš„æ•°é‡ï¼Œjobå°†å®Œæˆæ‰§è¡Œ\n\napiVersion: batch/v1kind: Jobmetadata:  name:  namespace:  labels:    controller: jobspec:  completions: 1 #æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡Œpodsçš„æ¬¡æ•°ï¼Œé»˜è®¤1  parallelism: 1 #æŒ‡å®šjobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡Œçš„podsæ•°é‡ï¼Œé»˜è®¤1  activeDeadlineSecond: 30 #æŒ‡å®šjobå¯è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æœªç»“æŸï¼Œç³»ç»Ÿä¼šå°è¯•ç»ˆæ­¢  backoffLimit: 6  #æŒ‡å®šjobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤6  manualSelector: true  # æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©pod,é»˜è®¤false  selector:      matchLabels:      app: counter-pod    matchExpressions:      - &#123;key: app, operator: In, values: [counter-pod]&#125;  template:    metadata:      labels:        app: counter-pod    spec:      restartPolicy: Never #é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–OnFailure      containers:      - name: counter        image: busybox:1.30\n\nCronJob(cj)CronJobä»¥jobæ§åˆ¶å™¨ä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†podèµ„æºå¯¹è±¡ï¼ŒCronJobå¯ä»¥åœ¨ç‰¹ç‚¹æ—¶é—´ç‚¹åå¤è¿è¡Œjobä»»åŠ¡\napiVersion: batch/v1beta1kind: CronJobmetadata:  name:  namespace:  labels:    controller: cronjobspec:  schedule:      #cromæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹  concurrencyPolicy:  #å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼Œç”¨äºå®šä¹‰å‰ä¸€æ¬¡ä½œä¸šè¿è¡Œå°šæœªå®Œæˆæ—¶æ˜¯å¦ä»¥åŠå¦‚ä½•è¿è¡Œåä¸€æ¬¡ä½œä¸š  Allow å…è®¸jobså¹¶å‘è¿è¡Œï¼ˆé»˜è®¤ï¼‰ Forbid ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œä¸Šä¸€æ¬¡å°šæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€æ¬¡è¿è¡Œ   Replace æ›¿æ¢ï¼Œå–æ¶ˆå½“å‰ä½œä¸šå¹¶ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ  failedJobHistoryLimit:  #ä¸ºå¤±è´¥çš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤1  successfulJobHistoryLimit:  #ä¸ºæˆåŠŸçš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤3  startingDeadlineSecond: #å¯åŠ¨ä½œä¸šé”™è¯¯çš„è¶…æ—¶æ—¶é•¿  jobTemplate:  #jobæ§åˆ¶å™¨    metadata:    spec:      completions: 1 #æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡Œpodsçš„æ¬¡æ•°ï¼Œé»˜è®¤1      parallelism: 1 #æŒ‡å®šjobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡Œçš„podsæ•°é‡ï¼Œé»˜è®¤1      activeDeadlineSecond: 30 #æŒ‡å®šjobå¯è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æœªç»“æŸï¼Œç³»ç»Ÿä¼šå°è¯•ç»ˆæ­¢      backoffLimit: 6  #æŒ‡å®šjobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤6      manualSelector: true  # æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©pod,é»˜è®¤false      selector:          matchLabels:          app: counter-pod        matchExpressions:          - &#123;key: app, operator: In, values: [counter-pod]&#125;      template:        metadata:          labels:            app: counter-pod        spec:          restartPolicy: Never #é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–OnFailure          containers:          - name: counter            image: busybox:1.30\n\nServiceserviceå¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒçœŸæ­£èµ·ä½œç”¨çš„æ˜¯kube-proxy,kube-proxyä¼šå°†æœ€æ–°çš„serviceä¿¡æ¯è½¬æ¢æˆå¯¹åº”çš„è®¿é—®è§„åˆ™\napiVersion: v1kind: Servicemetadata:  name:  namespace:spec:  selector:   #ç¡®å®šå½“å‰serviceä»£ç†å“ªäº›pod    app: nginx  type:  #serviceç±»å‹  clusterIP:  #è™šæ‹ŸæœåŠ¡çš„ipåœ°å€  sessionAffinity:  #sessionäº²å’Œæ€§ï¼Œæ”¯æŒclusterIP/None2ä¸ªé€‰é¡¹  ports:    - protocol: TCP      port: 3017        #serviceç«¯å£      targetPort: 5003  #podç«¯å£      nodePort: 31122   #ä¸»æœºç«¯å£\n\nserviceç±»å‹\n\nclusterIPï¼šé»˜è®¤å€¼ï¼Œk8sç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®\nHeadLiness:è¿™ç±»serviceä¸ä¼šåˆ†é…ClusterIPï¼Œå¦‚æœæƒ³è¦è®¿é—®service,åªèƒ½é€šè¿‡serviceçš„åŸŸåè¿›è¡ŒæŸ¥è¯¢\nNodePort: å°†serviceé€šè¿‡æŒ‡å®šnodeä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨\nLoadBalancer: ä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨(é›†ç¾¤å¤–)å®ŒæˆæœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒæ”¯æŒ\nExternalName: æŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨\n\napiVersion: v1kind: Servicemetadata:  name: service-clusterip  namespace: devspec:  selector:    app: nginx-pod  clusterIP: 10.97.97.97   #serviceçš„ipåœ°å€ï¼Œè®¾ä¸ºNoneå¯ä»¥å¯åŠ¨HeadLinessService  type: ClusterIP  ports:  - port: 80    targetPort: 80\n\næŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™ipvsadm -Ln\nNodePortç±»å‹çš„ServiceNodePortå·¥ä½œåŸç†å°±æ˜¯å°†serviceçš„ç«¯å£æ˜ å°„åˆ°Nodeçš„ä¸€ä¸ªç«¯å£ä¸Šï¼Œé€šè¿‡NodeIp:NodePortæ¥è®¿é—®service\næ•°æ®å­˜å‚¨Volumeæ˜¯podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªpodçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“æ–‡ä»¶ç›®å½•ä¸‹ï¼ŒVolumeæ”¯æŒå¤šç§ç±»å‹ï¼š\n\nç®€å•å­˜å‚¨ï¼šEmptyDir&#x2F;HostPath&#x2F;NFS\né«˜çº§å­˜å‚¨ï¼šPV&#x2F;PVC\né…ç½®å­˜å‚¨ï¼šConfigMap&#x2F;Secret\n\nç®€å•å­˜å‚¨EmptyDirEmptyDirå°±æ˜¯å®¿ä¸»æœºä¸Šçš„ç©ºç›®å½•ï¼Œå½“podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºï¼Œå½“podé”€æ¯ï¼ŒEmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ï¼Œå®ƒçš„ç”¨é€”ï¼š\n\nä¸´æ—¶ç©ºé—´ï¼ŒæŸåº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„ä¸´æ—¶ç›®å½•\nä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨è·å–æ•°æ®ï¼ˆåŒä¸€ä¸ªpodå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰\n\nHostPathHostPathå°†nodeä¸»æœºä¸­å®é™…çš„ç›®å½•æŒ‚åœ¨Podä¸­ï¼Œè¿™æ ·podé”€æ¯äº†ï¼Œæ•°æ®ä¾æ®å¯ä»¥å­˜åœ¨ä¸»æœºä¸Š\nNFSHostPathå¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†ä¸€æ—¦nodeèŠ‚ç‚¹æ•…éšœäº†ï¼Œpodå¦‚æœè½¬ç§»åˆ°åˆ«çš„èŠ‚ç‚¹ï¼Œåˆä¼šå‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„NFS&#x2F;CIFS\né«˜çº§å­˜å‚¨å­˜å‚¨ç³»ç»Ÿæœ‰å¾ˆå¤šï¼Œè¦æ±‚ç”¨æˆ·å…¨éƒ¨æŒæ¡ä¸ç°å®ï¼Œä¸ºäº†å±è”½åº•å±‚å®ç°ï¼Œk8så¼•å…¥PVå’ŒPVC2ç§èµ„æºå¯¹è±¡\nPVï¼ˆPersistent Volumeï¼‰æ˜¯å¯¹åº•å±‚å…±äº«çš„æŠ½è±¡\nPVCï¼ˆPersistent Volume Claimï¼‰æŒä¹…åŒ–å·å£°æ˜ï¼Œç”¨æˆ·å¯¹å­˜å‚¨éœ€æ±‚çš„å£°æ˜ï¼Œå³ç”¨æˆ·å‘ç³»ç»Ÿå‘èµ·èµ„æºéœ€æ±‚ç”³è¯·\nPVPVæ˜¯å­˜å‚¨èµ„æºçš„æŠ½è±¡\napiVersion: v1kind: PersistentVolumemetadata:  name: pv2spec:  nfs:   #å­˜å‚¨ç±»å‹ï¼Œä¸åº•å±‚å­˜å‚¨å¯¹åº”  capacity:  \tstorage: 2Gi  accessModes:\t  #è®¿é—®æ¨¡å¼  storageClassName:   #å­˜å‚¨ç±»å‹  PersistentVolumeReclaimPolicy:  #å›æ”¶ç­–ç•¥\n\nPVCPVCæ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´&#x2F;è®¿é—®æ–¹å¼&#x2F;å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯\napiVersion: v1kind: PersistentVolumeClaimmetadata:  name: pvc  namespace: devspec:  accessModes:\t  #è®¿é—®æ¨¡å¼  storageClassName:   #å­˜å‚¨ç±»å‹  selector:    #é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹©  resources:   #è¯·æ±‚ç©ºé—´  \trequests:  \t  storage: 5Gi\n\nConfigMapConfigMapä¸»è¦ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯\napiVersion: v1kind: ConfigMapmetadata:  name: configmap  namespace: devdata:  info:  \tusername: admin  \tpassword: 123456\n\nSecretSecretä¸»è¦ç”¨æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå¯†ç &#x2F;å¯†åŒ™&#x2F;è¯ä¹¦\n","categories":["å®¹å™¨"],"tags":["å­¦ä¹ ","kubernetes"]},{"title":"Reactor 3 Guide","url":"/java4u/2022/08/12/Reactor%203%20Guide/","content":"å‚è€ƒåœ°å€ï¼šprojectreactor\n1.ååº”å¼ç¼–ç¨‹ç®€ä»‹Reactive programming is an asynchronous programming paradigm concerned with data streams and the propagation of change. This means that it becomes possible to express static (e.g. arrays) or dynamic (e.g. event emitters) data streams with ease via the employed programming language(s).\nä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥å“åº”åº“ï¼Ÿ\né˜»å¡å¯èƒ½æ˜¯æµªè´¹é˜»å¡ä¼šæµªè´¹èµ„æºï¼Œä¸€æ—¦ç¨‹åºæ¶‰åŠå»¶è¿Ÿï¼Œå°±ä¼šæµªè´¹èµ„æºï¼Œå› ä¸ºçº¿ç¨‹ï¼ˆå¯èƒ½å¤šçº¿ç¨‹ï¼‰ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œç­‰å¾…æ•°æ®\næ•‘æ´çš„å¼‚æ­¥æ€§ï¼ŸJavaæä¾›2ç§å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼š\n\nå›è°ƒï¼šéœ€è¦ä¸€ä¸ªcallbackå‚æ•°ï¼Œå½“ç»“æœå¯ç”¨æ—¶è°ƒç”¨è¯¥å‚æ•°\nFuturesï¼šå¼‚æ­¥æ–¹æ³•ç«‹å³è¿”å›futureï¼Œè¯¥å€¼ä¸æ˜¯ç«‹å³å¯ç”¨ï¼Œå¯ä»¥è½®è¯¢å¯¹è±¡ï¼Œç›´åˆ°è¯¥å€¼å¯ç”¨\n\nä¸¤è€…éƒ½æœ‰å±€é™æ€§ï¼Œå›è°ƒå¾ˆéš¾ç»„åˆï¼Œå¾ˆå¿«å¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ï¼ˆå›è°ƒåœ°ç‹±ï¼‰ï¼›Futureé€šè¿‡è°ƒç”¨get()æ–¹æ³•å®¹æ˜“å¯¼è‡´å¯¹è±¡çš„å¦ä¸€ç§é˜»å¡ï¼Œä¸æ”¯æŒæƒ°æ€§è®¡ç®—ï¼Œç¼ºä¹å¯¹å¤šä¸ªå€¼å’Œé«˜çº§é”™è¯¯å¤„ç†çš„æ”¯æŒ\n2.ååº”å †æ ¸å¿ƒç‰¹ç‚¹Fluxï¼Œä¸€ä¸ª0-Né¡¹çš„å¼‚æ­¥åºåˆ—Monoï¼Œå¼‚æ­¥0-1ç»“æœ","categories":["æ–‡æ¡£æ€»ç»“"],"tags":["Reactor","å‚è€ƒèµ„æ–™"]},{"title":"springæŠ€æœ¯æ ˆ","url":"/java4u/2022/08/10/spring%E6%8A%80%E6%9C%AF%E6%A0%88/","content":"springæŠ€æœ¯æ ˆæè¿°\n1.Reactor Core&#x2F;Reactor Project  ååº”å¼ç¼–ç¨‹ï¼Œå¼€å‘webfluxé¡¹ç›®\n\n2.Spring Batch  æ‰¹å¤„ç†æ¶æ„ï¼Œæ‰§è¡Œjobçš„è°ƒåº¦ä»»åŠ¡å’Œä¸jobäº¤äº’ï¼Œä¸€ä¸ªjobå¯ä»¥åˆ†ä¸ºå¤šä¸ªstepè¿›è¡Œå¤„ç†æ•°æ®  \n\n3.Spring Data JPA  æŒä¹…åŒ–æ¡†æ¶\n\n4.Spring Security  å®‰å…¨æ¡†æ¶ï¼Œä¸º Java åº”ç”¨ç¨‹åºæä¾›èº«ä»½éªŒè¯å’Œæˆæƒçš„æ¡†æ¶\n\n5.Spring Boot  ç”¨æœ€å°çš„é…ç½®è½»æ¾åˆ›å»ºspringç¨‹åº\n\n6.Spring Cloud Task  å…è®¸ç”¨æˆ·å°†å‡ ä¹ä»»ä½• Spring Boot åº”ç”¨ç¨‹åºä½œä¸ºçŸ­æœŸä»»åŠ¡æ‰§è¡Œ  Spring Cloud Taskå¯ä»¥åœ¨å¹³å°ç¯å¢ƒä¸­æ‰§è¡ŒçŸ­ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨ï¼Œå¹¶è®°å½•è¿™äº›åº”ç”¨çš„ç»“æœï¼Œ  ç»ç”±é€šè¿‡æ¶ˆæ¯é€šçŸ¥çš„æœºåˆ¶æ¥é›†æˆå„ä¸ªtasksã€‚é€šè¿‡è¿™ç‰¹æ€§å°±å¯ä»¥å®ç°è®©çŸ­ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨åƒé•¿ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨ä¸€æ ·ç»„æˆå¾®æœåŠ¡æ¶æ„ã€‚\n\n7.Spring AMQP  å°†æ ¸å¿ƒ Spring æ¦‚å¿µåº”ç”¨äºåŸºäº AMQP çš„æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆçš„å¼€å‘\n\n8.Spring Cloud Stream  ä¸ºäº†è§£å†³ç³»ç»Ÿä¸­ä¸åŒä¸­é—´ä»¶çš„é€‚é…é—®é¢˜ï¼Œå‡ºç°äº†cloud streamï¼Œé‡‡ç”¨é€‚é…ç»‘å®šçš„æ–¹å¼ï¼Œè‡ªåŠ¨ç»™ä¸åŒçš„MQä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚  ç›®å‰ä»…ä»…æ”¯æŒRabbitMQå’ŒKafka\n\n9.Spring Data REST  Spring Data RESTæŠŠæˆ‘ä»¬éœ€è¦ç¼–å†™çš„å¤§é‡RESTæ¨¡ç‰ˆæ¥å£åšäº†è‡ªåŠ¨åŒ–å®ç°  åªéœ€ç¼–å†™å®ä½“ç±»å’Œdaoå±‚æ¥å£å°±ä¼šè‡ªåŠ¨éšè—å¼ç”Ÿæˆç›¸å…³çš„restfulå¢åˆ æ”¹æŸ¥å’Œåˆ†é¡µæŸ¥è¯¢ç­‰ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ¥å£\n\n10.Spring Cloud Data Flow  åŸºäºå¾®æœåŠ¡çš„ï¼Œä¸“é—¨ç”¨äºæµå¼å’Œæ‰¹å¼æ•°æ®å¤„ç†çš„æ¡†æ¶ï¼ˆç›¸å½“äºSpring Batch å’Œ Spring Cloud Taskçš„æ§åˆ¶å°ï¼‰\n\n11.Spring HATEOAS  åˆ›å»ºéµå¾ª HATEOAS åŸåˆ™çš„ REST è¡¨ç¤ºï¼Œåœ¨èµ„æºçš„è¡¨è¾¾ä¸­åŒ…å«äº†é“¾æ¥ä¿¡æ¯ã€‚å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®é“¾æ¥æ¥å‘ç°å¯ä»¥æ‰§è¡Œçš„åŠ¨ä½œ\n\n12 Spring LDAP  ç®€åŒ– Java ä¸­çš„ LDAP ç¼–ç¨‹çš„åº“\n\n13 Spring XD  Spring XD æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ï¼Œåˆ†å¸ƒå¼ï¼Œå¯æ‰©å±•çš„ç³»ç»Ÿç”¨äºæ•°æ®æ‘„å–ï¼Œå®æ—¶åˆ†æï¼Œæ‰¹é‡å¤„ç†å’Œæ•°æ®å¯¼å‡ºã€‚è¯¥é¡¹ç›®çš„ç›®æ ‡æ˜¯ç®€åŒ–å¤§æ•°æ®åº”ç”¨çš„å¼€å‘\n\n14 Spring Cloud Consul  Consulæ˜¯ HashiCorp å…¬å¸æ¨å‡ºçš„å¼€æºå·¥å…·ï¼Œç”¨äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœåŠ¡å‘ç°ä¸é…ç½®\n\n15 Spring Session  è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿsessionå…±äº«é—®é¢˜\n\n16 Spring Statemachine  ä¾›åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜åœ¨ Spring åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çŠ¶æ€æœºæ¦‚å¿µ\n\n\n","categories":["æ–‡æ¡£æ€»ç»“"],"tags":["å‚è€ƒèµ„æ–™","spring"]},{"title":"80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II","url":"/java4u/2022/08/01/80.%20%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9%20II/","content":"80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ IIç»™ä½ ä¸€ä¸ªæœ‰åºæ•°ç»„ nums ï¼Œè¯·ä½  åŸåœ° åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸¤æ¬¡çš„å…ƒç´ åªå‡ºç°ä¸¤æ¬¡ ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ åŸåœ° ä¿®æ”¹è¾“å…¥æ•°ç»„ å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚\nè¯´æ˜ï¼š\nä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢ï¼Ÿè¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥ã€Œå¼•ç”¨ã€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:&#x2F;&#x2F; nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´int len &#x3D; removeDuplicates(nums);&#x2F;&#x2F; åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚&#x2F;&#x2F; æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­ è¯¥é•¿åº¦èŒƒå›´å†… çš„æ‰€æœ‰å…ƒç´ ã€‚for (int i &#x3D; 0; i &lt; len; i++) {    print(nums[i]);}\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1,1,1,2,2,3]è¾“å‡ºï¼š5, nums &#x3D; [1,1,2,2,3]è§£é‡Šï¼šå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length &#x3D; 5, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 1, 2, 2, 3 ã€‚ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0,0,1,1,1,1,2,3,3]è¾“å‡ºï¼š7, nums &#x3D; [0,0,1,1,2,3,3]è§£é‡Šï¼šå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length &#x3D; 7, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 0, 1, 1, 2, 3, 3 ã€‚ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 3 * 10^4-10^4 &lt;&#x3D; nums[i] &lt;&#x3D; 10^4nums å·²æŒ‰å‡åºæ’åˆ—\nåˆ·leetcodeæ­£å¥½åˆ°200é“äº†ï¼Œçºªå¿µä¸‹\n/** * å› ä¸ºç»™å®šæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ç›¸åŒå…ƒç´ å¿…ç„¶è¿ç»­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆè§£å†³æœ¬é¢˜ï¼Œéå†æ•°ç»„æ£€æŸ¥æ¯ä¸€ä¸ªå…ƒç´ æ˜¯å¦åº”è¯¥è¢«ä¿ç•™ï¼Œ * å¦‚æœåº”è¯¥è¢«ä¿ç•™ï¼Œå°±å°†å…¶ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚å…·ä½“åœ°ï¼Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ slow å’Œ fast åˆ†åˆ«ä¸ºæ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆï¼Œå…¶ä¸­æ…¢æŒ‡é’ˆè¡¨ç¤ºå¤„ç†å‡ºçš„æ•°ç»„çš„é•¿åº¦ï¼Œ * å¿«æŒ‡é’ˆè¡¨ç¤ºå·²ç»æ£€æŸ¥è¿‡çš„æ•°ç»„çš„é•¿åº¦ï¼Œå³ nums[fast] è¡¨ç¤ºå¾…æ£€æŸ¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œnums[slowâˆ’1] ä¸ºä¸Šä¸€ä¸ªåº”è¯¥è¢«ä¿ç•™çš„å…ƒç´ æ‰€ç§»åŠ¨åˆ°çš„æŒ‡å®šä½ç½®ã€‚ * å› ä¸ºæœ¬é¢˜è¦æ±‚ç›¸åŒå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡è€Œéä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ£€æŸ¥ä¸Šä¸Šä¸ªåº”è¯¥è¢«ä¿ç•™çš„å…ƒç´  nums[slowâˆ’2] æ˜¯å¦å’Œå½“å‰å¾…æ£€æŸ¥å…ƒç´  nums[fast] ç›¸åŒã€‚ * å½“ä¸”ä»…å½“ nums[slowâˆ’2]=nums[fast] æ—¶ï¼Œå½“å‰å¾…æ£€æŸ¥å…ƒç´  nums[fast] ä¸åº”è¯¥è¢«ä¿ç•™ï¼ˆå› ä¸ºæ­¤æ—¶å¿…ç„¶æœ‰ nums[slowâˆ’2]=nums[slowâˆ’1]=nums[fast]ï¼‰ã€‚ * æœ€åï¼Œslow å³ä¸ºå¤„ç†å¥½çš„æ•°ç»„çš„é•¿åº¦ã€‚ * * ç‰¹åˆ«åœ°ï¼Œæ•°ç»„çš„å‰ä¸¤ä¸ªæ•°å¿…ç„¶å¯ä»¥è¢«ä¿ç•™ï¼Œå› æ­¤å¯¹äºé•¿åº¦ä¸è¶…è¿‡ 2 çš„æ•°ç»„ï¼Œæˆ‘ä»¬æ— éœ€è¿›è¡Œä»»ä½•å¤„ç†ï¼Œå¯¹äºé•¿åº¦è¶…è¿‡ 2 çš„æ•°ç»„ï¼Œæˆ‘ä»¬ç›´æ¥å°†åŒæŒ‡é’ˆçš„åˆå§‹å€¼è®¾ä¸º 2 å³å¯ã€‚ * * @param nums * @return */public int removeDuplicates(int[] nums) &#123;    int n = nums.length;    if (n &lt;= 2) &#123;        return n;    &#125;    //æ…¢æŒ‡é’ˆè¡¨ç¤ºå¤„ç†å®Œçš„ä½ç½®ï¼Œå®ƒå‡ºç°çš„å…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡    //å¿«æŒ‡é’ˆè¡¨ç¤ºè¢«æ£€æŸ¥çš„å…ƒç´     int slow = 2, fast = 2;    while (fast &lt; n) &#123;        if (nums[slow - 2] != nums[fast]) &#123;            nums[slow] = nums[fast];            ++slow;        &#125;        ++fast;    &#125;    return slow;&#125;//ä¿ç•™å‡ ä¸ªç›¸åŒæ•°å­—çš„é€šç”¨è§£æ³•public int removeDuplicates2(int[] nums) &#123;    return process(nums, 2);&#125;private int process(int[] nums, int k)&#123;    int slow = k;    int fast = k;    while (fast &lt; nums.length)&#123;        if(nums[slow-k]!=nums[fast])&#123;            nums[slow]=nums[fast];            slow++;        &#125;        fast++;    &#125;    return slow;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"592. åˆ†æ•°åŠ å‡è¿ç®—","url":"/java4u/2022/07/27/592.%20%E5%88%86%E6%95%B0%E5%8A%A0%E5%87%8F%E8%BF%90%E7%AE%97/","content":"592. åˆ†æ•°åŠ å‡è¿ç®—ç»™å®šä¸€ä¸ªè¡¨ç¤ºåˆ†æ•°åŠ å‡è¿ç®—çš„å­—ç¬¦ä¸² expression ï¼Œä½ éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„è®¡ç®—ç»“æœã€‚è¿™ä¸ªç»“æœåº”è¯¥æ˜¯ä¸å¯çº¦åˆ†çš„åˆ†æ•°ï¼Œå³æœ€ç®€åˆ†æ•°ã€‚ å¦‚æœæœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¾‹å¦‚ 2ï¼Œä½ éœ€è¦å°†å®ƒè½¬æ¢æˆåˆ†æ•°å½¢å¼ï¼Œå…¶åˆ†æ¯ä¸º 1ã€‚æ‰€ä»¥åœ¨ä¸Šè¿°ä¾‹å­ä¸­, 2 åº”è¯¥è¢«è½¬æ¢ä¸º 2&#x2F;1ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: expression &#x3D; â€œ-1&#x2F;2+1&#x2F;2â€è¾“å‡º: â€œ0&#x2F;1â€\nç¤ºä¾‹ 2:\nè¾“å…¥: expression &#x3D; â€œ-1&#x2F;2+1&#x2F;2+1&#x2F;3â€è¾“å‡º: â€œ1&#x2F;3â€\nç¤ºä¾‹ 3:\nè¾“å…¥: expression &#x3D; â€œ1&#x2F;3-1&#x2F;2â€è¾“å‡º: â€œ-1&#x2F;6â€\næç¤º:\nè¾“å…¥å’Œè¾“å‡ºå­—ç¬¦ä¸²åªåŒ…å« â€˜0â€™ åˆ° â€˜9â€™ çš„æ•°å­—ï¼Œä»¥åŠ â€˜&#x2F;â€˜, â€˜+â€™ å’Œ â€˜-â€˜ã€‚è¾“å…¥å’Œè¾“å‡ºåˆ†æ•°æ ¼å¼å‡ä¸º Â±åˆ†å­&#x2F;åˆ†æ¯ã€‚å¦‚æœè¾“å…¥çš„ç¬¬ä¸€ä¸ªåˆ†æ•°æˆ–è€…è¾“å‡ºçš„åˆ†æ•°æ˜¯æ­£æ•°ï¼Œåˆ™ â€˜+â€™ ä¼šè¢«çœç•¥æ‰ã€‚è¾“å…¥åªåŒ…å«åˆæ³•çš„æœ€ç®€åˆ†æ•°ï¼Œæ¯ä¸ªåˆ†æ•°çš„åˆ†å­ä¸åˆ†æ¯çš„èŒƒå›´æ˜¯  [1,10]ã€‚ å¦‚æœåˆ†æ¯æ˜¯1ï¼Œæ„å‘³ç€è¿™ä¸ªåˆ†æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•´æ•°ã€‚è¾“å…¥çš„åˆ†æ•°ä¸ªæ•°èŒƒå›´æ˜¯ [1,10]ã€‚æœ€ç»ˆç»“æœçš„åˆ†å­ä¸åˆ†æ¯ä¿è¯æ˜¯ 32 ä½æ•´æ•°èŒƒå›´å†…çš„æœ‰æ•ˆæ•´æ•°ã€‚  \nå¾ˆä¹…æ²¡æœ‰è®°å½•åšçš„é¢˜äº†ï¼Œä»Šå¤©è®°å½•ä¸‹â€œåˆ†æ•°åŠ å‡è¿ç®—â€ã€‚çœ‹åˆ°é¢˜ç›®æƒ³åˆ°æ•°å­¦æ¨¡æ‹Ÿï¼Œç›´æ¥æ¨¡æ‹Ÿè¿ç®—æ­¥éª¤ã€‚å…ˆå°†è¡¨è¾¾å¼è¿›è¡Œè§£æï¼Œå°†æ‰€æœ‰æ­£æ•°æ”¾å…¥æ­£æ•°é›†åˆï¼Œè´Ÿæ•°æ”¾å…¥è´Ÿæ•°é›†åˆï¼ˆå»æ‰â€œ-â€ï¼‰ï¼Œä¹‹ååˆ†åˆ«å¯¹2ä¸ªé›†åˆè¿›è¡Œæ±‚å’Œå¯ä»¥ä¸ç”¨è€ƒè™‘â€œ-â€çš„æƒ…å†µã€‚æœ€åç”¨æ­£æ•°å’Œå‡å»è´Ÿæ•°å’Œå³å¯å¾—åˆ°ç»“æœã€‚ç›¸åŠ å’Œç›¸å‡çš„æµç¨‹å¤§è‡´ç›¸åŒï¼Œå…¶å®å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ã€‚ä»¥æ±‚å’Œä¸¾ä¾‹ï¼š\n\nè·å–2æ•°åˆ†æ¯çš„æœ€å°å…¬å€æ•°cm\næ±‚å’Œçš„åˆ†å­ä¸ºï¼ˆcm&#x2F;åˆ†æ¯ * åˆ†å­ï¼‰ä¹‹å’Œ\nå¯¹å¾—åˆ°çš„åˆ†æ•°è¿›è¡Œçº¦åˆ†ï¼Œå³åˆ†å­ã€åˆ†æ¯éƒ½é™¤ä»¥æœ€å¤§å…¬çº¦æ•°\n\nå¾—åˆ°çš„ä»£ç ä¸ç®—ä¼˜é›…ï¼Œä¸è¿‡è€—æ—¶å’Œå†…å­˜æ¶ˆè€—éƒ½ç›¸å½“ä¸é”™\npublic String fractionAddition(String expression) &#123;    //å¦‚ä½•åˆ†å‰²å­—ç¬¦ä¸²    String[] split = expression.split(&quot;\\\\+&quot;);    //è´Ÿæ•°    List&lt;String&gt; negative = new ArrayList&lt;&gt;();    //æ­£æ•°    List&lt;String&gt; positive = new ArrayList&lt;&gt;();    for (String s : split) &#123;        if (s.contains(&quot;-&quot;)) &#123;            if (s.startsWith(&quot;-&quot;)) &#123;                if (s.substring(1).contains(&quot;-&quot;)) &#123;                    //-a-b-c                    String[] ss = s.split(&quot;-&quot;);                    negative.addAll(Arrays.asList(ss));                &#125; else &#123;                    //-a                    negative.add(s.substring(1));                &#125;            &#125; else &#123;                // a-b-c                String[] ss = s.split(&quot;-&quot;);                positive.add(ss[0]);                negative.addAll(Arrays.asList(ss).subList(1, ss.length));            &#125;        &#125; else &#123;            positive.add(s);        &#125;    &#125;    String p = &quot;&quot;;    for (String s : positive) &#123;        p = add(p, s);    &#125;    String n = &quot;&quot;;    for (String s : negative) &#123;        n = add(n, s);    &#125;    return subtract(p, n);&#125;private String subtract(String a, String b) &#123;    if (a.equals(&quot;&quot;)) return &quot;-&quot; + b;    if (b.equals(&quot;&quot;)) return a;    StringBuilder stringBuilder = new StringBuilder(&quot;&quot;);    String[] sa = a.split(&quot;/&quot;);    int ma = Integer.parseInt(sa[0]);    int da = Integer.parseInt(sa[1]);    String[] sb = b.split(&quot;/&quot;);    int mb = Integer.parseInt(sb[0]);    int db = Integer.parseInt(sb[1]);    int cm = getCM(da, db);    ma = (cm / da) * ma;    mb = (cm / db) * mb;    int m = ma - mb;    if (m == 0) return &quot;0/1&quot;;    boolean nf = false;    if (m &lt; 0) &#123;        nf = true;        m = -m;    &#125;    int d = cm;    int gcd = gcd(m,d);    stringBuilder.append(nf ? &quot;-&quot; : &quot;&quot;)            .append(m / gcd)            .append(&quot;/&quot;)            .append(d / gcd);    return stringBuilder.toString();&#125;private String add(String a, String b) &#123;    if (a.equals(&quot;&quot;)) return b;    if (b.equals(&quot;&quot;)) return a;    StringBuilder stringBuilder = new StringBuilder(&quot;&quot;);    String[] sa = a.split(&quot;/&quot;);    int ma = Integer.parseInt(sa[0]);    int da = Integer.parseInt(sa[1]);    String[] sb = b.split(&quot;/&quot;);    int mb = Integer.parseInt(sb[0]);    int db = Integer.parseInt(sb[1]);    int cm = getCM(da, db);    ma = (cm / da) * ma;    mb = (cm / db) * mb;    int m = ma + mb;    int d = cm;    int gcd = gcd(m,d);    stringBuilder.append(m / gcd)            .append(&quot;/&quot;)            .append(d / gcd);    return stringBuilder.toString();&#125;//æœ€å¤§å…¬å› æ•°gcd(a,b)private int gcd(int a, int b) &#123;    if (a == 0) return b;    return gcd(b % a, a);&#125;//æœ€å°å…¬å€æ•°=a*b/gcd(a,b)private int getCM(int a, int b)&#123;    return a*b/gcd(a,b);&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°å­¦"]},{"title":"Elasticsearch","url":"/java4u/2022/06/26/Elasticsearch/","content":"Elasticsearchç®€ä»‹Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTful æ¥å£\nElasticsearchåŠŸèƒ½\nåˆ†å¸ƒå¼çš„æœç´¢å¼•æ“å’Œæ•°æ®åˆ†æå¼•æ“æœç´¢ï¼šäº’è”ç½‘æœç´¢ã€ç”µå•†ç½‘ç«™ç«™å†…æœç´¢ã€OAç³»ç»ŸæŸ¥è¯¢æ•°æ®åˆ†æï¼šç”µå•†ç½‘ç«™æŸ¥è¯¢è¿‘ä¸€å‘¨å“ªäº›å“ç±»çš„å›¾ä¹¦é”€å”®å‰åï¼›æ–°é—»ç½‘ç«™ï¼Œæœ€è¿‘3å¤©é˜…è¯»é‡æœ€é«˜çš„åä¸ªå…³é”®è¯ï¼Œèˆ†æƒ…åˆ†æ\nå…¨æ–‡æ£€ç´¢ï¼Œç»“æ„åŒ–æ£€ç´¢ï¼Œæ•°æ®åˆ†æ\nå¯¹æµ·é‡æ•°æ®è¿›è¡Œè¿‘å®æ—¶çš„å¤„ç†\n\nä½¿ç”¨è„šæœ¬æ›´æ–°ï¼Œè·å–åŸå€¼çš„åŒæ—¶è¿›è¡Œæ›´æ–°\nPOST /test_index/_doc/6/_update&#123;  &quot;script&quot;: &quot;ctx._source.num+=1&quot;&#125;\n\nESå†…éƒ¨çš„ä¸»ä»å’Œå¹¶å‘æ§åˆ¶åŸºäºä¹è§‚é”versionæ¥æ§åˆ¶\nå€’æ’ç´¢å¼•ä»€ä¹ˆæ˜¯æ–‡æ¡£å’Œè¯æ¡ï¼Ÿ\n\næ¯ä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£\nå¯¹æ–‡æ¡£ä¸­çš„å†…å®¹åˆ†è¯ï¼Œå¾—åˆ°çš„è¯è¯­å°±æ˜¯è¯æ¡\n\nä»€ä¹ˆæ˜¯æ­£å‘ç´¢å¼•ï¼Ÿ\n\nåŸºäºæ–‡æ¡£idåˆ›å»ºç´¢å¼•ã€‚æŸ¥è¯¢è¯æ¡æ—¶å¿…é¡»å…ˆæ‰¾åˆ°æ–‡æ¡£ï¼Œè€Œååˆ¤æ–­æ˜¯å¦åŒ…å«è¯æ¡\n\nä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿ\n\nå¯¹æ–‡æ¡£å†…å®¹åˆ†è¯ï¼Œå¯¹è¯æ¡åˆ›å»ºç´¢å¼•ï¼Œå¹¶è®°å½•è¯æ¡æ‰€åœ¨æ–‡æ¡£çš„ä¿¡æ¯ã€‚æŸ¥è¯¢æ—¶å…ˆæ ¹æ®è¯æ¡æŸ¥è¯¢åˆ°æ–‡æ¡£id,è€Œåè·å–åˆ°æ–‡æ¡£\n\nesä¸mysqlæ¦‚å¿µå¯¹æ¯”\n\n\n\nmysql\nelasticsearch\nè¯´æ˜\n\n\n\ntable\nindex\nç´¢å¼•å°±æ˜¯æ–‡æ¡£é›†åˆï¼Œç±»ä¼¼æ•°æ®åº“çš„è¡¨\n\n\nrow\ndocument\næ–‡æ¡£å°±æ˜¯ä¸€æ¡æ¡æ•°æ®ï¼Œç±»ä¼¼æ•°æ®åº“çš„è¡Œï¼Œæ–‡æ¡£éƒ½æ˜¯JSONæ ¼å¼\n\n\ncolumn\nfield\nå­—æ®µï¼Œå°±æ˜¯æ–‡æ¡£ä¸­çš„å­—æ®µï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„åˆ—\n\n\nschema\nmapping\næ˜ å°„æ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œä¾‹å¦‚å­—æ®µç±»å‹çº¦æŸã€‚ç±»ä¼¼æ•°æ®åº“çš„è¡¨ç»“æ„\n\n\nSQL\nDSL\nDSLæ˜¯elasticsearchæä¾›çš„JSONé£æ ¼çš„è¯·æ±‚è¯­å¥ï¼Œå®ç°CRUD\n\n\nåˆ†è¯å™¨åˆ†è¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\n\nåˆ›å»ºå€’æ’ç´¢å¼•æ—¶å¯¹æ–‡æ¡£åˆ†è¯\nç”¨æˆ·æœç´¢æ—¶ï¼Œå¯¹è¾“å…¥çš„å†…å®¹åˆ†è¯\n\nIKåˆ†è¯å™¨æœ‰å‡ ç§æ¨¡å¼ï¼Ÿ\n\nik_smart:æ™ºèƒ½åˆ‡åˆ†ï¼Œç²—ç²’åº¦\nik_max_workï¼›æœ€ç»†åˆ‡åˆ†ï¼Œç»†ç²’åº¦\n\nIKåˆ†è¯å™¨å¦‚ä½•æ‰©å±•è¯æ¡ï¼Ÿå¦‚ä½•åœç”¨è¯æ¡\n\nåˆ©ç”¨configç›®å½•çš„IkAnalyzer.cfg.xmlæ–‡ä»¶æ·»åŠ æ‹“å±•è¯å…¸å’Œåœç”¨è¯å…¸\nåœ¨è¯å…¸ä¸­æ·»åŠ æ‹“å±•è¯æ¡æˆ–è€…åœç”¨è¯æ¡\n\nç´¢å¼•åº“æ“ä½œmappingå±æ€§mappingæ˜¯å¯¹ç´¢å¼•åº“ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œå¸¸è§çš„mappingå±æ€§åŒ…æ‹¬ï¼š\n\ntype:å­—æ®µæ•°æ®ç±»å‹ï¼Œå¸¸è§ç®€å•ç±»å‹ï¼š\nå­—ç¬¦ä¸²ï¼štext(å¯åˆ†è¯æ–‡æœ¬)ã€keyword(ç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œã€å›½å®¶ã€ipåœ°å€)\næ•°å€¼ï¼šlong&#x2F;integer&#x2F;short&#x2F;byte&#x2F;double&#x2F;float\nå¸ƒå°”ï¼šboolean\næ—¥æœŸï¼šdate\nå¯¹è±¡ï¼šobject\n\n\nindex:æ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue\nanalyzer:ä½¿ç”¨å“ªç§åˆ†è¯å™¨\nproperties:è¯¥å­—æ®µå­å­—æ®µ\nstore:æ˜¯å¦åœ¨sourceå¤–åœ¨å‚¨å­˜ä¸€ä»½\n\nç´¢å¼•åº“æ“ä½œï¼š\n\nåˆ›å»ºç´¢å¼•åº“ï¼šPUT&#x2F;ç´¢å¼•å\næŸ¥è¯¢ç´¢å¼•åº“ï¼šGET&#x2F;ç´¢å¼•å\nåˆ é™¤ç´¢å¼•åº“ï¼šDELETE&#x2F;ç´¢å¼•å\næ·»åŠ å­—æ®µï¼šPUT&#x2F;ç´¢å¼•å&#x2F;_mapping\n\nPUT book/_mapping&#123;  &quot;properties&quot;: &#123;    &quot;name&quot;: &#123;      &quot;type&quot;: &quot;text&quot;    &#125;,    &quot;description&quot;: &#123;      &quot;type&quot;: &quot;text&quot;,      &quot;analyzer&quot;: &quot;english&quot;,      &quot;search_analyzer&quot;: &quot;english&quot;    &#125;,    &quot;pic&quot;: &#123;      &quot;type&quot;: &quot;keyword&quot;    &#125;,    &quot;studymodel&quot;: &#123;      &quot;type&quot;: &quot;text&quot;    &#125;,    &quot;timestamp&quot;: &#123;      &quot;type&quot;: &quot;date&quot;,      &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd&quot;    &#125;,    &quot;price&quot;: &#123;      &quot;type&quot;: &quot;scaled_float&quot;,      &quot;scaling_factor&quot;: 100    &#125;  &#125;&#125;\n\næ–‡æ¡£æ“ä½œï¼š\n\næ–°å¢æ–‡æ¡£ï¼šPOST&#x2F;ç´¢å¼•åº“å&#x2F;_doc&#x2F;æ–‡æ¡£id {JSONæ–‡æ¡£}\næŸ¥è¯¢æ–‡æ¡£ï¼šGET&#x2F;ç´¢å¼•åº“å&#x2F;_doc&#x2F;æ–‡æ¡£id\nåˆ é™¤ï¼šDELETE&#x2F;ç´¢å¼•åº“å&#x2F;_doc&#x2F;æ–‡æ¡£id\nä¿®æ”¹æ–‡æ¡£ï¼š\nå…¨é‡ä¿®æ”¹ï¼Œåˆ é™¤æ—§æ–‡æ¡£ï¼Œæ·»åŠ æ–°æ–‡æ¡£ PUT&#x2F;ç´¢å¼•åº“å&#x2F;_doc&#x2F;æ–‡æ¡£id {JSONæ–‡æ¡£}\nå¢é‡ä¿®æ”¹ï¼Œä¿®æ”¹æŒ‡å®šå­—æ®µ  POST&#x2F;ç´¢å¼•åº“å&#x2F;_update&#x2F;æ–‡æ¡£id {â€œdocâ€:{å­—æ®µ}}\n\n\n\nESæ”¯æŒ2ç§åœ°ç†åæ ‡æ•°æ®ç±»å‹ï¼š\n\ngeo_point:ç”±ç»åº¦çº¬åº¦ç¡®å®šçš„ä¸€ä¸ªç‚¹ â€œ32.8752, 120.2981â€\ngeo_shape:å¤šä¸ªgeo_pointç»„æˆçš„å¤æ‚å‡ ä½•å›¾å½¢\n\nå­—æ®µæ‹·è´å¯ä»¥ä½¿ç”¨copy_toå±æ€§å°†å½“å‰å­—æ®µæ‹·è´åˆ°æŒ‡å®šå­—æ®µï¼šâ€œallâ€: {  â€œtypeâ€ï¼šâ€textâ€,  â€œanalyzerâ€: â€œik_max_wordâ€},â€œbrandâ€: {  â€œtypeâ€: â€œkeywordâ€,  â€œcopy_toâ€: â€œallâ€}\nDSLæŸ¥è¯¢æ–‡æ¡£DSLæŸ¥è¯¢åˆ†ç±»ï¼Œå¸¸è§æŸ¥è¯¢ç±»å‹ï¼š\n\næŸ¥è¯¢æ‰€æœ‰ï¼šæŸ¥è¯¢æ‰€æœ‰æ•°æ®\nå…¨æ–‡æ£€ç´¢ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•åº“åŒ¹é…\nmatch_query\nmulti_match_query\n\n\nç²¾ç¡®æŸ¥è¯¢ï¼›ä¸€èˆ¬æŸ¥è¯¢keywordã€æ•°å€¼ã€æ—¥æœŸç­‰ï¼Œä¾‹å¦‚ï¼š\nids\nrange\nterm\n\n\nåœ°ç†æŸ¥è¯¢ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š\ngeo_distance\ngeo_bounding_box\n\n\nå¤åˆæŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢\n\nESæ”¯æŒå¤šç´¢å¼•æœç´¢\nGET &#x2F;book1,book2&#x2F;_searchGET &#x2F;book*&#x2F;_search\nå¯ä»¥ç›´æ¥å°†bookå¼€å¤´çš„ç´¢å¼•ä¸€èµ·æœç´¢å‡ºæ¥ï¼Œåº”ç”¨åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒçš„logç´¢å¼•å¯ä»¥æŒ‰æ—¥æœŸåˆ†å¼€log_to_es_20190910log_to_es_20190911log_to_es_20180910å¯ä»¥æŸ¥è¯¢æ‰€æœ‰æˆ–å•ä¸ªæ—¥æœŸçš„æ—¥å¿—\nå…¨æ–‡æ£€ç´¢matchæŸ¥è¯¢\nGET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;match&quot;: &#123;      &quot;FIELD&quot;: &quot;TEXT&quot;    &#125;  &#125;&#125;\n\nmulti_match:ä¸matchæŸ¥è¯¢ç±»ä¼¼ï¼Œåªä¸è¿‡å…è®¸åŒæ—¶æŸ¥è¯¢å¤šä¸ªå­—æ®µ\nGET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;multi_match&quot;: &#123;      &quot;query&quot;: &quot;TEXT&quot;,      &quot;fields&quot;: [&quot;FIELD1&quot;,&quot;FIELD2&quot;]    &#125;  &#125;&#125;\n\nå„ç±»æŸ¥è¯¢#termæŸ¥è¯¢,ç²¾ç¡®æŸ¥è¯¢GET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;term&quot;: &#123;      &quot;FIELD&quot;: &#123;        &quot;value&quot;: &quot;VALUE&quot;      &#125;    &#125;  &#125;&#125;#rangeæŸ¥è¯¢GET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;range&quot;: &#123;      &quot;FIELD&quot;: &#123;        &quot;gte&quot;: 10,        &quot;lte&quot;: 20      &#125;    &#125;  &#125;&#125;#Fuzzy query#è¿”å›åŒ…å«ä¸æœç´¢è¯ç±»ä¼¼è¯çš„æ–‡æ¡£ï¼Œç¼–è¾‘è·ç¦»æ›´æ”¹ box -&gt; foxåˆ é™¤ aple -&gt; appleæ’å…¥ sick -&gt; sicè°ƒæ¢å­—ç¬¦ ACT -&gt; CATGET /book/_search&#123;  &quot;query&quot;: &#123;    &quot;fuzzy&quot;: &#123;      &quot;description&quot;: &#123;        &quot;value&quot;: &quot;jave&quot;      &#125;    &#125;  &#125;&#125;#æ­£åˆ™æŸ¥è¯¢GET /book/_search&#123;  &quot;query&quot;: &#123;    &quot;regexp&quot;: &#123;      &quot;description&quot;: &#123;        &quot;value&quot;: &quot;j.*a&quot;,        &quot;flags&quot;: &quot;ALL&quot;,        &quot;max_determinized_states&quot;: 10000,        &quot;rewrite&quot;: &quot;constant_score&quot;      &#125;    &#125;  &#125;&#125;\n\nåœ°ç†æŸ¥è¯¢geo_bounding_box:æŸ¥è¯¢geo_pointè½åœ¨æŸä¸ªçŸ©å½¢èŒƒå›´çš„æ‰€æœ‰æ–‡æ¡£\nGET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;geo_bounding_box&quot;: &#123;      &quot;FIELD&quot;: &#123;        &quot;top_left&quot;: &#123;          &quot;lat&quot;: 31.1,          &quot;lon&quot;: 121.5        &#125;,        &quot;bottom_right&quot;: &#123;          &quot;lat&quot;: 30.9,          &quot;lon&quot;: 121.7        &#125;      &#125;    &#125;  &#125;&#125;\n\ngeo_distance:æŸ¥è¯¢åˆ°æŒ‡å®šä¸­å¿ƒç‚¹å°äºæŸä¸ªè·ç¦»å€¼çš„æ‰€æœ‰æ–‡æ¡£\nGET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;geo_distance&quot;: &#123;      &quot;distance&quot;: &quot;15km&quot;,      &quot;FIELD&quot;: &quot;31.21,121.5&quot;    &#125;  &#125;&#125;\n\nå¤åˆæŸ¥è¯¢ç›¸å…³æ€§ç®—åˆ†ï¼šTFï¼ˆè¯æ¡é¢‘ç‡ï¼‰&#x3D; è¯æ¡å‡ºç°æ¬¡æ•°&#x2F;æ–‡æ¡£ä¸­è¯æ¡æ€»æ•°\nTF-IDFç®—æ³•IDFï¼ˆé€†æ–‡æ¡£é¢‘ç‡ï¼‰&#x3D; log(æ–‡æ¡£æ€»æ•°&#x2F;åŒ…å«è¯æ¡çš„æ–‡æ¡£æ€»æ•°)score &#x3D; TF * IDF(1â€“n)\nBM25ç®—æ³•score(Q,d)&#x3D;log(1+(N-n+0.5)&#x2F;(n+0.5))fi&#x2F;(fi+k1(1-b+b*dl&#x2F;avgdl));\nFunction Score Queryå¯ä»¥ä¿®æ”¹æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ†ï¼Œæ ¹æ®æ–°å¾—åˆ°çš„ç®—åˆ†æ’åº\nGET /hotel/_search&#123;  &quot;query&quot;: &#123;    &quot;function_score&quot;: &#123;      &quot;query&quot;: &#123;&quot;match&quot;: &#123;&quot;all&quot;: &quot;å¤–æ»©&quot;&#125;&#125;,       //åŸå§‹æŸ¥è¯¢æ¡ä»¶ï¼Œæœç´¢æ–‡æ¡£å¹¶ æ ¹æ®ç›¸å…³æ€§æ‰“åˆ†      &quot;function&quot;: [        &#123;          &quot;filter&quot;: &#123;&quot;term&quot;: &#123;&quot;id&quot;: &quot;1&quot;&#125;&#125;,      //è¿‡æ»¤æ¡ä»¶ï¼Œç¬¦åˆæ–‡æ¡£æ‰ä¼šè¢«é‡æ–°ç®—åˆ†          &quot;weight&quot;: 10                          //ç®—åˆ†å‡½æ•°ï¼Œå°†æ¥ä¸query scoreè¿ç®—        &#125;      ],      &quot;boot_mode&quot;: &quot;multiply&quot;                   //åŠ æƒæ¨¡å¼ï¼Œå®šä¹‰function scoreä¸query scoreè¿ç®—æ–¹å¼    &#125;  &#125;&#125;\n\nBoolean Queryå¸ƒå°”æŸ¥è¯¢æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥çš„ç»„åˆï¼Œç»„åˆæ–¹å¼ï¼š\n\nmust:å¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œ&amp;&amp;\nshould:é€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œ||\nmust_not:å¿…é¡»ä¸åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†ï¼Œï¼\nfilter:å¿…é¡»åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†\n\néœ€æ±‚ï¼šæœç´¢åå­—åŒ…å«â€œå¦‚å®¶â€ï¼Œä»·æ ¼ä¸é«˜äº400ï¼Œåœ¨åæ ‡31.21ï¼Œ121.5å‘¨å›´10KMèŒƒå›´çš„é…’åº—\næŸ¥è¯¢è®¡åˆ’(å®šä½é”™è¯¯è¯­æ³•)\nGET &#x2F;book&#x2F;_validate&#x2F;query?explain{  â€œqueryâ€: {    â€œmatchâ€: {      â€œdescriptionâ€: â€œjavaç¨‹åºå‘˜â€    }  }}\nGET /hotel/_search&#123;  &quot;query&quot;: &#123;    &quot;bool&quot;: &#123;      &quot;must&quot;: [        &#123;          &quot;match&quot;: &#123;&quot;name&quot;: &quot;å¦‚å®¶&quot;&#125;        &#125;      ],      &quot;must_not&quot;: [        &#123;          &quot;range&quot;: &#123;&quot;price&quot;: &#123;&quot;gt&quot;: 400&#125;&#125;        &#125;      ],      &quot;filter&quot;: [        &#123;          &quot;geo_distance&quot;: &#123;            &quot;distance&quot;: &quot;10km&quot;, &quot;location&quot;: &#123;&quot;lat&quot;: 31.21, &quot;lon&quot;: 121.5&#125;          &#125;        &#125;      ]    &#125;  &#125;&#125;\n\næœç´¢ç»“æœå¤„ç†æ’åºelasticsearché»˜è®¤æ ¹æ®ç›¸å…³åº¦æ’åºã€‚å¯ä»¥æ’åºå­—æ®µç±»å‹ï¼škeywordã€æ•°å€¼ç±»å‹ã€åœ°ç†åæ ‡ç±»å‹ã€æ—¥æœŸç±»å‹\nGET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;match_all&quot;: &#123;&#125;  &#125;,  &quot;sort&quot;: [    &#123;      &quot;FIELD&quot;: &quot;desc&quot;    &#125;  ]&#125;#åœ°ç†æ’åºGET /indexName/_search&#123;  &quot;query&quot;: &#123;    &quot;match_all&quot;: &#123;&#125;  &#125;,  &quot;sort&quot;: [    &#123;      &quot;_geo_distance&quot;: &#123;        &quot;FIELD&quot;: &quot;çº¬åº¦ï¼Œç»åº¦&quot;,        &quot;order&quot;: &quot;asc&quot;,        &quot;unit&quot;: &quot;km&quot;      &#125;    &#125;  ]&#125;\n\nåˆ†é¡µelasticsearché»˜è®¤åªè¿”å›top10æ•°æ®\nGET /hotel/_search&#123;  &quot;query&quot;: &#123;    &quot;match_all&quot;: &#123;&#125;  &#125;,  &quot;from&quot;: 990,     //åˆ†é¡µå¼€å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º0  &quot;size&quot;: 10,      //æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°  &quot;sort&quot;: [    &#123;&quot;price&quot;: &quot;asc&quot;&#125;  ]&#125;\n\næ·±åº¦åˆ†é¡µé—®é¢˜ï¼šESæ˜¯åˆ†å¸ƒå¼çš„ï¼Œåœ¨ESé›†ç¾¤é‡Œæ•°æ®ä¼šè¢«åˆ†åˆ°å¤šä¸ªåˆ†ç‰‡ä¸Šï¼Œå¦‚æœéœ€è¦æ’åºï¼Œéœ€è¦è·å–æ‰€æœ‰åˆ†ç‰‡çš„ç»“æœï¼Œé‡æ–°æ’åºå–å‰å‡ ä½çš„æ•°æ®æ¯”å¦‚:éœ€è¦9990-10000çš„æ•°æ®éœ€è¦ä»æ¯ä¸ªèŠ‚ç‚¹è·å–å‰10000æ¡æ•°æ®ç»™åè°ƒèŠ‚ç‚¹ï¼Œåè°ƒèŠ‚ç‚¹æ±‡æ€»æ‰€æœ‰æ•°æ®åœ¨è¿›è¡Œæ’åºï¼Œå¦‚æœ3ä¸ªä¸»èŠ‚ç‚¹å°±30000æ¡æ•°æ®æ’åºï¼Œæµªè´¹æœºå™¨æ€§èƒ½å’Œå¸¦å®½å°½é‡å‡å°‘æ·±åº¦åˆ†é¡µ\né«˜äº®GET /hotel/_search&#123;  &quot;query&quot;: &#123;    &quot;match&quot;: &#123;      &quot;FIELD&quot;: &quot;TEXT&quot;    &#125;,    &quot;hightlight&quot;: &#123;      &quot;fields&quot;: &#123;         //æŒ‡å®šè¦é«˜äº®çš„å­—æ®µ        &quot;FIELD&quot;: &#123;          &quot;require_field_match&quot;: &quot;true&quot; //é»˜è®¤æƒ…å†µESæœç´¢å­—æ®µå¿…é¡»ä¸é«˜äº®å­—æ®µä¸€è‡´          &quot;pre_tags&quot;: &quot;&lt;em&gt;&quot;,   //ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µå‰ç½®æ ‡ç­¾          &quot;post_tags&quot;: &quot;&lt;/em&gt;&quot;  //ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µåç½®æ ‡ç­¾        &#125;      &#125;    &#125;  &#125;&#125;\n\næ•°æ®èšåˆèšåˆå¯ä»¥å®ç°å¯¹æ–‡æ¡£æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ï¼Œå¸¸è§èšåˆæœ‰ï¼š\n\næ¡¶ï¼ˆBucketï¼‰èšåˆï¼šç”¨æ¥å¯¹æ–‡æ¡£åšåˆ†ç»„\ntermAggregation:æŒ‰ç…§æ–‡æ¡£å­—æ®µå€¼åˆ†ç»„\nDate Histogram:æŒ‰ç…§æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ä¸€å‘¨ä¸ºä¸€ç»„ï¼Œæˆ–è€…ä¸€æœˆä¸ºä¸€ç»„\n\n\nåº¦é‡ï¼ˆMetricï¼‰èšåˆï¼šç”¨ä»¥è®¡ç®—ä¸€äº›å€¼ï¼Œæ¯”å¦‚ï¼šæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ç­‰\nç®¡é“ï¼ˆpipelineï¼‰èšåˆï¼šå…¶ä»–èšåˆçš„ç»“æœä¸ºåŸºç¡€åšèšåˆ\n\nç»Ÿè®¡é…’åº—å“ç‰Œæœ‰å‡ ç§ï¼Œæ ¹æ®é…’åº—å“ç‰Œçš„åç§°åšèšåˆï¼ŒBucketèšåˆ\nGET /hotel/_search&#123;  &quot;size&quot;: 0,   //è®¾ç½®sizeä¸º0ï¼Œç»“æœä¸­ä¸åŒ…å«æ–‡æ¡£ï¼ŒåªåŒ…å«èšåˆç»“æœ  &quot;aggs&quot;: &#123;   //å®šä¹‰èšåˆ    &quot;brandAgg&quot;: &#123;   //ç»™èšåˆèµ·ä¸ªåå­—      &quot;terms&quot;: &#123;    //èšåˆç±»å‹ï¼ŒæŒ‰ç…§å“ç‰Œå€¼èšåˆ        &quot;field&quot;: &quot;brand&quot;,   //å‚ä¸èšåˆçš„å­—æ®µ        &quot;size&quot;: 20     //å¸Œæœ›è·å–çš„èšåˆæ•°é‡      &#125;    &#125;  &#125;&#125;\n\nè·å–æ¯ä¸ªå“ç‰Œçš„ç”¨æˆ·è¯„åˆ†min&#x2F;max&#x2F;avg  Metricsèšåˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨statsèšåˆï¼š\nGET /hotel/_search&#123;  &quot;size&quot;: 0,  &quot;aggs&quot;: &#123;    &quot;brandAgg&quot;: &#123;      &quot;term&quot;: &#123;        &quot;field&quot;: &quot;brand&quot;,        &quot;size&quot;: 20      &#125;,      &quot;aggs&quot;: &#123;  //æ˜¯brandsèšåˆçš„å­èšåˆï¼Œä¹Ÿå°±æ˜¯åˆ†ç»„åå¯¹æ¯ç»„åˆ†åˆ«è®¡ç®—        &quot;score_stats&quot;: &#123;          &quot;stats&quot;: &#123;   //èšåˆç±»å‹ï¼Œè¿™é‡Œstatså¯ä»¥è®¡ç®—min/max/avg            &quot;field&quot;: &quot;score&quot;          &#125;        &#125;      &#125;    &#125;  &#125;&#125;\n\nè‡ªåŠ¨è¡¥å…¨æ‹¼éŸ³åˆ†è¯å™¨é€šè¿‡æ‹¼éŸ³å¯¹è¯ç»„è¿›è¡Œåˆ†è¯\nè‡ªå®šä¹‰åˆ†è¯å™¨\nåœ¨åˆ›å»ºç´¢å¼•åº“æ—¶ï¼Œé€šè¿‡settingsæ¥é…ç½®è‡ªå®šä¹‰analyzer\nPUT /test&#123;  &quot;settings&quot;: &#123;    &quot;analysis&quot;: &#123;      &quot;analyzer&quot;: &#123;  //è‡ªå®šä¹‰åˆ†è¯å™¨        &quot;my_analyzer&quot;: &#123;  //åˆ†è¯å™¨åç§°          &quot;tokenizer&quot;: &quot;ik_max_word&quot;,          &quot;filter&quot;: &quot;py&quot;        &#125;      &#125;,      &quot;filter&quot;: &#123;  //è‡ªå®šä¹‰tokenizer filter        &quot;py&quot;: &#123;    //è¿‡æ»¤å™¨åç§°          &quot;type&quot;: &quot;pinyin&quot;,   //è¿‡æ»¤å™¨ç±»å‹ï¼Œè¿™é‡Œæ˜¯pinyin          &quot;keep_full_pinyin&quot;: false,          &quot;keep_joined_full_pinyin&quot;: true,          &quot;keep_original&quot;: true,          &quot;limit_first_letter_length&quot;: 16,          &quot;remove_duplicated_term&quot;: true,          &quot;none_chinese_pinyin_tokenize&quot;: false        &#125;      &#125;    &#125;  &#125;,  &quot;mappings&quot;: &#123;    &quot;properties&quot;: &#123;      &quot;name&quot;: &#123;        &quot;type&quot;: &quot;text&quot;,        &quot;analyzer&quot;: &quot;my_analyzer&quot;,      //åˆ›å»ºç´¢å¼•ä½¿ç”¨è‡ªå®šä¹‰åˆ†è¯        &quot;search_analyzer&quot;: &quot;ik_smart&quot;   //å­—æ®µæœç´¢ä½¿ç”¨ik_smartåˆ†è¯å™¨      &#125;    &#125;  &#125;&#125;\n\nè‡ªåŠ¨è¡¥å…¨ï¼šå­—æ®µç±»å‹æ˜¯completionç±»å‹ï¼Œå­—æ®µå€¼æ˜¯å¤šè¯æ¡çš„æ•°ç»„\nGET /test/_search&#123;  &quot;suggest&quot;: &#123;    &quot;title_suggest&quot;: &#123;      &quot;text&quot;: &quot;s&quot;,   //å…³é”®å­—      &quot;completion&quot;: &#123;        &quot;field&quot;: &quot;title&quot;,   //è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µ        &quot;skip_duplicates&quot;: true,   //è·³è¿‡é‡å¤çš„        &quot;size&quot;: 10     //è·å–å‰10æ¡ç»“æœ      &#125;    &#125;  &#125;&#125;\n\næ•°æ®åŒæ­¥elasticsearchä¸­çš„æ•°æ®æ¥è‡ªmysqlæ•°æ®åº“ï¼Œå› æ­¤mysqlæ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œeså¿…é¡»è·Ÿç€æ”¹å˜ï¼Œè¿™å°±æ˜¯æ•°æ®åŒæ­¥\næ–¹æ¡ˆä¸€ï¼šåŒæ­¥è°ƒç”¨  å†™æ•°æ®åº“æ—¶åŒæ­¥è°ƒç”¨esä¿®æ”¹æ–¹æ¡ˆäºŒï¼šå¼‚æ­¥é€šçŸ¥  é€šè¿‡mqå‘å¸ƒæ¶ˆæ¯æ–¹æ¡ˆä¸‰ï¼šç›‘å¬binlog   canalç›‘å¬binlogé€šçŸ¥æœåŠ¡\nelasticsearché›†ç¾¤å•æœºesåšæ•°æ®å­˜å‚¨ï¼Œå¿…ç„¶é¢ä¸´2ä¸ªé—®é¢˜ï¼šæµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ã€å•ç‚¹æ•…éšœé—®é¢˜ï¼š\n\næµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ï¼šå°†ç´¢å¼•åº“ä»é€»è¾‘ä¸Šæ‹†åˆ†æˆNä¸ªåˆ†ç‰‡ï¼Œå­˜å‚¨åˆ°å¤šä¸ªèŠ‚ç‚¹\nå•ç‚¹æ•…éšœé—®é¢˜ï¼šå°†åˆ†ç‰‡æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹å¤‡ä»½\n\nESé›†ç¾¤çš„èŠ‚ç‚¹è§’è‰²\n\n\n\nèŠ‚ç‚¹ç±»å‹\né…ç½®å‚æ•°\né»˜è®¤å€¼\nèŠ‚ç‚¹èŒè´£\n\n\n\nmaster eligible\nnode.master\ntrue\nå¤‡é€‰ä¸»èŠ‚ç‚¹ï¼šä¸»èŠ‚ç‚¹å¯ä»¥ç®¡ç†å’Œè®°å½•é›†ç¾¤çŠ¶æ€ã€å†³å®šåˆ†ç‰‡åœ¨å“ªä¸ªèŠ‚ç‚¹ã€å¤„ç†åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•åº“çš„è¯·æ±‚\n\n\ndata\nnode.data\ntrue\næ•°æ®èŠ‚ç‚¹ï¼šå­˜å‚¨æ•°æ®ã€æœç´¢ã€èšåˆã€CRUD\n\n\ningest\nnode.ingest\ntrue\næ•°æ®å­˜å‚¨ä¹‹å‰çš„é¢„å¤„ç†\n\n\ncoordinating\nä¸Šé¢3ä¸ªå‚æ•°éƒ½ä¸ºfalseåˆ™ä¸ºcoordinatingèŠ‚ç‚¹\næ— \nè·¯ç”±è¯·æ±‚åˆ°å…¶ä»–èŠ‚ç‚¹åˆå¹¶å…¶ä»–èŠ‚ç‚¹å¤„ç†çš„ç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·\n\n\nESé›†ç¾¤çš„åˆ†å¸ƒå¼æŸ¥è¯¢åˆ†æˆ2ä¸ªé˜¶æ®µï¼š\n\nscatter phase:åˆ†æ•£é˜¶æ®µï¼Œåè°ƒè€…ä¼šæŠŠè¯·æ±‚åˆ†å‘åˆ°æ¯ä¸€ä¸ªåˆ†ç‰‡\ngather phase:èšé›†é˜¶æ®µï¼Œåè°ƒè€…æ±‡æ€»data nodeçš„æœç´¢ç»“æœï¼Œå¹¶å¤„ç†ä¸ºæœ€ç»ˆç»“æœé›†è¿”å›ç»™ç”¨æˆ·\n\nESé›†ç¾¤çš„æ•…éšœè½¬ç§»\né›†ç¾¤çš„masterèŠ‚ç‚¹ä¼šç›‘æ§é›†ç¾¤ä¸­çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚æœå‘ç°èŠ‚ç‚¹å®•æœºï¼Œä¼šç«‹å³å°†å®•æœºèŠ‚ç‚¹çš„åˆ†ç‰‡æ•°æ®\nESåˆ†å¸ƒå¼åŸºç¡€ESå¯¹å¤æ‚åˆ†å¸ƒå¼æœºåˆ¶çš„é€æ˜éšè—ç‰¹æ€§\nåˆ†å¸ƒå¼æœºåˆ¶\nåˆ†ç‰‡æœºåˆ¶\né›†ç¾¤å‘ç°æœºåˆ¶\nshardè´Ÿè½½å‡è¡¡\nshardå‰¯æœ¬\n\næ‰©å®¹æ–¹æ¡ˆï¼ˆ1ï¼‰å‚ç›´æ‰©å®¹ ä¹°å…¥æ€§èƒ½æ›´å¼ºçš„æœºå™¨æ›¿æ¢æ‰åŸæ¥çš„æœºå™¨ï¼ˆ2ï¼‰æ°´å¹³æ‰©å®¹ æ–°å¢æœºå™¨åŠ å…¥é›†ç¾¤\nrebalanceæŸäº›æœåŠ¡å™¨è´Ÿè½½é‡æˆ–è½»ã€‚ESé›†ç¾¤å°†æŸäº›åˆ†ç‰‡è½¬ç§»åˆ°æ­¤æœºå™¨æˆ–ç§»èµ°\nmasterèŠ‚ç‚¹ï¼ˆ1ï¼‰ç®¡ç†ESé›†ç¾¤çš„å…ƒæ•°æ®ï¼šåˆ›å»ºåˆ é™¤ç´¢å¼•ï¼Œç»´æŠ¤ç´¢å¼•çš„å…ƒæ•°æ®ã€‚èŠ‚ç‚¹çš„å¢åŠ æˆ–å‡å°‘ï¼ˆ2ï¼‰é»˜è®¤æƒ…å†µESä¼šè‡ªåŠ¨é€‰æ‹©ä¸€å°æœºå™¨ä½œä¸ºmaster\nèŠ‚ç‚¹å¯¹ç­‰çš„åˆ†å¸ƒå¼æ¶æ„æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½æ¥å—æ‰€æœ‰è¯·æ±‚ï¼Œè‡ªåŠ¨è·¯ç”±\næ¨ªå‘æ‰©å®¹\nåˆ†ç‰‡è‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œåˆ†ç‰‡å‘ç©ºé—²æœºå™¨è½¬ç§»\næ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ›´å°‘åˆ†ç‰‡ï¼Œç³»ç»Ÿç»™ä¸æ¯ä¸ªåˆ†ç‰‡çš„èµ„æºæ›´å¤šï¼Œæ•´ä½“é›†ç¾¤æ€§èƒ½æé«˜\næ‰©å®¹æé™ï¼šèŠ‚ç‚¹æ•°å¤§äºæ•´ä½“åˆ†ç‰‡æ•°ï¼Œåˆ™å¿…æœ‰ç©ºé—²æœºå™¨\nè¶…è¿‡æ‰©å®¹æé™ï¼Œå¯ä»¥å¢åŠ å‰¯æœ¬æ•°ï¼Œå­˜å‚¨å’Œæœç´¢æ€§èƒ½æ›´å¼ºï¼Œå®¹é”™æ€§æ›´å¥½\nå®¹é”™æ€§ï¼šåªè¦ä¸€ä¸ªç´¢å¼•çš„æ‰€æœ‰ä¸»åˆ†ç‰‡åœ¨ï¼Œé›†ç¾¤å°±å¯ä»¥è¿è¡Œ\n\nESå®¹é”™æœºåˆ¶ masteré€‰ä¸¾ï¼Œreplicaå®¹é”™\nmaster nodeå®•æœºï¼Œè‡ªåŠ¨è¿›è¡Œmasteré€‰ä¸¾ï¼Œé›†ç¾¤ä¸ºred\nreplicaå®¹é”™ï¼Œæ–°masterå°†replicaæå‡ä¸ºprimary shardï¼Œé›†ç¾¤ä¸ºyellow\né‡å¯å®•æœºnodeï¼Œæ–°masterå°†ç¼ºå¤±çš„å‰¯æœ¬åˆ†ç‰‡copyåˆ°è¯¥èŠ‚ç‚¹ï¼ˆå¢é‡æ•°æ®ï¼‰ï¼Œé›†ç¾¤ä¸ºgreen\n\n","categories":["åˆ†å¸ƒå¼æœç´¢"],"tags":["å­¦ä¹ "]},{"title":"å¾®æœåŠ¡ä¿æŠ¤","url":"/java4u/2022/06/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4/","content":"åˆå§‹Sentinelé›ªå´©é—®é¢˜åŠè§£å†³æ–¹æ¡ˆå¾®æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªæœåŠ¡æ•…éšœï¼Œå¼•èµ·æ•´ä¸ªé“¾è·¯ä¸­æ‰€æœ‰å¾®æœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œè¿™å°±æ˜¯é›ªå´©\nè§£å†³é›ªå´©é—®é¢˜æ–¹æ¡ˆï¼š\n\nè¶…æ—¶å¤„ç†ï¼šè®¾å®šè¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å“åº”å°±è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šæ— ä¼‘æ­¢ç­‰å¾…ï¼ˆCSFå¤„ç†æ–¹å¼ï¼‰\nèˆ±å£æ¨¡å¼ï¼šé™å®šæ¯ä¸ªä¸šåŠ¡ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé¿å…è€—å°½æ•´ä¸ªtomcatèµ„æºï¼Œå› æ­¤ä¹Ÿå«çº¿ç¨‹éš”ç¦»\nç†”æ–­é™çº§ï¼šç”±æ–­è·¯å™¨ç»Ÿè®¡ä¸šåŠ¡æ‰§è¡Œçš„å¼‚å¸¸æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜™å€¼åˆ™ä¼šç†”æ–­ä¸šåŠ¡ï¼Œæ‹¦æˆªè®¿é—®è¯¥ä¸šåŠ¡çš„ä¸€åˆ‡è¯·æ±‚\næµé‡æ§åˆ¶ï¼šé™åˆ¶ä¸šåŠ¡è®¿é—®çš„QPSï¼Œé¿å…æœåŠ¡å› æµé‡çªå¢è€Œæ•…éšœ\n\næœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”\n\n\n\n\nSentinel\nHystrix\n\n\n\néš”ç¦»ç­–ç•¥\nä¿¡å·é‡éš”ç¦»\nçº¿ç¨‹æ± éš”ç¦»ã€ä¿¡å·é‡éš”ç¦»\n\n\nç†”æ–­é™çº§ç­–ç•¥\nåŸºäºæ…¢è°ƒç”¨æ¯”ä¾‹æˆ–å¼‚å¸¸æ¯”ä¾‹\nåŸºäºå¤±è´¥æ¯”ç‡\n\n\né™æµ\nåŸºäºQPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ\næœ‰é™çš„æ”¯æŒ\n\n\næµé‡æ•´å½¢\næ”¯æŒæ…¢å¯åŠ¨ã€åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼\nä¸æ”¯æŒ\n\n\næ§åˆ¶å°\nå¼€ç®±å³ç”¨ï¼Œå¯é…ç½®è§„åˆ™ã€æŸ¥çœ‹ç§’çº§ç›‘æ§ã€æœºå™¨å‘ç°ç­‰\nä¸å®Œå–„\n\n\né™æµè§„åˆ™æµæ§æ¨¡å¼ï¼š\n\nç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµ\nå…³è”ï¼Œç»Ÿè®¡å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµ\né“¾è·¯ï¼šç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼ï¼Œå¯¹æŒ‡å®šé“¾è·¯é™æµ\n\nå…³è”æ¨¡å¼ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·æ”¯ä»˜éœ€è¦æ›´æ–°è®¢å•ï¼ŒåŒæ—¶ä¼šæœ‰æŸ¥è¯¢è®¢å•ï¼Œæ”¯ä»˜è¯·æ±‚æ›´æ–°è®¢å•çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œå½“æ”¯ä»˜è¯·æ±‚è¿‡é«˜æ—¶ï¼Œé™åˆ¶æŸ¥è¯¢\né“¾è·¯æ¨¡å¼ä½¿ç”¨åœºæ™¯ï¼šæŸ¥è¯¢è®¢å•å’Œåˆ›å»ºè®¢å•ä¸šåŠ¡ï¼Œä¸¤è€…éƒ½éœ€è¦æŸ¥è¯¢å•†å“ã€‚é’ˆå¯¹æŸ¥è¯¢è®¢å•è¿›å…¥æŸ¥è¯¢å•†å“çš„è¯·æ±‚ç»Ÿè®¡å¹¶é™æµï¼ˆé˜²æ­¢æŸ¥è¯¢å½±å“åˆ›å»ºä¸šåŠ¡ï¼‰\næµæ§æ•ˆæœï¼š\n\nå¿«é€Ÿå¤±è´¥ï¼šè¾¾åˆ°é˜ˆå€¼ï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸\nwarm upï¼šé¢„çƒ­æ¨¡å¼ï¼Œå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚åŒæ ·æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ä½†è¿™ç§æ¨¡å¼é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œä»ä¸€ä¸ªè¾ƒå°å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§é˜ˆå€¼\næ’é˜Ÿç­‰å¾…ï¼šè®©æ‰€æœ‰è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºæ’é˜Ÿæ‰§è¡Œï¼Œ2ä¸ªè¯·æ±‚é—´éš”ä¸èƒ½å°äºæŒ‡å®šæ—¶é•¿(CSFçš„è¯·æ±‚é˜Ÿåˆ—)å°†æ³¢åŠ¨çš„æµé‡å˜æˆå‡åŒ€çš„æµé‡\n\nçƒ­ç‚¹å‚æ•°é™æµï¼šç»Ÿè®¡å‚æ•°å€¼ç›¸åŒçš„è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡QPS\néš”ç¦»å’Œé™çº§sentinelæ”¯æŒçš„é›ªå´©è§£å†³æ–¹æ¡ˆï¼š\n\nçº¿ç¨‹éš”ç¦»ï¼ˆèˆ±å£æ¨¡å¼ï¼‰\né™çº§ç†”æ–­\n\nçº¿ç¨‹éš”ç¦»æœ‰2ä¸­å®ç°æ–¹å¼ï¼šçº¿ç¨‹æ± éš”ç¦»ï¼›ä¿¡å·é‡éš”ç¦»\nçº¿ç¨‹æ± éš”ç¦»ï¼š\n\nä¼˜ç‚¹ï¼šæ”¯æŒä¸»åŠ¨è¶…æ—¶ï¼Œæ”¯æŒå¼‚æ­¥è°ƒç”¨\nç¼ºç‚¹ï¼šçº¿ç¨‹çš„é¢å¤–å¼€é”€æ¯”è¾ƒå¤§\nåœºæ™¯ï¼šä½æ‰‡å‡º\n\nä¿¡å·é‡éš”ç¦»ï¼š\n\nä¼˜ç‚¹ï¼šè½»é‡ï¼Œæ— é¢å¤–å¼€é”€\nç¼ºç‚¹ï¼šä¸æ”¯æŒä¸»åŠ¨è¶…æ—¶ï¼Œä¸æ”¯æŒå¼‚æ­¥è°ƒç”¨\nåœºæ™¯ï¼šé«˜é¢‘è°ƒç”¨ï¼Œé«˜æ‰‡å‡º\n\nç†”æ–­é™çº§ç”±æ–­è·¯å™¨ç»Ÿè®¡æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸æ¯”ä¾‹ã€æ…¢è¯·æ±‚æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ç†”æ–­è¯¥æœåŠ¡ï¼Œä¸€æ®µæ—¶é—´åï¼Œæ–­è·¯å™¨ä¼šåŠå¼€æ”¾ï¼Œå°è¯•æ”¾è¡Œï¼Œå¦‚æœæˆåŠŸåˆ™é‡æ–°æ”¾å¼€æœåŠ¡çš„è®¿é—®\nç†”æ–­ç­–ç•¥ï¼šæ…¢è°ƒç”¨ã€å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°\næˆæƒè§„åˆ™å¯¹è¯·æ±‚æ¥æºè¿›è¡Œåˆ¤æ–­èƒ½å¦è®¿é—®\nsentinelä¸‰ç§é…ç½®ç®¡ç†æ¨¡å¼ï¼š\n\nåŸå§‹æ¨¡å¼ï¼šä¿å­˜åœ¨å†…å­˜ï¼ˆä¸æ”¯æŒæŒä¹…åŒ–ï¼‰\npullæ¨¡å¼ï¼šä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼ˆå®šæ—¶è½®è¯¢ï¼Œå¯èƒ½æ•°æ®ä¸ä¸€è‡´ï¼‰\npushæ¨¡å¼ï¼šä¿å­˜åœ¨nacos,ç›‘å¬å˜æ›´å®æ—¶æ›´æ–°\n\n","categories":["å¾®æœåŠ¡ä¿æŠ¤"],"tags":["å­¦ä¹ "]},{"title":"å¤šçº§ç¼“å­˜","url":"/java4u/2022/06/01/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/","content":"å¤šçº§ç¼“å­˜å°±æ˜¯å……åˆ†åˆ©ç”¨è¯·æ±‚å¤„ç†çš„æ¯ä¸ªç¯èŠ‚ï¼Œåˆ†åˆ«æ·»åŠ ç¼“å­˜ï¼Œå‡è½»tomcatå‹åŠ›ï¼Œæå‡æœåŠ¡æ€§èƒ½\n1.æµè§ˆå™¨å®¢æˆ·ç«¯ç¼“å­˜2.nginxåå‘ä»£ç† â€“ã€‹ nginxæœ¬åœ°ç¼“å­˜ï¼ˆopenrestyï¼‰3.redisç¼“å­˜4.è¿›ç¨‹ç¼“å­˜(tomcat)5.æ•°æ®åº“\nJVMè¿›ç¨‹ç¼“å­˜åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¾‹å¦‚redis:\n\nä¼˜ç‚¹ï¼šå­˜å‚¨å®¹é‡æ›´å¤§ã€å¯é æ€§æ›´å¥½ã€å¯ä»¥åœ¨é›†ç¾¤é—´å…±äº«\nç¼ºç‚¹ï¼šè®¿é—®ç¼“å­˜æœ‰ç½‘ç»œå¼€é”€\n\nè¿›ç¨‹æœ¬åœ°ç¼“å­˜ï¼Œä¾‹å¦‚Hashmap&#x2F;GuavaCache\n\nä¼˜ç‚¹ï¼šè¯»å–æœ¬åœ°å†…å­˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€\nç¼ºç‚¹ï¼šå­˜å‚¨å®¹é‡æœ‰é™ã€å¯é æ€§è¾ƒä½ã€æ— æ³•å…±äº«\n\nCaffeineåŸºäºCaffeineå¯ä»¥å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜ï¼Œåœ¨æŸ¥è¯¢æ•°æ®åº“\nCaffeineç¼“å­˜é©±é€ç­–ç•¥ï¼š\n\nåŸºäºå¤§å°è®¾ç½®é©±é€ç­–ç•¥\nåŸºäºæ—¶é—´è®¾ç½®é©±é€ç­–ç•¥\nå¼±å¼•ç”¨ï¼ˆæ€§èƒ½ä¸å¥½ï¼‰\n\nLuaprint(&quot;Hello World!&quot;)local arr = &#123;&#x27;java&#x27;,&#x27;lua&#x27;,&#x27;python&#x27;&#125;local map = &#123;name=&#x27;jack&#x27;,age=21&#125;local function printArr(arr)        if(not arr)then                print(&#x27;æ•°ç»„ä¸èƒ½ä¸ºç©º&#x27;)                return nil        end        for i,value in ipairs(arr) do                print(value)        endendprintArr(arr)local arr2 = &#123;100,200,300&#125;printArr(arr2)printArr(nil)for index,value in ipairs(arr) do        print(index,value)endfor key,value in pairs(map) do        print(key,value)end\n\nOpenResty1.è¯·æ±‚å‚æ•°çš„è·å–\n&#x2F;item&#x2F;1001æ­£åˆ™åŒ¹é…ï¼š location ~ &#x2F;item&#x2F;(\\d+) {content_by_lua_file lua&#x2F;item.lua}å¦‚ä½•è·å–è¯·æ±‚å‚æ•°ï¼šlocal id &#x3D; ngx.var[1]  åŒ¹é…çš„æ•°æ®ä¼šå­˜å…¥ngx.varæ•°ç»„ä¸­\n2.å°è£…httpè¯·æ±‚\n-- å¯¼å…¥commonå‡½æ•°åº“local common = require(&#x27;common&#x27;)local read_http = common.read_http-- å¯¼å…¥cjsonåº“local cjson = require(&#x27;cjson&#x27;)--è·å–è·¯å¾„å‚æ•°local id = ngx.var[1]--æŸ¥è¯¢å•†å“ä¿¡æ¯local itemJSON = read_http(&quot;/item/&quot; .. id, nil)--æŸ¥è¯¢åº“å­˜ä¿¡æ¯local stockJSON = read_http(&quot;/item/stock/&quot; .. id, nil)-- JOSNè½¬åŒ–æˆå¯¹è±¡local item = cjson.decode(itemJSON)local stock = cjson.decode(stockJSON)--ç»„åˆæ•°æ®item.stock = stock.stockitem.sold=stock.sold-- è¿”å›å‡æ•°æ®--ngx.say(&#x27;&#123;&quot;id&quot;:&#x27; .. id ..&#x27;,&quot;name&quot;:&quot;SALSA AIR&quot;&#125;&#x27;)--æŠŠitemåºåˆ—åŒ–æˆjsonè¿”å›ngx.say(cjson.encode(itemJSON))\n\nredisredisç¼“å­˜é¢„çƒ­ï¼ˆé¡¹ç›®å¯åŠ¨æ—¶ï¼ŒåŠ è½½ç¼“å­˜ï¼‰é¡¹ç›®å¯åŠ¨æ—¶åŠ è½½å„ç±»ç¼“å­˜ç±»ï¼Œé¢„åŠ è½½ç¼“å­˜æ•°æ®\n--å¯¼å…¥redislocal redis = require(&#x27;resty.redis&#x27;)--åˆå§‹åŒ–redislocal red = redis::new()red:set_timeouts(1000, 1000, 1000)--å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± local function close_redis(red)\tlocal pool_max_idle_time = 10000 --è¿æ¥çš„ç©ºé—²æ—¶é—´\tlocal pool_size = 100  --è¿æ¥æ± å¤§å°\tlocal ok, err = red:set_keepalive(pool_max_idle_time,pool_size)\tif not ok then\t\tngx.log(ngx.ERR, &quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥ï¼š&quot;+err)\tendend--æŸ¥è¯¢redisæ–¹æ³•local function read_redis(ip,port,key)\t--è·å–ä¸€ä¸ªè¿æ¥\tlocal ok,err = red:connect(ip,port)\tif not ok then\t\tngx.log(ngx.ERR, &quot;è¿æ¥rediså¤±è´¥ï¼š&quot;+err)\t\treturn nil\tend\t--æŸ¥è¯¢redis\tlocal resp,err=red:get(key)\t--æŸ¥è¯¢å¤±è´¥å¤„ç†\tif not resp then\t\tngx.log(ngx.ERR,&quot;æŸ¥è¯¢rediså¤±è´¥ï¼š&quot;,err,&quot;,key=&quot;,key)\tend\tclose_redis(red)\treturn respend--å°è£…å‡½æ•°ï¼Œå…ˆæŸ¥è¯¢redis,åœ¨æŸ¥è¯¢httplocal function read_data(key, expire, path, params)\t-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜\tlocal val = item_cache:get(key)\tif not val then\t\tngx.log(ngx.ERR, &quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥&quot;)\t\t--æŸ¥è¯¢redis\t\tval = read_redis(&quot;127.0.0.1&quot;,6379,key)\t\t--åˆ¤æ–­redisæ˜¯å¦å‘½ä¸­\t\tif not val then\t\t\t--redisæŸ¥è¯¢å¤±è´¥ï¼ŒæŸ¥è¯¢http\t\t\tval = read_http(path, params)\t\tend\tend\t--æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å­˜å…¥æœ¬åœ°ç¼“å­˜\titem_cache:set(key, val, expire)\treturn valend\n\nç¼“å­˜åŒæ­¥ç¼“å­˜åŒæ­¥ç­–ç•¥ï¼š\n\nè®¾ç½®æœ‰æ•ˆæœŸï¼Œåˆ°æœŸè‡ªåŠ¨åˆ é™¤\nä¼˜åŠ¿ï¼šç®€å•ã€æ–¹ä¾¿\nç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®ï¼Œç¼“å­˜å¯èƒ½ä¸ä¸€è‡´\nåœºæ™¯ï¼šæ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œæ—¶æ•ˆæ€§è¦æ±‚ä½çš„ä¸šåŠ¡\n\n\nåŒæ­¥åŒå†™ï¼Œä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œç›´æ¥ä¿®æ”¹ç¼“å­˜\nä¼˜åŠ¿ï¼šæ—¶æ•ˆæ€§å¼ºï¼Œç¼“å­˜ä¸æ•°æ®åº“å¼ºä¸€è‡´\nç¼ºç‚¹ï¼šæœ‰ä»£ç ä¾µå…¥ï¼Œè€¦åˆåº¦é«˜\nåœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§ã€æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„ç¼“å­˜æ•°æ®\n\n\nå¼‚æ­¥é€šçŸ¥ï¼Œä¿®æ”¹æ•°æ®åº“æ—¶å‘é€äº‹ä»¶é€šçŸ¥\nä¼˜åŠ¿ï¼šä½è€¦åˆï¼Œå¯ä»¥é€šçŸ¥å¤šä¸ªç¼“å­˜\nç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§ä¸€èˆ¬ï¼Œå­˜åœ¨ä¸­é—´ä¸ä¸€è‡´çŠ¶æ€\nåœºæ™¯ï¼šæ—¶æ•ˆæ€§è¦æ±‚ä¸€èˆ¬ï¼Œæœ‰å¤šä¸ªæœåŠ¡éœ€è¦åŒæ­¥\n\n\n\nç›‘å¬canalå®ç°ç¼“å­˜åŒæ­¥","categories":["ç¼“å­˜"],"tags":["å­¦ä¹ "]},{"title":"é«˜æ€§èƒ½é˜Ÿåˆ—--Disruptor","url":"/java4u/2022/05/10/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97--Disruptor/","content":"èƒŒæ™¯Disruptoræ˜¯è‹±å›½å¤–æ±‡äº¤æ˜“å…¬å¸LMAXå¼€å‘çš„ä¸€ä¸ªé«˜æ€§èƒ½é˜Ÿåˆ—ï¼Œç ”å‘çš„åˆè¡·æ˜¯è§£å†³å†…å­˜é˜Ÿåˆ—çš„å»¶è¿Ÿé—®é¢˜ï¼ˆåœ¨æ€§èƒ½æµ‹è¯•ä¸­å‘ç°ç«Ÿç„¶ä¸I&#x2F;Oæ“ä½œå¤„äºåŒæ ·çš„æ•°é‡çº§ï¼‰\njavaå†…ç½®é˜Ÿåˆ—å¸¸ç”¨çš„çº¿ç¨‹å®‰å…¨çš„å†…ç½®é˜Ÿåˆ—å¦‚ä¸‹ï¼š\n\n\n\né˜Ÿåˆ—\næœ‰ç•Œæ€§\né”\næ•°æ®ç»“æ„\n\n\n\nArrayBlockingQueue\nbounded\nåŠ é”\narraylist\n\n\nLinkedBlockingQueue\noptionally-bounded\nåŠ é”\nlinkedlist\n\n\nConcurrentLinkedQueue\nunbounded\næ— é”\nlinkedlist\n\n\nLinkedTransferQueue\nunbounded\næ— é”\nlinkedlist\n\n\nPriorityBlockingQueue\nunbounded\nåŠ é”\nheap\n\n\nDelayQueue\nunbounded\nåŠ é”\nheap\n\n\né˜Ÿåˆ—åº•å±‚ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§ï¼šæ•°ç»„ã€é“¾è¡¨ã€å †ï¼Œå †ä¸€èˆ¬ä¸ºäº†å®ç°å¸¦æœ‰ä¼˜å…ˆçº§ç‰¹æ€§çš„é˜Ÿåˆ—ï¼Œæš‚æ—¶ä¸è€ƒè™‘é€šè¿‡ä¸åŠ é”çš„æ–¹å¼å®ç°çš„é˜Ÿåˆ—éƒ½æ˜¯æ— ç•Œçš„ï¼ˆæ— æ³•ä¿è¯é˜Ÿåˆ—çš„é•¿åº¦åœ¨ç¡®å®šçš„èŒƒå›´å†…ï¼‰ï¼›è€ŒåŠ é”çš„æ–¹å¼ï¼Œå¯ä»¥å®ç°æœ‰ç•Œé˜Ÿåˆ—ã€‚åœ¨ç¨³å®šæ€§è¦æ±‚ç‰¹åˆ«é«˜çš„ç³»ç»Ÿä¸­ï¼Œä¸ºäº†é˜²æ­¢ç”Ÿäº§è€…é€Ÿåº¦è¿‡å¿«ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œåªèƒ½é€‰æ‹©æœ‰ç•Œé˜Ÿåˆ—ï¼›åŒæ—¶ï¼Œä¸ºäº†å‡å°‘Javaçš„åƒåœ¾å›æ”¶å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ï¼Œä¼šå°½é‡é€‰æ‹©array&#x2F;heapæ ¼å¼çš„æ•°æ®ç»“æ„ã€‚è¿™æ ·ç­›é€‰ä¸‹æ¥ï¼Œç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—å°±åªæœ‰ArrayBlockingQueueã€‚\nArrayBlockingQueueçš„é—®é¢˜åŠ é”åŠ é”å½±å“æ€§èƒ½,ä¸‹é¢æ˜¯ArrayBlockingQueueé€šè¿‡åŠ é”çš„æ–¹å¼å®ç°çš„offeræ–¹æ³•ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨\npublic boolean offer(E e) &#123;    checkNotNull(e);    final ReentrantLock lock = this.lock;    lock.lock();    try &#123;        if (count == items.length)            return false;        else &#123;            insert(e);            return true;        &#125;    &#125; finally &#123;        lock.unlock();    &#125;&#125;\n\nç°å®ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼ŒåŠ é”é€šå¸¸ä¼šä¸¥é‡åœ°å½±å“æ€§èƒ½ã€‚çº¿ç¨‹ä¼šå› ä¸ºç«äº‰ä¸åˆ°é”è€Œè¢«æŒ‚èµ·ï¼Œç­‰é”è¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œçº¿ç¨‹åˆä¼šè¢«æ¢å¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨ç€å¾ˆå¤§çš„å¼€é”€ï¼Œå¹¶ä¸”é€šå¸¸ä¼šæœ‰è¾ƒé•¿æ—¶é—´çš„ä¸­æ–­ï¼Œå› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…é”æ—¶ï¼Œå®ƒä¸èƒ½åšä»»ä½•å…¶ä»–äº‹æƒ…ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”çš„æƒ…å†µä¸‹è¢«å»¶è¿Ÿæ‰§è¡Œï¼Œä¾‹å¦‚å‘ç”Ÿäº†ç¼ºé¡µé”™è¯¯ã€è°ƒåº¦å»¶è¿Ÿæˆ–è€…å…¶å®ƒç±»ä¼¼æƒ…å†µï¼Œé‚£ä¹ˆæ‰€æœ‰éœ€è¦è¿™ä¸ªé”çš„çº¿ç¨‹éƒ½æ— æ³•æ‰§è¡Œä¸‹å»ã€‚å¦‚æœè¢«é˜»å¡çº¿ç¨‹çš„ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œè€ŒæŒæœ‰é”çš„çº¿ç¨‹ä¼˜å…ˆçº§è¾ƒä½ï¼Œå°±ä¼šå‘ç”Ÿä¼˜å…ˆçº§åè½¬ã€‚\nä¼ªå…±äº«ArrayBlockingQueueæœ‰ä¸‰ä¸ªæˆå‘˜å˜é‡ï¼š - takeIndexï¼šéœ€è¦è¢«å–èµ°çš„å…ƒç´ ä¸‹æ ‡ - putIndexï¼šå¯è¢«å…ƒç´ æ’å…¥çš„ä½ç½®çš„ä¸‹æ ‡ - countï¼šé˜Ÿåˆ—ä¸­å…ƒç´ çš„æ•°é‡\nè¿™ä¸‰ä¸ªå˜é‡å¾ˆå®¹æ˜“æ”¾åˆ°ä¸€ä¸ªç¼“å­˜è¡Œä¸­ï¼Œä½†æ˜¯ä¹‹é—´ä¿®æ”¹æ²¡æœ‰å¤ªå¤šçš„å…³è”ã€‚æ‰€ä»¥æ¯æ¬¡ä¿®æ”¹ï¼Œéƒ½ä¼šä½¿ä¹‹å‰ç¼“å­˜çš„æ•°æ®å¤±æ•ˆï¼Œä»è€Œä¸èƒ½å®Œå…¨è¾¾åˆ°å…±äº«çš„æ•ˆæœã€‚\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“ç”Ÿäº§è€…çº¿ç¨‹putä¸€ä¸ªå…ƒç´ åˆ°ArrayBlockingQueueæ—¶ï¼ŒputIndexä¼šä¿®æ”¹ï¼Œä»è€Œå¯¼è‡´æ¶ˆè´¹è€…çº¿ç¨‹çš„ç¼“å­˜ä¸­çš„ç¼“å­˜è¡Œæ— æ•ˆï¼Œéœ€è¦ä»ä¸»å­˜ä¸­é‡æ–°è¯»å–ã€‚\nè¿™ç§æ— æ³•å……åˆ†ä½¿ç”¨ç¼“å­˜è¡Œç‰¹æ€§çš„ç°è±¡ï¼Œç§°ä¸ºä¼ªå…±äº«ã€‚\nDisruptorçš„è®¾è®¡æ–¹æ¡ˆDisruptoré€šè¿‡ä»¥ä¸‹è®¾è®¡æ¥è§£å†³é˜Ÿåˆ—é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼š\n\nç¯å½¢æ•°ç»„ç»“æ„ä¸ºäº†é¿å…åƒåœ¾å›æ”¶ï¼Œé‡‡ç”¨æ•°ç»„è€Œéé“¾è¡¨ã€‚åŒæ—¶ï¼Œæ•°ç»„å¯¹å¤„ç†å™¨çš„ç¼“å­˜æœºåˆ¶æ›´åŠ å‹å¥½ã€‚\nå…ƒç´ ä½ç½®å®šä½æ•°ç»„é•¿åº¦2^nï¼Œé€šè¿‡ä½è¿ç®—ï¼ŒåŠ å¿«å®šä½çš„é€Ÿåº¦ã€‚ä¸‹æ ‡é‡‡å–é€’å¢çš„å½¢å¼ã€‚ä¸ç”¨æ‹…å¿ƒindexæº¢å‡ºçš„é—®é¢˜ã€‚indexæ˜¯longç±»å‹ï¼Œå³ä½¿100ä¸‡QPSçš„å¤„ç†é€Ÿåº¦ï¼Œä¹Ÿéœ€è¦30ä¸‡å¹´æ‰èƒ½ç”¨å®Œã€‚\næ— é”è®¾è®¡æ¯ä¸ªç”Ÿäº§è€…æˆ–è€…æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œä¼šå…ˆç”³è¯·å¯ä»¥æ“ä½œçš„å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œç”³è¯·åˆ°ä¹‹åï¼Œç›´æ¥åœ¨è¯¥ä½ç½®å†™å…¥æˆ–è€…è¯»å–æ•°æ®ã€‚\n\nå¤šä¸ªç”Ÿäº§è€…å¤šä¸ªç”Ÿäº§è€…çš„æƒ…å†µä¸‹ï¼Œä¼šé‡åˆ°â€œå¦‚ä½•é˜²æ­¢å¤šä¸ªçº¿ç¨‹é‡å¤å†™åŒä¸€ä¸ªå…ƒç´ â€çš„é—®é¢˜ã€‚Disruptorçš„è§£å†³æ–¹æ³•æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–ä¸åŒçš„ä¸€æ®µæ•°ç»„ç©ºé—´è¿›è¡Œæ“ä½œã€‚è¿™ä¸ªé€šè¿‡CASå¾ˆå®¹æ˜“è¾¾åˆ°ã€‚åªéœ€è¦åœ¨åˆ†é…å…ƒç´ çš„æ—¶å€™ï¼Œé€šè¿‡CASåˆ¤æ–­ä¸€ä¸‹è¿™æ®µç©ºé—´æ˜¯å¦å·²ç»åˆ†é…å‡ºå»å³å¯ã€‚\nä½†æ˜¯ä¼šé‡åˆ°ä¸€ä¸ªæ–°é—®é¢˜ï¼šå¦‚ä½•é˜²æ­¢è¯»å–çš„æ—¶å€™ï¼Œè¯»åˆ°è¿˜æœªå†™çš„å…ƒç´ ã€‚Disruptoråœ¨å¤šä¸ªç”Ÿäº§è€…çš„æƒ…å†µä¸‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªä¸Ring Bufferå¤§å°ç›¸åŒçš„bufferï¼šavailable Bufferã€‚å½“æŸä¸ªä½ç½®å†™å…¥æˆåŠŸçš„æ—¶å€™ï¼Œä¾¿æŠŠavailble Bufferç›¸åº”çš„ä½ç½®ç½®ä½ï¼Œæ ‡è®°ä¸ºå†™å…¥æˆåŠŸã€‚è¯»å–çš„æ—¶å€™ï¼Œä¼šéå†available Bufferï¼Œæ¥åˆ¤æ–­å…ƒç´ æ˜¯å¦å·²ç»å°±ç»ªã€‚\nä¸‹é¢åˆ†è¯»æ•°æ®å’Œå†™æ•°æ®ä¸¤ç§æƒ…å†µä»‹ç»ã€‚\nè¯»æ•°æ®1.ç”³è¯·è¯»å–åˆ°åºå·nï¼›2.è‹¥writer cursor &gt;&#x3D; nï¼Œè¿™æ—¶ä»ç„¶æ— æ³•ç¡®å®šè¿ç»­å¯è¯»çš„æœ€å¤§ä¸‹æ ‡ã€‚ä»reader cursorå¼€å§‹è¯»å–available Bufferï¼Œä¸€ç›´æŸ¥åˆ°ç¬¬ä¸€ä¸ªä¸å¯ç”¨çš„å…ƒç´ ï¼Œç„¶åè¿”å›æœ€å¤§è¿ç»­å¯è¯»å…ƒç´ çš„ä½ç½®ï¼›3.æ¶ˆè´¹è€…è¯»å–å…ƒç´ ã€‚\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯»çº¿ç¨‹è¯»åˆ°ä¸‹æ ‡ä¸º2çš„å…ƒç´ ï¼Œä¸‰ä¸ªçº¿ç¨‹Writer1&#x2F;Writer2&#x2F;Writer3æ­£åœ¨å‘RingBufferç›¸åº”ä½ç½®å†™æ•°æ®ï¼Œå†™çº¿ç¨‹è¢«åˆ†é…åˆ°çš„æœ€å¤§å…ƒç´ ä¸‹æ ‡æ˜¯11ã€‚\nè¯»çº¿ç¨‹ç”³è¯·è¯»å–åˆ°ä¸‹æ ‡ä»3åˆ°11çš„å…ƒç´ ï¼Œåˆ¤æ–­writer cursor&gt;&#x3D;11ã€‚ç„¶åå¼€å§‹è¯»å–availableBufferï¼Œä»3å¼€å§‹ï¼Œå¾€åè¯»å–ï¼Œå‘ç°ä¸‹æ ‡ä¸º7çš„å…ƒç´ æ²¡æœ‰ç”Ÿäº§æˆåŠŸï¼Œäºæ˜¯WaitFor(11)è¿”å›6ã€‚\nç„¶åï¼Œæ¶ˆè´¹è€…è¯»å–ä¸‹æ ‡ä»3åˆ°6å…±è®¡4ä¸ªå…ƒç´ ã€‚\n\nå†™æ•°æ®1.ç”³è¯·å†™å…¥mä¸ªå…ƒç´ ï¼›2.è‹¥æ˜¯æœ‰mä¸ªå…ƒç´ å¯ä»¥å†™å…¥ï¼Œåˆ™è¿”å›æœ€å¤§çš„åºåˆ—å·ã€‚æ¯ä¸ªç”Ÿäº§è€…ä¼šè¢«åˆ†é…ä¸€æ®µç‹¬äº«çš„ç©ºé—´ï¼›3.ç”Ÿäº§è€…å†™å…¥å…ƒç´ ï¼Œå†™å…¥å…ƒç´ çš„åŒæ—¶è®¾ç½®available Bufferé‡Œé¢ç›¸åº”çš„ä½ç½®ï¼Œä»¥æ ‡è®°è‡ªå·±å“ªäº›ä½ç½®æ˜¯å·²ç»å†™å…¥æˆåŠŸçš„ã€‚\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒWriter1å’ŒWriter2ä¸¤ä¸ªçº¿ç¨‹å†™å…¥æ•°ç»„ï¼Œéƒ½ç”³è¯·å¯å†™çš„æ•°ç»„ç©ºé—´ã€‚Writer1è¢«åˆ†é…äº†ä¸‹æ ‡3åˆ°ä¸‹è¡¨5çš„ç©ºé—´ï¼ŒWriter2è¢«åˆ†é…äº†ä¸‹æ ‡6åˆ°ä¸‹æ ‡9çš„ç©ºé—´ã€‚\nWriter1å†™å…¥ä¸‹æ ‡3ä½ç½®çš„å…ƒç´ ï¼ŒåŒæ—¶æŠŠavailable Bufferç›¸åº”ä½ç½®ç½®ä½ï¼Œæ ‡è®°å·²ç»å†™å…¥æˆåŠŸï¼Œå¾€åç§»ä¸€ä½ï¼Œå¼€å§‹å†™ä¸‹æ ‡4ä½ç½®çš„å…ƒç´ ã€‚Writer2åŒæ ·çš„æ–¹å¼ã€‚æœ€ç»ˆéƒ½å†™å…¥å®Œæˆã€‚\n\né˜²æ­¢ä¸åŒç”Ÿäº§è€…å¯¹åŒä¸€æ®µç©ºé—´å†™å…¥çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\npublic long tryNext(int n) throws InsufficientCapacityException&#123;    if (n &lt; 1)    &#123;        throw new IllegalArgumentException(&quot;n must be &gt; 0&quot;);    &#125;     long current;    long next;     do    &#123;        current = cursor.get();        next = current + n;         if (!hasAvailableCapacity(gatingSequences, n, current))        &#123;            throw InsufficientCapacityException.INSTANCE;        &#125;    &#125;    while (!cursor.compareAndSet(current, next));     return next;&#125;\n\né€šè¿‡do&#x2F;whileå¾ªç¯çš„æ¡ä»¶cursor.compareAndSet(current, next)ï¼Œæ¥åˆ¤æ–­æ¯æ¬¡ç”³è¯·çš„ç©ºé—´æ˜¯å¦å·²ç»è¢«å…¶ä»–ç”Ÿäº§è€…å æ®ã€‚å‡å¦‚å·²ç»è¢«å æ®ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›å¤±è´¥ï¼ŒWhileå¾ªç¯é‡æ–°æ‰§è¡Œï¼Œç”³è¯·å†™å…¥ç©ºé—´ã€‚\næ€»ç»“Disruptoré€šè¿‡ç²¾å·§çš„æ— é”è®¾è®¡å®ç°äº†åœ¨é«˜å¹¶å‘æƒ…å½¢ä¸‹çš„é«˜æ€§èƒ½ã€‚\nä»£ç æ ·ä¾‹ï¼š\n/** * @description disruptorä»£ç æ ·ä¾‹ã€‚æ¯10mså‘disruptorä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œæ¶ˆè´¹è€…è¯»å–æ•°æ®ï¼Œå¹¶æ‰“å°åˆ°ç»ˆç«¯ */import com.lmax.disruptor.*;import com.lmax.disruptor.dsl.Disruptor;import com.lmax.disruptor.dsl.ProducerType;import java.util.concurrent.ThreadFactory;public class DisruptorMain&#123;    public static void main(String[] args) throws Exception    &#123;        // é˜Ÿåˆ—ä¸­çš„å…ƒç´         class Element &#123;            private int value;            public int get()&#123;                return value;            &#125;            public void set(int value)&#123;                this.value= value;            &#125;        &#125;        // ç”Ÿäº§è€…çš„çº¿ç¨‹å·¥å‚        ThreadFactory threadFactory = new ThreadFactory()&#123;            @Override            public Thread newThread(Runnable r) &#123;                return new Thread(r, &quot;simpleThread&quot;);            &#125;        &#125;;        // RingBufferç”Ÿäº§å·¥å‚,åˆå§‹åŒ–RingBufferçš„æ—¶å€™ä½¿ç”¨        EventFactory&lt;Element&gt; factory = new EventFactory&lt;Element&gt;() &#123;            @Override            public Element newInstance() &#123;                return new Element();            &#125;        &#125;;        // å¤„ç†Eventçš„handler        EventHandler&lt;Element&gt; handler = new EventHandler&lt;Element&gt;()&#123;            @Override            public void onEvent(Element element, long sequence, boolean endOfBatch)            &#123;                System.out.println(&quot;Element: &quot; + element.get());            &#125;        &#125;;        // é˜»å¡ç­–ç•¥        BlockingWaitStrategy strategy = new BlockingWaitStrategy();        // æŒ‡å®šRingBufferçš„å¤§å°        int bufferSize = 16;        // åˆ›å»ºdisruptorï¼Œé‡‡ç”¨å•ç”Ÿäº§è€…æ¨¡å¼        Disruptor&lt;Element&gt; disruptor = new Disruptor(factory, bufferSize, threadFactory, ProducerType.SINGLE, strategy);        // è®¾ç½®EventHandler        disruptor.handleEventsWith(handler);        // å¯åŠ¨disruptorçš„çº¿ç¨‹        disruptor.start();        RingBuffer&lt;Element&gt; ringBuffer = disruptor.getRingBuffer();        for (int l = 0; true; l++)        &#123;            // è·å–ä¸‹ä¸€ä¸ªå¯ç”¨ä½ç½®çš„ä¸‹æ ‡            long sequence = ringBuffer.next();              try            &#123;                // è¿”å›å¯ç”¨ä½ç½®çš„å…ƒç´                 Element event = ringBuffer.get(sequence);                 // è®¾ç½®è¯¥ä½ç½®å…ƒç´ çš„å€¼                event.set(l);             &#125;            finally            &#123;                ringBuffer.publish(sequence);            &#125;            Thread.sleep(10);        &#125;    &#125;&#125;\n","categories":["è¿›ç¨‹"],"tags":["Disruptor","é˜Ÿåˆ—"]},{"title":"åˆ†å¸ƒå¼äº‹åŠ¡","url":"/java4u/2022/05/09/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/","content":"CAPå®šç†åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰ä¸‰ä¸ªæŒ‡æ ‡ï¼š\n\nä¸€è‡´æ€§ ç”¨æˆ·è®¿é—®åˆ†å¸ƒå¼ç³»ç»Ÿä»»æ„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®å¿…é¡»ä¸€è‡´\nå¯ç”¨æ€§ ç”¨æˆ·è®¿é—®é›†ç¾¤ä»»æ„å¥åº·èŠ‚ç‚¹ï¼Œå¿…é¡»å¾—åˆ°å“åº”\nåˆ†åŒºå®¹é”™ å› ä¸ºç½‘ç»œæ•…éšœæˆ–å…¶ä»–åŸå› å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éƒ¨åˆ†èŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹å¤±å»è¿æ¥ï¼Œå½¢æˆç‹¬ç«‹åˆ†åŒºã€‚åœ¨é›†ç¾¤å‡ºç°åˆ†åŒºæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿè¦æŒç»­å¯¹å¤–æä¾›æœåŠ¡\n\nåˆ†å¸ƒå¼ç³»ç»Ÿé€šè¿‡ç½‘ç»œè¿æ¥ï¼Œä¸€å®šä¼šå‡ºç°åˆ†åŒºé—®é¢˜ï¼ˆPï¼‰ï¼Œç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰æ— æ³•åŒæ—¶æ»¡è¶³\nBASEç†è®ºBASEç†è®ºå¯¹CAPçš„ä¸€ç§è§£å†³æ€è·¯ï¼š\n\nåŸºæœ¬å¯ç”¨ ç³»ç»Ÿå‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨\nè½¯çŠ¶æ€ ä¸€å®šæ—¶é—´å†…ï¼Œå…è®¸å‡ºç°ä¸­é—´çŠ¶æ€ï¼Œä¸´æ—¶çš„ä¸ä¸€è‡´çŠ¶æ€\næœ€ç»ˆä¸€è‡´æ€§ åœ¨è½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´\n\nåˆ†å¸ƒå¼äº‹åŠ¡æœ€å¤§é—®é¢˜æ˜¯å„ä¸ªå­äº‹åŠ¡çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå€Ÿé‰´CAPå®šç†å’ŒBASEç†è®ºï¼š\n\nAPæ¨¡å¼ï¼šå­äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå’Œæäº¤ï¼Œé‡‡ç”¨è¡¥å¿æœºåˆ¶æ¢å¤æ•°æ®ï¼Œå®ç°æœ€ç»ˆä¸€è‡´\nCPæ¨¡å¼ï¼šå­äº‹åŠ¡æ‰§è¡Œåç›¸äº’ç­‰å¾…ï¼ŒåŒæ—¶æ‰§è¡Œï¼ŒåŒæ—¶å›æ»šï¼Œè¾¾æˆå¼ºä¸€è‡´ï¼ˆAppframeé‡‡ç”¨æ–¹å¼ï¼‰\n\nSeataæ¶æ„seataäº‹åŠ¡ç®¡ç†ä¸­é‡è¦çš„è§’è‰²ï¼š\n\nTCäº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»š\nTMäº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡èŒƒå›´ã€å¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡\nRMèµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡ï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»š\n\nXAæ¨¡å¼\nseataçš„XAæ¨¡å¼åšäº†è°ƒæ•´ï¼ˆæ•°æ®åº“æ”¯æŒï¼Œseataåªåšç®€å•çš„å°è£…ï¼‰ï¼Œä½†å¤§ä½“ç›¸ä¼¼ï¼šRMä¸€é˜¶æ®µå·¥ä½œï¼š\n\næ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TC\næ‰§è¡Œåˆ†æ”¯ä¸šåŠ¡sqlä½†ä¸æäº¤\næŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€åˆ°TC\n\nTCäºŒé˜¶æ®µå·¥ä½œï¼š\n\nTCæ£€æµ‹å„åˆ†æ”¯äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼ˆéƒ½æˆåŠŸåˆ™é€šçŸ¥æ‰€æœ‰RMæäº¤äº‹åŠ¡ï¼Œå¦‚æœæœ‰å¤±è´¥ï¼Œå°±é€šçŸ¥æ‰€æœ‰RMå›æ»šäº‹åŠ¡ï¼‰\n\nRMäºŒé˜¶æ®µå·¥ä½œï¼š\n\næ¥å—TCæŒ‡ä»¤ï¼Œæäº¤æˆ–å›æ»šäº‹åŠ¡\n\nXAæ¨¡å¼ä¼˜ç‚¹ï¼š\n\näº‹åŠ¡å¼ºä¸€è‡´æ€§ï¼Œæ»¡è¶³ACIDåŸåˆ™\nå¸¸ç”¨æ•°æ®åº“éƒ½æ”¯æŒï¼Œå®ç°ç®€å•ï¼Œæ²¡æœ‰ä¸šåŠ¡ä»£ç å…¥ä¾µ\n\nXAæ¨¡å¼ç¼ºç‚¹ï¼š\n\nç¬¬ä¸€é˜¶æ®µéœ€è¦é”å®šæ•°æ®åº“èµ„æºï¼Œç­‰å¾…äºŒé˜¶æ®µæ‰é‡Šæ”¾ï¼Œæ€§èƒ½è¾ƒå·®\nä¾èµ–å…³ç³»å‹æ•°æ®åº“å®ç°äº‹åŠ¡\n\nATæ¨¡å¼\nATåŒæ ·æ˜¯åˆ†é˜¶æ®µæäº¤äº‹åŠ¡æ¨¡å‹ï¼Œä¸è¿‡å¼¥è¡¥äº†XAæ¨¡å¼ä¸­èµ„æºé”å®šå‘¨æœŸè¿‡é•¿çš„ç¼ºé™·\nRMä¸€é˜¶æ®µå·¥ä½œï¼š\n\næ³¨å†Œåˆ†æ”¯äº‹åŠ¡\nè®°å½•undo-logï¼ˆæ•°æ®å¿«ç…§ï¼Œç”¨äºæ•°æ®æ¢å¤å’Œå›æ»šï¼‰\næ‰§è¡Œä¸šåŠ¡sqlå¹¶æäº¤\næŠ¥å‘Šäº‹åŠ¡çŠ¶æ€\n\nRMäºŒé˜¶æ®µæäº¤æ—¶å·¥ä½œï¼š\n\nåˆ é™¤undo-logå³å¯\n\nRMäºŒé˜¶æ®µå›æ»šæ—¶å·¥ä½œï¼š\n\næ ¹æ®undo-logæ¢å¤æ•°æ®åˆ°æ›´æ–°å‰\n\nATæ¨¡å¼ä¸XAæ¨¡å¼åŒºåˆ«ï¼š\n\nXAæ¨¡å¼ä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œä¼šé”å®šèµ„æºï¼›ATæ¨¡å¼ç›´æ¥æäº¤äº‹åŠ¡ï¼Œä¸é”å®šèµ„æº\nXAæ¨¡å¼ä¾èµ–æ•°æ®åº“æœºåˆ¶å®ç°ï¼›ATæ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»š\nXAæ¨¡å¼å¼ºä¸€è‡´ï¼›ATæ¨¡å¼æœ€ç»ˆä¸€è‡´\n\nATæ¨¡å¼ä¼˜ç‚¹ï¼š\n\nä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾èµ„æºï¼Œæ€§èƒ½æ¯”è¾ƒå¥½\nåˆ©ç”¨å…¨å±€é”å®ç°è¯»å†™éš”ç¦»\næ²¡æœ‰ä»£ç ä¾µå…¥ï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆå›æ»šå’Œæäº¤\n\nATæ¨¡å¼ç¼ºç‚¹ï¼š\n\nä¸¤é˜¶æ®µä¹‹é—´å±äºè½¯çŠ¶æ€ï¼Œå±äºæœ€ç»ˆä¸€è‡´\næ¡†æ¶å¿«ç…§ä¼šå½±å“æ€§èƒ½ï¼Œä½†æ¯”XAæ¨¡å¼è¦å¥½å¾—å¤š\n\nTCCæ¨¡å¼\nTCCé€šè¿‡äººå·¥ç¼–ç å®ç°æ•°æ®æ¢å¤\n\nTry:èµ„æºæ£€æµ‹å’Œé¢„ç•™\nConfirm:å®Œæˆèµ„æºæ“ä½œä¸šåŠ¡ï¼›è¦æ±‚tryæˆåŠŸconfirmä¸€å®šèƒ½æˆåŠŸ\nCancel:é¢„ç•™èµ„æºé‡Šæ”¾ï¼Œå¯ä»¥ç†è§£æœªtryçš„åå‘æ“ä½œ\n\nTCCä¼˜åŒ–ï¼š\n\nä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œæ€§èƒ½å¥½\nç›¸æ¯”ATæ¨¡å‹ï¼Œæ— éœ€ç”Ÿæˆå¿«ç…§ï¼Œæ— éœ€ä½¿ç”¨å…¨å±€é”\nä¸ä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼Œå¯ä»¥ç”¨äºéäº‹åŠ¡å‹æ•°æ®åº“\n\nTCCç¼ºç‚¹ï¼š\n\næœ‰ä»£ç ä¾µå…¥ï¼Œéœ€è¦äººä¸ºç¼–å†™\nè½¯çŠ¶æ€ï¼Œäº‹åŠ¡æœ€ç»ˆä¸€è‡´\néœ€è¦è€ƒè™‘confirmå’Œcancelå¤±è´¥æƒ…å†µï¼Œåšå¥½å¹‚ç­‰å¤„ç†\n\nTCCç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚å½“æŸåˆ†æ”¯äº‹åŠ¡tryé˜¶æ®µé˜»å¡æ—¶ï¼Œå¯èƒ½å¯¼è‡´å…¨å±€äº‹åŠ¡è¶…æ—¶è€Œè§¦å‘äºŒé˜¶æ®µçš„cancelæ“ä½œã€‚å¯¹äºæœªæ‰§è¡Œtryæ“ä½œçš„åˆ†æ”¯ï¼Œæ­¤æ—¶cancelä¸èƒ½å›æ»šï¼Œå°±åšä¸€ä¸ªç©ºå›æ»š\nå¯¹äºå·²ç»ç©ºå›æ»šçš„ä¸šåŠ¡ï¼Œå¦‚æœä¹‹ååˆå¯ä»¥ç»§ç»­æ‰§è¡Œtryï¼Œä½†æ•´ä¸ªäº‹åŠ¡å·²ç»å›æ»šäº†ï¼Œé‚£ä¹‹åçš„confirmå’Œcancelå°±ä¸ä¼šæ‰§è¡Œäº†ï¼Œå°±æ˜¯ä¸šåŠ¡æ‚¬æŒ‚ã€‚åº”å½“é˜»æ­¢æ‰§è¡Œç©ºå›æ»šåçš„tryæ“ä½œï¼Œé¿å…æ‚¬æŒ‚\nSagaæ¨¡å¼Sagaæ˜¯seataæä¾›çš„é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š\n\nä¸€é˜¶æ®µï¼šç›´æ¥æäº¤æœ¬åœ°äº‹åŠ¡\näºŒé˜¶æ®µï¼šæˆåŠŸåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼›å¤±è´¥åˆ™é€šè¿‡ç¼–å†™è¡¥å¿ä¸šåŠ¡æ¥å›æ»š\n\nsagaæ¨¡å¼ä¼˜ç‚¹ï¼š\n\näº‹åŠ¡å‚ä¸è€…å¯ä»¥åŸºäºäº‹ä»¶é©±åŠ¨å®ç°å¼‚æ­¥è°ƒç”¨ï¼Œååé«˜\nä¸€é˜¶æ®µç›´æ¥æäº¤äº‹åŠ¡ï¼Œæ— é”ï¼Œæ€§èƒ½å¥½\nä¸ç”¨ç¼–å†™TCCä¸­ä¸‰ä¸ªé˜¶æ®µï¼Œå®ç°ç®€å•\n\nç¼ºç‚¹ï¼š\n\nè½¯çŠ¶æ€æŒç»­æ—¶é—´ä¸ç¡®å®šï¼Œæ—¶æ•ˆæ€§å·®\næ²¡æœ‰é”ï¼Œæ²¡æœ‰äº‹åŠ¡éš”ç¦»ï¼Œä¼šæœ‰è„å†™\n\n","categories":["äº‹åŠ¡"],"tags":["åˆ†å¸ƒå¼"]},{"title":"å°†æ•°æ®åº“ä»oracleæ›´æ¢ä¸ºantDBé‡åˆ°çš„é—®é¢˜","url":"/java4u/2022/04/27/%E5%B0%86%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8Eoracle%E6%9B%B4%E6%8D%A2%E4%B8%BAantDB%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/","content":"éœ€è¦å˜æ›´çš„åœ°æ–¹åšä¸‹è®°å½•ï¼š\n1.ä¸ä½¿ç”¨rowidï¼Œantdbä¸æ”¯æŒrowid\n2.ä¿®æ”¹é…ç½®è¿æ¥ï¼Œå˜æ›´driver\n3.è·å–SEQæ—¶æŠ¥é”™ä¿®æ”¹æ‰¹é‡è·å–SEQåŒ…ä¸­è·å–SEQçš„æ–¹å¼select SEQ_BUSINESS_ID.nextval from generate_series(1,50);\n4.æŸ¥è¯¢ç¼“å­˜æ—¶æŠ¥é”™ç¬¬ä¸€æ¬¡æŸ¥è¯¢ç¼“å­˜æ—¶ï¼Œåœ¨æŸ¥è¯¢è¡¨æ•°æ®çš„åŒæ—¶ä¼šæŸ¥è¯¢è¡¨çš„å­—æ®µä¸ä¸»é”®å’ŒåŒä¹‰è¯é‡Œé¢ä¼šç”¨åˆ°userè¿™ä¸ªoracleçš„ç‰¹æ®Šè¯ï¼Œpgä¸æ”¯æŒï¼Œéœ€è¦ä¿®æ”¹è·å–SQLä¿®æ”¹å‰ï¼š\nSELECT C.COLUMN_NAMEã€€  FROM ALL_CONS_COLUMNS C, ALL_CONSTRAINTS KWHERE K.CONSTRAINT_TYPE = &#x27;P&#x27;    \tAND (K.OWNER, K.TABLE_NAME) = (\t\tSELECT USER TABLE_OWNER, TABLE_NAME  \t\tFROM USER_TABLES          \t\tWHERE TABLE_NAME = &#x27;BS_ENTITY_TAG_REL&#x27;        \t\tUNION         \t\tSELECT TABLE_OWNER, TABLE_NAME           \t\tFROM USER_SYNONYMS          \t\tWHERE SYNONYM_NAME = &#x27;BS_ENTITY_TAG_REL&#x27;)    \tAND K.CONSTRAINT_NAME = C.CONSTRAINT_NAME    \tAND K.TABLE_NAME = C.TABLE_NAME    \tAND K.OWNER = C.OWNER  ORDER BY COLUMN_NAME ;\nä¿®æ”¹åï¼š\nSELECT c.column_nameFROM ALL_CONS_COLUMNS C, ALL_CONSTRAINTS KWHERE K.CONSTRAINT_TYPE = &#x27;P&#x27;      AND (K.OWNER, K.TABLE_NAME) = (    SELECT owner TABLE_OWNER, TABLE_NAME      FROM USER_TABLES              WHERE TABLE_NAME = &#x27;BS_ENTITY_TAG_REL&#x27; )      AND K.CONSTRAINT_NAME = C.CONSTRAINT_NAME      AND K.TABLE_NAME = C.TABLE_NAME      AND K.OWNER = C.OWNER  ORDER BY COLUMN_NAME ;\n ä½¿ç”¨ownerä»£æ›¿ï¼ŒåŒæ—¶ä¸ä½¿ç”¨åŒä¹‰è¯\n5.ä¿®æ”¹oracleç‰¹å®šç”¨æ³•\n\nï¼ˆ+ï¼‰è¡¨ç¤ºå¤–è¿æ¥ï¼Œå¹¶ä¸”æ€»æ˜¯æ”¾åœ¨éä¸»è¡¨çš„ä¸€æ–¹ï¼ˆ+ï¼‰æ›¿æ¢ä¸ºæ ‡å‡†SQL  LEFT JOIN æˆ– RIGHT JOIN\nä¸ä½¿ç”¨dblink,ä½¿ç”¨å¤–éƒ¨è¡¨æŸ¥è¯¢å…¶ä»–ä¸­å¿ƒçš„æ•°æ®\n\n","categories":["æ•°æ®åº“"],"tags":["æ›´æ¢æ•°æ®åº“"]},{"title":"MQ","url":"/java4u/2022/04/24/MQ/","content":"MQåˆå§‹MQåŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ï¼šæ—¶æ•ˆæ€§é«˜\nåŒæ­¥è°ƒç”¨å­˜åœ¨çš„é—®é¢˜ï¼š\n\n1.è€¦åˆåº¦é«˜ï¼Œæ¯æ¬¡æ–°åŠ éœ€æ±‚éœ€è¦ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼ˆåŠ å…¥çŸ­ä¿¡ï¼Œç§¯åˆ†ã€‚ã€‚ï¼‰\n2.æ€§èƒ½ä¸‹é™ï¼Œè°ƒç”¨é“¾è¿‡é•¿åˆ™å“åº”æ—¶é—´å˜é•¿\n3.èµ„æºæµªè´¹ï¼Œè°ƒç”¨æ–¹åœ¨ç­‰å¾…å“åº”çš„æ—¶å€™ä¸èƒ½é‡Šæ”¾è¯·æ±‚ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹æµªè´¹ç³»ç»Ÿèµ„æº\n4.çº§è”å¤±è´¥ï¼ŒæœåŠ¡æä¾›è€…å‡ºç°é—®é¢˜ï¼Œæ‰€æœ‰è°ƒç”¨æ–¹éƒ½ä¼šå‡ºç°é—®é¢˜\n\nå¼‚æ­¥é€šä¿¡çš„ä¼˜ç‚¹ï¼š\n\nè€¦åˆåº¦é™ä½ï¼Œä¿®æ”¹éœ€æ±‚ä¸å½±å“ä»£ç ï¼Œåªéœ€è¦å–æ¶ˆè®¢é˜…å³å¯\nååé‡æå‡ï¼Œå¯ä»¥é©¬ä¸Šè¿”å›è°ƒç”¨ç»“æœ\næ•…éšœéš”ç¦»ï¼ŒæœåŠ¡å‡ºç°å¼‚å¸¸ä¸ä¼šç›¸äº’å½±å“\næµé‡å‰Šå³°ï¼Œå¤§é‡è¯·æ±‚ç”±brokerç¼“å­˜\n\nå¼‚æ­¥é€šä¿¡çš„ç¼ºç‚¹ï¼š\n\nä¾èµ–brokerçš„å¯é æ€§ã€å®‰å…¨æ€§ã€ååèƒ½åŠ›\næ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½è¿½è¸ªç®¡ç†\n\nRabbitmqå¦‚ä½•windowså¯åŠ¨rabbitmq\nå®‰è£…RabbitMQç®¡ç†æ’ä»¶ï¼šrabbitmq-plugins enable rabbitmq_management å‘½ä»¤è¿›è¡Œå®‰è£…\nç´§æ¥ç€è¾“å…¥ rabbitmq-server.bat è¿›è¡Œå¯åŠ¨RabbitMQæœåŠ¡\nSpringAMQPSpringAMQPé»˜è®¤ä½¿ç”¨rabbitmqä½¿ç”¨@RabbitListeneræŒ‡å®šé˜Ÿåˆ—çš„åç§°è®©springå»æ¥å—æ¶ˆæ¯\nåˆ†å¸ƒè®¢é˜…æ¨¡å¼ï¼šfanout exchange:å‘é€åˆ°ç»‘å®šçš„æ¯ä¸ªqueue\ndirect exchange:æ ¹æ®è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±åˆ°æŒ‡å®šçš„queue,å› æ­¤ç§°ä¹‹è·¯ç”±æ¨¡å¼(æ ¹æ®routingkeyè¿›è¡Œè·¯ç”±)\ntopic exchange:topicçš„routingkeyå¿…é¡»æ˜¯å¤šä¸ªå•è¯çš„åˆ—è¡¨å¹¶ä»¥.åˆ†å‰²ï¼ˆå¯ä»¥ä½¿ç”¨é€šé…ç¬¦è·¯ç”±ï¼‰\nä½¿ç”¨MessageConverterä½¿ç”¨æ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–,å‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„converterå¿…é¡»ç›¸åŒ\nRocketMQrocketmqè§’è‰²\nproducer:æ¶ˆæ¯å‘é€è€…\nconsumer:æ¶ˆæ¯æ¥æ”¶è€…\nbroker:æš‚å­˜å’Œä¼ è¾“æ¶ˆæ¯\nnameserver:ç®¡ç†broker\ntopic:åŒºåˆ†æ¶ˆæ¯çš„ç§ç±»\nmessage queue:ç›¸å½“äºtopicçš„åˆ†åŒº\n\n","categories":["ä¸­é—´ä»¶"],"tags":["MQ"]},{"title":"SpringCloud","url":"/java4u/2022/04/21/SpringCloud/","content":"å¾®æœåŠ¡æŠ€æœ¯å¯¹æ¯”\n\n\n\nDubbo\nSpringCloud\nSpringCloudAlibaba\n\n\n\næ³¨å†Œä¸­å¿ƒ\nzookeeper&#x2F;redis\nEureka\nNacos&#x2F;Eureka\n\n\næœåŠ¡è¿œç¨‹è°ƒç”¨\nDubboåè®®\nFeign(httpåè®®)\nDubbo&#x2F;Feign\n\n\né…ç½®ä¸­å¿ƒ\næ— \nSpringCloudConfig\nSpringCloudConfig&#x2F;Nacos\n\n\næœåŠ¡ç½‘å…³\næ— \nSpringCloudGateway&#x2F;zuul\nSpringCloudGateway&#x2F;zuul\n\n\næœåŠ¡ç›‘æ§å’Œä¿æŠ¤\ndubbo-admin\nHystrix\nSentinel\n\n\nEurekaSpringCloudä½¿ç”¨httpåè®®å‘èµ·è¿œç¨‹è°ƒç”¨è¯·æ±‚æ¯”å¦‚   restTemplate.getForObject(â€œlocalhost:8081&#x2F;user&#x2F;â€œ+user.getId(), User.class)\nä½¿ç”¨Eurekaæä¾›æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ï¼Œä½¿ç”¨æœåŠ¡åè°ƒç”¨            restTemplate.getForObject(â€œUserService&#x2F;userâ€+user.getId(), User.class)\nRibbonRibbonè´Ÿè½½å‡è¡¡æµç¨‹\norderService  --1.å‘èµ·è¯·æ±‚ http://userservice/user/1--&gt;   4.è½®è¯¢åˆ°æŸå°æœº userservice 8001                        |                   |                            |                   |                      2.æ‹‰å–userservice     3.è¿”å›æœåŠ¡åˆ—è¡¨                        |                   |                        |                   |                            eureka-service\n\nRibbonä½¿ç”¨IRuleè¿›è¡Œè´Ÿè½½å‡è¡¡è§„åˆ™çš„é€‰æ‹©    å¯ä»¥é€šè¿‡beanæˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿®æ”¹è´Ÿè½½å‡è¡¡ç­–ç•¥\nRibbonæ˜¯æ‡’åŠ è½½ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ‰ä¼šåˆ›å»ºloadbalanceClient,è¯·æ±‚æ—¶é—´å¾ˆé•¿ï¼Œé…ç½®é¥¥é¥¿åŠ è½½å¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨æ—¶åˆ›å»ºï¼Œé™ä½ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶é—´ï¼ˆæœåŠ¡é¢„çƒ­ï¼‰\nNacosNacosé›†ç¾¤æœåŠ¡ç®¡ç†\næœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼ˆCSFæ§åˆ¶å°ï¼‰nacosä¼šå±•ç¤ºæœåŠ¡å¯¹åº”çš„å®ä¾‹åŠå®ä¾‹åœ°å€ï¼ˆå…³æ³¨å®ä¾‹çš„çŠ¶æ€å¯ä»¥ç»™å®ä¾‹è®¾ç½®æƒé‡ï¼‰ï¼Œcsfä¸»è¦å±•ç¤ºæœåŠ¡çš„é…ç½®ä¿¡æ¯ï¼ˆè·¯ç”±ç­–ç•¥ï¼Œè´Ÿè½½ç±»å‹ï¼Œé™çº§ç­–ç•¥ï¼Œè¶…æ—¶è®¾å®šï¼‰\næœåŠ¡åˆ†çº§å­˜å‚¨ä»¥æœºæˆ¿åˆ’åˆ†é›†ç¾¤ï¼Œæ¯”å¦‚ï¼šæ­å·é›†ç¾¤ã€ä¸Šæµ·é›†ç¾¤ï¼ˆCSFçš„ç§Ÿæˆ·æ¦‚å¿µï¼‰\nnacosä½¿ç”¨namespaceåšç¯å¢ƒéš”ç¦»ï¼Œä¸åŒç¯å¢ƒæ— æ³•ç›¸äº’è®¿é—®\nNacoså’ŒEurekaåŒºåˆ«1.nacosæœ‰ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹ï¼Œä¸´æ—¶å®ä¾‹å¿ƒè·³ç›‘æµ‹ï¼ˆå¤±æ•ˆä¼šè¢«ç›´æ¥å‰”é™¤ï¼‰ï¼Œéä¸´æ—¶å®ä¾‹nacosä¸»åŠ¨è¯¢é—®ï¼ˆä¼šä¸€ç›´ä¿æŒå®ä¾‹ï¼‰2.nacosä¸»åŠ¨æ¨é€å˜æ›´æ¶ˆæ¯\nNacosç»Ÿä¸€é…ç½®ç®¡ç†ï¼ˆK8Sç»Ÿä¸€é…ç½®ï¼‰\nç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œå¯ä»¥è¿›è¡Œçƒ­æ›´æ–°é…ç½®\nFeignä½¿ç”¨feignä»£æ›¿resttemplateï¼Œå£°æ˜å¼è¿œç¨‹è°ƒç”¨ï¼ˆhttpå®¢æˆ·ç«¯ï¼‰\nFeignåº•å±‚å®¢æˆ·ç«¯å®ç°ï¼š    URLConnection     é»˜è®¤ä¸æ”¯æŒè¿æ¥æ±     Apache HttpClient    OKHttp\nFeignæ€§èƒ½ä¼˜åŒ–    1.ä½¿ç”¨å¸¦è¿æ¥æ± çš„æ›¿æ¢URLConnection    2.ä¿®æ”¹æ—¥å¿—çº§åˆ«ä¸ºBASICå’ŒNONE\nFeignçš„æœ€ä½³å®ç°ï¼š    1.è®©controllerå’Œfeignclientç»§æ‰¿ç›¸åŒæ¥å£    2.FeignæŠ½å–è°ƒç”¨æ¨¡å—ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨\nGateWayç½‘å…³åŠŸèƒ½ï¼š  1.èº«ä»½è®¤è¯å’Œæƒé™æ ¡éªŒ  2.æœåŠ¡è·¯ç”±å’Œè´Ÿè½½å‡è¡¡  3.è¯·æ±‚é™æµ\nzuulåŸºäºservletï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ï¼Œgatewayå±äºå“åº”å¼ç¼–ç¨‹ï¼Œå…·æœ‰æ›´å¥½çš„æ€§èƒ½\nè·¯ç”±æ–­è¨€å·¥å‚ï¼šï¼ˆæ»¡è¶³æ–­è¨€æ‰ä¼šè·¯ç”±ï¼‰path  è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™before  åœ¨æŸä¸ªæ—¶é—´ç‚¹å‰è¯·æ±‚after  åœ¨æŸä¸ªæ—¶é—´ç‚¹åè¯·æ±‚\nè·¯ç”±è¿‡æ»¤å™¨å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡çš„å“åº”è¿›è¡Œè¿‡æ»¤\né’ˆå¯¹éƒ¨åˆ†è·¯ç”±çš„è¿‡æ»¤å™¨é’ˆå¯¹æ‰€æœ‰è·¯ç”±çš„è¿‡æ»¤å™¨å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå“åº”ï¼ˆå…¨å±€è¿‡æ»¤å™¨ï¼‰é€»è¾‘è‡ªå®šä¹‰\nç½‘å…³CORSï¼ˆæµè§ˆå™¨è¯¢é—®æœåŠ¡å™¨èƒ½å¦è·¨åŸŸï¼‰è·¨åŸŸè·¨åŸŸé…ç½®\nwww.taobao.com  www.taobao.org   miaosha.taobao  åŸŸåä¸åŒçš„è·¨åŸŸè¯·æ±‚\n","categories":["æ¡†æ¶"],"tags":["å­¦ä¹ "]},{"title":"REDISæ·±å…¥äº†è§£","url":"/java4u/2022/04/20/REDIS%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3/","content":"redisæ•°æ®å¯¹è±¡å­—ç¬¦ä¸²å¯¹è±¡ï¼ˆstringï¼‰ã€åˆ—è¡¨å¯¹è±¡ï¼ˆlistï¼‰ã€å“ˆå¸Œå¯¹è±¡ï¼ˆhashï¼‰ã€é›†åˆï¼ˆsetï¼‰å¯¹è±¡å’Œæœ‰åºé›†åˆå¯¹è±¡ï¼ˆzsetï¼‰\n\n1.redisObjectredisæ˜¯ä»¥é”®å€¼å¯¹å­˜å‚¨æ•°æ®çš„ï¼Œæ‰€ä»¥å¯¹è±¡åˆåˆ†ä¸ºé”®å¯¹è±¡å’Œå€¼å¯¹è±¡ï¼Œå³å­˜å‚¨ä¸€ä¸ªkey-valueé”®å€¼å¯¹ä¼šåˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œé”®å¯¹è±¡å’Œå€¼å¯¹è±¡ã€‚é”®å¯¹è±¡æ€»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œå€¼å¯¹è±¡å¯ä»¥æ˜¯äº”å¤§å¯¹è±¡ä¸­çš„ä»»æ„ä¸€ç§ã€‚\n#define REDIS_LRU_BITS 24#define REDIS_LRU_CLOCK_MAX ((1&lt;&lt;REDIS_LRU_BITS)-1) /* Max value of obj-&gt;lru */#define REDIS_LRU_CLOCK_RESOLUTION 1000 /* LRU clock resolution in ms */typedef struct redisObject &#123;    // ç±»å‹    //ç±»å‹å±æ€§å­˜å‚¨çš„æ˜¯å¯¹è±¡çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ stringã€listã€hashã€setã€zsetä¸­çš„ä¸€ç§    unsigned type:4;    // ç¼–ç     unsigned encoding:4;    // å¯¹è±¡æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´    unsigned lru:REDIS_LRU_BITS; /* lru time (relative to server.lruclock) */    // å¼•ç”¨è®¡æ•°    int refcount;    // æŒ‡å‘å®é™…å€¼çš„æŒ‡é’ˆ    void *ptr;&#125; robj;\n\n2.Stringå­—ç¬¦ä¸²å¯¹è±¡åº•å±‚æ•°æ®ç»“æ„å®ç°ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰å’Œç›´æ¥å­˜å‚¨ï¼Œä½†å…¶ç¼–ç æ–¹å¼å¯ä»¥æ˜¯intã€rawæˆ–è€…embstrï¼ŒåŒºåˆ«åœ¨äºå†…å­˜ç»“æ„çš„ä¸åŒã€‚\n1)intç¼–ç ï¼Œç›´æ¥ä¿å­˜åœ¨ptrå±æ€§ä¸­\n\n2ï¼‰rawç¼–ç \nåœ¨é•¿åº¦ç‰¹åˆ«çŸ­æ—¶ï¼Œä½¿ç”¨ emb å½¢å¼å­˜å‚¨ (embedded)ï¼Œå½“é•¿åº¦è¶…è¿‡ 44 æ—¶ï¼Œä½¿ç”¨ raw å½¢å¼å­˜å‚¨\nembstr å­˜å‚¨å½¢å¼æ˜¯è¿™æ ·ä¸€ç§å­˜å‚¨å½¢å¼ï¼Œå®ƒå°† RedisObject å¯¹è±¡å¤´å’Œ SDS å¯¹è±¡è¿ç»­å­˜åœ¨ä¸€èµ·ï¼Œä½¿ç”¨ malloc æ–¹æ³•ä¸€æ¬¡åˆ†é…ã€‚è€Œ raw å­˜å‚¨å½¢å¼ä¸ä¸€æ ·ï¼Œå®ƒéœ€è¦ä¸¤æ¬¡ mallocï¼Œä¸¤ä¸ªå¯¹è±¡å¤´åœ¨å†…å­˜åœ°å€ä¸Šä¸€èˆ¬æ˜¯ä¸è¿ç»­çš„ã€‚\n å­—ç¬¦ä¸²ä¿å­˜çš„å¤§äº32å­—èŠ‚çš„å­—ç¬¦ä¸²å€¼ï¼Œåˆ™ä½¿ç”¨ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰ç»“æ„ï¼Œå¹¶å°†ç¼–ç è®¾ç½®ä¸ºrawï¼Œæ­¤æ—¶å†…å­˜ç»“æ„ä¸SDSç»“æ„ä¸€è‡´ï¼Œå†…å­˜åˆ†é…æ¬¡æ•°ä¸ºä¸¤æ¬¡ï¼Œåˆ›å»ºredisObjectå¯¹è±¡å’Œsdshdrç»“æ„ï¼Œå¦‚å›¾ï¼š\n\n3ï¼‰embstrç¼–ç \n\n3.liståˆ—è¡¨å¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ziplistå’Œlinkedlistä¹‹ä¸€ï¼Œå½“å­—ç¬¦ä¸²é•¿åº¦è¾ƒå°ä¸”å…ƒç´ æ•°é‡ä¹Ÿè¾ƒå°æ—¶ï¼Œä¼šè½¬æ¢æˆå‹ç¼©åˆ—è¡¨ï¼Œå¦åˆ™éƒ½æ˜¯åŒç«¯åˆ—è¡¨\n1ï¼‰linkedlistlinkedlistç¼–ç åº•å±‚é‡‡ç”¨åŒç«¯é“¾è¡¨å®ç°ï¼Œæ¯ä¸ªåŒç«¯é“¾è¡¨èŠ‚ç‚¹éƒ½ä¿å­˜äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œåœ¨æ¯ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å†…ä¿å­˜äº†ä¸€ä¸ªåˆ—è¡¨å…ƒç´ ã€‚\n\n2ï¼‰ziplistziplistæ˜¯listé”®ã€hashé”®ä»¥åŠzseté”®çš„åº•å±‚å®ç°ä¹‹ä¸€\nZiplist æ˜¯ä¸ºäº†å°½å¯èƒ½åœ°èŠ‚çº¦å†…å­˜è€Œè®¾è®¡çš„ç‰¹æ®Šç¼–ç åŒç«¯é“¾è¡¨ã€‚Ziplist å¯ä»¥å‚¨å­˜å­—ç¬¦ä¸²å€¼å’Œæ•´æ•°å€¼ï¼Œå…¶ä¸­ï¼Œæ•´æ•°å€¼è¢«ä¿å­˜ä¸ºå®é™…çš„æ•´æ•°ï¼Œè€Œä¸æ˜¯å­—ç¬¦æ•°ç»„ã€‚\nZiplist çš„æ•´ä½“å¸ƒå±€ï¼š\n&lt;zlbytes&gt;&lt;zltail&gt;&lt;zllen&gt;&lt;entry&gt;&lt;entry&gt;&lt;zlend&gt;\n\n\nzlbytes æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œä¿å­˜ç€ ziplist ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚é€šè¿‡è¿™ä¸ªå€¼ï¼Œç¨‹åºå¯ä»¥ç›´æ¥å¯¹ ziplist çš„å†…å­˜å¤§å°è¿›è¡Œè°ƒæ•´ï¼Œè€Œæ— é¡»ä¸ºäº†è®¡ç®— ziplist çš„å†…å­˜å¤§å°è€Œéå†æ•´ä¸ªåˆ—è¡¨ã€‚\nzltailä¿å­˜ç€åˆ°è¾¾åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åç§»é‡ã€‚è¿™ä¸ªåç§»é‡ä½¿å¾—å¯¹è¡¨å°¾çš„ pop æ“ä½œå¯ä»¥åœ¨æ— é¡»éå†æ•´ä¸ªåˆ—è¡¨çš„æƒ…å†µä¸‹è¿›è¡Œã€‚\nzllenä¿å­˜ç€åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹æ•°é‡ã€‚å½“ zllen ä¿å­˜çš„å€¼å¤§äº 2**16-2 æ—¶ï¼Œç¨‹åºéœ€è¦éå†æ•´ä¸ªåˆ—è¡¨æ‰èƒ½çŸ¥é“åˆ—è¡¨å®é™…åŒ…å«äº†å¤šå°‘ä¸ªèŠ‚ç‚¹ã€‚\nZIPLIST èŠ‚ç‚¹ï¼šæ¯ä¸ª ziplist èŠ‚ç‚¹çš„å‰é¢éƒ½å¸¦æœ‰ä¸€ä¸ª header ï¼Œè¿™ä¸ª header åŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š\n\n1)å‰ç½®èŠ‚ç‚¹çš„é•¿åº¦ï¼Œåœ¨ç¨‹åºä»åå‘å‰éå†æ—¶ä½¿ç”¨ã€‚2)å½“å‰èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼çš„ç±»å‹å’Œé•¿åº¦ã€‚\n/* ç©ºç™½ ziplist ç¤ºä¾‹å›¾area        |&lt;---- ziplist header ----&gt;|&lt;-- end --&gt;|size          4 bytes   4 bytes 2 bytes  1 byte            +---------+--------+-------+-----------+component   | zlbytes | zltail | zllen | zlend     |            |         |        |       |           |value       |  1011   |  1010  |   0   | 1111 1111 |            +---------+--------+-------+-----------+                                       ^                                       |                               ZIPLIST_ENTRY_HEAD                                       &amp;address                        ZIPLIST_ENTRY_TAIL                                       &amp;                               ZIPLIST_ENTRY_ENDéç©º ziplist ç¤ºä¾‹å›¾area        |&lt;---- ziplist header ----&gt;|&lt;----------- entries -------------&gt;|&lt;-end-&gt;|size          4 bytes  4 bytes  2 bytes    ?        ?        ?        ?     1 byte            +---------+--------+-------+--------+--------+--------+--------+-------+component   | zlbytes | zltail | zllen | entry1 | entry2 |  ...   | entryN | zlend |            +---------+--------+-------+--------+--------+--------+--------+-------+                                       ^                          ^        ^address                                |                          |        |                                ZIPLIST_ENTRY_HEAD                |   ZIPLIST_ENTRY_END                                                                  |                                                        ZIPLIST_ENTRY_TAIL*/\n\n/* \\* ä¿å­˜ ziplist èŠ‚ç‚¹ä¿¡æ¯çš„ç»“æ„ */typedef struct zlentry &#123;  // prevrawlen ï¼šå‰ç½®èŠ‚ç‚¹çš„é•¿åº¦  // prevrawlensize ï¼šç¼–ç  prevrawlen æ‰€éœ€çš„å­—èŠ‚å¤§å°  unsigned int prevrawlensize, prevrawlen;  // len ï¼šå½“å‰èŠ‚ç‚¹å€¼çš„é•¿åº¦  // lensize ï¼šç¼–ç  len æ‰€éœ€çš„å­—èŠ‚å¤§å°  unsigned int lensize, len;  // å½“å‰èŠ‚ç‚¹ header çš„å¤§å°  // ç­‰äº prevrawlensize + lensize  unsigned int headersize;  // å½“å‰èŠ‚ç‚¹å€¼æ‰€ä½¿ç”¨çš„ç¼–ç ç±»å‹  unsigned char encoding;  // æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„æŒ‡é’ˆ  unsigned char *p;&#125; zlentry;\n\n4.hashå“ˆå¸Œå¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ziplistå’Œhashtableä¹‹ä¸€ã€‚\n1ï¼‰ziplistziplistç¼–ç çš„å“ˆå¸Œå¯¹è±¡åº•å±‚å®ç°æ˜¯å‹ç¼©åˆ—è¡¨ï¼Œåœ¨ziplistç¼–ç çš„å“ˆå¸Œå¯¹è±¡ä¸­ï¼Œkey-valueé”®å€¼å¯¹æ˜¯ä»¥ç´§å¯†ç›¸è¿çš„æ–¹å¼æ”¾å…¥å‹ç¼©é“¾è¡¨çš„ï¼Œå…ˆæŠŠkeyæ”¾å…¥è¡¨å°¾ï¼Œå†æ”¾å…¥valueï¼›é”®å€¼å¯¹æ€»æ˜¯å‘è¡¨å°¾æ·»åŠ ã€‚\n\n2ï¼‰hashtable/* \\* å“ˆå¸Œè¡¨èŠ‚ç‚¹ */typedef struct dictEntry &#123;  // é”®  void *key;  // å€¼  union &#123;â€‹    void *val;â€‹    uint64_t u64;â€‹    int64_t s64;  &#125; v;  // æŒ‡å‘ä¸‹ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨  struct dictEntry *next;&#125; dictEntry;\n\n/* \\* å“ˆå¸Œè¡¨ * \\* æ¯ä¸ªå­—å…¸éƒ½ä½¿ç”¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œä»è€Œå®ç°æ¸è¿›å¼ rehash ã€‚ */typedef struct dictht &#123;  // å“ˆå¸Œè¡¨æ•°ç»„  dictEntry **table;  // å“ˆå¸Œè¡¨å¤§å°  unsigned long size;  // å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼  // æ€»æ˜¯ç­‰äº size - 1  unsigned long sizemask;  // è¯¥å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹çš„æ•°é‡  unsigned long used;&#125; dictht;\n\n/* \\* å­—å…¸ */typedef struct dict &#123;  // ç±»å‹ç‰¹å®šå‡½æ•°  dictType *type;  // ç§æœ‰æ•°æ®  void *privdata;  // å“ˆå¸Œè¡¨  dictht ht[2];  // rehash ç´¢å¼•  // å½“ rehash ä¸åœ¨è¿›è¡Œæ—¶ï¼Œå€¼ä¸º -1  int rehashidx; /* rehashing not in progress if rehashidx == -1 */  // ç›®å‰æ­£åœ¨è¿è¡Œçš„å®‰å…¨è¿­ä»£å™¨çš„æ•°é‡  int iterators; /* number of iterators currently running */&#125; dict;\n\nht[0]:å­—å…¸ä½¿ç”¨çš„dicthtå“ˆå¸Œè¡¨ï¼Œht[1]å“ˆå¸Œè¡¨è¿›è¡Œrehashæ—¶ä½¿ç”¨ã€‚\nrehashæ­¥éª¤ï¼š\nä¸ºå­—å…¸çš„ht[1]å“ˆå¸Œè¡¨åˆ†é…ç©ºé—´ï¼Œå¤§å°å°±æ˜¯ht[0].usedã€‚å°†ht[0]ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹rehashåˆ°ht[1]ä¸Šé¢ã€‚å½“ht[0]åŒ…å«çš„æ‰€æœ‰é”®éƒ½è¿ç§»åˆ°ht[1]ä¹‹åï¼Œé‡Šæ”¾ht[0]ï¼Œå°†ht[1]è®¾ç½®ä¸ºht[0]ï¼Œå¹¶åœ¨ht[1]æ–°å»ºä¸€ä¸ªç©ºç™½å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹æ¬¡rehashå‡†å¤‡ã€‚\n5.seté›†åˆå¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯intsetå’Œhashtableä¹‹ä¸€ã€‚\n1ï¼‰intsetç¼–ç intsetç¼–ç çš„é›†åˆå¯¹è±¡åº•å±‚å®ç°æ˜¯æ•´æ•°é›†åˆï¼Œæ‰€æœ‰å…ƒç´ éƒ½ä¿å­˜åœ¨æ•´æ•°é›†åˆä¸­ã€‚\n\n1.zsetæœ‰åºé›†åˆçš„ç¼–ç å¯ä»¥æ˜¯ziplistå’Œskiplistä¹‹ä¸€ã€‚\n1ï¼‰ziplistç¼–ç ziplistç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡åº•å±‚å®ç°æ˜¯å‹ç¼©åˆ—è¡¨ï¼Œå…¶ç»“æ„ä¸å“ˆå¸Œå¯¹è±¡ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ä¸¤ä¸ªç´§å¯†ç›¸è¿çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªä¿å­˜å…ƒç´ çš„åˆ†å€¼ï¼Œè€Œä¸”åˆ†å€¼å°çš„é è¿‘è¡¨å¤´ï¼Œå¤§çš„é è¿‘è¡¨å°¾ã€‚\n\n2ï¼‰skiplistç¼–ç skiplistç¼–ç çš„æœ‰åºé›†åˆå¯¹è±¡åº•å±‚å®ç°æ˜¯è·³è·ƒè¡¨å’Œå­—å…¸ä¸¤ç§ï¼›\næ¯ä¸ªè·³è·ƒè¡¨èŠ‚ç‚¹éƒ½ä¿å­˜ä¸€ä¸ªé›†åˆå…ƒç´ ï¼Œå¹¶æŒ‰åˆ†å€¼ä»å°åˆ°å¤§æ’åˆ—ï¼›èŠ‚ç‚¹çš„objectå±æ€§ä¿å­˜äº†å…ƒç´ çš„æˆå‘˜ï¼Œscoreå±æ€§ä¿å­˜åˆ†å€¼ï¼›\nå­—å…¸çš„æ¯ä¸ªé”®å€¼å¯¹ä¿å­˜ä¸€ä¸ªé›†åˆå…ƒç´ ï¼Œå­—å…¸çš„é”®ä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œå­—å…¸çš„å€¼ä¿å­˜åˆ†å€¼ã€‚\nè·³è·ƒè¡¨è§£å†³æ•°æ®æŸ¥è¯¢é—®é¢˜\n\n/* ZSETs use a specialized version of Skiplists *//* * è·³è·ƒè¡¨èŠ‚ç‚¹ */typedef struct zskiplistNode &#123;    // æˆå‘˜å¯¹è±¡    robj *obj;    // åˆ†å€¼    double score;    // åé€€æŒ‡é’ˆ    struct zskiplistNode *backward;    // å±‚    struct zskiplistLevel &#123;        // å‰è¿›æŒ‡é’ˆ        struct zskiplistNode *forward;        // è·¨åº¦        unsigned int span;    &#125; level[];&#125; zskiplistNode;\n\n/* * è·³è·ƒè¡¨ */typedef struct zskiplist &#123;    // è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹    struct zskiplistNode *header, *tail;    // è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡    unsigned long length;    // è¡¨ä¸­å±‚æ•°æœ€å¤§çš„èŠ‚ç‚¹çš„å±‚æ•°    int level;&#125; zskiplist;\n\n/* * æœ‰åºé›†åˆ */typedef struct zset &#123;    // å­—å…¸ï¼Œé”®ä¸ºæˆå‘˜ï¼Œå€¼ä¸ºåˆ†å€¼    // ç”¨äºæ”¯æŒ O(1) å¤æ‚åº¦çš„æŒ‰æˆå‘˜å–åˆ†å€¼æ“ä½œ    dict *dict;    // è·³è·ƒè¡¨ï¼ŒæŒ‰åˆ†å€¼æ’åºæˆå‘˜    // ç”¨äºæ”¯æŒå¹³å‡å¤æ‚åº¦ä¸º O(log N) çš„æŒ‰åˆ†å€¼å®šä½æˆå‘˜æ“ä½œ    // ä»¥åŠèŒƒå›´æ“ä½œ    zskiplist *zsl;&#125; zset;\n\n3.redisClient/* With multiplexing we need to take per-client state. * Clients are taken in a liked list. * * å› ä¸º I/O å¤ç”¨çš„ç¼˜æ•…ï¼Œéœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç»´æŒä¸€ä¸ªçŠ¶æ€ã€‚ * * å¤šä¸ªå®¢æˆ·ç«¯çŠ¶æ€è¢«æœåŠ¡å™¨ç”¨é“¾è¡¨è¿æ¥èµ·æ¥ã€‚ */typedef struct redisClient &#123;    // å¥—æ¥å­—æè¿°ç¬¦    int fd;    // å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“    redisDb *db;    // å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“çš„ id ï¼ˆå·ç ï¼‰    int dictid;    // å®¢æˆ·ç«¯çš„åå­—    robj *name;             /* As set by CLIENT SETNAME */    // æŸ¥è¯¢ç¼“å†²åŒº    sds querybuf;    // æŸ¥è¯¢ç¼“å†²åŒºé•¿åº¦å³°å€¼    size_t querybuf_peak;   /* Recent (100ms or more) peak of querybuf size */    // å‚æ•°æ•°é‡    int argc;    // å‚æ•°å¯¹è±¡æ•°ç»„    robj **argv;    // è®°å½•è¢«å®¢æˆ·ç«¯æ‰§è¡Œçš„å‘½ä»¤    struct redisCommand *cmd, *lastcmd;    // è¯·æ±‚çš„ç±»å‹ï¼šå†…è”å‘½ä»¤è¿˜æ˜¯å¤šæ¡å‘½ä»¤    int reqtype;    // å‰©ä½™æœªè¯»å–çš„å‘½ä»¤å†…å®¹æ•°é‡    int multibulklen;       /* number of multi bulk arguments left to read */    // å‘½ä»¤å†…å®¹çš„é•¿åº¦    long bulklen;           /* length of bulk argument in multi bulk request */    // å›å¤é“¾è¡¨    list *reply;    // å›å¤é“¾è¡¨ä¸­å¯¹è±¡çš„æ€»å¤§å°    unsigned long reply_bytes; /* Tot bytes of objects in reply list */    // å·²å‘é€å­—èŠ‚ï¼Œå¤„ç† short write ç”¨    int sentlen;            /* Amount of bytes already sent in the current                               buffer or object being sent. */    // åˆ›å»ºå®¢æˆ·ç«¯çš„æ—¶é—´    time_t ctime;           /* Client creation time */    // å®¢æˆ·ç«¯æœ€åä¸€æ¬¡å’ŒæœåŠ¡å™¨äº’åŠ¨çš„æ—¶é—´    time_t lastinteraction; /* time of the last interaction, used for timeout */    // å®¢æˆ·ç«¯çš„è¾“å‡ºç¼“å†²åŒºè¶…è¿‡è½¯æ€§é™åˆ¶çš„æ—¶é—´    time_t obuf_soft_limit_reached_time;    // å®¢æˆ·ç«¯çŠ¶æ€æ ‡å¿—    int flags;              /* REDIS_SLAVE | REDIS_MONITOR | REDIS_MULTI ... */    // å½“ server.requirepass ä¸ä¸º NULL æ—¶    // ä»£è¡¨è®¤è¯çš„çŠ¶æ€    // 0 ä»£è¡¨æœªè®¤è¯ï¼Œ 1 ä»£è¡¨å·²è®¤è¯    int authenticated;      /* when requirepass is non-NULL */    // å¤åˆ¶çŠ¶æ€    int replstate;          /* replication state if this is a slave */    // ç”¨äºä¿å­˜ä¸»æœåŠ¡å™¨ä¼ æ¥çš„ RDB æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦    int repldbfd;           /* replication DB file descriptor */    // è¯»å–ä¸»æœåŠ¡å™¨ä¼ æ¥çš„ RDB æ–‡ä»¶çš„åç§»é‡    off_t repldboff;        /* replication DB file offset */    // ä¸»æœåŠ¡å™¨ä¼ æ¥çš„ RDB æ–‡ä»¶çš„å¤§å°    off_t repldbsize;       /* replication DB file size */        sds replpreamble;       /* replication DB preamble. */    // ä¸»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡    long long reploff;      /* replication offset if this is our master */    // ä»æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘é€ REPLCONF ACK æ—¶çš„åç§»é‡    long long repl_ack_off; /* replication ack offset, if this is a slave */    // ä»æœåŠ¡å™¨æœ€åä¸€æ¬¡å‘é€ REPLCONF ACK çš„æ—¶é—´    long long repl_ack_time;/* replication ack time, if this is a slave */    // ä¸»æœåŠ¡å™¨çš„ master run ID    // ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œç”¨äºæ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥    char replrunid[REDIS_RUN_ID_SIZE+1]; /* master run id if this is a master */    // ä»æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£å·    int slave_listening_port; /* As configured with: SLAVECONF listening-port */    // äº‹åŠ¡çŠ¶æ€    multiState mstate;      /* MULTI/EXEC state */    // é˜»å¡ç±»å‹    int btype;              /* Type of blocking op if REDIS_BLOCKED. */    // é˜»å¡çŠ¶æ€    blockingState bpop;     /* blocking state */    // æœ€åè¢«å†™å…¥çš„å…¨å±€å¤åˆ¶åç§»é‡    long long woff;         /* Last write global replication offset. */    // è¢«ç›‘è§†çš„é”®    list *watched_keys;     /* Keys WATCHED for MULTI/EXEC CAS */    // è¿™ä¸ªå­—å…¸è®°å½•äº†å®¢æˆ·ç«¯æ‰€æœ‰è®¢é˜…çš„é¢‘é“    // é”®ä¸ºé¢‘é“åå­—ï¼Œå€¼ä¸º NULL    // ä¹Ÿå³æ˜¯ï¼Œä¸€ä¸ªé¢‘é“çš„é›†åˆ    dict *pubsub_channels;  /* channels a client is interested in (SUBSCRIBE) */    // é“¾è¡¨ï¼ŒåŒ…å«å¤šä¸ª pubsubPattern ç»“æ„    // è®°å½•äº†æ‰€æœ‰è®¢é˜…é¢‘é“çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯    // æ–° pubsubPattern ç»“æ„æ€»æ˜¯è¢«æ·»åŠ åˆ°è¡¨å°¾    list *pubsub_patterns;  /* patterns a client is interested in (SUBSCRIBE) */    sds peerid;             /* Cached peer ID. */    /* Response buffer */    // å›å¤åç§»é‡    int bufpos;    // å›å¤ç¼“å†²åŒº    char buf[REDIS_REPLY_CHUNK_BYTES];&#125; redisClient;\n\n4.zskiplist  è·³è·ƒè¡¨åƒè¿™ç§é“¾è¡¨åŠ å¤šçº§ç´¢å¼•çš„ç»“æ„ï¼Œå°±æ˜¯è·³è·ƒè¡¨ï¼\n/* ZSETs use a specialized version of Skiplists *//* * è·³è·ƒè¡¨èŠ‚ç‚¹ */typedef struct zskiplistNode &#123;    // æˆå‘˜å¯¹è±¡    robj *obj;    // åˆ†å€¼    double score;    // åé€€æŒ‡é’ˆ    struct zskiplistNode *backward;    // å±‚    struct zskiplistLevel &#123;        // å‰è¿›æŒ‡é’ˆ        struct zskiplistNode *forward;        // è·¨åº¦        unsigned int span;    &#125; level[];&#125; zskiplistNode;/* * è·³è·ƒè¡¨ */typedef struct zskiplist &#123;    // è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹    struct zskiplistNode *header, *tail;    // è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡    unsigned long length;    // è¡¨ä¸­å±‚æ•°æœ€å¤§çš„èŠ‚ç‚¹çš„å±‚æ•°    int level;&#125; zskiplist;\n\nredisæŒä¹…åŒ–ï¼ˆæ•°æ®ä¸¢å¤±é—®é¢˜ï¼‰RDBredisæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼Œä¹Ÿå«redisæ•°æ®å¿«ç…§ï¼Œå°†å†…å­˜ä¸­æ‰€æœ‰æ•°æ®è®°å½•åˆ°ç£ç›˜ä¸­ã€‚å½“rediså®ä¾‹æ•…éšœé‡å¯åï¼Œä»ç£ç›˜è¯»å–å¿«ç…§æ–‡ä»¶ï¼Œæ¢å¤æ•°æ®\nbgsaveå¼€å§‹ä¼šforkä¸»è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å…±äº«ä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚å®Œæˆforkåè¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥RDBæ–‡ä»¶\nforkæµç¨‹ï¼šè¿›ç¨‹ä¸ç›´æ¥æ“ä½œç‰©ç†å†…å­˜ï¼Œè€Œç”±æ“ä½œç³»ç»Ÿè·å–ç‰©ç†å†…å­˜æ˜ å°„çš„é¡µè¡¨ã€‚å­è¿›ç¨‹ç›´æ¥forkä¸»è¿›ç¨‹çš„é¡µè¡¨å°±è·å¾—äº†ä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®\nforké‡‡ç”¨copy-on-writeæŠ€æœ¯ï¼š\n\nå½“ä¸»è¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œï¼Œè®¿é—®å…±äº«å†…å­˜\nå½“ä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œï¼Œåˆ™ä¼šæ‹·è´ä¸€ä»½æ•°æ®ï¼Œæ‰§è¡Œå†™æ“ä½œ\n\nRDBç¼ºç‚¹ï¼š\n\nRDBæ‰§è¡Œé—´éš”æ—¶é—´é•¿ï¼Œä¸¤æ¬¡RDBä¹‹é—´å†™æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©\nforkå­è¿›ç¨‹ã€å‹ç¼©ã€å†™å‡ºRDBæ–‡ä»¶éƒ½æ¯”è¾ƒè€—æ—¶\n\nAOFAppend Only File(è¿½åŠ æ–‡ä»¶)ã€‚rediså¤„ç†çš„æ¯ä¸€ä¸ªå†™çš„å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶\nredisä¸»ä»é›†ç¾¤ï¼ˆå¹¶å‘èƒ½åŠ›é—®é¢˜ï¼‰å¯åŠ¨å¤šä¸ªå®ä¾‹ï¼Œæ‰§è¡Œ slaveof ä¸»èŠ‚ç‚¹åœ°å€ï¼Œå³å¯å®Œæˆä¸»ä»é›†ç¾¤çš„æ­å»º\næ•°æ®åŒæ­¥åŸç†ä¸»ä»ç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å…¨é‡åŒæ­¥bgsaveå°†å†…å­˜ç”ŸæˆRDBå¿«ç…§ï¼Œå‘é€RDBæ–‡ä»¶ç»™ä»èŠ‚ç‚¹\nå…¨é‡åŒæ­¥æµç¨‹ï¼š\n\nslaveèŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥replidå’Œåç§»é‡offset\nmasterèŠ‚ç‚¹åˆ¤æ–­replidï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥\nmasterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slave\nslaveæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½masterçš„RDB\nmasterå°†RDBæœŸé—´çš„å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œå¹¶æŒç»­å°†logä¸­å‘½ä»¤å‘é€ç»™slave\nslaveæ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸masterä¹‹é—´çš„åŒæ­¥\n\nrepl_baklogå¤§å°æœ‰ä¸Šé™ï¼ˆç¯çŠ¶çš„æ•°ç»„ï¼‰ï¼Œå†™æ»¡åä¼šè¦†ç›–æœ€æ—©çš„æ•°æ®ã€‚å¦‚æœslaveæ–­å¼€æ—¶é—´è¿‡ä¹…ï¼Œå¯¼è‡´æ•°æ®è¢«è¦†ç›–ï¼Œåˆ™æ— æ³•å®ç°å¢é‡åŒæ­¥ï¼Œåªèƒ½å†æ¬¡å…¨é‡åŒæ­¥\nrediså“¨å…µï¼ˆæ•…éšœæ¢å¤é—®é¢˜ï¼‰å“¨å…µçš„ä½œç”¨ï¼š\n\nç›‘æ§ï¼šsentinelä¼šä¸æ–­æ£€æŸ¥masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼ˆå¿ƒè·³æœºåˆ¶ç›‘æµ‹ï¼‰\nè‡ªåŠ¨æ•…éšœæ¢å¤ï¼šå¦‚æœmasteræ•…éšœï¼Œsentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœæ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»\né€šçŸ¥ï¼šsentinelå……å½“rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€åˆ°rediså®¢æˆ·ç«¯\n\næ•…éšœè½¬ç§»æ­¥éª¤ï¼š\n\né¦–å…ˆé€‰å®šä¸€ä¸ªslaveä½œä¸ºæ–°çš„masterï¼Œæ‰§è¡Œ slaveof no oneï¼ˆæˆä¸ºmasterï¼‰\nè®©æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œslaveof æ–°master\nä¿®æ”¹æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œæ·»åŠ slaveofæ–°master\n\nredisåˆ†ç‰‡é›†ç¾¤ï¼ˆå­˜å‚¨èƒ½åŠ›é—®é¢˜ï¼‰æ•£åˆ—æ’æ§½redisä¼šæŠŠæ¯ä¸€ä¸ªmasterèŠ‚ç‚¹æ˜ å°„åˆ°0-16383å…±16384ä¸ªæ’æ§½æ•°æ®keyä¸æ’æ§½ç»‘å®šï¼Œredisæ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—æ’æ§½å€¼è®¿é—®é›†ç¾¤å†…ä»»æ„èŠ‚ç‚¹ï¼Œéƒ½ä¼šè®¡ç®—å‡ºæ’æ§½å€¼ï¼Œä¹‹åé‡å®šå‘åˆ°å¯¹åº”èŠ‚ç‚¹\n","categories":["ä¸­é—´ä»¶"],"tags":["å­¦ä¹ ","æºç "]},{"title":"å›½ç½‘å‘ç¥¨ä¸šåŠ¡è§„åˆ™æ•´ç†","url":"/java4u/2022/04/20/%E5%9B%BD%E7%BD%91%E5%8F%91%E7%A5%A8%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99%E6%95%B4%E7%90%86/","content":"åŠŸèƒ½æ¦‚è¿°ä»»ä½•è´¹ç”¨äº§ç”Ÿçš„ä¸šåŠ¡æˆ–æ”¶è´¹åŠ¨ä½œéƒ½è¦äº§ç”Ÿå‘ç¥¨ã€‚å›½ç½‘æš‚å®šåªæœ‰æœˆç»“å‘ç¥¨å’Œä¸€æ¬¡æ€§å‘ç¥¨ï¼Œä¸€æ¬¡æ€§å‘ç¥¨ç”±è´­ä¹°ç‰©å“äº§ç”Ÿï¼Œæœˆç»“å‘ç¥¨åœ¨æœˆæœ«æ—¶ç»Ÿä¸€ç”Ÿæˆæœˆç»“å‘ç¥¨å‘é€ç»™å®¢æˆ·ã€‚\nä¸šåŠ¡æµç¨‹1.å‘ç¥¨é¢„ç”Ÿæˆæµç¨‹1.1ä¸€æ¬¡æ€§å‘ç¥¨é¢„ç”Ÿæˆ1.æŸ¥è¯¢ä¸€æ¬¡æ€§è´¹ç”¨ä¿¡æ¯2.æŸ¥è¯¢ç¥¨æ®æ‰“å°ä¿¡æ¯3.åˆ¤æ–­è¯¥æµæ°´èƒ½å¦æ‰“å°å‘ç¥¨4.æ’ç¥¨æ®æ‰“å°æ—¥å¿—5.æ’ç¥¨æ®ä¿¡æ¯6.è®°å½•å‘ç¥¨é¡¹ç›®ä¿¡æ¯è¡¨\n\n1.2æœˆç»“å‘ç¥¨é¢„ç”ŸæˆæŒ‰è´¦æˆ·ç”Ÿæˆæœˆç»“å‘ç¥¨æ—¶ï¼Œä¸€æ¡æ‰“å°è®°å½•ï¼ŒæŒ‰ç…§ç”¨æˆ·ç”Ÿæˆå¤šæ¡ç¥¨æ®æ˜ç»†\n1.æŒ‰ç…§è´¦æˆ·ã€è´¦æœŸæŸ¥è¯¢æ¬ è´¹è´¦å•2.æŸ¥è¯¢é”€è´¦è½¨è¿¹\n\n\n\n2.å‘ç¥¨å¼€å…·æµç¨‹1.æ ¹æ®å¤–éƒ¨ä¼ å…¥çš„ç¥¨æ®æ‰“å°æ—¶é—´è·å–åˆ†è¡¨å­—æ®µ2.è·å–ç¥¨æ®æ‰“å°ä¿¡æ¯3.æ ¡éªŒç¥¨æ®ï¼šå‘ç¥¨æ€»é‡‘é¢ä¸º0æ—¶ï¼Œä¸å…è®¸ç”³è¯·ç”µå­å‘ç¥¨            æ”¶æ®ä¸å…è®¸ç”³è¯·ç”µå­å‘ç¥¨4.æŸ¥è¯¢ç¥¨æ®è¯¦ç»†ä¿¡æ¯5.è·å–å‘ç¥¨ç¨æ”¶ç¼–ç æ˜ç»†6.ç»„ç»‡å‘ç¥¨éœ€è¦çš„ä¿¡æ¯  1ï¼‰ç”Ÿæˆè¯·æ±‚æµæ°´å·  2ï¼‰ç”Ÿæˆç¥¨æ®å…¶ä»–ä¿¡æ¯7.å‘é€ç¨æ§ç³»ç»Ÿå¼€å…·å‘ç¥¨8.å¼€å…·æˆåŠŸå›å†™å‘ç¥¨å·ç ã€ä»£ç ç­‰ä¿¡æ¯\n\n3.å‘ç¥¨å†²çº¢æµç¨‹å¯ä»¥çœ‹ä½œå†²çº¢å‘ç¥¨çš„é¢„ç”Ÿæˆè¿‡ç¨‹\n1.æŸ¥è¯¢åŸç¥¨æ®æ‰“å°ä¿¡æ¯å’Œç¥¨æ®ä¿¡æ¯2.æ ¡éªŒåŸç¥¨ä¿¡æ¯ï¼ŒåŸç¥¨å°šæœªå¼€å…·çš„ä¸å…è®¸å†²çº¢3.æ›´æ–°åŸç¥¨çŠ¶æ€ä¿¡æ¯4.ç”Ÿæˆçº¢ç¥¨æ‰“å°ä¿¡æ¯ã€ç¥¨æ®ä¿¡æ¯å’Œç¥¨æ®é¡¹ç›®ä¿¡æ¯\n","categories":["é¡¹ç›®æµç¨‹"],"tags":["ä¸šåŠ¡"]},{"title":"è´¦ç®¡ä¸šåŠ¡æµç¨‹","url":"/java4u/2022/04/20/%E8%B4%A6%E7%AE%A1%E6%B5%81%E7%A8%8B/","content":"æ•´ç†è®°å½•è´¦ç®¡ä¸»è¦ä¸šåŠ¡æµç¨‹\n1.æŸ¥æ¬ åŠŸèƒ½ï¼šæŸ¥è¯¢å®¢æˆ·çš„æ¬ è´¹ï¼Œè´¦å•/è´¦æœ¬ä¿¡æ¯ä»¥åŠè™šé”€ä¿¡æ¯ã€‚æ­¥éª¤ï¼š    1.æŸ¥è¯¢å¾€æœˆã€å®æ—¶è´¦å•    2.æŸ¥è¯¢å†å²è´¦å•ï¼Œå®æ—¶è´¦å•å’Œå†å²è´¦å•åˆå¹¶    3.æŸ¥è¯¢æ‰€æœ‰è´¦æœ¬ä¿¡æ¯    4.è°ƒç”¨è™šé”€æ¥å£ï¼Œå†²é”€è¯¥è´¦æˆ·ä¸‹æ‰€æœ‰è´¦æœ¬å’Œè´¦å•    æ¶‰åŠè¡¨ï¼š    AM_BILL_ITEM     è´¦å•æœªé”€è´¦æ¬ è´¹è¡¨    AM_BALANCE       é€šä¿¡è´¦æœ¬æœˆè¡¨    AM_ACCT_DEBT     æ¬ è´¹è¡¨\n\n2.è´¦æˆ·å……å€¼åŠŸèƒ½ï¼šå±•ç¤ºå®¢æˆ·çš„è´¦æˆ·ä½™é¢ä»¥åŠæ¬ è´¹æƒ…å†µã€‚æ”¯æŒç»™å®¢æˆ·æŒ‡å®šçš„è´¦æœ¬è¿›è¡Œç¼´è´¹æ­¥éª¤ï¼š    1.å…¥è´¦ï¼šå†™è´¦æœ¬è¡¨ï¼Œæ¥æºè¡¨ï¼Œç¼´è´¹æ—¥å¿—    2.åˆ¤æ–­æ˜¯å¦é”€è´¦ï¼ˆæ˜¯å¦æ¬ è´¹ï¼‰    3.å¦‚æœæ¬ è´¹ï¼Œæ ¹æ®å†²é”€çš„è´¦å•è®¡ç®—æ¬ è´¹æƒ…å†µï¼Œæ›´æ–°è´¦æœ¬å’Œæ¬ è´¹è´¦å•è¡¨    4.èµ„äº§ä¸Šå‘    ä¸»è¦æœåŠ¡ï¼šasset_IPaymentCSV_asyncPayment   å¼‚æ­¥ç¼´è´¹æ¥å£        è°ƒç”¨ RechargeLogic å…¥è´¦é€»è¾‘å±‚çš„ doRechargeï¼ˆï¼‰ç¼´è´¹å…¥è´¦æ–¹æ³•                setPayTradeï¼ˆï¼‰è®¾ç½®äº¤æ˜“ä¿¡æ¯                ç”Ÿæˆç¼´è´¹å·¥å•\n\nèµ„äº§ä¸Šå‘    åŠŸèƒ½ï¼šå†™èµ„äº§ä¸Šå‘è¡¨ï¼Œä¸Šå‘è®¡è´¹å¸å¤„    é€»è¾‘ï¼š\n3.ç¼´è´¹è¿”é”€åŠŸèƒ½ï¼šæ’¤é”€å……å€¼ï¼Œå›é€€è´¦æœ¬å’Œè´¦å•æ­¥éª¤ï¼š        1.æ›´æ–°ä¹‹å‰çš„AM_BUSIæ•°æ®ï¼Œè®°å½•è¿”é”€ä¿¡æ¯        2.æ–°æ’å…¥AM_BUSIä¸€æ¡è¿”é”€ä¿¡æ¯\n\n4.ä¿¡æ§ç®¡ç†1.è´¦åŠ¡åœå¼€æœº    å¯¹å®¢æˆ·ä¸‹çš„ç”¨æˆ·åˆ†ä¸šåŠ¡çº§åˆ«åœå¼€æœºæ“ä½œ    é€»è¾‘ï¼š        è¥ä¸šå‘˜æˆ–è¿ç»´äººå‘˜å®šä½éœ€è¦åšè´¦åŠ¡åœå¼€æœºçš„å®¢æˆ·ã€‚        è¥ä¸šå‘˜é€‰æ‹©ç”¨æˆ·åï¼Œä¼šåŠ è½½ç”¨æˆ·ä¸‹å¯¹åº”çš„åˆ†ä¸šåŠ¡åœå¼€æœºçŠ¶æ€ï¼Œè¥ä¸šå‘˜å¯¹å…¶è¿›è¡Œåœå¼€æœºåŠ¨ä½œã€‚        å·²å¼€/åœæœºçš„åˆ†ä¸šåŠ¡ä¸å…è®¸å†æ¬¡å¼€/åœæœºï¼Œå¼€æœºæ“ä½œä¼šè‡ªåŠ¨è§¦å‘æ–°å¢å…å‚¬å…åœï¼Œèµ·å§‹æ—¶é—´ä¸ºæ“ä½œæ—¶é—´ï¼Œç»“æŸæ—¶é—´å¯é€‰ï¼Œé»˜è®¤ä¸ºä¸€ä¸ªæ˜ŸæœŸã€‚        è´¦ç®¡ç³»ç»Ÿè®°å½•æ“ä½œæ—¥å¿—å¹¶å°†ä¿¡æ§åŠ¨ä½œä¸Šå‘CRMæ“ä½œã€‚        æ¶‰åŠè¡¨ï¼š        AM_OWE_NO_PRESS_STOP    å…å‚¬å…åœæ“ä½œè®°å½•è¡¨        AM_ACCT_FORCE_STOP_OPEN_REC   åœå¼€æœºæ“ä½œè®°å½•è¡¨        2.ä¿¡ç”¨åº¦æŸ¥è¯¢ã€ä¿®æ”¹    é€»è¾‘ï¼š        é€‰æ‹©å®¢æˆ·åé€šè¿‡ACCTIDå‚æ•°è‡ªåŠ¨è°ƒç”¨è´¦å¤„æŸ¥è¯¢ä¿¡ç”¨åº¦æ¥å£è¿”å›è´¦æˆ·çº§ä¿¡ç”¨åº¦ã€‚ï¼ˆæŸ¥è¯¢ä¿¡ç”¨åº¦æ¥å£å…·ä½“çš„æ¶ˆæ¯å·QUERY_Credit_UP(858)ï¼‰        è¿”å›ä¿¡ç”¨åº¦å¹¶è¿”å›assetId,åé¢ç”¨æˆ·å¯é€‰æ‹©æŸ¥è¯¢çš„ä¿¡ç”¨åº¦é€šè¿‡acctidä»¥åŠassetIdæŸ¥è¯¢åˆ°å¯¹åº”çš„ä¿¡ç”¨åº¦è¿›è¡Œä¿®æ”¹ç„¶åç›´æ¥ä¸Šå‘è´¦å¤„è¡¨ã€‚            æ¶‰åŠè¡¨ï¼š        CA_CREDIT     ä¿¡ç”¨åº¦è¡¨        CA_ASSET_SYN_XX  åŒæ­¥é€šçŸ¥è¡¨\n\n5.ç»¼åˆæŸ¥è¯¢1.è´¦å•æŸ¥è¯¢    é€»è¾‘ï¼š        è´¦å•ä¿¡æ¯æŸ¥è¯¢ï¼Œé€šè¿‡é€‰æ‹©çš„å®¢æˆ·ä¿¡æ¯ï¼Œè´¦å•æ‰€åœ¨æ—¥æœŸåŒºé—´ï¼Œè°ƒç”¨æŸ¥æ¬ æ¥å£æŸ¥è¯¢å®¢æˆ·è´¦å•ä¿¡æ¯ï¼Œ        å¹¶æ ¹æ®è´¦æœŸç”±è¿‘åˆ°è¿œè¿›è¡Œæ±‡æ€»å±•ç¤ºï¼Œåœ¨åŒå‡»æŸä¸€æ¡è´¦æœŸæ±‡æ€»è´¦å•æ—¶ï¼Œå±•ç¤ºæ¯ä¸€ä¸ªè´¦æœŸçš„è¯¦ç»†è´¦å•ä¿¡æ¯ã€‚\n\n6.å¸åŠ¡ç¨½æ ¸ä¸€.é¢„å­˜æ¸…é€€ï¼ˆé€€è´¦æœ¬ä¸Šçš„é’±ï¼‰            1.æŸ¥è¯¢å¯æ¸…é€€å­˜æŠ˜                    æŸ¥è¯¢å­˜æŠ˜                    æ‰£å‡æ¬ è´¹ï¼ˆé»˜è®¤ä¸æ‰£å‡ï¼‰                    è¿‡æ»¤æ‰æ— æ³•æ¸…é€€çš„å­˜æŠ˜            2.è®¾ç½®æ¸…é€€æˆ–è€…è½¬å‡ºå­˜æŠ˜            3.æ›´æ–°å­˜æŠ˜ä»¥åŠæ—¥å¿—                    è·å–è´¦æœ¬                    è¿‡æ»¤æŠ¼é‡‘è´¦æœ¬                    è®¡ç®—éœ€è¦æ¸…é€€çš„é‡‘é¢                    æ›´æ–°å­˜æŠ˜                    è®°å½•è´¦æœ¬æ”¯å‡º                    æ’ç¼´è´¹æ¥å£è¡¨                    æ›´æ–°ä¸šåŠ¡æ—¥å¿—            4.æ›´æ–°ç»Ÿè®¡busiè¡¨            5.èµ„äº§ä¸Šå‘            äºŒ.è½¬è´¦        1.è·å–å¯è½¬å‡ºå­˜æŠ˜        2.è®¾ç½®è½¬å‡ºå­˜æŠ˜        3.æ›´æ–°è½¬å‡ºå­˜æŠ˜        4.è®¾ç½®è½¬å…¥å­˜æŠ˜        5.æ›´æ–°è½¬å…¥å­˜æŠ˜        ä¸‰.è´¦å•è°ƒè´¦ï¼ˆå¸å‰è°ƒè´¦ï¼Œè´¦å•è¿˜åœ¨MDB  è´¦åè°ƒè´¦ï¼Œè´¦å•åœ¨è´¦ç®¡ï¼‰    è´¦å•é¢„è°ƒè´¦ï¼ˆè´¦å‰è°ƒè´¦ï¼‰            1.æ›´æ–°è°ƒè´¦ä¸»è¡¨                       AM_ADJUST            2.æ›´æ–°è°ƒè´¦å­è¡¨                         AM_ADJUST_BILL            3.å†™è®¡è´¹å¤–éƒ¨æ•°æ®å¯¼å…¥è¡¨    CA_EXT_DATA            4.å†™è°ƒè´¦æ¥å£è¡¨                    I_ADJUST                è´¦å•è°ƒè´¦ï¼ˆè´¦åè°ƒè´¦ï¼‰            1.æŸ¥è¯¢è´¦å•            2.åˆ¤æ–­è´¦å•é‡‘é¢ä¸è°ƒè´¦é‡‘é¢            3.è°ƒé«˜è°ƒä½                æ¬ è´¹è°ƒä½  &quot;R&quot;                        è®¡ç®—è°ƒè´¦é‡‘é¢                        ä¿®æ”¹è´¦å•é‡‘é¢                æ¬ è´¹è°ƒé«˜  &quot;A&quot;                        æ·»åŠ åº”æ”¶æ•°æ®    AM_BILL_AR                                    4.è°ƒä½çš„æ—¶å€™æ›´æ–°æ¬ è´¹è¡¨                è°ƒæ”¹çš„æ—¶å€™æ–°å¢æ¬ è´¹ä¿¡æ¯            5.æ›´æ–°æ¬ è´¹é‡‘é¢       AM_ACCT_DEBT            6.è°ƒè´¦ä¸»è¡¨ã€å­è¡¨æ›´æ–°\n\n7.é”€è´¦è¿™é‡Œçš„é”€è´¦ç³»ç»Ÿç‰¹æŒ‡å¼‚æ­¥é”€è´¦æˆ–è€…è¡¥é”€è´¦ï¼Œé’ˆå¯¹ç”¨æˆ·å½“å‰è´¦å•å’Œå†å²è´¦å•çš„é”€è´¦ï¼Œä¸€èˆ¬é€šè¿‡æ¥å£è°ƒç”¨æˆ–è€…å·¥å•å¤„ç†ç³»ç»Ÿè§¦å‘ã€‚æ¶‰åŠè¡¨ï¼š    AM_SPE_PAYMENT     ä¸“æ¬¾ä¸“ç”¨è¡¨    AM_BILL_TYPE       è´¦å•ç§‘ç›®è¡¨    AM_BILL_TYPE_CLASS è´¦å•ç§‘ç›®åˆ†ç±»è¡¨        AM_ASSET_SPE_DEF    è´¦æœ¬é»˜è®¤ä¸“æ¬¾æ ‡è¯†    AM_SPE_PAYMENT      ä¸“æ¬¾ä¸“ç”¨è¯¦æƒ…    AM_ASSET_TYPE       è´¦æœ¬ç§‘ç›®    AM_ASSET_TYPE_CLASS è´¦æœ¬ç§‘ç›®åˆ†ç±»    æ­¥éª¤ï¼š    1.æŸ¥æ‰¾è´¦æœ¬    2.æŸ¥è¯¢æ¬ è´¹ä¿¡æ¯ï¼ˆæœˆç»“åº”æ”¶ï¼‰        å½“å‰è´¦æœŸ            ä¸é”€è´¦        ä¸æ˜¯å½“å‰è´¦æœŸ        æŸ¥è¯¢å†å²åº”æ”¶æ˜ç»†    3.æŒ‰ç…§ä¼˜å…ˆçº§é”€è´¦\n\nå¼‚æ­¥é”€è´¦ç°åœ¨æ‰¹é”€åçš„æ•°æ®ï¼Œè¿›å…¥æ‰¹é‡å¼‚æ­¥å·¥å•å¤„ç†\n\nBatchCalcç±»ä¸­è°ƒç”¨singleCalc()åœ¨æœ‰å¾€æœˆæ¬ è´¹å¹¶ä¸”æŠµæ‰£åæœ‰å‰©ä½™çš„é¢„å­˜çš„æƒ…å†µä¸‹ï¼Œå†™å…¥å¼‚æ­¥é”€è´¦è¡¨ï¼ˆå…ˆæ”¹ä¸ºbatchè¡¨ï¼‰\n\næ‰¹é‡é”€è´¦    1.ç¨‹åºå…¥å£   WriteoffMain  é…ç½® é€šé“å·    2.æ‰§è¡Œé¡ºåº                 produce              initCalc            åˆå§‹åŒ–é€šé“ä¿¡æ¯              changeCycleFlag   ä¿®æ”¹è´¦æœŸçŠ¶æ€,è¿›å…¥æŠµæ‰£æœŸé—´              calcBatchNo       è®¡ç®—è¯¥é€šé“æ¯ä¸ªæ‰¹æ¬¡çš„å¼€å§‹å€¼å’Œç»“æŸå€¼              batchWriteOffCalc æŒ‰æ‰¹æ¬¡åŠ è½½æ•°æ®è¿›è¡ŒæŠµæ‰£è®¡ç®—                  3.batchRanges è®¡ç®—æ‰¹æ¬¡        4.batchWriteOffCalc            batchWriteOffCalc   åŠ è½½æŠµæ‰£æ‰€éœ€è´¦åŠ¡æ•°æ®            startId   endId     åˆ†åŒºID            bizEntryTl  ä½œç”¨,å®¢æˆ·è´¦æœ¬ã€è´¦å•ã€é”€è´¦æ•°æ®        Monitor.addAllCount(entrys.size());   ç›‘è§†ï¼Ÿ        dispatchè°ƒç”¨å“ªä¸ªæ–¹æ³•  executeå‡½æ•°        BatchWriteOffCalculator  è´¦æœ¬ã€è´¦å•é¢„å…ˆæ’åºï¼ˆè®¾ç½®è´¦æœ¬æ—¶åŒæ—¶æ’åºï¼‰        é”€è´¦å®Œå‘å¼‚æ­¥é”€è´¦é€šçŸ¥ï¼ˆæœ‰å¾€æœˆæ¬ è´¹å¹¶ä¸”æŠµæ‰£åæœ‰å‰©ä½™çš„é¢„å­˜ï¼‰        WFileUtil InDBå†™å…¥æ–‡ä»¶ï¼Œå†™å…¥æ–‡ä»¶å¦‚æœæ˜¯å¤šçº¿ç¨‹æ··åˆå†™å…¥ï¼Œä¼šåŠ é”    BalOutFormater ä¸  writeoff-indb.xml é…ç½®çš„å­—æ®µéœ€è¦ä¸€è‡´        å½“æœˆè´¦å•ï¼ˆSæ–‡ä»¶ï¼‰  è´¦æœ¬    é”€è´¦  ---ã€‹ é”€è´¦è½¨è¿¹ä»€ä¹ˆæƒ…å†µä¸Šå‘ï¼Ÿ    éœ€è¦        æ¬ è´¹å¢åŠ                 æ¬ è´¹å‡å°‘ï¼Œè´¦æœ¬å†²é”€å®Œ    ä¸éœ€è¦        æ¬ è´¹å‡å°‘  è´¦æœ¬è¿˜æœ‰é’±ï¼ˆå¼‚æ­¥å†²é”€ï¼‰    ä¸Šå‘ä»€ä¹ˆæ•°æ®ï¼Ÿ    è´¦æœ¬æ•°æ®        OweQueueTask  æ‰¹é‡ä¸Šå‘\n\n8.æ‰˜æ”¶ä¸€ã€æ‰˜æ”¶ç­¾çº¦å®¢æˆ·-ã€‹é“¶è¡Œ-ã€‹ç­¾çº¦     å°†è¦æ‰˜æ”¶        am_entrust_relation      ç­¾çº¦å…³ç³»è¡¨          am_entrust_relation_his                    1.å‚æ•°æ ¡éªŒå’Œåˆå§‹åŒ–ï¼ˆå®¢æˆ·ä¿¡æ¯ã€å®¢æˆ·ä¿¡ç”¨åº¦ç­‰çº§ã€å§”æ‰˜å…³ç³»ï¼‰2.æ”¯ä»˜ç”¨æˆ·  åˆ é™¤ä¹‹å‰çš„ç­¾çº¦å…³ç³»ï¼Œæ–°å»ºç­¾çº¦å…³ç³»  æ™®é€šç”¨æˆ·  æ›´æ–°ç­¾çº¦å…³ç³»  3.é€šçŸ¥CRMä¿®æ”¹æ”¯ä»˜æ–¹å¼4.é¢„ä»˜è´¹è´¦æˆ·éœ€è¦é€šçŸ¥è´¦å¤„ä¿®æ”¹ä¿¡ç”¨åº¦\n\näºŒã€æ‰˜æ”¶è§£çº¦1.åˆ¤æ–­æ˜¯å¦æ‰˜æ”¶åœ¨é€”ï¼Œæ­£åœ¨æ‰˜æ”¶ä¸è§£çº¦ ï¼ˆæŸ¥è¯¢æ‰˜æ”¶ç”Ÿæˆæ˜ç»†ï¼‰2.æ›´æ–°åŸæ‰˜æ”¶å…³ç³»ä¸ºä½œåºŸ\n\nä¸‰ã€æ‰˜æ”¶å‘èµ·ï¼ˆè½è¡¨ï¼‰        am_entrust_create_notify     æ‰˜æ”¶å‘èµ·é€šçŸ¥è¡¨ï¼ˆ EntrustCreateTask è¿›ç¨‹æ‰«æï¼‰ ï¼ˆæ¥æºï¼šå‰å°é¡µé¢å¯¼å…¥æˆ–æ”¯ä»˜å‘èµ·è¿›ç¨‹ï¼‰                am_entrust_create_dtl         æ‰˜æ”¶ç”Ÿæˆæ˜ç»†è¡¨(å¹´æœˆè¡¨)  éªŒè¯æ‰˜æ”¶ä¿¡æ¯    ï¼ˆæ‰˜æ”¶å‘èµ·è¿›ç¨‹ç”Ÿæˆçš„ï¼ŒæŒ‰æ‰¹æ¬¡ç”Ÿæˆå…·ä½“çš„æ‰˜æ”¶ä¿¡æ¯ï¼‰                am_entrust_payboss_notify    ç¬¬ä¸‰æ–¹é€šçŸ¥è¡¨   æ”¯ä»˜å®        1.æ”¯ä»˜å®å‘é€æ–‡ä»¶æˆ–BOSSå‰å°å‘èµ·æ‰˜æ”¶è¯·æ±‚2.æ’å…¥æ‰˜æ”¶å‘èµ·é€šçŸ¥è¡¨3.æ‰˜æ”¶ç”Ÿæˆè¿›ç¨‹ EntrustCreateTask æ‰«ææ‰˜æ”¶é€šçŸ¥è¡¨ï¼Œç”Ÿæˆæ‰˜æ”¶æ˜ç»†æ•°æ®ï¼ˆæ ¹æ®1æ¡é€šçŸ¥è¡¨æ•°æ®ï¼ŒæŸ¥è¯¢ç­¾çº¦è¡¨ï¼Œå»ç”Ÿæˆæ‰€æœ‰å®¢æˆ·çš„æ˜ç»†è¡¨æ•°æ®ï¼Œç”Ÿæˆæ˜ç»†è¡¨æ•°æ®çŠ¶æ€ä¸º5ï¼‰    \n\nå››ã€æ‰˜æ”¶ç®—è´¹   EntrustQryFeeTaskç®—è´¹è¿›ç¨‹    am_entrust_create_dtl   æ›´æ–°æ˜ç»†è¡¨ï¼Œè®¡ç®—å‡ºè´¹ç”¨æ‰˜æ”¶ç®—è´¹    1ï¼‰æŸ¥è¯¢æ‰˜æ”¶å…³ç³»æ•°æ®    2ï¼‰æŸ¥è¯¢æ‰˜æ”¶ç”Ÿæˆæ˜ç»†æ•°æ®    3ï¼‰æ ¹æ®è´¦æˆ·IDæŸ¥è¯¢æ˜¯å¦æœ‰æœªç”³è¯·åœæœºç”¨æˆ·    4ï¼‰æ‰˜æ”¶ç®—è´¹è®¡ç®—é‡‘é¢            1.æŸ¥è¯¢ä¸šåŠ¡ç±»å‹å¯¹åº”çš„åˆ†ä¸šåŠ¡            2.æŸ¥æ¬ ï¼Œç„¶åè®¡ç®—æ•°å­—åŸºæœ¬å’Œäº’åŠ¨åŸºæœ¬è´¹ç”¨ï¼ˆè®¡ç®—æ¬ è´¹é‡‘é¢ï¼‰            3.è´¦æœ¬æŒ‰ç…§åˆ†ä¸šåŠ¡æ±‡æ€»            4.åˆ†ä¸šåŠ¡è®¡ç®—è´¦æœ¬é‡‘é¢               \n\näº”ã€æ‰˜æ”¶æ–‡ä»¶å‘é€  -ã€‹é“¶è¡Œ    EntrustCreateFileTask è¿›ç¨‹ç”Ÿæˆæ‰˜æ”¶æ–‡ä»¶            æŸ¥è¯¢æ‰˜æ”¶å‘èµ·é€šçŸ¥è¡¨ AM_ENTRUST_CREATE_NOTIFY çŠ¶æ€ä¸º2 å¤„ç†ä¸­çš„æ•°æ®            æŸ¥è¯¢æ˜ç»†è¡¨æ•°æ®ä¸º6 ç®—è´¹æˆåŠŸçš„æ•°æ®            æ ¹æ®æ‰˜æ”¶æ˜ç»†ç”Ÿæˆå‘é€æ–‡ä»¶            æ–°å¢æ‰˜æ”¶ç”Ÿæˆæ€»è¡¨ï¼ˆ1ä¸ªæ–‡ä»¶1æ¡è®°å½•ï¼‰            æ›´æ–°æ˜ç»†è¡¨æ•°æ®    am_enrtust_create       æ‰˜æ”¶ç”Ÿæˆæ€»è¡¨    ç”Ÿæˆæ–‡ä»¶ï¼ˆå‰å°å‘é€ï¼‰æ‰˜æ”¶å‘ç›˜ï¼ˆæ“ä½œå‘˜å®¡æ ¸æ–‡ä»¶ï¼Œç‚¹å‡»æ–‡ä»¶å‘é€ï¼‰1.æŸ¥è¯¢ç”Ÿæˆæ€»è¡¨æ•°æ®   am_enrtust_create2.æŸ¥è¯¢æ˜ç»†è¡¨æ•°æ®   å¤šçº¿ç¨‹å¤„ç†                                è·å–am_enrtust_createæ€»è¡¨ä¸­çš„æ‰˜æ”¶æ€»æ•°TOTAL_NUM,è®¾ç½®æŸ¥è¯¢æ•°é‡                                è®¡ç®—å‡ºæŸ¥è¯¢æ¬¡æ•°time                                åˆ›å»ºçº¿ç¨‹æ± ï¼Œå°†æŸ¥è¯¢ä»»åŠ¡æ”¾å…¥çº¿ç¨‹æ± å¤„ç†                                æ¯æ¬¡æŸ¥è¯¢ä½¿ç”¨ThredQueryå®ç°Callableè¿›è¡ŒæŸ¥è¯¢                                3.è·å–FTPåœ°å€4.ç”Ÿæˆæ–‡ä»¶5.ä¸Šä¼ æœ¬åœ°6.ä¸Šä¼ FTP7.é€šçŸ¥UPGæ¥å£8.æ›´æ–°æ‰˜æ”¶ç”Ÿæˆæ€»è¡¨\n\nå…­ã€æ‰˜æ”¶å…¥è´¦  ï¼ˆå›ç›˜æ–‡ä»¶ï¼Œå…¥è¡¨ï¼Œå…¥è´¦ï¼‰        am_entrust_deal       æ‰˜æ”¶å¤„ç†æ€»è¡¨                am_entrust_deal_dtl   æ‰˜æ”¶å¤„ç†æ˜ç»†è¡¨(å¹´æœˆè¡¨)                å¸¸å·æ¸…ç®—ä¸­å¿ƒ  å›ç›˜æ–‡ä»¶æŒ‰é“¶è¡Œï¼ˆä¸€ä¸ªé“¶è¡Œä¸€ä¸ªæ–‡ä»¶ï¼‰                      FTPè·¯å¾„æ ¹æ®åˆ†å…¬å¸ï¼Œåˆ†äº†3ä¸ªåœ°å€    é“¶è¡Œå›è°ƒè¿‡ç¨‹    1.é“¶è¡Œè¿”å›å›ç›˜æ–‡ä»¶ï¼Œè°ƒæ¥å£é€šçŸ¥BOSSï¼Œè°ƒæ¥å£asset_ICRMServiceCSV_doEntrustDealNotifyCom\t\tå†™å…¥æ•°æ®åˆ°select *  from  cen.am_file_batch_info where source=&#x27;ENTRUST_DEALNOTIFYCOM&#x27;  AND STATE=0 \t2ã€AsynEntrustDealNotifyTask åšå›ç›˜å¤„ç†ï¼ˆè§£æå›ç›˜æ–‡ä»¶ï¼‰ï¼Œå¾€ AM_ENTRUST_DEAL_DTLï¼ŒAM_ENTRUST_DEAL è¡¨å†™å…¥æ•°æ®           AsynEntrustDealNotifyTaskæ‰˜æ”¶å›ç›˜å¼‚æ­¥å¤„ç†è¿›ç¨‹       \t1ï¼‰ä¸‹è½½æ–‡ä»¶ï¼Œè§£ææ–‡ä»¶ï¼Œæ’å…¥æ‰˜æ”¶å¤„ç†æ˜ç»†è¡¨ï¼ˆçŠ¶æ€ä¸º1ï¼‰    \t2ï¼‰å¦‚æœæ˜¯å¸¸å·æ¸…ç®—ä¸­å¿ƒä¼šæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œéœ€è¦å¤„ç†åˆ°æœ€å¥½ä¸€ä¸ªæ–‡ä»¶å†æ›´æ–°ä¸ºå¤„ç†ç»“æŸ\t\t3ï¼‰å†™å…¥æ‰˜æ”¶å¤„ç†æ€»è¡¨ï¼ˆçŠ¶æ€ä¸º1ï¼‰\t3.EntrustDealThreadTask è¿›è¡Œå…¥è´¦å¤„ç†       \tæŸ¥è¯¢å¤„ç†æ˜ç»†è¡¨çš„æ•°æ®    \tè°ƒç”¨é¢„å­˜è¿›è¡Œå…¥è´¦                      æ‰˜æ”¶åˆ†ä¸šåŠ¡å…¥è´¦ï¼š    ä¸šåŠ¡åˆ†ä¸ºï¼šåŸºæœ¬ä¸šåŠ¡å’Œå¢å€¼ä¸šåŠ¡    é¡µé¢æ“ä½œ      0   å¢å€¼                    å¢å€¼åˆ†ä¸šåŠ¡ï¼Œå…¶ä»–è¿›é€šæ¬¾                1    æ•°å­—+äº’åŠ¨åŸºæœ¬            åŸºæœ¬åˆ†ä¸šåŠ¡ï¼Œå…¶ä»–è¿›é€šæ¬¾                2    åŸºæœ¬+å¢å€¼                å…¨éƒ¨ä¸šåŠ¡                5    åŸºæœ¬ä¸šåŠ¡å’Œå¢å€¼ä¸šåŠ¡        å…¨éƒ¨åˆå¹¶è¿›é€šæ¬¾                    ç®—è´¹åï¼šæŒ‰ç…§ä¸šåŠ¡åˆ†ä¸ºå¤šæ¡æ•°æ®        å…¥è´¦æ—¶ï¼š   æ¯”å¦‚     1002        åŸºæœ¬1       å¦‚æœæ˜¯å¢å€¼ï¼Œåˆ†ä¸º1008ï¼Œ1009ï¼Œ100ï¼ˆ1002ï¼Œ1003åˆå¹¶ï¼‰                        1003        åŸºæœ¬2        å¦‚æœæ˜¯åŸºæœ¬ï¼Œåˆ†ä¸º1002ï¼Œ1003ï¼Œ700ï¼ˆ1008ï¼Œ1009åˆå¹¶ï¼‰                                                å¦‚æœæ˜¯åŸºæœ¬+å¢å€¼ï¼Œåˆ†ä¸º1002ï¼Œ1003ï¼Œ1008ï¼Œ1009                        1008        å¢å€¼1        å¦‚æœæ˜¯åŸºæœ¬ä¸šåŠ¡å’Œå¢å€¼ä¸šåŠ¡ï¼Œåˆ†ä¸º100ï¼ˆ1002ï¼Œ1003ï¼Œ1008ï¼Œ1009å…¨åˆå¹¶ï¼‰                        1009        å¢å€¼2\n\nä¸ƒã€è‹å·æ‰˜æ”¶æ°¸ä¸åœæœºæ°¸ä¸åœæœºè§„åˆ™ï¼šæ°¸ä¸åœæœºæ˜¯ä¸é“¶è”è¿›è¡Œå¯¹æ¥ï¼Œç”¨æˆ·é€šè¿‡æä¾›é“¶è¡Œå¡å·ã€å§“åã€èº«ä»½è¯ä¿¡æ¯ï¼Œåœ¨æˆ‘æ–¹è¥ä¸šå…æŸœå°ç­¾è®¢ä»£æ‰£åè®®è¿›è¡Œç­¾çº¦ç»‘å®šï¼Œç­¾çº¦æ—¶ç”¨æˆ·å¯è‡ªè¡Œè®¾ç½®ä¸è¶³é¢åº¦ï¼ˆå¦‚5å…ƒã€30å…ƒã€50å…ƒï¼‰å’Œæ¯æ¬¡ä»£æ‰£é¢åº¦ï¼ˆå¦‚50å…ƒã€100å…ƒã€300å…ƒï¼‰ã€‚æ°¸ä¸åœæœºæ¯æ—¥å‘èµ·ä¸€æ¬¡ä»£æ‰£ï¼Œå½“ç”¨æˆ·è´¦æˆ·é¢åº¦ä¸è¶³é¢„è®¾é™é¢åï¼Œè‡ªåŠ¨å‘é“¶è”å‘èµ·æ‰£æ¬¾è¯·æ±‚ï¼Œä»ç”¨æˆ·é“¶è¡Œå¡ä¸­è¿›è¡Œæ‰£æ¬¾å¹¶å……å€¼ï¼Œæ‰£æ¬¾é‡‘é¢ä¸ºç”¨æˆ·ç­¾çº¦æ—¶é¢„è®¾é‡‘é¢ï¼Œå¦‚ä»£æ‰£åä½™é¢ä»ä¸è¶³é™é¢ï¼Œå¯ä¸€æ¬¡å‘èµ·å¤šç¬”æ‰£æ¬¾ç›´è‡³ä½™é¢æ»¡è¶³é™é¢ã€‚ä»£æ‰£ä»»åŠ¡å®æ—¶æ‰£æ¬¾åï¼Œå°†æ‰£æ¬¾æˆåŠŸä¸å¦ä¿¡æ¯å‘ç»™æˆ‘æ–¹ï¼Œæˆ‘æ–¹æ ¹æ®æ‰£æ¬¾æƒ…å†µè¿›è¡ŒBOSSå…¥è´¦ã€‚æ”¹é€ ç‚¹ï¼š1.æ–°å¢æ°¸ä¸åœæœºè¿›ç¨‹ï¼Œæ¯å¤©å®šæ—¶è°ƒåº¦\tæŸ¥è¯¢å‡ºç­¾çº¦è¡¨ä¸­ç­¾çº¦äº†æ°¸ä¸åœæœºçš„å®¢æˆ·ï¼Œæ¯ä¸ªå®¢æˆ·è¿›è¡ŒæŸ¥æ¬ ï¼Œåˆ¤æ–­å®¢æˆ·é‡‘é¢æ˜¯å¦å°äºä¸è¶³é¢åº¦ï¼Œå°äºåˆ™å‘èµ·ä¸€ç¬”æ‰˜æ”¶ï¼Œæ–°å¢ä¸€æ¡æ•°æ®è¿›å…¥æ‰˜æ”¶å‘èµ·é€šçŸ¥è¡¨ï¼ˆæ ¹æ®é“¶è¡Œã€ç­¾çº¦ç±»å‹ï¼‰ï¼ŒåŒæ—¶éœ€è¦åˆ¤æ–­è¯¥ç”¨æˆ·ä¹‹å‰çš„æ•°æ®è¢«å¤„ç†å®Œäº†å˜›ï¼Ÿå¦‚æœæ²¡æœ‰å¤„ç†åˆ™ä¸ç”Ÿæˆæ–°çš„æ˜ç»†æ•°æ® IEntrustAppBC.checkEntrustBank()2.æ‰˜æ”¶å‘èµ·è¿›ç¨‹æ”¹é€ \tç”Ÿæˆæ‰˜æ”¶æ˜ç»†çš„æ—¶å€™æ˜¯æ ¹æ®ä¸šåŠ¡ç±»å‹BUSI_TYPEï¼Œåˆ†å…¬å¸CORP_ORG_IDï¼Œç­¾çº¦ç±»å‹src_typeï¼Œé“¶è¡Œbank_idæ¥ä»ç­¾çº¦è¡¨ä¸­è·å–æ•°æ®ï¼Œæ°¸ä¸åœæœºç”Ÿæˆæ‰˜æ”¶æ˜ç»†çš„æ—¶å€™å¯èƒ½ä¼šè·å–åˆ°ä¹‹å‰é€æ‰˜çš„æ•°æ®ï¼Œé€ æˆé‡å¤å‘é€ã€‚æ·»åŠ æŸ¥è¯¢æ¡ä»¶3.ç®—è´¹è¿›ç¨‹æ”¹é€ \tä¹‹å‰ç®—è´¹æ ¹æ®åˆ†ä¸šåŠ¡æ±‡æ€»æ¬ è´¹é‡‘é¢ï¼Œåœ¨å‘èµ·æ‰˜æ”¶ã€‚ç°åœ¨ç›´æ¥åˆ¤æ–­æ˜¯å¦ä¸ºæ°¸ä¸åœæœºçš„æ‰˜æ”¶ï¼Œç›´æ¥å‘èµ·è®¾ç½®çš„ä»£æ‰£é‡‘é¢4.é€æ‰˜æ”¹é€ \tæ°¸ä¸åœæœºçš„æ•°æ®ä¸åœ¨é¡µé¢ä¸Šç‚¹å‡»é€æ‰˜ï¼Œç›´æ¥åœ¨åå°å¤„ç†æ·»åŠ è‡ªåŠ¨é€æ‰˜è¿›ç¨‹\n\næ‰˜æ”¶çŠ¶æ€am_entrust_relation      ç­¾çº¦å…³ç³»è¡¨   state  0æœ‰æ•ˆï¼Œ1æ— æ•ˆ ï¼ˆè§£çº¦å˜æˆæ— æ•ˆï¼‰am_entrust_create_notify     æ‰˜æ”¶å‘èµ·é€šçŸ¥è¡¨ï¼ˆæ‰«æï¼‰     state   1 æœªå¤„ç†   åˆšæ’å…¥é€šçŸ¥è¡¨çš„æ•°æ®              2 å¤„ç†ä¸­   å‘èµ·è¿›ç¨‹å¤„ç†å            3 å¤„ç†ç»“æŸ                    AM_ENTRUST_CREATE       æ‰˜æ”¶ç”Ÿæˆæ€»è¡¨ state    2    å¤„ç†ä¸­ï¼ˆå‘é€æ‰˜æ”¶æ–‡ä»¶ï¼‰am_entrust_create_dtl         æ‰˜æ”¶ç”Ÿæˆæ˜ç»†è¡¨(å¹´æœˆè¡¨)       state   1 æœªå¤„ç†    \t\t2 å¤„ç†ä¸­    \t\t3 å¤„ç†ç»“æŸ            5 æ‰˜æ”¶ç”Ÿæˆåˆå§‹çŠ¶æ€ï¼ˆæ‰˜æ”¶å‘èµ·è¿›ç¨‹ç”Ÿæˆæ‰˜æ”¶æ˜ç»†è¡¨ï¼‰            6 ç®—è´¹è¿›ç¨‹ç®—è´¹æˆåŠŸå            9 ç®—è´¹è¿›ç¨‹å¤„ç†å¼€å§‹ï¼ˆå…¥è´¦å¤„ç†ï¼‰                    AM_ENTRUST_DEAL_DTL   æ‰˜æ”¶å¤„ç†æ€»è¡¨    state   1   æœªå¤„ç†    æ‰˜æ”¶å…¥è´¦æ—¶å†™å…¥            3   å¤„ç†ç»“æŸ\n\n9.æ´»åŠ¨åˆ’æ‹¨ä¸€.æ´»åŠ¨åŠç†  æä¾›CRMæ¥å£åŠç†æ´»åŠ¨1.æŸ¥è¯¢ç”¨æˆ·ä¸‰æˆ·ä¿¡æ¯\n2.æœ‰TRANS_AMOUNTè¯´æ˜éœ€è¦ä»è´¦æˆ·ä¸Šæ‰£é’±\n    1ï¼‰æŸ¥è¯¢æ´»åŠ¨è½¬å‡ºè´¦æœ¬ç§‘ç›®é…ç½®\n    2ï¼‰æŸ¥æ¬ è·å–å®¢æˆ·è™šé”€åè´¦æœ¬\n    3ï¼‰è®¡ç®—ä»é…ç½®çš„å¯è½¬å‡ºè´¦æœ¬ä¸€å…±éœ€è¦è½¬å‡ºå¤šå°‘é’±\n    4ï¼‰æ»¡è¶³è½¬å‡ºæ¡ä»¶ï¼Œèµ°æ¸…é€€æµç¨‹\n3.æ ¹æ®ä¼ å…¥çš„å®šä»·è®¡åˆ’ç¼–ç \n    æŸ¥è¯¢æ´»åŠ¨è®¡åˆ’å®šä¹‰è¡¨ AM_PRICE_PLAN è¿”å›amPricePlan\n    æŸ¥è¯¢æ´»åŠ¨è®¡åˆ’ç»„æˆè¡¨ AM_PRICE_PLAN_COMP è¿”å›planComps\n4.beforeExecuteComp æ ¡éªŒè§„åˆ™ä¸é…ç½®\n    åˆ¤æ–­æ˜¯å¦æœ‰é¢„å­˜ç±»æ´»åŠ¨\n        1ï¼‰æœ‰é¢„å­˜ç±»è§„åˆ™\n            æŸ¥è¯¢æ´»åŠ¨è®¡åˆ’å±æ€§å®šä¹‰è¡¨ AM_PRICE_PLAN_ATTR\n            æ ¡éªŒæ¯æ¡å±æ€§è§„åˆ™\n        2ï¼‰éé¢„å­˜ç±»æ´»åŠ¨ä¸”ACCEP_AMOUNTä¸ä¸º0æ—¶ï¼Œä¸ºå®¢æˆ·åšACCEP_AMOUNTçš„ç¼´è´¹ï¼ˆACCEP_AMOUNTè¢«è¦†ç›–æˆ0ï¼Œæš‚æ—¶ä¸èµ°è¯¥åˆ†æ”¯ï¼‰\n5.éå†æ´»åŠ¨ç»„æˆexecuteComp\n    1)æŸ¥è¯¢æ´»åŠ¨å±æ€§ï¼Œæœ‰2ä¸ªå±æ€§çš„ATTR_CODEç›¸åŒï¼Œè¡¨ç¤ºå­˜åœ¨ä¸¤ä¸ªç«‹å³åˆ°è´¦(é¢„å­˜/èµ é€)ï¼Œæˆ–è€…ä¸¤ä¸ªåˆ†æœˆè¿”æ¬¾(é¢„å­˜ï¼Œèµ é€)ã€‚\n    2ï¼‰æ„å»ºæ´»åŠ¨å±æ€§\n        2.1 è®¡ç®—è¿”å›é‡‘é¢ä»å…¥å‚ã€è¡¨é…ç½®ã€ä¸é™åˆ¶\n        2.2 å¦‚æœå±æ€§ä»å¤–éƒ¨ä¼ å…¥ï¼Œå¦‚æœä¸å…¨ï¼Œåˆ™éœ€è¦é¢å¤–è®¡ç®—\n    3ï¼‰åˆ¤æ–­å±æ€§æ˜¯å¦æ˜¯ç”¨æˆ·çº§è´¦æœ¬\n    åˆ’æ‹¨ç±»å‹ï¼š\n        1ï¼‰ç«‹å³åˆ°è´¦ï¼š\n                è·å–ç«‹å³åˆ°è´¦æ€»é‡‘é¢ totalMoney\n                PAY_TYPEä¸ºé¢„å­˜ç±»ã€èµ é€ç±»è®¡ç®—åˆ’æ‹¨é‡‘é¢\n                PAY_TYPEä¸ºè´¦æœ¬åˆ’æ‹¨ç›´æ¥è°ƒç”¨è½¬è´¦æœåŠ¡è¿›è¡Œè½¬è´¦\n                \n                é™¤äº†è´¦æœ¬åˆ’æ‹¨è°ƒç”¨é¢„å­˜æœåŠ¡ç«‹å³åˆ°è´¦\n                è®°å½•è¿”æ¬¾æ—¥å¿—returnè¡¨\n        2ï¼‰åˆ†æœˆè¿”è¿˜ï¼š\n                è®¡ç®—é‡‘é¢ ï¼ˆé¢„å­˜æŒ‰æœˆè¿”è¿˜æ€»é¢RETURN_AMOUNT é¢„å­˜æœ¬é‡‘æ€»é¢CAPITAL_AMOUNT  èµ é€æ€»é¢REWARD_AMOUNTï¼‰\n                è·å–è´¦æˆ·è´¦æœŸ\n                æ´»åŠ¨ç”Ÿæ•ˆå¼€å§‹æ—¶é—´ï¼ˆå¦‚æœæœ‰ä¼ å…¥ï¼š 1ã€ ä¼ å…¥æ—¶é—´æœˆä»½å¤§äºå½“å‰æ—¶é—´æœˆä»½ï¼šå–START_DATEæ‰€åœ¨è´¦æœŸå¼€å§‹æ—¶é—´+AMONTH-1ä½œä¸ºæ´»åŠ¨å¼€å§‹æ—¶é—´ 2ã€ ä¼ å…¥æ—¶é—´æœˆåˆ†å°äºç­‰äºå½“å‰æ—¶é—´æœˆä»½ï¼šå–å½“å‰æ—¶é—´æ‰€åœ¨è´¦æœŸå¼€å§‹æ—¶é—´+AMONTH-1ä½œä¸ºæ´»åŠ¨å¼€å§‹æ—¶é—´ 3ã€ æœªä¼ å…¥åˆ™å–å½“å‰æ—¶é—´æ‰€åœ¨è´¦æœŸå¼€å§‹æ—¶é—´+AMONTH-1ä½œä¸ºæ´»åŠ¨å¼€å§‹æ—¶é—´ï¼‰\n                æŸ¥è¯¢æ´»åŠ¨è®¡åˆ’è§„åˆ™å®šä¹‰è¡¨ AM_PRICE_PLAN_APP_RULE\n                å†™åˆ†æ‘Šè®¡åˆ’è¡¨ AM_APPORTION_PLAN\n    6.afterExecuteComp  å‰©ä½™é‡‘é¢ç¼´è´¹ä»¥åŠç”Ÿæˆå—ç†æ€»è¡¨  AM_APPORTION\n\näºŒ.æ´»åŠ¨å–æ¶ˆ     æä¾›CRMæ¥å£å–æ¶ˆæ´»åŠ¨ä¸‰.åå°ä»»åŠ¡1.æŸ¥è¯¢æ´»åŠ¨è®¡åˆ’å·¥å•AM_APPORTION_PLAN2.è½¬æ¢è¿”æ¬¾é‡‘é¢3.å†™å…¥æ–‡ä»¶\n\n10.ç§¯åˆ†ä¸€ã€ç§¯åˆ†è°ƒæ•´1.æŸ¥è¯¢ç§¯åˆ†è´¦æœ¬  SC_BALANCE2.æ ¡éªŒç”¨æˆ·ç§¯åˆ†æ˜¯å¦å¤Ÿæ‰£3.æ–°å¢ç§¯åˆ†ä¸šåŠ¡æ—¥å¿—è®°å½• SC_BUSI4.è®°å½•ç»Ÿè®¡éœ€è¦çš„ç§¯åˆ†æ ¸å¿ƒä¸šåŠ¡æ—¥å¿— I_SC_BUSI_BAL5.ç§¯åˆ†å…¥è´¦6.çŸ­ä¿¡æé†’\n\näºŒã€ç§¯åˆ†è¿”å›1.ç”Ÿæˆç§¯åˆ†æ´»åŠ¨å—ç†è¡¨ SC_APPORTION2.ç”Ÿæˆç§¯åˆ†è¿”è¿˜å·¥å•è¡¨ SC_APPORTION_PLAN\n\nä¸‰ã€ç§¯åˆ†æ¸…é›¶1.è®°å½•ç§¯åˆ†ä¸šåŠ¡æ—¥å¿—è®°å½•2.è®°å½•ç»Ÿè®¡éœ€è¦çš„ç§¯åˆ†æ ¸å¿ƒä¸šåŠ¡æ—¥å¿—3.ç§¯åˆ†å…¥è´¦ï¼ˆæ¸…é›¶æ‰€æœ‰ç§¯åˆ†ï¼‰\n\nå››ã€ç§¯åˆ†è®¡ç®—å®æ—¶é”€è´¦ç§¯åˆ†è®¡ç®—ï¼ˆé”€è´¦æ—¶äº§ç”Ÿç§¯åˆ†ï¼‰\t1.è·å–é”€è´¦é‡‘é¢ åˆ¨é™¤ä¸äº§ç”Ÿç§¯åˆ†çš„è´¦æœ¬\t2.è·å–ç³»ç»Ÿé»˜è®¤çš„ç§¯åˆ†è®¡åˆ’\t3.è®¡ç®—æ¶ˆè´¹ç§¯åˆ†\t4.è®°å½•ç§¯åˆ†ä¸šåŠ¡æ—¥å¿—\t5.ç§¯åˆ†å…¥è´¦\n\näº”ã€ç§¯åˆ†å…‘æ¢1.æŸ¥è¯¢ç¬¦åˆç§¯åˆ†å…‘æ¢è§„åˆ™çš„ç§¯åˆ†è´¦æœ¬ï¼ˆåŠ è½½å¯ç”¨å’Œä¸å¯ç”¨çš„ç¤¼ç‰©ï¼Œè¿‡æ»¤ç§¯åˆ†è´¦æœ¬ï¼‰2.æ ¡éªŒç§¯åˆ†æ˜¯å¦è¶³å¤Ÿ3.æŸ¥è¯¢æ­¤ç¬”äº¤æ˜“æ˜¯å¦å·²ç»æˆåŠŸ(å¯¹äº‹ç‰©ä¸ä¸€è‡´çš„å®¹é”™å¤„ç†)4.è®°å½•ç§¯åˆ†ä¸šåŠ¡æ—¥å¿—5.ç§¯åˆ†å…¥è´¦ï¼ˆå‡æ‰£ï¼‰\n\nå…­ã€ç§¯åˆ†å†»ç»“ã€è§£å†»ä¸ƒã€ç§¯åˆ†ä¿ƒé”€ï¼ˆèµ é€ï¼‰å…«ã€ç§¯åˆ†å……å€¼ä¹ã€ç§¯åˆ†è¿”é”€åã€ç§¯åˆ†è½¬èµ 11.å‘ç¥¨ä¸€ã€æœˆç»“å‘ç¥¨æŸ¥è¯¢æœˆç»“å‘ç¥¨\n1.æ ¹æ®è´¦æˆ·æ ‡è¯†å’Œèµ·å§‹ç»ˆæ­¢æœˆä»½è·å–è´¦æœŸåˆ—è¡¨2.éå†è´¦æœŸæŸ¥è¯¢æœˆç»“å‘ç¥¨3.æŒ‰ç…§è´¦æˆ·å’Œè´¦å•æŸ¥è¯¢æ¬ è´¹è´¦å•bills4.æŸ¥è¯¢è¯¥è´¦æœŸä¸‹å¯ç”¨çš„æœˆç»“å‘ç¥¨5.æ ¹æ®æ‰“å°æ–¹å¼ï¼ˆé¢„æ‰“å°ã€æ­£å¸¸æ‰“å°ï¼‰6.æ­£å¸¸æ‰“å°æ–¹å¼7.è´¦æœŸå†…æœ‰æœªé”€å®Œçš„è´¦å• ä¸å…è®¸æ‰“å°8.æ ¹æ®è´¦å•æœˆä»½æŸ¥è¯¢é”€è´¦æ—¥å¿— witeoffLogs9.æ²¡æœ‰é”€è´¦æ—¥å¿—çš„è´¦æœŸä¸æ‰“å°æœˆç»“å‘ç¥¨10.æŒ‰ç…§ç”¨æˆ·è®°å½•é”€è´¦è®°å½• logMap11.æŒ‰ç…§ç”¨æˆ·åˆ†åˆ«è®¡ç®—æœˆç»“å‘ç¥¨é‡‘é¢\n\n12.åˆ†è´¦å›½ç½‘æ”¶å…¥éƒ½æš‚æ—¶ç»Ÿä¸€æ”¶åˆ°å›½ç½‘ï¼Œç”±å›½ç½‘æ¥ç»Ÿä¸€æ ¹æ®åˆ†è´¦æ¯”ä¾‹è¿›è¡Œåˆ†è´¦\n","categories":["é¡¹ç›®æµç¨‹"],"tags":["ä¸šåŠ¡"]},{"title":"Zookeeper","url":"/java4u/2022/04/11/zookeeper/","content":"zookeeperåŠ¨ç‰©ç®¡ç†å‘˜  ç®¡ç† hadoop(å¤§è±¡)hive(èœœèœ‚)\nzkæ˜¯å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„åè°ƒæœåŠ¡\nåŠŸèƒ½ï¼š    é…ç½®ç®¡ç† ï¼ˆæœåŠ¡é…ç½®ï¼‰    åˆ†å¸ƒå¼é”    é›†ç¾¤ç®¡ç†\næ ‘å‹çš„ç›®å½•ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ZNODEï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šä¿å­˜è‡ªå·±çš„æ•°æ®å’ŒèŠ‚ç‚¹ä¿¡æ¯\nzookeeperåˆ†å¸ƒå¼é”åŸç†æ ¸å¿ƒæ€æƒ³ï¼šå½“å®¢æˆ·ç«¯è¦è·å–é”ï¼Œåˆ™åˆ›å»ºèŠ‚ç‚¹ï¼Œä½¿ç”¨å®Œé”ï¼Œåˆ™åˆ é™¤è¯¥èŠ‚ç‚¹1.å®¢æˆ·ç«¯è·å–é”æ—¶ï¼Œåœ¨lockèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹2.ç„¶åè·å–Lockä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯è·å–åˆ°æ‰€æœ‰å­èŠ‚ç‚¹åï¼Œå¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„åºå·æœ€å°ï¼Œ    åˆ™å®¢æˆ·ç«¯è·å–åˆ°é”ã€‚ä½¿ç”¨å®Œé”åï¼Œåˆ é™¤è¯¥èŠ‚ç‚¹3.å¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹å¹¶élockä¸­æœ€å°çš„ï¼Œè¯´æ˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå®¢æˆ·ç«¯éœ€è¦æ‰¾åˆ°æ¯”è‡ªå·±å°çš„    é‚£ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶å¯¹å…¶æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬åˆ é™¤äº‹ä»¶ã€‚ï¼ˆè§¦å‘åˆ é™¤äº‹ä»¶æ—¶ï¼Œåªéœ€è¦å”¤é†’ä¸€ä¸ªï¼Œä¸éœ€è¦å…¨éƒ¨æé†’ï¼‰4.å¦‚æœå‘ç°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåˆ™å®¢æˆ·ç«¯çš„    watcherä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå†æ¬¡åˆ¤æ–­è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯    lockå­èŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ï¼Œå¦‚æœæ˜¯è·å–åˆ°é”ï¼Œ    å¦‚æœä¸æ˜¯åˆ™é‡å¤ä»¥ä¸Šæ­¥éª¤ç»§ç»­è·å–åˆ°æ¯”è‡ªå·±å°çš„ä¸€ä¸ªèŠ‚ç‚¹    å¹¶æ³¨å†Œç›‘å¬\nzookeeperé›†ç¾¤    leaderé€‰ä¸¾        serverid   æœåŠ¡å™¨ID\n    Zxid     æ•°æ®ID    è·å–è¶…è¿‡åŠæ•°çš„é€‰ç¥¨ï¼Œå°±å¯ä»¥æˆä¸ºleaderé›†ç¾¤è§’è‰²        leader:å¤„ç†äº‹åŠ¡è¯·æ±‚ï¼ˆå¢åˆ æ”¹ï¼‰                        é›†ç¾¤å†…éƒ¨å„æœåŠ¡å™¨çš„è°ƒåº¦è€…        follower:å¤„ç†éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡è¯·æ±‚ç»™leader                         å‚ä¸leaderé€‰ä¸¾æŠ•ç¥¨        observer:    å¤„ç†éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡è¯·æ±‚ç»™leader\n","categories":["ä¸­é—´ä»¶"],"tags":["å­¦ä¹ "]},{"title":"1179.é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨","url":"/java4u/2022/02/10/1179.%20%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%83%A8%E9%97%A8%E8%A1%A8/","content":"éƒ¨é—¨è¡¨Â Departmentï¼š\n+---------------+---------+| Column Name   | Type    |+---------------+---------+| id            | int     || revenue       | int     || month         | varchar |+---------------+---------+\n(id, month) æ˜¯è¡¨çš„è”åˆä¸»é”®ã€‚è¿™ä¸ªè¡¨æ ¼æœ‰å…³äºæ¯ä¸ªéƒ¨é—¨æ¯æœˆæ”¶å…¥çš„ä¿¡æ¯ã€‚æœˆä»½ï¼ˆmonthï¼‰å¯ä»¥å–ä¸‹åˆ—å€¼ [â€œJanâ€,â€Febâ€,â€Marâ€,â€Aprâ€,â€Mayâ€,â€Junâ€,â€Julâ€,â€Augâ€,â€Sepâ€,â€Octâ€,â€Novâ€,â€Decâ€]ã€‚\nÂ \nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥é‡æ–°æ ¼å¼åŒ–è¡¨ï¼Œä½¿å¾—æ–°çš„è¡¨ä¸­æœ‰ä¸€ä¸ªéƒ¨é—¨ id åˆ—å’Œä¸€äº›å¯¹åº”Â æ¯ä¸ªæœˆ çš„æ”¶å…¥ï¼ˆrevenueï¼‰åˆ—ã€‚\næŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼š\nDepartment è¡¨ï¼š\n+------+---------+-------+| id   | revenue | month |+------+---------+-------+| 1    | 8000    | Jan   || 2    | 9000    | Jan   || 3    | 10000   | Feb   || 1    | 7000    | Feb   || 1    | 6000    | Mar   |+------+---------+-------+\næŸ¥è¯¢å¾—åˆ°çš„ç»“æœè¡¨ï¼š\n+------+-------------+-------------+-------------+-----+-------------+| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |+------+-------------+-------------+-------------+-----+-------------+| 1    | 8000        | 7000        | 6000        | ... | null        || 2    | 9000        | null        | null        | ... | null        || 3    | null        | 10000       | null        | ... | null        |+------+-------------+-------------+-------------+-----+-------------+\næ³¨æ„ï¼Œç»“æœè¡¨æœ‰ 13 åˆ— (1ä¸ªéƒ¨é—¨ id åˆ— + 12ä¸ªæœˆä»½çš„æ”¶å…¥åˆ—)ã€‚\nè§£ç­”ï¼š\nselect id,\tsum(case month when &#x27;Jan&#x27; then revenue end) as &#x27;Jan_Revenue&#x27;,\tsum(case month when &#x27;Feb&#x27; then revenue end) as &#x27;Feb_Revenue&#x27;,\tsum(case month when &#x27;Mar&#x27; then revenue end) as &#x27;Mar_Revenue&#x27;,\tsum(case month when &#x27;Apr&#x27; then revenue end) as &#x27;Apr_Revenue&#x27;,\tsum(case month when &#x27;May&#x27; then revenue end) as &#x27;May_Revenue&#x27;,\tsum(case month when &#x27;Jun&#x27; then revenue end) as &#x27;Jun_Revenue&#x27;,\tsum(case month when &#x27;Jul&#x27; then revenue end) as &#x27;Jul_Revenue&#x27;,\tsum(case month when &#x27;Aug&#x27; then revenue end) as &#x27;Aug_Revenue&#x27;,\tsum(case month when &#x27;Sep&#x27; then revenue end) as &#x27;Sep_Revenue&#x27;,\tsum(case month when &#x27;Oct&#x27; then revenue end) as &#x27;Oct_Revenue&#x27;,\tsum(case month when &#x27;Nov&#x27; then revenue end) as &#x27;Nov_Revenue&#x27;,\tsum(case month when &#x27;Dec&#x27; then revenue end) as &#x27;Dec_Revenue&#x27;from department group by id;\nåˆ—å‡ºéƒ¨é—¨çš„æœˆä»½æ”¶å…¥ï¼Œå³ä»¥idä½œä¸ºåˆ†ç»„æŸ¥è¯¢select id from department group by id\nåˆ†ç»„åæŒ‰ç…§æœˆä»½æ±‡æ€»æ”¶å…¥ï¼Œä½¿ç”¨case whenåˆ¤æ–­æœˆä»½sum(case month when â€˜Janâ€™ then revenue end) as Jan_Revenue,\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"çª—å£å‡½æ•°","url":"/java4u/2022/02/10/%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/","content":"çª—å£å‡½æ•°çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š&lt;çª—å£å‡½æ•°&gt; over (partition by &lt;ç”¨äºåˆ†ç»„çš„åˆ—å&gt;                order by &lt;ç”¨äºæ’åºçš„åˆ—å&gt;)é‚£ä¹ˆè¯­æ³•ä¸­çš„&lt;çª—å£å‡½æ•°&gt;éƒ½æœ‰å“ªäº›å‘¢ï¼Ÿ&lt;çª—å£å‡½æ•°&gt;çš„ä½ç½®ï¼Œå¯ä»¥æ”¾ä»¥ä¸‹ä¸¤ç§å‡½æ•°ï¼š1ï¼‰ ä¸“ç”¨çª—å£å‡½æ•°ï¼ŒåŒ…æ‹¬åé¢è¦è®²åˆ°çš„rank, dense_rank, row_numberç­‰ä¸“ç”¨çª—å£å‡½æ•°ã€‚2ï¼‰ èšåˆå‡½æ•°ï¼Œå¦‚sum. avg, count, max, minç­‰å› ä¸ºçª—å£å‡½æ•°æ˜¯å¯¹whereæˆ–è€…group byå­å¥å¤„ç†åçš„ç»“æœè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥çª—å£å‡½æ•°åŸåˆ™ä¸Šåªèƒ½å†™åœ¨selectå­å¥ä¸­ã€‚\n1.rankä¸“ä¸šçª—å£å‡½æ•°  å¯¹ä¸€ä»½æˆç»©è¡¨æ’åºï¼ŒæŒ‰ç…§ç­çº§æ’åºselect *,   rank() over (partition by ç­çº§                 order by æˆç»© desc) as rankingfrom ç­çº§è¡¨\ngroup byä¼šå‡å°‘åŸè¡¨æ•°æ®ï¼Œçª—å£å‡½æ•°åœ¨ä¸å‡å°‘åŸè¡¨æ•°æ®çš„æƒ…å†µä¸‹ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç»„å’Œæ’åº\n2.èšåˆçª—å£å‡½æ•°ï¼Œå¯¹è‡ªèº«åŠä»¥ä¸Šæ•°æ®è¿›è¡Œè¿ç®—select *,   sum(æˆç»©) over (order by å­¦å·) as current_sum,   avg(æˆç»©) over (order by å­¦å·) as current_avg,   count(æˆç»©) over (order by å­¦å·) as current_count,   max(æˆç»©) over (order by å­¦å·) as current_max,   min(æˆç»©) over (order by å­¦å·) as current_minfrom ç­çº§è¡¨\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"626.æ¢åº§ä½","url":"/java4u/2022/02/09/626.%20%E6%8D%A2%E5%BA%A7%E4%BD%8D/","content":"å°ç¾æ˜¯ä¸€æ‰€ä¸­å­¦çš„ä¿¡æ¯ç§‘æŠ€è€å¸ˆï¼Œå¥¹æœ‰ä¸€å¼  seatÂ åº§ä½è¡¨ï¼Œå¹³æ—¶ç”¨æ¥å‚¨å­˜å­¦ç”Ÿåå­—å’Œä¸ä»–ä»¬ç›¸å¯¹åº”çš„åº§ä½ idã€‚\nå…¶ä¸­çºµåˆ—çš„Â idÂ æ˜¯è¿ç»­é€’å¢çš„\nå°ç¾æƒ³æ”¹å˜ç›¸é‚»ä¿©å­¦ç”Ÿçš„åº§ä½ã€‚\nä½ èƒ½ä¸èƒ½å¸®å¥¹å†™ä¸€ä¸ª SQL queryÂ æ¥è¾“å‡ºå°ç¾æƒ³è¦çš„ç»“æœå‘¢ï¼Ÿ\nÂ \nç¤ºä¾‹ï¼š\n+---------+---------+|    id   | student |+---------+---------+|    1    | Abbot   ||    2    | Doris   ||    3    | Emerson ||    4    | Green   ||    5    | Jeames  |+---------+---------+\nå‡å¦‚æ•°æ®è¾“å…¥çš„æ˜¯ä¸Šè¡¨ï¼Œåˆ™è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\n+---------+---------+|    id   | student |+---------+---------+|    1    | Doris   ||    2    | Abbot   ||    3    | Green   ||    4    | Emerson ||    5    | Jeames  |+---------+---------+\næ³¨æ„ï¼š\nå¦‚æœå­¦ç”Ÿäººæ•°æ˜¯å¥‡æ•°ï¼Œåˆ™ä¸éœ€è¦æ”¹å˜æœ€åä¸€ä¸ªåŒå­¦çš„åº§ä½ã€‚\nè§£ç­”ï¼š\nSELECT    (CASE        WHEN MOD(id, 2) != 0 AND counts != id THEN id + 1        WHEN MOD(id, 2) != 0 AND counts = id THEN id        ELSE id - 1    END) AS id,    studentFROM    seat,    (SELECT        COUNT(*) AS counts    FROM        seat) AS seat_countsORDER BY id ASC;\nå¯¹äºæ‰€æœ‰åº§ä½ id æ˜¯å¥‡æ•°çš„å­¦ç”Ÿï¼Œä¿®æ”¹å…¶ id ä¸º id+1ï¼Œå¦‚æœæœ€åä¸€ä¸ªåº§ä½ id ä¹Ÿæ˜¯å¥‡æ•°ï¼Œåˆ™æœ€åä¸€ä¸ªåº§ä½ id ä¸ä¿®æ”¹ã€‚å¯¹äºæ‰€æœ‰åº§ä½ id æ˜¯å¶æ•°çš„å­¦ç”Ÿï¼Œä¿®æ”¹å…¶ id ä¸º id-1\n(SELECT    COUNT(*) AS countsFROM    seat) AS seat_counts  æŸ¥è¯¢åº§ä½æ•°é‡","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"627.å˜æ›´æ€§åˆ«","url":"/java4u/2022/02/09/627.%20%E5%8F%98%E6%9B%B4%E6%80%A7%E5%88%AB/","content":"Salary è¡¨ï¼š\n+-------------+----------+| Column Name | Type     |+-------------+----------+| id          | int      || name        | varchar  || sex         | ENUM     || salary      | int      |+-------------+----------+\nid æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚sex è¿™ä¸€åˆ—çš„å€¼æ˜¯ ENUM ç±»å‹ï¼Œåªèƒ½ä» (â€˜mâ€™, â€˜fâ€™) ä¸­å–ã€‚æœ¬è¡¨åŒ…å«å…¬å¸é›‡å‘˜çš„ä¿¡æ¯ã€‚\nÂ \nè¯·ä½ ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥äº¤æ¢æ‰€æœ‰çš„ â€˜fâ€™ å’Œ â€˜mâ€™ ï¼ˆå³ï¼Œå°†æ‰€æœ‰ â€˜fâ€™ å˜ä¸º â€˜mâ€™ ï¼Œåä¹‹äº¦ç„¶ï¼‰ï¼Œä»…ä½¿ç”¨ å•ä¸ª update è¯­å¥ ï¼Œä¸”ä¸äº§ç”Ÿä¸­é—´ä¸´æ—¶è¡¨ã€‚æ³¨æ„ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ä¸€æ¡ update è¯­å¥ï¼Œä¸” ä¸èƒ½ ä½¿ç”¨ select è¯­å¥ã€‚\næŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š\nÂ \nSalary è¡¨ï¼š\n+----+------+-----+--------+| id | name | sex | salary |+----+------+-----+--------+| 1  | A    | m   | 2500   || 2  | B    | f   | 1500   || 3  | C    | m   | 5500   || 4  | D    | f   | 500    |+----+------+-----+--------+\nResult è¡¨ï¼š\n+----+------+-----+--------+| id | name | sex | salary |+----+------+-----+--------+| 1  | A    | f   | 2500   || 2  | B    | m   | 1500   || 3  | C    | f   | 5500   || 4  | D    | m   | 500    |+----+------+-----+--------+\n(1, A) å’Œ (3, C) ä» â€˜mâ€™ å˜ä¸º â€˜fâ€™ ã€‚(2, B) å’Œ (4, D) ä» â€˜fâ€™ å˜ä¸º â€˜mâ€™ ã€‚\nç­”æ¡ˆï¼šä½¿ç”¨CASEâ€¦WHENè¡¨è¾¾å¼\nupdate\tsalaryset\tsex =\tcase\t\tsex        when &#x27;m&#x27; then &#x27;f&#x27;\t\telse &#x27;m&#x27;\tend;\n\n\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"596.è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾","url":"/java4u/2022/02/08/596.%20%E8%B6%85%E8%BF%875%E5%90%8D%E5%AD%A6%E7%94%9F%E7%9A%84%E8%AF%BE/","content":"æœ‰ä¸€ä¸ªcourses è¡¨ ï¼Œæœ‰: studentÂ (å­¦ç”Ÿ) å’Œ class (è¯¾ç¨‹)ã€‚\nè¯·åˆ—å‡ºæ‰€æœ‰è¶…è¿‡æˆ–ç­‰äº5åå­¦ç”Ÿçš„è¯¾ã€‚\nä¾‹å¦‚ï¼Œè¡¨ï¼š\n+---------+------------+| student | class      |+---------+------------+| A       | Math       || B       | English    || C       | Math       || D       | Biology    || E       | Math       || F       | Computer   || G       | Math       || H       | Math       || I       | Math       |+---------+------------+\nåº”è¯¥è¾“å‡º:\n+---------+| class   |+---------+| Math    |+---------+\n\næç¤ºï¼š\nå­¦ç”Ÿåœ¨æ¯ä¸ªè¯¾ä¸­ä¸åº”è¢«é‡å¤è®¡ç®—ã€‚\nè§£ç­”ï¼šselect class from courses group by class having count(class)&gt;&#x3D;5;\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"620.æœ‰è¶£çš„ç”µå½±","url":"/java4u/2022/02/08/620.%20%E6%9C%89%E8%B6%A3%E7%9A%84%E7%94%B5%E5%BD%B1/","content":"æŸåŸå¸‚å¼€äº†ä¸€å®¶æ–°çš„ç”µå½±é™¢ï¼Œå¸å¼•äº†å¾ˆå¤šäººè¿‡æ¥çœ‹ç”µå½±ã€‚è¯¥ç”µå½±é™¢ç‰¹åˆ«æ³¨æ„ç”¨æˆ·ä½“éªŒï¼Œä¸“é—¨æœ‰ä¸ª LEDæ˜¾ç¤ºæ¿åšç”µå½±æ¨èï¼Œä¸Šé¢å…¬å¸ƒç€å½±è¯„å’Œç›¸å…³ç”µå½±æè¿°ã€‚ä½œä¸ºè¯¥ç”µå½±é™¢çš„ä¿¡æ¯éƒ¨ä¸»ç®¡ï¼Œæ‚¨éœ€è¦ç¼–å†™ä¸€ä¸ª SQLæŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰å½±ç‰‡æè¿°ä¸ºéÂ boringÂ (ä¸æ— èŠ)Â çš„å¹¶ä¸” id ä¸ºå¥‡æ•°Â çš„å½±ç‰‡ï¼Œç»“æœè¯·æŒ‰ç­‰çº§ rating æ’åˆ—ã€‚\nÂ \nä¾‹å¦‚ï¼Œä¸‹è¡¨ cinema:\n+---------+-----------+--------------+-----------+|   id    | movie     |  description |  rating   |+---------+-----------+--------------+-----------+|   1     | War       |   great 3D   |   8.9     ||   2     | Science   |   fiction    |   8.5     ||   3     | irish     |   boring     |   6.2     ||   4     | Ice song  |   Fantacy    |   8.6     ||   5     | House card|   Interesting|   9.1     |+---------+-----------+--------------+-----------+\nå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œåˆ™æ­£ç¡®çš„è¾“å‡ºæ˜¯ä¸ºï¼š\n+---------+-----------+--------------+-----------+|   id    | movie     |  description |  rating   |+---------+-----------+--------------+-----------+|   5     | House card|   Interesting|   9.1     ||   1     | War       |   great 3D   |   8.9     |+---------+-----------+--------------+-----------+\n\nè§£ç­”ï¼š\nselect * from cinema where \tdescription &lt;&gt; &#x27;boring&#x27; and id%2 = 1order by rating desc;\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"262.è¡Œç¨‹å’Œç”¨æˆ·","url":"/java4u/2022/02/07/262.%20%E8%A1%8C%E7%A8%8B%E5%92%8C%E7%94%A8%E6%88%B7/","content":"è¡¨ï¼šTrips\n+-------------+----------+| Column Name | Type     |+-------------+----------+| id          | int      || client_id   | int      || driver_id   | int      || city_id     | int      || status      | enum     || request_at  | date     |     +-------------+----------+\nid æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€ id ï¼Œå…¶ä¸­ client_id å’Œ driver_id æ˜¯ Users è¡¨ä¸­ users_id çš„å¤–é”®ã€‚status æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¡Œç¨‹çŠ¶æ€çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º(â€˜completedâ€™, â€˜cancelled_by_driverâ€™, â€˜cancelled_by_clientâ€™) ã€‚\nÂ \nè¡¨ï¼šUsers\n+-------------+----------+| Column Name | Type     |+-------------+----------+| users_id    | int      || banned      | enum     || role        | enum     |+-------------+----------+\nusers_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ users_id ï¼Œrole æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·èº«ä»½çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜clientâ€™, â€˜driverâ€™, â€˜partnerâ€™) ã€‚banned æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜Yesâ€™, â€˜Noâ€™) ã€‚\nÂ \nå–æ¶ˆç‡ çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) &#x2F; (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)ã€‚å†™ä¸€æ®µ SQL è¯­å¥æŸ¥å‡ºÂ â€œ2013-10-01â€Â è‡³Â â€œ2013-10-03â€Â æœŸé—´éç¦æ­¢ç”¨æˆ·ï¼ˆä¹˜å®¢å’Œå¸æœºéƒ½å¿…é¡»æœªè¢«ç¦æ­¢ï¼‰çš„å–æ¶ˆç‡ã€‚éç¦æ­¢ç”¨æˆ·å³ banned ä¸º No çš„ç”¨æˆ·ï¼Œç¦æ­¢ç”¨æˆ·å³ banned ä¸º Yes çš„ç”¨æˆ·ã€‚è¿”å›ç»“æœè¡¨ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ä»»æ„é¡ºåºç»„ç»‡ã€‚å…¶ä¸­å–æ¶ˆç‡ Cancellation Rate éœ€è¦å››èˆäº”å…¥ä¿ç•™ ä¸¤ä½å°æ•° ã€‚\næŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚\nÂ \nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼šTrips è¡¨ï¼š\n+----+-----------+-----------+---------+---------------------+------------+| id | client_id | driver_id | city_id | status              | request_at |+----+-----------+-----------+---------+---------------------+------------+| 1  | 1         | 10        | 1       | completed           | 2013-10-01 || 2  | 2         | 11        | 1       | cancelled_by_driver | 2013-10-01 || 3  | 3         | 12        | 6       | completed           | 2013-10-01 || 4  | 4         | 13        | 6       | cancelled_by_client | 2013-10-01 || 5  | 1         | 10        | 1       | completed           | 2013-10-02 || 6  | 2         | 11        | 6       | completed           | 2013-10-02 || 7  | 3         | 12        | 6       | completed           | 2013-10-02 || 8  | 2         | 12        | 12      | completed           | 2013-10-03 || 9  | 3         | 10        | 12      | completed           | 2013-10-03 || 10 | 4         | 13        | 12      | cancelled_by_driver | 2013-10-03 |+----+-----------+-----------+---------+---------------------+------------+\nUsers è¡¨ï¼š\n+----------+--------+--------+| users_id | banned | role   |+----------+--------+--------+| 1        | No     | client || 2        | Yes    | client || 3        | No     | client || 4        | No     | client || 10       | No     | driver || 11       | No     | driver || 12       | No     | driver || 13       | No     | driver |+----------+--------+--------+\nè¾“å‡ºï¼š\n+------------+-------------------+| Day        | Cancellation Rate |+------------+-------------------+| 2013-10-01 | 0.33              || 2013-10-02 | 0.00              || 2013-10-03 | 0.50              |+------------+-------------------+\nè§£é‡Šï¼š2013-10-01ï¼š\n\nå…±æœ‰ 4 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 2 æ¡å–æ¶ˆã€‚\nç„¶è€Œï¼Œid&#x3D;2 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·ï¼ˆuser_id&#x3D;2ï¼‰å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚\nå› æ­¤ï¼Œæ€»å…±æœ‰ 3 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚\nå–æ¶ˆç‡ä¸º (1 &#x2F; 3) &#x3D; 0.332013-10-02ï¼š\nå…±æœ‰ 3 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 0 æ¡å–æ¶ˆã€‚\nç„¶è€Œï¼Œid&#x3D;6 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚\nå› æ­¤ï¼Œæ€»å…±æœ‰ 2 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 0 æ¡å–æ¶ˆã€‚\nå–æ¶ˆç‡ä¸º (0 &#x2F; 2) &#x3D; 0.002013-10-03ï¼š\nå…±æœ‰ 3 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚\nç„¶è€Œï¼Œid&#x3D;8 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚\nå› æ­¤ï¼Œæ€»å…±æœ‰ 2 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚\nå–æ¶ˆç‡ä¸º (1 &#x2F; 2) &#x3D; 0.50\n\nè§£ç­”:client_id å’Œ driver_id å„è‡ªå…³è”çš„ users_idï¼ŒåŒæ—¶æ£€æµ‹æ˜¯å¦è¢«ç¦æ­¢ã€‚\nif (client_id &#x3D; users_id_1 ä¸” users_id_1æ²¡è¢«ç¦æ­¢ å¹¶ä¸” client_id &#x3D; users_id_2 ä¸” users_id_2æ²¡è¢«ç¦æ­¢){    æ­¤æ¡è®°å½•æ²¡è¢«ç¦æ­¢ã€‚}è·å–æ‰€æœ‰æ²¡æœ‰è¢«ç¦æ­¢çš„è®°å½•\nSELECT *FROM Trips AS TJOIN Users AS U1 ON (T.client_id = U1.users_id AND U1.banned =&#x27;No&#x27;)JOIN Users AS U2 ON (T.driver_id = U2.users_id AND U2.banned =&#x27;No&#x27;)\næ¯ç»„çš„å–æ¶ˆçš„è¡Œç¨‹æ•°ï¼šSUM(    IF(T.STATUS &#x3D; â€˜completedâ€™,0,1))\nSELECT T.request_at AS `Day`, \tROUND(\t\t\tSUM(\t\t\t\tIF(T.STATUS = &#x27;completed&#x27;,0,1)\t\t\t)\t\t\t/ \t\t\tCOUNT(T.STATUS),\t\t\t2\t) AS `Cancellation Rate`FROM Trips AS TJOIN Users AS U1 ON (T.client_id = U1.users_id AND U1.banned =&#x27;No&#x27;)JOIN Users AS U2 ON (T.driver_id = U2.users_id AND U2.banned =&#x27;No&#x27;)WHERE T.request_at BETWEEN &#x27;2013-10-01&#x27; AND &#x27;2013-10-03&#x27;GROUP BY T.request_at\n\n\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"595.å¤§çš„å›½å®¶","url":"/java4u/2022/02/07/595.%20%E5%A4%A7%E7%9A%84%E5%9B%BD%E5%AE%B6/","content":"World è¡¨ï¼š\n+-------------+---------+| Column Name | Type    |+-------------+---------+| name        | varchar || continent   | varchar || area        | int     || population  | int     || gdp         | int     |+-------------+---------+\nname æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œæä¾›ï¼šå›½å®¶åç§°ã€æ‰€å±å¤§é™†ã€é¢ç§¯ã€äººå£å’Œ GDP å€¼ã€‚\nÂ \nå¦‚æœä¸€ä¸ªå›½å®¶æ»¡è¶³ä¸‹è¿°ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œåˆ™è®¤ä¸ºè¯¥å›½æ˜¯ å¤§å›½ ï¼š\né¢ç§¯è‡³å°‘ä¸º 300 å¹³æ–¹å…¬é‡Œï¼ˆå³ï¼Œ3000000 km2ï¼‰ï¼Œæˆ–è€…äººå£è‡³å°‘ä¸º 2500 ä¸‡ï¼ˆå³ 25000000ï¼‰ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ä»¥æŠ¥å‘Š å¤§å›½ çš„å›½å®¶åç§°ã€äººå£å’Œé¢ç§¯ã€‚\næŒ‰ ä»»æ„é¡ºåº è¿”å›ç»“æœè¡¨ã€‚\næŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚\nÂ \nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼šWorld è¡¨ï¼š\n+-------------+-----------+---------+------------+--------------+| name        | continent | area    | population | gdp          |+-------------+-----------+---------+------------+--------------+| Afghanistan | Asia      | 652230  | 25500100   | 20343000000  || Albania     | Europe    | 28748   | 2831741    | 12960000000  || Algeria     | Africa    | 2381741 | 37100000   | 188681000000 || Andorra     | Europe    | 468     | 78115      | 3712000000   || Angola      | Africa    | 1246700 | 20609294   | 100990000000 |+-------------+-----------+---------+------------+--------------+\nè¾“å‡ºï¼š\n+-------------+------------+---------+| name        | population | area    |+-------------+------------+---------+| Afghanistan | 25500100   | 652230  || Algeria     | 37100000   | 2381741 |+-------------+------------+---------+\n\nè§£ç­”ï¼š\nselect * from (select * from World w1 where w1.area &gt; 3000000unionselect * from World w2 where w2.population &gt; 25000000)\n\nç­”æ¡ˆï¼šä½¿ç”¨ORè¿æ¥2ä¸ªå­æŸ¥è¯¢\nSELECT    name, population, areaFROM    worldWHERE    area &gt;= 3000000 OR population &gt;= 25000000;\nä½¿ç”¨UNIONè¿æ¥2ä¸ªå­æŸ¥è¯¢ï¼ŒUNIONé€‰å–ä¸åŒçš„å€¼ï¼Œé€‰å–ç›¸åŒçš„å€¼ä½¿ç”¨UNION ALL\nSELECT    name, population, areaFROM    worldWHERE    area &gt;= 3000000UNIONSELECT    name, population, areaFROM    worldWHERE    population &gt;= 25000000;\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"196.åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±","url":"/java4u/2022/02/06/196.%20%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1/","content":"ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥åˆ é™¤Â PersonÂ è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ï¼Œé‡å¤çš„é‚®ç®±é‡Œåªä¿ç•™Â IdÂ æœ€å°Â çš„é‚£ä¸ªã€‚\n+----+------------------+| Id | Email            |+----+------------------+| 1  | john@example.com || 2  | bob@example.com  || 3  | john@example.com |+----+------------------+\nId æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿è¡Œä½ çš„æŸ¥è¯¢è¯­å¥ä¹‹åï¼Œä¸Šé¢çš„ Person è¡¨åº”è¿”å›ä»¥ä¸‹å‡ è¡Œ:\n+----+------------------+| Id | Email            |+----+------------------+| 1  | john@example.com || 2  | bob@example.com  |+----+------------------+\n\næç¤ºï¼š\næ‰§è¡Œ SQL ä¹‹åï¼Œè¾“å‡ºæ˜¯æ•´ä¸ª PersonÂ è¡¨ã€‚ä½¿ç”¨ delete è¯­å¥ã€‚\nç­”æ¡ˆï¼š\nDELETE p1 FROM Person p1,    Person p2WHERE    p1.Email = p2.Email AND p1.Id &gt; p2.Id\nè§£ç­”ï¼šæŸ¥è¯¢é‡å¤çš„åˆ—ï¼Œå°†è¡¨ä¸è‡ªèº«é€šè¿‡Emailè¿æ¥\nSELECT p1.*FROM Person p1,    Person p2WHERE    p1.Email = p2.Email;\néœ€è¦æ‰¾åˆ°å…¶ä»–è®°å½•ä¸­å…·æœ‰ç›¸åŒç”µå­é‚®ä»¶åœ°å€çš„æ›´å¤§ IDã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç»™ WHERE å­å¥æ·»åŠ ä¸€ä¸ªæ–°çš„æ¡ä»¶é‡å¤çš„æ•°æ®ä¸­åªè¦idå¤§äºå…¶ä»–çš„idï¼Œå°±éœ€è¦è¢«åˆ é™¤\nSELECT p1.*FROM Person p1,    Person p2WHERE    p1.Email = p2.Email AND p1.Id &gt; p2.Id;","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"197.ä¸Šå‡çš„æ¸©åº¦","url":"/java4u/2022/02/06/197.%20%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A6/","content":"è¡¨ Weather\n+---------------+---------+| Column Name   | Type    |+---------------+---------+| id            | int     || recordDate    | date    || temperature   | int     |+---------------+---------+\nid æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®è¯¥è¡¨åŒ…å«ç‰¹å®šæ—¥æœŸçš„æ¸©åº¦ä¿¡æ¯\nÂ \nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥æŸ¥æ‰¾ä¸ä¹‹å‰ï¼ˆæ˜¨å¤©çš„ï¼‰æ—¥æœŸç›¸æ¯”æ¸©åº¦æ›´é«˜çš„æ‰€æœ‰æ—¥æœŸçš„ id ã€‚\nè¿”å›ç»“æœ ä¸è¦æ±‚é¡ºåº ã€‚\næŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹ï¼š\nWeather\n+----+------------+-------------+| id | recordDate | Temperature |+----+------------+-------------+| 1  | 2015-01-01 | 10          || 2  | 2015-01-02 | 25          || 3  | 2015-01-03 | 20          || 4  | 2015-01-04 | 30          |+----+------------+-------------+\nResult table:\n+----+| id |+----+| 2  || 4  |+----+\n2015-01-02 çš„æ¸©åº¦æ¯”å‰ä¸€å¤©é«˜ï¼ˆ10 -&gt; 25ï¼‰2015-01-04 çš„æ¸©åº¦æ¯”å‰ä¸€å¤©é«˜ï¼ˆ20 -&gt; 30ï¼‰\nç­”æ¡ˆï¼šMySQL ä½¿ç”¨ DATEDIFF æ¥æ¯”è¾ƒä¸¤ä¸ªæ—¥æœŸç±»å‹çš„å€¼DATEDIFF(date1,date2) è¿”å›date1-date2ç›¸å·®çš„å¤©æ•°\nselect \tw1.id from \tweather w1,weather w2where \tdatediff(w1.recordDate,w2.recordDate)=1 and w1.temperature &gt; w2.temperature ;","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"184.éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥","url":"/java4u/2022/02/05/184.%20%E9%83%A8%E9%97%A8%E5%B7%A5%E8%B5%84%E6%9C%80%E9%AB%98%E7%9A%84%E5%91%98%E5%B7%A5/","content":"è¡¨ï¼šÂ Employee\n+--------------+---------+| åˆ—å          | ç±»å‹    |+--------------+---------+| id           | int     || name         | varchar || salary       | int     || departmentId | int     |+--------------+---------+\nidæ˜¯æ­¤è¡¨çš„ä¸»é”®åˆ—ã€‚departmentIdæ˜¯Departmentè¡¨ä¸­IDçš„å¤–é”®ã€‚æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå‘˜å·¥çš„IDã€å§“åå’Œå·¥èµ„ã€‚å®ƒè¿˜åŒ…å«ä»–ä»¬æ‰€åœ¨éƒ¨é—¨çš„IDã€‚\nÂ \nè¡¨ï¼šÂ Department\n+-------------+---------+| åˆ—å         | ç±»å‹    |+-------------+---------+| id          | int     || name        | varchar |+-------------+---------+\nidæ˜¯æ­¤è¡¨çš„ä¸»é”®åˆ—ã€‚æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºä¸€ä¸ªéƒ¨é—¨çš„IDåŠå…¶åç§°ã€‚\nÂ \nç¼–å†™SQLæŸ¥è¯¢ä»¥æŸ¥æ‰¾æ¯ä¸ªéƒ¨é—¨ä¸­è–ªèµ„æœ€é«˜çš„å‘˜å·¥ã€‚æŒ‰ ä»»æ„é¡ºåº è¿”å›ç»“æœè¡¨ã€‚æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚\nÂ \nç¤ºä¾‹ 1:\nè¾“å…¥ï¼šEmployee è¡¨:\n+----+-------+--------+--------------+| id | name  | salary | departmentId |+----+-------+--------+--------------+| 1  | Joe   | 70000  | 1            || 2  | Jim   | 90000  | 1            || 3  | Henry | 80000  | 2            || 4  | Sam   | 60000  | 2            || 5  | Max   | 90000  | 1            |+----+-------+--------+--------------+\nDepartment è¡¨:\n+----+-------+| id | name  |+----+-------+| 1  | IT    || 2  | Sales |+----+-------+\nè¾“å‡ºï¼š\n+------------+----------+--------+| Department | Employee | Salary |+------------+----------+--------+| IT         | Jim      | 90000  || Sales      | Henry    | 80000  || IT         | Max      | 90000  |+------------+----------+--------+\nè§£é‡Šï¼šMax å’Œ Jim åœ¨ IT éƒ¨é—¨çš„å·¥èµ„éƒ½æ˜¯æœ€é«˜çš„ï¼ŒHenry åœ¨é”€å”®éƒ¨çš„å·¥èµ„æœ€é«˜ã€‚\nè§£ç­”ï¼š\nselect d.name Department ,t1.name Employee,t1.salary Salary from \tdepartment d join(\t\tselect e.* from \t\t\tEmployee e join ( \t\t\t\tselect departmentId,max(salary) max_sal from Employee\t\t\t\tgroup by departmentId\t\t\t) t\t\t\ton e.salary = t.max_sal\t\t\tand e.departmentId = t.departmentId\t) t1\ton d.id = t1.departmentId\nSELECT    Department.name AS &#x27;Department&#x27;,    Employee.name AS &#x27;Employee&#x27;,    SalaryFROM    Employee        JOIN    Department ON Employee.DepartmentId = Department.IdWHERE    (Employee.DepartmentId , Salary) IN    (   SELECT            DepartmentId, MAX(Salary)        FROM            Employee        GROUP BY DepartmentId\t);\nå°†å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ç”¨INæŸ¥è¯¢\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"185.éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥","url":"/java4u/2022/02/05/185.%20%E9%83%A8%E9%97%A8%E5%B7%A5%E8%B5%84%E5%89%8D%E4%B8%89%E9%AB%98%E7%9A%84%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5/","content":"Employee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„å·¥å·Â Idï¼Œå§“å Nameï¼Œå·¥èµ„ Salary å’Œéƒ¨é—¨ç¼–å· DepartmentId ã€‚\n+----+-------+--------+--------------+| Id | Name  | Salary | DepartmentId |+----+-------+--------+--------------+| 1  | Joe   | 85000  | 1            || 2  | Henry | 80000  | 2            || 3  | Sam   | 60000  | 2            || 4  | Max   | 90000  | 1            || 5  | Janet | 69000  | 1            || 6  | Randy | 85000  | 1            || 7  | Will  | 70000  | 1            |+----+-------+--------+--------------+\nDepartment è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ã€‚\n+----+----------+| Id | Name     |+----+----------+| 1  | IT       || 2  | Sales    |+----+----------+\nç¼–å†™ä¸€ä¸ªÂ SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨è·å¾—å‰ä¸‰é«˜å·¥èµ„çš„æ‰€æœ‰å‘˜å·¥ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„è¡¨ï¼ŒæŸ¥è¯¢ç»“æœåº”è¿”å›ï¼š\n+------------+----------+--------+| Department | Employee | Salary |+------------+----------+--------+| IT         | Max      | 90000  || IT         | Randy    | 85000  || IT         | Joe      | 85000  || IT         | Will     | 70000  || Sales      | Henry    | 80000  || Sales      | Sam      | 60000  |+------------+----------+--------+\nè§£é‡Šï¼š\nIT éƒ¨é—¨ä¸­ï¼ŒMax è·å¾—äº†æœ€é«˜çš„å·¥èµ„ï¼ŒRandy å’Œ Joe éƒ½æ‹¿åˆ°äº†ç¬¬äºŒé«˜çš„å·¥èµ„ï¼ŒWill çš„å·¥èµ„æ’ç¬¬ä¸‰ã€‚é”€å”®éƒ¨é—¨ï¼ˆSalesï¼‰åªæœ‰ä¸¤åå‘˜å·¥ï¼ŒHenry çš„å·¥èµ„æœ€é«˜ï¼ŒSam çš„å·¥èµ„æ’ç¬¬äºŒã€‚\nè§£ç­”ï¼š\nselect \tDepartment,Employee,Salaryfrom (\tselect \t\te.name Employee, e.salary Salary, d.name Department,\t\tdense_rank() over(partition by departmentId order by salary desc) sal_rank\tfrom employee e,department d\twhere \t\te.departmentId = d.id)twhere \tsal_rank&lt;=3","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"182.æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±","url":"/java4u/2022/02/04/182.%20%E6%9F%A5%E6%89%BE%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1/","content":"ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾Â Person è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ã€‚\nç¤ºä¾‹ï¼š\n+----+---------+| Id | Email   |+----+---------+| 1  | a@b.com || 2  | c@d.com || 3  | a@b.com |+----+---------+\næ ¹æ®ä»¥ä¸Šè¾“å…¥ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š\n+---------+| Email   |+---------+| a@b.com |+---------+\nè¯´æ˜ï¼šæ‰€æœ‰ç”µå­é‚®ç®±éƒ½æ˜¯å°å†™å­—æ¯ã€‚\nè§£ç­”ï¼š\nselect * from Person group by Email\nç­”æ¡ˆï¼š\nselect Email from(  select Email, count(Email) as num  from Person  group by Email) as statisticwhere num &gt; 1;\n\nè§£é‡Šï¼šä½¿ç”¨ä¸´æ—¶è¡¨å­˜å‚¨æ¯å°ç”µå­é‚®ä»¶çš„æ¬¡æ•°\nselect Email, count(Email) as numfrom Persongroup by Email;\ngroup byå¯¹ç»“æœé›†è¿›è¡Œåˆ†ç»„ï¼Œå‰é¢æŸ¥è¯¢çš„å­—æ®µéœ€è¦æ˜¯ç›¸åŒçš„å­—æ®µæˆ–è€…æ˜¯å‡½æ•°\nselect Emailfrom Persongroup by Emailhaving count(Email) &gt; 1;\nä½¿ç”¨havingç­›é€‰ç»“æœé›†æ›´åŠ é«˜æ•ˆ\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"183.ä»ä¸è®¢è´­çš„å®¢æˆ·","url":"/java4u/2022/02/04/183.%20%E4%BB%8E%E4%B8%8D%E8%AE%A2%E8%B4%AD%E7%9A%84%E5%AE%A2%E6%88%B7/","content":"æŸç½‘ç«™åŒ…å«ä¸¤ä¸ªè¡¨ï¼ŒCustomers è¡¨å’Œ Orders è¡¨ã€‚ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»ä¸è®¢è´­ä»»ä½•ä¸œè¥¿çš„å®¢æˆ·ã€‚\nCustomers è¡¨ï¼š\n+----+-------+| Id | Name  |+----+-------+| 1  | Joe   || 2  | Henry || 3  | Sam   || 4  | Max   |+----+-------+\nOrders è¡¨ï¼š\n+----+------------+| Id | CustomerId |+----+------------+| 1  | 3          || 2  | 1          |+----+------------+\nä¾‹å¦‚ç»™å®šä¸Šè¿°è¡¨æ ¼ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ï¼š\n+-----------+| Customers |+-----------+| Henry     || Max       |+-----------+\n\nç­”æ¡ˆï¼š\nselect customers.name as &#x27;Customers&#x27;from customerswhere customers.id not in(    select customerid from orders);\n\nè§£ç­”ï¼šselect customerid from orders;è·å–è®¢è´­è¿‡çš„å®¢æˆ·åˆ—è¡¨\nä½¿ç”¨ NOT IN æŸ¥è¯¢ä¸åœ¨æ­¤åˆ—è¡¨ä¸­çš„å®¢æˆ·\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"181.è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥","url":"/java4u/2022/02/03/181.%E8%B6%85%E8%BF%87%E7%BB%8F%E7%90%86%E6%94%B6%E5%85%A5%E7%9A%84%E5%91%98%E5%B7%A5/","content":"EmployeeÂ è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ï¼Œä»–ä»¬çš„ç»ç†ä¹Ÿå±äºå‘˜å·¥ã€‚æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ä¸€ä¸ª Idï¼Œæ­¤å¤–è¿˜æœ‰ä¸€åˆ—å¯¹åº”å‘˜å·¥çš„ç»ç†çš„ Idã€‚\n+----+-------+--------+-----------+| Id | Name  | Salary | ManagerId |+----+-------+--------+-----------+| 1  | Joe   | 70000  | 3         || 2  | Henry | 80000  | 4         || 3  | Sam   | 60000  | NULL      || 4  | Max   | 90000  | NULL      |+----+-------+--------+-----------+\nç»™å®šÂ EmployeeÂ è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢å¯ä»¥è·å–æ”¶å…¥è¶…è¿‡ä»–ä»¬ç»ç†çš„å‘˜å·¥çš„å§“åã€‚åœ¨ä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼ŒJoe æ˜¯å”¯ä¸€ä¸€ä¸ªæ”¶å…¥è¶…è¿‡ä»–çš„ç»ç†çš„å‘˜å·¥ã€‚\n+----------+| Employee |+----------+| Joe      |+----------+\n\nç»ƒä¹ ï¼š\nselect Name from(\tselect * from(\tselect y.Salary ys, m.Salary ms,Name,ManagerId from  Employee e left join Employee m on e.ManagerId=m.Id\twhere  ManagerId is not null\t) where ys &gt; ms)\n\n\nè§£ç­”ï¼š\nSELECT    a.Name AS &#x27;Employee&#x27;FROM    Employee AS a,    Employee AS bWHERE    a.ManagerId = b.Id    AND a.Salary &gt; b.Salary;\n\nSELECT     a.NAME AS EmployeeFROM Employee AS a JOIN Employee AS b     ON a.ManagerId = b.Id     AND a.Salary &gt; b.Salary;\n\nè§£é‡Šï¼šéœ€è¦ä»è¡¨ä¸­è·å–2æ¬¡ä¿¡æ¯SELECT *FROM Employee AS a, Employee AS b;è·å¾—2ä¸ªè¡¨çš„ç¬›å¡å°”ç§¯16æ¡è®°å½•æ·»åŠ è¿‡æ»¤æ¡ä»¶\nSELECT    *FROM    Employee AS a,    Employee AS bWHERE    a.ManagerId = b.Id    AND a.Salary &gt; b.Salary;","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"180.è¿ç»­å‡ºç°çš„æ•°å­—","url":"/java4u/2022/02/03/180.%20%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%95%B0%E5%AD%97/","content":"è¡¨ï¼šLogs\n+-------------+---------+| Column Name | Type    |+-------------+---------+| id          | int     || num         | varchar |+-------------+---------+\nid æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚\nÂ \nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾æ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—ã€‚\nè¿”å›çš„ç»“æœè¡¨ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ ä»»æ„é¡ºåº æ’åˆ—ã€‚\nÂ \næŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼š\nÂ \nLogs è¡¨ï¼š\n+----+-----+| Id | Num |+----+-----+| 1  | 1   || 2  | 1   || 3  | 1   || 4  | 2   || 5  | 1   || 6  | 2   || 7  | 2   |+----+-----+\nResult è¡¨ï¼š\n+-----------------+| ConsecutiveNums |+-----------------+| 1               |+-----------------+\n1 æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—ã€‚\nç­”æ¡ˆï¼š\nSELECT DISTINCT    l1.Num AS ConsecutiveNumsFROM    Logs l1,    Logs l2,    Logs l3WHERE    l1.Id = l2.Id - 1    AND l2.Id = l3.Id - 1    AND l1.Num = l2.Num    AND l2.Num = l3.Num;\n\nç­”æ¡ˆï¼š\nSELECT DISTINCT    l1.Num AS ConsecutiveNumsFROM    Logs l1,    Logs l2,    Logs l3WHERE    l1.Id = l2.Id - 1    AND l2.Id = l3.Id - 1    AND l1.Num = l2.Num    AND l2.Num = l3.Num;\nä¸Šè¡¨ä¸­é€‰æ‹©ä»»æ„çš„ Num è·å¾—æƒ³è¦çš„ç­”æ¡ˆã€‚åŒæ—¶æˆ‘ä»¬éœ€è¦æ·»åŠ å…³é”®å­— DISTINCT ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªæ•°å­—è¿ç»­å‡ºç°è¶…è¿‡ 3 æ¬¡ï¼Œä¼šè¿”å›é‡å¤å…ƒç´ ã€‚\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"177.ç¬¬Né«˜çš„è–ªæ°´","url":"/java4u/2022/02/02/177.%20%E7%AC%ACN%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B4/","content":"ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– Employee è¡¨ä¸­ç¬¬Â nÂ é«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰ã€‚\n+----+--------+| Id | Salary |+----+--------+| 1  | 100    || 2  | 200    || 3  | 300    |+----+--------+\nä¾‹å¦‚ä¸Šè¿°Â EmployeeÂ è¡¨ï¼Œn &#x3D; 2Â æ—¶ï¼Œåº”è¿”å›ç¬¬äºŒé«˜çš„è–ªæ°´Â 200ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬Â nÂ é«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å›Â nullã€‚\n+------------------------+| getNthHighestSalary(2) |+------------------------+| 200                    |+------------------------+\n\nç­”æ¡ˆï¼š\nCREATE FUNCTION getNthHighestSalary(N INT) RETURNS INTBEGIN    SET N := N-1;  RETURN (      # Write your MySQL query statement below.      SELECT             salary      FROM             employee      GROUP BY             salary      ORDER BY             salary DESC      LIMIT N, 1  );END\nåŒè–ªåŒåä¸”ä¸è·³çº§çš„é—®é¢˜ï¼Œè§£å†³åŠæ³•æ˜¯ç”¨group byæŒ‰è–ªæ°´åˆ†ç»„åå†order byæ’åç¬¬Né«˜æ„å‘³ç€è¦è·³è¿‡N-1ä¸ªè–ªæ°´ï¼Œç”±äºæ— æ³•ç›´æ¥ç”¨limit N-1ï¼Œæ‰€ä»¥éœ€å…ˆåœ¨å‡½æ•°å¼€å¤´å¤„ç†Nä¸ºN&#x3D;N-1ã€‚æ³¨ï¼šè¿™é‡Œä¸èƒ½ç›´æ¥ç”¨limit N-1æ˜¯å› ä¸ºlimitå’Œoffsetå­—æ®µåé¢åªæ¥å—æ­£æ•´æ•°ï¼ˆæ„å‘³ç€0ã€è´Ÿæ•°ã€å°æ•°éƒ½ä¸è¡Œï¼‰æˆ–è€…å•ä¸€å˜é‡ï¼ˆæ„å‘³ç€ä¸èƒ½ç”¨è¡¨è¾¾å¼ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æƒ³å–ä¸€æ¡ï¼Œlimit 2-1ã€limit 1.1è¿™ç±»çš„å†™æ³•éƒ½æ˜¯æŠ¥é”™çš„ã€‚\nCREATE FUNCTION getNthHighestSalary(N INT) RETURNS INTBEGIN  RETURN (      # Write your MySQL query statement below.        SELECT             DISTINCT salary        FROM             (SELECT                 salary, dense_rank() over(ORDER BY salary DESC) AS rnk             FROM                 employee) tmp        WHERE rnk = N  );END\n\nrow_number(): åŒè–ªä¸åŒåï¼Œç›¸å½“äºè¡Œå·ï¼Œä¾‹å¦‚3000ã€2000ã€2000ã€1000æ’ååä¸º1ã€2ã€3ã€4rank(): åŒè–ªåŒåï¼Œæœ‰è·³çº§ï¼Œä¾‹å¦‚3000ã€2000ã€2000ã€1000æ’ååä¸º1ã€2ã€2ã€4dense_rank(): åŒè–ªåŒåï¼Œæ— è·³çº§ï¼Œä¾‹å¦‚3000ã€2000ã€2000ã€1000æ’ååä¸º1ã€2ã€2ã€3ntile(): åˆ†æ¡¶æ’åï¼Œå³é¦–å…ˆæŒ‰æ¡¶çš„ä¸ªæ•°åˆ†å‡ºç¬¬ä¸€äºŒä¸‰æ¡¶ï¼Œç„¶åå„æ¡¶å†…ä»1æ’åï¼Œå®é™…ä¸æ˜¯å¾ˆå¸¸ç”¨æ˜¾ç„¶ï¼Œæœ¬é¢˜æ˜¯è¦ç”¨ç¬¬ä¸‰ä¸ªå‡½æ•°ã€‚å¦å¤–è¿™ä¸‰ä¸ªå‡½æ•°å¿…é¡»è¦è¦ä¸å…¶æ­æ¡£over()é…å¥—ä½¿ç”¨ï¼Œover()ä¸­çš„å‚æ•°å¸¸è§çš„æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯partition byï¼ŒæŒ‰æŸå­—æ®µåˆ‡åˆ†order byï¼Œä¸å¸¸è§„order byç”¨æ³•ä¸€è‡´ï¼Œä¹ŸåŒºåˆ†ASC(é»˜è®¤)å’ŒDESCï¼Œå› ä¸ºæ’åæ€»å¾—æœ‰ä¸ªä¾æ®\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"178.åˆ†æ•°æ’å","url":"/java4u/2022/02/02/178.%20%E5%88%86%E6%95%B0%E6%8E%92%E5%90%8D/","content":"ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥å®ç°åˆ†æ•°æ’åã€‚\nå¦‚æœä¸¤ä¸ªåˆ†æ•°ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªåˆ†æ•°æ’åï¼ˆRankï¼‰ç›¸åŒã€‚è¯·æ³¨æ„ï¼Œå¹³åˆ†åçš„ä¸‹ä¸€ä¸ªåæ¬¡åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªè¿ç»­çš„æ•´æ•°å€¼ã€‚æ¢å¥è¯è¯´ï¼Œåæ¬¡ä¹‹é—´ä¸åº”è¯¥æœ‰â€œé—´éš”â€ã€‚\n+----+-------+| Id | Score |+----+-------+| 1  | 3.50  || 2  | 3.65  || 3  | 4.00  || 4  | 3.85  || 5  | 4.00  || 6  | 3.65  |+----+-------+\nä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„Â Scores è¡¨ï¼Œä½ çš„æŸ¥è¯¢åº”è¯¥è¿”å›ï¼ˆæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åˆ—ï¼‰ï¼š\n+-------+------+| Score | Rank |+-------+------+| 4.00  | 1    || 4.00  | 1    || 3.85  | 2    ||Â 3.65  | 3    || 3.65  | 3    || 3.50  | 4    |+-------+------+\né‡è¦æç¤ºï¼šå¯¹äº MySQL è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœè¦è½¬ä¹‰ç”¨ä½œåˆ—åçš„ä¿ç•™å­—ï¼Œå¯ä»¥åœ¨å…³é”®å­—ä¹‹å‰å’Œä¹‹åä½¿ç”¨æ’‡å·ã€‚ä¾‹å¦‚ Rank\nç­”æ¡ˆï¼š\nselect     Score, dense_rank() over(order by Score desc) &#x27;RANK&#x27; from Scores","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"176.ç¬¬äºŒé«˜çš„è–ªæ°´","url":"/java4u/2022/02/01/176.%20%E7%AC%AC%E4%BA%8C%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B4/","content":"Employee è¡¨ï¼š\n+-------------+------+| Column Name | Type |+-------------+------+| id          | int  || salary      | int  |+-------------+------+\nid æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«å‘˜å·¥çš„å·¥èµ„ä¿¡æ¯ã€‚\nÂ \nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å–å¹¶è¿”å› EmployeeÂ è¡¨ä¸­ç¬¬äºŒé«˜çš„è–ªæ°´ ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ŒæŸ¥è¯¢åº”è¯¥è¿”å› null ã€‚\næŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚\nÂ \nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šEmployee è¡¨ï¼š\n+----+--------+| id | salary |+----+--------+| 1  | 100    || 2  | 200    || 3  | 300    |+----+--------+\nè¾“å‡ºï¼š\n+---------------------+| SecondHighestSalary |+---------------------+| 200                 |+---------------------+\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šEmployee è¡¨ï¼š\n+----+--------+| id | salary |+----+--------+| 1  | 100    |+----+--------+\nè¾“å‡ºï¼š\n+---------------------+| SecondHighestSalary |+---------------------+| null                |+---------------------+\n\nç­”æ¡ˆï¼š\nSELECT    (SELECT DISTINCT            Salary        FROM            Employee        ORDER BY Salary DESC        LIMIT 1 OFFSET 1) AS SecondHighestSalary;\nè®©è–ªæ°´å»é‡æ’åºï¼Œå»é™¤é‡å¤çš„è–ªæ°´æ²¡æœ‰ç¬¬äºŒé«˜çš„è–ªæ°´æ—¶ä¸ä¼šè¿”å›ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œå»è¿”å›ç­”æ¡ˆ\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"175.ç»„åˆä¸¤ä¸ªè¡¨","url":"/java4u/2022/02/01/175.%E7%BB%84%E5%90%88%E4%B8%A4%E4%B8%AA%E8%A1%A8/","content":"è¡¨1: Person\n+-------------+---------+| åˆ—å         | ç±»å‹     |+-------------+---------+| PersonId    | int     || FirstName   | varchar || LastName    | varchar |+-------------+---------+\nPersonId æ˜¯ä¸Šè¡¨ä¸»é”®è¡¨2: Address\n+-------------+---------+| åˆ—å         | ç±»å‹    |+-------------+---------+| AddressId   | int     || PersonId    | int     || City        | varchar || State       | varchar |+-------------+---------+\nAddressId æ˜¯ä¸Šè¡¨ä¸»é”®\nÂ \nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ»¡è¶³æ¡ä»¶ï¼šæ— è®º person æ˜¯å¦æœ‰åœ°å€ä¿¡æ¯ï¼Œéƒ½éœ€è¦åŸºäºä¸Šè¿°ä¸¤è¡¨æä¾›Â person çš„ä»¥ä¸‹ä¿¡æ¯ï¼šÂ FirstName, LastName, City, State\nç»ƒä¹ ï¼š\nselect FirstName,LastName,City,State from (\tselect * from Person a left join Address b on a.PersonId=b.PersonId )\n\n\nç­”æ¡ˆï¼š\nselect FirstName, LastName, City, Statefrom Person left join Addresson Person.PersonId = Address.PersonId;\nè§£é‡Šï¼šjoinå¯ä»¥çœ‹æˆå°†2å¼ è¡¨åˆä¸º1å¼ è¡¨\n","categories":["SQL"],"tags":["å­¦ä¹ "]},{"title":"æ±Ÿè‹æ‰˜æ”¶æ°¸ä¸åœæœºæ–¹æ¡ˆ","url":"/java4u/2021/11/25/%E6%B1%9F%E8%8B%8F%E6%89%98%E6%94%B6%E6%B0%B8%E4%B8%8D%E5%81%9C%E6%9C%BA%E6%96%B9%E6%A1%88/","content":"æ°¸ä¸åœæœºè§„åˆ™æ°¸ä¸åœæœºæ˜¯ä¸é“¶è”è¿›è¡Œå¯¹æ¥ï¼Œç”¨æˆ·é€šè¿‡æä¾›é“¶è¡Œå¡å·ã€å§“åã€èº«ä»½è¯ä¿¡æ¯ï¼Œåœ¨æˆ‘æ–¹è¥ä¸šå…æŸœå°ç­¾è®¢ä»£æ‰£åè®®è¿›è¡Œç­¾çº¦ç»‘å®šï¼Œç­¾çº¦æ—¶ç”¨æˆ·å¯è‡ªè¡Œè®¾ç½®ä¸è¶³é¢åº¦ï¼ˆå¦‚5å…ƒã€30å…ƒã€50å…ƒï¼‰å’Œæ¯æ¬¡ä»£æ‰£é¢åº¦ï¼ˆå¦‚50å…ƒã€100å…ƒã€300å…ƒï¼‰ã€‚æ°¸ä¸åœæœºæ¯æ—¥å‘èµ·ä¸€æ¬¡ä»£æ‰£ï¼Œå½“ç”¨æˆ·è´¦æˆ·é¢åº¦ä¸è¶³é¢„è®¾é™é¢åï¼Œè‡ªåŠ¨å‘é“¶è”å‘èµ·æ‰£æ¬¾è¯·æ±‚ï¼Œä»ç”¨æˆ·é“¶è¡Œå¡ä¸­è¿›è¡Œæ‰£æ¬¾å¹¶å……å€¼ï¼Œæ‰£æ¬¾é‡‘é¢ä¸ºç”¨æˆ·ç­¾çº¦æ—¶é¢„è®¾é‡‘é¢ï¼Œå¦‚ä»£æ‰£åä½™é¢ä»ä¸è¶³é™é¢ï¼Œå¯ä¸€æ¬¡å‘èµ·å¤šç¬”æ‰£æ¬¾ç›´è‡³ä½™é¢æ»¡è¶³é™é¢ã€‚ä»£æ‰£ä»»åŠ¡å®æ—¶æ‰£æ¬¾åï¼Œå°†æ‰£æ¬¾æˆåŠŸä¸å¦ä¿¡æ¯å‘ç»™æˆ‘æ–¹ï¼Œæˆ‘æ–¹æ ¹æ®æ‰£æ¬¾æƒ…å†µè¿›è¡ŒBOSSå…¥è´¦ã€‚\né—®é¢˜1.å¦‚ä½•åŒºåˆ†æ™®é€šå®¢æˆ·å’Œæ°¸ä¸åœæœºå®¢æˆ·ï¼Ÿ  ç­¾çº¦æ—¶ç­¾çº¦è¡¨æ·»åŠ æ°¸ä¸åœæœºçš„æ ‡è¯†\nEntrustCreateTask   è·å–AM_ENTRUST_CREATE_NOTIFY æ‰˜æ”¶å‘èµ·é€šçŸ¥è¡¨ ä¸­state&#x3D;1 æœªå¤„ç†çš„æ•°æ®å¤„ç†å®Œå°†stateæ›´æ–°ä¸º2 å¤„ç†ä¸­\n2.é€šè¿‡å‘èµ·ä»»åŠ¡ç”Ÿæˆæ‰˜æ”¶æ˜ç»†è¡¨ï¼Œä¹‹åå†è¿›è¡Œç®—è´¹ï¼Œå€˜è‹¥ä»£æ‰£çš„é‡‘é¢æ¯”è¾ƒå°‘ï¼Œé‚£å°±éœ€è¦åå¤å‘èµ·æ‰˜æ”¶ï¼Œè¿›è¡Œåå¤ç®—è´¹ï¼Ÿ\næ¯æ—¥åªå‘èµ·ä¸€æ¬¡æ‰˜æ”¶ï¼Œä»£æ‰£é‡‘é¢ä¸å¤Ÿå°±æ¯å¤©å‘èµ·æ‰˜æ”¶ï¼Œç›´è‡³é‡‘é¢åˆ°è¾¾è®¾å®šçš„é˜™å€¼\n3.åœ¨æ‰˜æ”¶æ–‡ä»¶å‘é€çš„æ—¶å€™ï¼Œåå¤å‘èµ·æ‰£æ¬¾è¯·æ±‚\næ¯æ—¥ä¸€æ¬¡ï¼Œä¸ä¼šå‘èµ·å¤šæ¬¡æ‰£æ¬¾\n4.éœ€è¦è°ƒæŸ¥æ¬ æŸ¥è¯¢ç”¨æˆ·é‡‘é¢ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šè¶…æ—¶å¦‚ä½•è§£å†³\nå°†æŸ¥è¯¢éƒ¨åˆ†æ”¾åˆ°ç®—è´¹è¿›ç¨‹å»å¤„ç†\n5.æ‰˜æ”¶ä¸è¶³é‡‘é¢å’Œæ‰˜æ”¶é‡‘é¢æ˜¯å“ªä¸ªå­—æ®µï¼Ÿæ°¸ä¸åœæœºè¿›ç¨‹æ¯å¤©æŸ¥è¯¢ä¸€æ¬¡ç­¾çº¦è¡¨ am_entrust_relation åˆ†å…¬å¸ä¸º1001ï¼Œç±»å‹ä¸ºæ°¸ä¸åœæœºçš„æ•°æ®åŒæ—¶é¡µé¢ä¸èƒ½æŸ¥è¯¢åˆ°æ°¸ä¸åœæœºçš„æ•°æ®  â€”â€”é¡µé¢æŸ¥è¯¢éœ€è¦è°ƒæ•´ä¸è¶³ä½™é¢æ˜¯æ€»é¢è¿˜æ˜¯æŸä¸ªä¸šåŠ¡ä¸è¶³\nå¤§æ¦‚æ–¹æ¡ˆæ­¥éª¤ä¸€ï¼šç”Ÿæˆæ‰˜æ”¶é€šçŸ¥ æ¯æ—¥ä»åå°å‘èµ·ä¸€æ¬¡æ‰˜æ”¶é€šçŸ¥&#123;&quot;SELECT t.STATE ,t.* FROM ac.AM_ENTRUST_CREATE_NOTIFY t \\r\\n\\tWHERE BANK_ID =&#x27;1000001005&#x27; AND CORP_ORG_ID =&#x27;1001&#x27; AND SRC_TYPE =&#x27;6&#x27;&quot;: [       &#123;  &quot;STATE&quot; : 1,  &quot;NOTIFY_ID&quot; : 26153,  &quot;BANK_ID&quot; : 1000001005,  &quot;BANK_NAME&quot; : &quot;ä¸­å›½é“¶è”&quot;,  &quot;STAFF_ID&quot; : 100016545,  &quot;CORP_ORG_ID&quot; : 1001,  &quot;CORP_ORG_NAME&quot; : &quot;è‹å·åˆ†å…¬å¸&quot;,  &quot;CREATE_TIME&quot; : &quot;2021-12-31T02:25:38.000Z&quot;,  &quot;STATE&quot; : 1,  &quot;STATE_TIME&quot; : &quot;2021-12-31T02:25:38.000Z&quot;,  &quot;REMARK&quot; : &quot;æ°¸ä¸åœæœºé€šçŸ¥&quot;,  &quot;BUSI_TYPE&quot; : 2,  &quot;END_MON&quot; : &quot;2099-12-30T16:00:00.000Z&quot;,  &quot;SRC_TYPE&quot; : 6,  &quot;PAYBOSS_BATCH_ID&quot; : null   &#125;]&#125;\n\næ­¥éª¤äºŒï¼šç”Ÿæˆæ‰˜æ”¶æ˜ç»†&#123;&quot;--æ‰˜æ”¶æ˜ç»†è¡¨\\r\\nSELECT t.STATE,t.AMOUNT,t.* FROM ac.AM_ENTRUST_CREATE_DTL t WHERE corp_org_id=1001 AND BANK_ID =1000001005&quot;: [       &#123;   &quot;STATE&quot; : 5,   &quot;AMOUNT&quot; : null,   &quot;ENTRUST_CREATE_DTL_ID&quot; : 6794129,   &quot;ENTRUST_CREATE_ID&quot; : null,   &quot;CUST_NAME&quot; : &quot;æœ±å¿ å&quot;,   &quot;CUST_CODE&quot; : &quot;8523030001086&quot;,   &quot;BUSI_TYPE&quot; : 2,   &quot;CORP_ORG_ID&quot; : 1001,   &quot;CORP_ORG_NAME&quot; : &quot;è‹å·åˆ†å…¬å¸&quot;,   &quot;ACCT_ID&quot; : 990002563106,   &quot;ACCT_NAME&quot; : &quot;æœ±å¿ å&quot;,   &quot;ACCT_TYPE&quot; : 1,   &quot;BANK_ID&quot; : 1000001005,   &quot;BANK_NAME&quot; : &quot;å»ºè®¾é“¶è¡Œ&quot;,   &quot;BANK_ACCT_ID&quot; : &quot;6221662072485938&quot;,   &quot;BANK_ACCT_NAME&quot; : &quot;8523030001086&quot;,   &quot;BANK_ACCT_TYPE&quot; : 5,   &quot;AMOUNT&quot; : null,   &quot;START_TIME&quot; : &quot;2021-12-31T02:24:10.000Z&quot;,   &quot;END_TIME&quot; : &quot;2021-12-31T02:24:10.000Z&quot;,   &quot;CREATE_TIME&quot; : &quot;2021-12-31T02:24:10.000Z&quot;,   &quot;BANK_DEAL_TIME&quot; : null,   &quot;STATE&quot; : 5,   &quot;STATE_TIME&quot; : &quot;2021-12-31T02:24:10.000Z&quot;,   &quot;IS_ERR&quot; : null,   &quot;ERR_CODE&quot; : null,   &quot;ERR_MSG&quot; : null,   &quot;REMARK&quot; : null,   &quot;CONTRACT_CODE&quot; : null,   &quot;CUST_ID&quot; : 2478574,   &quot;ENTRUST_DEAL_ID&quot; : 0,   &quot;SERV_ID&quot; : null,   &quot;SERVICE_ID&quot; : null,   &quot;BUSI_TYPE_NAME&quot; : null,   &quot;AMOUNT_LABEL&quot; : null,   &quot;SERVICE_NAME&quot; : null,   &quot;BANK_ACCT_BANK_ID&quot; : null,   &quot;AUTHOR_NO&quot; : null,   &quot;MEASURE_CODE&quot; : null,   &quot;ENTRUST_MONTHS&quot; : 0,   &quot;GIFT_MONTHS&quot; : 0,   &quot;ENTRUST_AMOUNT&quot; : 0,   &quot;GIFT_AMOUNT&quot; : 0,   &quot;PRICE_KIND_ID&quot; : 0,   &quot;NOTIFY_ID&quot; : 26153,   &quot;ENTRUST_RELATION_ID&quot; : 16851,   &quot;USER_TYPE&quot; : null   &#125;]&#125;UPDATE AM_ENTRUST_CREATE_NOTIFY  SET  STATE_TIME = ?,STATE = 2  where  STATE = ? and NOTIFY_ID = ?\n\næ­¥éª¤ä¸‰:è®¡ç®—æ‰˜æ”¶é‡‘é¢update AM_ENTRUST_CREATE_DTL set  STATE_TIME = ? ,STATE = 6, END_TIME = ?, AMOUNT = ? where  ENTRUST_CREATE_DTL_ID = ?\n\næ­¥éª¤å››ï¼šç”Ÿæˆæ‰˜æ”¶æ–‡ä»¶åç§°ï¼Œç”Ÿæˆæ‰˜æ”¶æ€»è¡¨update AM_ENTRUST_CREATE_DTL set  STATE_TIME = ? ,STATE = 2, ENTRUST_CREATE_ID = ?    where  ENTRUST_CREATE_DTL_ID = ?&#123;&quot;SELECT * FROM ac.AM_ENTRUST_CREATE WHERE BANK_ID =1000001005&quot;: [        &#123;    &quot;ENTRUST_CREATE_ID&quot; : 1976467,    &quot;FILE_NAME&quot; : &quot;9001_2000_Send202112316467.txt&quot;,    &quot;BANK_ID&quot; : 1000001005,    &quot;BANK_NAME&quot; : &quot;ä¸­å›½é“¶è”&quot;,    &quot;CORP_ORG_ID&quot; : 1001,    &quot;CORP_ORG_NAME&quot; : &quot;è‹å·åˆ†å…¬å¸&quot;,    &quot;TOTAL_AMOUNT&quot; : 10,    &quot;TOTAL_NUM&quot; : 1,    &quot;SUCC_NUM&quot; : null,    &quot;FAIL_NUM&quot; : null,    &quot;FORMAT_ERR_NUM&quot; : null,    &quot;STAFF_ID&quot; : 100016545,    &quot;CREATE_TIME&quot; : &quot;2021-12-31T03:13:23.000Z&quot;,    &quot;STATE&quot; : 1,    &quot;STATE_TIME&quot; : &quot;2021-12-31T03:13:23.000Z&quot;,    &quot;REMARK&quot; : null,    &quot;SRC_TYPE&quot; : 6,    &quot;BUSI_TYPE&quot; : 2,    &quot;AUTH_STATE&quot; : null,    &quot;AUDITOR_ID&quot; : null,    &quot;AUTH_TIME&quot; : null,    &quot;NOTIFY_ID&quot; : 26153    &#125;]&#125;UPDATE AM_ENTRUST_CREATE_NOTIFY  SET  STATE_TIME = ?,STATE = 3    where  STATE = ? and NOTIFY_ID = ?\n\næ­¥éª¤äº”ï¼šè‡ªåŠ¨é€æ‰˜æ–‡ä»¶ç”Ÿæˆå¹¶ä¸Šå‘æ‰˜æ”¶æ–‡ä»¶\nupdate AM_ENTRUST_CREATE set STATE = 2,STATE_TIME = ? where ROWID = ?\n\næ­¥éª¤å…­ï¼šå›ç›˜æ–‡ä»¶å¤„ç†ï¼ˆå›ç›˜è¿›è¡Œè§£æï¼‰ä»»åŠ¡è¿›ç¨‹ä¼˜åŒ–åŸå…ˆç­–ç•¥ï¼šå†™ä¸€ä¸ªä»»åŠ¡ç±»ç»§æ‰¿AbstractSingleTaskDealï¼Œè¯¥ä»»åŠ¡ç±»å¯ä»¥è¿›è¡ŒæŸ¥è¯¢æ•°æ®å’Œåˆ†å‘å¤„ç†æ•°æ®çš„æ“ä½œ    ç¼ºç‚¹ï¼šè°ƒåº¦å’Œåˆ†å‘ä»£ç ä¸ä¸šåŠ¡ä»£ç æ··åˆï¼Œé›†ç¾¤å¤„ç†ä»»åŠ¡æ—¶ï¼Œéœ€è¦é…ç½®é€šé“å·ï¼Œå¯åŠ¨å¤šä¸ªè¿›ç¨‹ä»»åŠ¡è¿›è¡Œå¤„ç†\nä¼˜åŒ–ç­–ç•¥ï¼šxxl-jobè°ƒåº¦ä»»åŠ¡ï¼ˆé€‰å‹ï¼šquarts,Elastic-job,xxl-jobï¼Œé€‰å‹åŸå› è½»é‡çº§ï¼Œèå…¥é¡¹ç›®ç®€å•ï¼Œæ”¯æŒåˆ†å¸ƒå¼è°ƒåº¦ï¼‰\n1.ä¸‹è½½ä»£ç å’Œä¾èµ–\n&lt;dependency&gt;    &lt;groupId&gt;com.xuxueli&lt;/groupId&gt;    &lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt;    &lt;version&gt;2.3.0&lt;/version&gt;&lt;/dependency&gt;\n\n2.æ–°å»ºåº“å’Œè¡¨tables_xxl_job.sql\n3.å¯åŠ¨æ§åˆ¶å°\n\n4.ç¼–å†™æ‰§è¡Œå™¨ä»£ç ï¼Œä¿®æ”¹æ‰§è¡Œå™¨å’Œåˆå§‹åŒ–æ”¯æŒä¼ å…¥ç«¯å£\n/** * æ°¸ä¸åœæœº * cron  0 0 2 * * ?   æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ * */@XxlJob(&quot;entrustNeverStopTaskHandler&quot;)public void entrustNeverStopTaskHandler() throws Exception &#123;    XxlJobHelper.log(&quot;EntrustNeverStopTaskHandler start&quot;);    EntrustNeverStopTaskApp app = new EntrustNeverStopTaskApp();    app.createEntrustNotify();    XxlJobHelper.log(&quot;EntrustNeverStopTaskHandler end&quot;);&#125;/** * è‡ªåŠ¨é€æ‰˜ * cron 0 0 3 * * ?   æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œï¼Œç¡®ä¿æ‰˜æ”¶æ€»è¡¨å·²ç”Ÿæˆ * */@XxlJob(&quot;entrustAutoDeliveryTaskHandler&quot;)public void entrustAutoDeliveryTask() throws Exception &#123;    XxlJobHelper.log(&quot;entrustAutoDeliveryTaskHandler start&quot;);    EntrustAutoDeliveryTaskApp app = new EntrustAutoDeliveryTaskApp();    app.autoDelivery();    XxlJobHelper.log(&quot;entrustAutoDeliveryTaskHandler end&quot;);&#125;\n\n5.ç¼–å†™ä¸šåŠ¡ä»£ç ï¼Œå–ä»£ä¹‹å‰çš„AbstractSingleTaskDealä»»åŠ¡å¤„ç†ç±»    å°†ä¸šåŠ¡ä»£ç ä¸åˆ†ç‰‡è°ƒåº¦åˆ†ç¦»å¼€\n6.å¯åŠ¨å¤šæ¡æ‰§è¡Œå™¨ï¼Œè¿›è¡Œè°ƒåº¦æµ‹è¯•ï¼ˆæ”¯æŒè‡ªé€‰è·¯ç”±æ–¹å¼ï¼‰\n","categories":["æ–¹æ¡ˆ"],"tags":["xxl-job","æ‰˜æ”¶"]},{"title":"æ‰¹é‡å·¥å•æ‰§è¡Œå‡ºé”™","url":"/java4u/2021/11/11/%E6%89%B9%E9%87%8F%E5%B7%A5%E5%8D%95%E6%89%A7%E8%A1%8C%E5%87%BA%E9%94%99/","content":"æ‰¹é‡å¤„ç†å·¥å•å¤„ç†ä»»åŠ¡æ—¶ï¼Œå‘ç°å¤§é‡é”™è¯¯ï¼šCsfException [serviceCode&#x3D;asset_ITaskCSV_syncWriteOffTask, processName&#x3D;asset_writeoffAsynBatch,date&#x3D;2021-11-11 23:13:08, exceptionCode&#x3D;csf1219, exceptionMessage&#x3D;è·å–è¿”å›å€¼å¤±è´¥ï¼Œå¯èƒ½åŸå› æ˜¯æœåŠ¡ç«¯è¿”å›å€¼è¿‡å¤§ï¼Œéœ€è¦é…ç½®csfå®¢æˆ·ç«¯maxContextLengthå¤§å°ï¼Œä¹Ÿå¯èƒ½æ˜¯åœ¨ç»™å®šæ—¶é—´å†…æœªæ”¶åˆ°æœåŠ¡çš„å“åº”ï¼Œæ— æ³•è·å–åˆ°è¿”å›å€¼,exceptionStack&#x3D;java.lang.OutOfMemoryError: GC overhead limit exceeded, requestId&#x3D;]\nåŸå› ï¼šç”±äºæŸç§åŸå› åƒåœ¾æ”¶é›†å™¨å ç”¨äº†è¿‡å¤šçš„æ—¶é—´ï¼ˆé»˜è®¤ä¸ºè¿›ç¨‹æ‰€æœ‰ CPU æ—¶é—´çš„ 98%ï¼‰å¹¶ä¸”åœ¨æ¯æ¬¡è¿è¡Œä¸­å›æ”¶çš„å†…å­˜éå¸¸å°‘ï¼ˆé»˜è®¤ä¸ºå †çš„ 2%ï¼‰ã€‚      è¿™å®é™…ä¸Šæ„å‘³ç€æ‚¨çš„ç¨‹åºåœæ­¢æ‰§è¡Œä»»ä½•è¿›åº¦å¹¶ä¸”ä¸€ç›´å¿™äºåªè¿è¡Œåƒåœ¾æ”¶é›†ã€‚     ä¸ºäº†é˜²æ­¢æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨æ²¡æœ‰å®Œæˆä»»ä½•äº‹æƒ…çš„æƒ…å†µä¸‹å ç”¨ CPU æ—¶é—´ï¼ŒJVM ä¼šæŠ›å‡ºæ­¤é—®é¢˜ï¼ŒErrorä»¥ä¾¿æ‚¨æœ‰æœºä¼šè¯Šæ–­é—®é¢˜\nç°è±¡ï¼š\nè¿›ç¨‹ç«¯æŠ¥é”™ï¼Œæ’å…¥å·¥å•å†å²è¡¨å‡ºé”™[2021-11-11 23:13:13,738] [processor-1] (DataStoreImpl.java:773)  WARN  - 3108java.lang.Exception: SQLÖ´Å»5;9Hat com.ai.appframe2.bo.DataStoreImpl.save2(DataStoreImpl.java:773)                                                  (                      )        at com.ai.appframe2.complex.tab.store.AdvanceDataStoreImpl.save2(AdvanceDataStoreImpl.java:44)        at com.ai.appframe2.bo.DataStoreImpl.save(DataStoreImpl.java:989)        at com.asiainfo.asset.component.po.bo.payment.BOBusiTaskEngine.save(BOBusiTaskEngine.java:141)        at com.asiainfo.asset.component.po.dao.payment.impl.BusiTaskDAOImpl.addBusiTaskHis(BusiTaskDAOImpl.java:186)        at sun.reflect.GeneratedMethodAccessor27.invoke(Unknown Source)        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)        at java.lang.reflect.Method.invoke(Method.java:498)        at com.ai.appframe2.complex.service.proxy.ProxyInvocationHandler.invoke(ProxyInvocationHandler.java:129)        at com.sun.proxy.$Proxy18.addBusiTaskHis(Unknown Source)        at com.ai.ac.core.writeoff.dao.BusiTaskDao.insertBusiTaskHis(BusiTaskDao.java:55)        at com.ai.ac.core.writeoff.bc.WriteOffAsynTaskApp.doWriteOffAsynEnd(WriteOffAsynTaskApp.java:125)        at com.ai.ac.core.writeoff.task.WriteOffAsynBatchTask.execute(WriteOffAsynBatchTask.java:146)        at com.ai.ac.core.writeoff.task.WriteOffAsynBatchTask.execute(WriteOffAsynBatchTask.java:30)        at com.ai.acctcomp.task.client.AbstractThreadTaskDeal.process(AbstractThreadTaskDeal.java:43)        at com.ai.acctcomp.queue.disruptor.MsgWorkHandler.onEvent(DisruptorQueueProcessor.java:92)        at com.ai.acctcomp.queue.disruptor.MsgWorkHandler.onEvent(DisruptorQueueProcessor.java:82)\t\tæ’å…¥å¼‚å¸¸æ—¥å¿—åˆ™ä¸ºå†…å­˜æº¢å‡º\n\n\tä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š\tJVM é€‰é¡¹å¯ç”¨ååé‡æ”¶é›†ï¼š\t-XX:+UseParallelGC\tåœ¨æ­¤æœŸé—´ï¼Œè¯·ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›å°½å¯èƒ½å¤šçš„å †ç©ºé—´ï¼š\t-Xms????mï¼ˆå…¶ä¸­????ä»£è¡¨ä»¥ MB ä¸ºå•ä½çš„å †ç©ºé—´é‡ï¼Œä¾‹å¦‚-Xms8192mï¼‰\tå¦‚æœè¿™æ²¡æœ‰å¸®åŠ©ï¼Œè¯·å°è¯•ä½¿ç”¨æ­¤é€‰é¡¹è®¾ç½®æ›´å®½æ¾çš„ååé‡ç›®æ ‡ï¼š\t-XX:GCTimeRatio=19 \n\n\tæŸ¥è¯¢JVMå†…å­˜å †ä¿¡æ¯ï¼š\t\t[boss@js-cache-04 batchAsynWoff]$ jmap -heap 1095460Attaching to process ID 1095460, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.211-b12using thread-local object allocation.Parallel GC with 23 thread(s)Heap Configuration:   MinHeapFreeRatio         = 0   MaxHeapFreeRatio         = 100   MaxHeapSize              = 1073741824 (1024.0MB)   NewSize                  = 89128960 (85.0MB)   MaxNewSize               = 357564416 (341.0MB)   OldSize                  = 179306496 (171.0MB)   NewRatio                 = 2   SurvivorRatio            = 8   MetaspaceSize            = 21807104 (20.796875MB)   CompressedClassSpaceSize = 1073741824 (1024.0MB)   MaxMetaspaceSize         = 17592186044415 MB   G1HeapRegionSize         = 0 (0.0MB)Heap Usage:PS Young GenerationEden Space:   capacity = 119537664 (114.0MB)   used     = 118662472 (113.16535186767578MB)   free     = 875192 (0.8346481323242188MB)   99.26785251550507% used                          -----EdenåŒºå‡ ä¹è¢«å®Œå…¨å ç”¨From Space:   capacity = 119013376 (113.5MB)   used     = 0 (0.0MB)   free     = 119013376 (113.5MB)   0.0% usedTo Space:   capacity = 119013376 (113.5MB)   used     = 0 (0.0MB)   free     = 119013376 (113.5MB)   0.0% usedPS Old Generation   capacity = 716177408 (683.0MB)   used     = 716172800 (682.99560546875MB)   free     = 4608 (0.00439453125MB)   99.99935658400439% used\t\t\t\t\t\t\t\t\t\t\t\t-------Old Generationå‡ ä¹è¢«å®Œå…¨å ç”¨\n\nå› ä¸ºä¿®æ”¹å †ç©ºé—´åªä¼šæš‚æ—¶å»¶ç¼“é—®é¢˜å‡ºç°çš„æ—¶é—´ï¼Œæ˜¯ç¨‹åºä¸­å‡ºç°çš„é—®é¢˜ï¼Œéœ€è¦åˆ†ædumpjmap -dump:file=a.dump &lt;pid&gt;  ç”Ÿæˆdumpæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨ jvisualvm åˆ†ædumpåœ¨ä½¿ç”¨MATï¼ˆMemoryAnalyzerï¼‰åˆ†ædumpï¼ŒæŸ¥çœ‹dominator tree\n\n\ncom.asiainfo.asset.component.po.bo.payment.BOBusiTaskBean å å…¶ä¸­91%    ---------BOBusiTaskBeanå°±æ˜¯åˆ†å‘çš„å¯¹è±¡å¿«é€Ÿå¤„ç†ä»»åŠ¡çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºå¤§é‡åˆ†å‘å¯¹è±¡åˆ†å‘åˆ°å¤šä¸ªçº¿ç¨‹å¤„ç†ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–åˆ°åˆ†å‘å¯¹è±¡ï¼Œéœ€è¦è°ƒé”€è´¦æœåŠ¡è¿›è¡Œå¤„ç†ï¼Œæ²¡æœ‰å®Œæˆé”€è´¦ä¼šä¸€ç›´æŒæœ‰åˆ†å‘å¯¹è±¡ï¼Œåœ¨ä¸å½±å“æ•ˆç‡çš„æƒ…å†µä¸‹æä¾›å†…å­˜ç©ºé—´åˆ°1024Mï¼Œä»»åŠ¡é¡ºåˆ©è·‘å®Œ\n","categories":["JVM"],"tags":["å†…å­˜æº¢å‡º","JVM"]},{"title":"å…¶ä»–æ¡†æ¶","url":"/java4u/2021/10/06/6.2%E5%85%B6%E4%BB%96%E6%A1%86%E6%9E%B6/","content":"å…¶ä»–æ¡†æ¶1. æè¿°â¼€ä¸‹Hibernateçš„ä¸‰ä¸ªçŠ¶æ€ï¼Ÿa. transient(ç¬æ—¶çŠ¶æ€)ï¼šnewå‡ºæ¥â¼€ä¸ªå¯¹è±¡ï¼Œè¿˜æ²¡è¢«ä¿å­˜åˆ°æ•°æ®åº“ä¸­\nb. persistent(æŒä¹…åŒ–çŠ¶æ€)ï¼šå¯¹è±¡å·²ç»ä¿å­˜åˆ°æ•°æ®åº“ä¸­å¹¶ä¸”åœ¨hibernate sessionä¹Ÿå­˜åœ¨è¯¥å¯¹è±¡\nc. detached(ç¦»çº¿çŠ¶æ€)ï¼šå¯¹è±¡åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œhibernate sessionä¸å­˜åœ¨\n2. Hibernateå¯¹â¼€â¼†çº§ç¼“å­˜çš„ä½¿â½¤ï¼Œ Lazy-Loadçš„ç†è§£;a. â¼€çº§ç¼“å­˜ï¼šhibernateçš„â¼€çº§ç¼“å­˜æ˜¯ç”±sessionæä¾›çš„ï¼Œå› æ­¤å®ƒåªå­˜åœ¨sessionçš„â½£å‘½å‘¨æœŸä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´sessionå…³é—­çš„æ—¶å€™è¯¥sessionæ‰€ç®¡ç†çš„â¼€çº§ç¼“å­˜ä¹Ÿéšä¹‹è¢«æ¸…é™¤ã€‚hibernateçš„â¼€çº§ç¼“å­˜æ˜¯sessionæ‰€å†…ç½®çš„ï¼Œé»˜è®¤å¼€å¯ï¼Œä¸èƒ½è¢«å¸è½½ï¼Œä¹Ÿä¸èƒ½è¿›â¾ä»»ä½•é…ç½®ã€‚åœ¨ç¼“å­˜ä¸­çš„å¯¹è±¡,å…·æœ‰æŒä¹…æ€§,sessionå¯¹è±¡è´Ÿè´£ç®¡ç†.â¼€çº§ç¼“å­˜çš„ä¼˜ç‚¹æ˜¯ä½¿â½¤åŒâ¼€ä¸ªsessionå¯¹è±¡å¤šæ¬¡æŸ¥è¯¢åŒâ¼€ä¸ªæ•°æ®å¯¹è±¡,ä»…å¯¹æ•°æ®åº“æŸ¥è¯¢â¼€æ¬¡ã€‚â¼€çº§ç¼“å­˜é‡‡â½¤çš„æ˜¯Key-Valueçš„MAPâ½…å¼æ¥å®ç°çš„ã€‚åœ¨ç¼“å­˜å®ä½“å¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„ä¸»å…³é”®å­—IDæ˜¯MAPçš„Keyï¼Œå®ä½“å¯¹è±¡å°±æ˜¯å¯¹è±¡çš„å€¼ã€‚æ‰€ä»¥è¯´â¼€çº§ç¼“å­˜æ˜¯ä»¥å®ä½“å¯¹è±¡ä¸ºå•ä½è¿›â¾å­˜å‚¨çš„ã€‚è®¿é—®çš„æ—¶å€™ä½¿â½¤çš„æ˜¯ä¸»é”®å…³é”®å­—IDã€‚â¼€çº§ç¼“å­˜ä½¿â½¤çš„æ˜¯â¾ƒåŠ¨ç»´æŠ¤çš„åŠŸèƒ½ã€‚ä½†å¯ä»¥é€šè¿‡sessionæä¾›çš„â¼¿åŠ¨â½…æ³•å¯¹â¼€çº§ç¼“å­˜çš„ç®¡ç†è¿›â¾â¼¿åŠ¨â¼²é¢„ã€‚evict()â½…æ³•â½¤äºå°†æŸä¸ªå¯¹è±¡ä»sessionçš„â¼€çº§ç¼“å­˜ä¸­æ¸…é™¤ã€‚clear()â½…æ³•â½¤äºå°†sessionç¼“å­˜ä¸­çš„â½…æ³•å…¨éƒ¨æ¸…é™¤ã€‚\nb. â¼†çº§ç¼“å­˜ï¼šâ¼†çº§ç¼“å­˜çš„å®ç°åŸç†ä¸â¼€çº§ç¼“å­˜æ˜¯â¼€æ ·çš„ã€‚ä¹Ÿæ˜¯é€šè¿‡Key-Valueçš„Mapæ¥å®ç°å¯¹å¯¹è±¡çš„ç¼“å­˜ã€‚â¼†çº§ç¼“å­˜æ˜¯ä½œâ½¤åœ¨SessionFactoryèŒƒå›´å†…çš„ã€‚å› æ­¤å®ƒå¯è¢«æ‰€æœ‰çš„Sessionå¯¹è±¡æ‰€å…±äº«ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ”¾â¼Šç¼“å­˜ä¸­çš„æ•°æ®ä¸èƒ½æœ‰ç¬¬ä¸‰â½…çš„åº”â½¤å¯¹æ•°æ®è¿›â¾ä¿®æ”¹ã€‚â¼†çº§ç¼“å­˜é»˜è®¤å…³é—­ï¼Œéœ€è¦ç¨‹åºå‘˜â¼¿åŠ¨å¼€å¯ï¼Œé»˜è®¤ä¸ºehcacheå®ç°.\nc. æ‡’åŠ è½½ï¼šå½“â½¤åˆ°æ•°æ®çš„æ—¶å€™æ‰å‘æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿™å°±æ˜¯hibernateçš„æ‡’åŠ è½½ç‰¹æ€§ã€‚å»¶è¿ŸåŠ è½½ç­–ç•¥èƒ½é¿å…åŠ è½½åº”â½¤ç¨‹åºä¸éœ€è¦è®¿é—®çš„å…³è”å¯¹è±¡ï¼Œä»¥æâ¾¼åº”â½¤ç¨‹åºçš„æ€§èƒ½ã€‚\n3. zookeeperæœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œé€‰ä¸¾ç®—æ³•å¦‚ä½•è¿›â¾ï¼š1ã€é€‰ä¸¾ç®—æ³•ï¼š1ã€Fast Leader(é¢†å¯¼è€…é€‰ä¸¾)é€‰ä¸¾ç®—æ³•ï¼š 1.serverå¯åŠ¨æ—¶é»˜è®¤é€‰ä¸¾â¾ƒâ¼°ï¼Œå¹¶å‘æ•´ä¸ªé›†ç¾¤â¼´æ’­\n 2.æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œé€šè¿‡3å±‚åˆ¤æ–­ï¼šé€‰ä¸¾è½®æ•°ï¼Œzxidï¼Œserver idâ¼¤â¼©åˆ¤æ–­æ˜¯å¦åŒæ„å¯¹â½…ï¼Œå¦‚æœåŒæ„ï¼Œåˆ™ä¿®æ”¹â¾ƒâ¼°çš„é€‰\nç¥¨ï¼Œå¹¶å‘é›†ç¾¤â¼´æ’­\n 3.QuorumCnxManagerè´Ÿè´£IOå¤„ç†ï¼Œæ¯2ä¸ªserverå»ºâ½´â¼€ä¸ªè¿æ¥ï¼Œåªå…è®¸idâ¼¤çš„serverè¿idâ¼©çš„serverï¼Œæ¯ä¸ª\nserverå¯åŠ¨å•ç‹¬çš„è¯»å†™çº¿ç¨‹å¤„ç†ï¼Œä½¿â½¤é˜»å¡IO\n 4.é»˜è®¤è¶…è¿‡åŠæ•°æœºå™¨åŒæ„æ—¶ï¼Œåˆ™é€‰ä¸¾æˆåŠŸï¼Œä¿®æ”¹â¾ƒèº«çŠ¶æ€ä¸ºLEADINGæˆ–FOLLOWING\n 5.Obsereræœºå™¨ä¸å‚ä¸é€‰ä¸¾\n2ã€åŸç†ï¼šé€‰ä¸¾ç»“æœçš„å½±å“æƒé‡å…³ç³»æ˜¯:â¾¸å…ˆçœ‹æ•°æ®id,æ•°æ®idâ¼¤è€…èƒœå‡º;å…¶æ¬¡å†åˆ¤æ–­leader id,leader idâ¼¤è€…èƒœå‡ºã€‚3ã€ä¸¾ä¾‹ï¼š å‡è®¾æœ‰äº”å°æœåŠ¡å™¨ç»„æˆçš„zookeeperé›†ç¾¤,å®ƒä»¬çš„idä»1-5,åŒæ—¶å®ƒä»¬éƒ½æ˜¯æœ€æ–°å¯åŠ¨çš„,ä¹Ÿå°±æ˜¯æ²¡æœ‰å†å²æ•°æ®,åœ¨å­˜æ”¾æ•°\næ®é‡è¿™â¼€ç‚¹ä¸Š,éƒ½æ˜¯â¼€æ ·çš„.å‡è®¾è¿™äº›æœåŠ¡å™¨ä¾åºå¯åŠ¨,æ¥çœ‹çœ‹ä¼šå‘â½£ä»€ä¹ˆ.\n \\1) æœåŠ¡å™¨1å¯åŠ¨,æ­¤æ—¶åªæœ‰å®ƒâ¼€å°æœåŠ¡å™¨å¯åŠ¨äº†,å®ƒå‘å‡ºå»çš„æŠ¥æ²¡æœ‰ä»»ä½•å“åº”,æ‰€ä»¥å®ƒçš„é€‰ä¸¾çŠ¶æ€â¼€ç›´æ˜¯LOOKING\nçŠ¶æ€ï¼›\n \\2) æœåŠ¡å™¨2å¯åŠ¨,å®ƒä¸æœ€å¼€å§‹å¯åŠ¨çš„æœåŠ¡å™¨1è¿›â¾é€šä¿¡,äº’ç›¸äº¤æ¢â¾ƒâ¼°çš„é€‰ä¸¾ç»“æœ,ç”±äºä¸¤è€…éƒ½æ²¡æœ‰å†å²æ•°æ®,æ‰€ä»¥id\nå€¼è¾ƒâ¼¤çš„æœåŠ¡å™¨2èƒœå‡º,ä½†æ˜¯ç”±äºæ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨éƒ½åŒæ„é€‰ä¸¾å®ƒ(è¿™ä¸ªä¾‹â¼¦ä¸­çš„åŠæ•°ä»¥ä¸Šæ˜¯3),æ‰€ä»¥æœåŠ¡å™¨1,2è¿˜æ˜¯ç»§ç»­ä¿æŒLOOKINGçŠ¶æ€.\n \\3) æœåŠ¡å™¨3å¯åŠ¨,æ ¹æ®å‰â¾¯çš„ç†è®ºåˆ†æ,æœåŠ¡å™¨3æˆä¸ºæœåŠ¡å™¨1,2,3ä¸­çš„â½¼â¼¤,â½½ä¸ä¸Šâ¾¯ä¸åŒçš„æ˜¯,æ­¤æ—¶æœ‰ä¸‰å°æœåŠ¡å™¨\né€‰ä¸¾äº†å®ƒ,æ‰€ä»¥å®ƒæˆä¸ºäº†è¿™æ¬¡é€‰ä¸¾çš„leader.\n \\4) æœåŠ¡å™¨4å¯åŠ¨,æ ¹æ®å‰â¾¯çš„åˆ†æ,ç†è®ºä¸ŠæœåŠ¡å™¨4åº”è¯¥æ˜¯æœåŠ¡å™¨1,2,3,4ä¸­æœ€â¼¤çš„,ä½†æ˜¯ç”±äºå‰â¾¯å·²ç»æœ‰åŠæ•°ä»¥ä¸Šçš„\næœåŠ¡å™¨é€‰ä¸¾äº†æœåŠ¡å™¨3,æ‰€ä»¥å®ƒåªèƒ½æ¥æ”¶å½“â¼©å¼Ÿçš„å‘½äº†.\n \\5) æœåŠ¡å™¨5å¯åŠ¨,åŒ4â¼€æ ·,å½“â¼©å¼Ÿ. \n4ã€zookeeperç®¡ç†å‘˜æŒ‡å—ï¼š 1ã€é›†ç¾¤ä¸­è¿‡åŠå­˜æ´»å³å¯â½¤ï¼Œæ•…é›†ç¾¤é€‰æ‹©å¥‡æ•°å°æœºå™¨ï¼›\n4. Nettyâ¾¼æ€§èƒ½ï¼š 1ã€NIOå¼‚æ­¥â¾®é˜»å¡é€šä¿¡\n 2ã€â€œé›¶æ‹·â»‰â€\n 3ã€å†…å­˜æ± ByteBuf\n 4ã€Nettyæä¾›äº†å¤šç§å†…å­˜ç®¡ç†ç­–ç•¥ï¼Œé€šè¿‡åœ¨å¯åŠ¨è¾…åŠ©ç±»ä¸­é…ç½®ç›¸å…³å‚æ•°ï¼Œå¯ä»¥å®ç°å·®å¼‚åŒ–çš„å®šåˆ¶ã€‚\n 5ã€â¾¼æ•ˆçš„Reactorçº¿ç¨‹æ¨¡å‹ï¼šReactorå•çº¿ç¨‹(å¤šçº¿ç¨‹ã€ä¸»ä»)æ¨¡å‹ï¼ŒæŒ‡çš„æ˜¯æ‰€æœ‰çš„IOæ“ä½œéƒ½åœ¨åŒâ¼€ä¸ªNIOçº¿ç¨‹ä¸Šâ¾¯å®Œæˆ\n 6ã€ä¸ºäº†å°½å¯èƒ½æå‡æ€§èƒ½ï¼ŒNettyé‡‡â½¤äº†ä¸²â¾â½†é”åŒ–è®¾è®¡ï¼Œåœ¨IOçº¿ç¨‹å†…éƒ¨è¿›â¾ä¸²â¾æ“ä½œï¼Œé¿å…å¤šçº¿ç¨‹ç«äº‰å¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚è¡¨â¾¯ä¸Šçœ‹ï¼Œä¸²â¾åŒ–è®¾è®¡ä¼¼ä¹CPUåˆ©â½¤ç‡ä¸â¾¼ï¼Œå¹¶å‘ç¨‹åº¦ä¸å¤Ÿã€‚ä½†æ˜¯ï¼Œé€šè¿‡è°ƒæ•´NIOçº¿ç¨‹æ± çš„çº¿ç¨‹å‚æ•°ï¼Œå¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ªä¸²â¾åŒ–çš„çº¿ç¨‹å¹¶â¾è¿â¾ï¼Œè¿™ç§å±€éƒ¨â½†é”åŒ–çš„ä¸²â¾çº¿ç¨‹è®¾è®¡ç›¸â½â¼€ä¸ªé˜Ÿåˆ—-å¤šä¸ªâ¼¯ä½œçº¿ç¨‹æ¨¡å‹æ€§èƒ½æ›´ä¼˜ã€‚\n 7ã€â¾¼æ•ˆçš„å¹¶å‘ç¼–ç¨‹ï¼šNettyçš„â¾¼æ•ˆå¹¶å‘ç¼–ç¨‹ä¸»è¦ä½“ç°åœ¨å¦‚ä¸‹â¼ç‚¹ï¼š\n \\1) volatileçš„â¼¤é‡ã€æ­£ç¡®ä½¿â½¤;\n \\2) CASå’ŒåŸâ¼¦ç±»çš„â¼´æ³›ä½¿â½¤ï¼›\n \\3) çº¿ç¨‹å®‰å…¨å®¹å™¨çš„ä½¿â½¤ï¼› 4) é€šè¿‡è¯»å†™é”æå‡å¹¶å‘æ€§èƒ½ã€‚\n 8ã€â¾¼æ•ˆçš„åºåˆ—åŒ–æ¡†æ¶ï¼š\n 9ã€çµæ´»çš„TCPå‚æ•°é…ç½®èƒ½â¼’ï¼šåˆç†è®¾ç½®TCPå‚æ•°åœ¨æŸäº›åœºæ™¯ä¸‹å¯¹äºæ€§èƒ½çš„æå‡å¯ä»¥èµ·åˆ°æ˜¾è‘—çš„æ•ˆæœï¼Œä¾‹å¦‚SO_RCVBUFå’ŒSO_SNDBUFã€‚å¦‚æœè®¾ç½®ä¸å½“ï¼Œå¯¹æ€§èƒ½çš„å½±å“æ˜¯â¾®å¸¸â¼¤çš„ã€‚\n5. å¦‚ä½•ä¿è¯æœåŠ¡çš„å¹‚ç­‰æ€§ï¼Ÿ1ã€æ¦‚å¿µï¼šæ¥â¼çš„å¹‚ç­‰æ€§å®é™…ä¸Šå°±æ˜¯æ¥â¼å¯é‡å¤è°ƒâ½¤ï¼Œåœ¨è°ƒâ½¤â½…å¤šæ¬¡è°ƒâ½¤çš„æƒ…å†µä¸‹ï¼Œæ¥â¼æœ€ç»ˆå¾—åˆ°çš„ç»“æœæ˜¯â¼€è‡´çš„ã€‚æœ‰äº›\næ¥â¼å¯ä»¥å¤©ç„¶çš„å®ç°å¹‚ç­‰æ€§ï¼Œâ½å¦‚æŸ¥è¯¢æ¥â¼ï¼Œå¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œä½ æŸ¥è¯¢â¼€æ¬¡å’Œä¸¤æ¬¡ï¼Œå¯¹äºç³»ç»Ÿæ¥è¯´ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ï¼ŒæŸ¥å‡ºçš„ç»“æœä¹Ÿæ˜¯â¼€æ ·ã€‚\n2ã€GETå¹‚ç­‰ï¼šå€¼å¾—æ³¨æ„ï¼Œå¹‚ç­‰æ€§æŒ‡çš„æ˜¯ä½œâ½¤äºç»“æœâ½½â¾®èµ„æºæœ¬èº«ã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿä¾‹å¦‚ï¼Œè¿™ä¸ªHTTP GETâ½…æ³•å¯èƒ½ä¼šæ¯æ¬¡\nå¾—åˆ°ä¸åŒçš„è¿”å›å†…å®¹ï¼Œä½†å¹¶ä¸å½±å“èµ„æºã€‚\n3ã€POSTâ¾®å¹‚ç­‰ï¼šå› ä¸ºå®ƒä¼šå¯¹èµ„æºæœ¬èº«äº§â½£å½±å“ï¼Œæ¯æ¬¡è°ƒâ½¤éƒ½ä¼šæœ‰æ–°çš„èµ„æºäº§â½£ï¼Œå› æ­¤ä¸æ»¡â¾œå¹‚ç­‰æ€§ã€‚\n4ã€å¦‚ä½•ä¿è¯å¹‚ç­‰æ€§ï¼š 1ã€å…¨å±€å”¯â¼€idï¼šå¦‚æœä½¿â½¤å…¨å±€å”¯â¼€IDï¼Œå°±æ˜¯æ ¹æ®ä¸šåŠ¡çš„æ“ä½œå’Œå†…å®¹â½£æˆâ¼€ä¸ªå…¨å±€IDï¼Œåœ¨æ‰§â¾æ“ä½œå‰å…ˆæ ¹æ®è¿™ä¸ªå…¨å±€å”¯â¼€IDæ˜¯å¦å­˜åœ¨ï¼Œæ¥åˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦å·²ç»æ‰§â¾ã€‚å¦‚æœä¸å­˜åœ¨åˆ™æŠŠå…¨å±€IDï¼Œå­˜å‚¨åˆ°å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œâ½å¦‚æ•°æ®åº“ã€redisç­‰ã€‚å¦‚æœå­˜åœ¨åˆ™è¡¨ç¤ºè¯¥â½…æ³•å·²ç»æ‰§â¾ã€‚ä»â¼¯ç¨‹çš„â»†åº¦æ¥è¯´ï¼Œä½¿â½¤å…¨å±€IDåšå¹‚ç­‰å¯ä»¥ä½œä¸ºâ¼€ä¸ªä¸šåŠ¡çš„åŸºç¡€çš„å¾®æœåŠ¡å­˜åœ¨ï¼Œåœ¨å¾ˆå¤šçš„å¾®æœåŠ¡ä¸­éƒ½ä¼šâ½¤åˆ°è¿™æ ·çš„æœåŠ¡ï¼Œåœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­éƒ½å®Œæˆè¿™æ ·çš„åŠŸèƒ½ï¼Œä¼šå­˜åœ¨â¼¯ä½œé‡é‡å¤ã€‚å¦å¤–æ‰“é€ â¼€ä¸ªâ¾¼å¯é çš„å¹‚ç­‰æœåŠ¡è¿˜éœ€è¦è€ƒè™‘å¾ˆå¤šé—®é¢˜ï¼Œâ½å¦‚â¼€å°æœºå™¨è™½ç„¶æŠŠå…¨å±€IDå…ˆå†™â¼Šäº†å­˜å‚¨ï¼Œä½†æ˜¯åœ¨å†™â¼Šä¹‹åæŒ‚äº†ï¼Œè¿™å°±éœ€è¦å¼•â¼Šå…¨å±€IDçš„è¶…æ—¶æœºåˆ¶ã€‚ ä½¿â½¤å…¨å±€å”¯â¼€IDæ˜¯â¼€ä¸ªé€šâ½¤â½…æ¡ˆï¼Œå¯ä»¥â½€æŒæ’â¼Šã€æ›´æ–°ã€åˆ é™¤ä¸šåŠ¡æ“ä½œã€‚ä½†æ˜¯è¿™ä¸ªâ½…æ¡ˆçœ‹èµ·æ¥å¾ˆç¾ä½†æ˜¯å®ç°èµ·æ¥â½è¾ƒéº»çƒ¦ï¼Œä¸‹â¾¯çš„â½…æ¡ˆé€‚â½¤äºç‰¹å®šçš„åœºæ™¯ï¼Œä½†æ˜¯å®ç°èµ·æ¥â½è¾ƒç®€å•ã€‚\n 2ã€å»é‡è¡¨ï¼šè¿™ç§â½…æ³•é€‚â½¤äºåœ¨ä¸šåŠ¡ä¸­æœ‰å”¯â¼€æ ‡çš„æ’â¼Šåœºæ™¯ä¸­ï¼Œâ½å¦‚åœ¨ä»¥ä¸Šçš„â½€ä»˜åœºæ™¯ä¸­ï¼Œå¦‚æœâ¼€ä¸ªè®¢å•åªä¼šâ½€ä»˜â¼€æ¬¡ï¼Œæ‰€ä»¥è®¢å•IDå¯ä»¥ä½œä¸ºå”¯â¼€æ ‡è¯†ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»ºâ¼€å¼ å»é‡è¡¨ï¼Œå¹¶ä¸”æŠŠå”¯â¼€æ ‡è¯†ä½œä¸ºå”¯â¼€ç´¢å¼•ï¼Œåœ¨æˆ‘ä»¬å®ç°æ—¶ï¼ŒæŠŠåˆ›å»ºâ½€ä»˜å•æ®å’Œå†™â¼Šå»å»é‡è¡¨ï¼Œæ”¾åœ¨â¼€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦‚æœé‡å¤åˆ›å»ºï¼Œæ•°æ®åº“ä¼šæŠ›å‡ºå”¯â¼€çº¦æŸå¼‚å¸¸ï¼Œæ“ä½œå°±ä¼šå›æ»šã€‚\n 3ã€æ’â¼Šæˆ–æ›´æ–°ï¼šè¿™ç§â½…æ³•æ’â¼Šå¹¶ä¸”æœ‰å”¯â¼€ç´¢å¼•çš„æƒ…å†µï¼Œâ½å¦‚æˆ‘ä»¬è¦å…³è”å•†å“å“ç±»ï¼Œå…¶ä¸­å•†å“çš„IDå’Œå“ç±»çš„IDå¯ä»¥æ„æˆå”¯â¼€ç´¢å¼•ï¼Œå¹¶ä¸”åœ¨æ•°æ®è¡¨ä¸­ä¹Ÿå¢åŠ äº†å”¯â¼€ç´¢å¼•ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿â½¤InsertOrUpdateæ“ä½œã€‚åœ¨mysqlæ•°æ®åº“ä¸­å¦‚ä¸‹ï¼š\ninsert into goods_category (goods_id,category_id,create_time,update_time) values(#&#123;goodsId&#125;,#&#123;categoryId&#125;,now(),now())on DUPLICATE KEY UPDATEupdate_time=now()\n\n 4ã€å¤šç‰ˆæœ¬æ§åˆ¶ï¼šè¿™ç§â½…æ³•é€‚åˆåœ¨æ›´æ–°çš„åœºæ™¯ä¸­ï¼Œâ½å¦‚æˆ‘ä»¬è¦æ›´æ–°å•†å“çš„åå­—ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨æ›´æ–°çš„æ¥â¼ä¸­å¢åŠ â¼€ä¸ªç‰ˆæœ¬å·ï¼Œæ¥åšå¹‚ç­‰\nupdate goods set name=#&#123;newName&#125;,version=#&#123;version&#125; where id=#&#123;id&#125; and version&lt;$&#123;version&#125;\n\n5ã€çŠ¶æ€æœºæ§åˆ¶ï¼šè¿™ç§â½…æ³•é€‚åˆåœ¨æœ‰çŠ¶æ€æœºæµè½¬çš„æƒ…å†µä¸‹ï¼Œâ½å¦‚å°±ä¼šè®¢å•çš„åˆ›å»ºå’Œä»˜æ¬¾ï¼Œè®¢å•çš„ä»˜æ¬¾è‚¯å®šæ˜¯åœ¨ä¹‹å‰ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è®¾è®¡çŠ¶æ€å­—æ®µæ—¶ï¼Œä½¿â½¤intç±»å‹ï¼Œå¹¶ä¸”é€šè¿‡å€¼ç±»å‹çš„â¼¤â¼©æ¥åšå¹‚ç­‰ï¼Œâ½å¦‚è®¢å•çš„åˆ›å»ºä¸º0ï¼Œä»˜æ¬¾æˆåŠŸä¸º100ã€‚ä»˜æ¬¾å¤±è´¥ä¸º99,åœ¨åšçŠ¶æ€æœºæ›´æ–°æ—¶ï¼Œæˆ‘ä»¬å°±è¿™å¯ä»¥è¿™æ ·æ§åˆ¶\nupdate `order` set status=#&#123;status&#125; where id=#&#123;id&#125; and status&lt;#&#123;status&#125;\n\n","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"spring","url":"/java4u/2021/09/23/6.1%E6%A1%86%E6%9E%B6%E2%80%94Spring/","content":"æ¡†æ¶â€“Spring1. Springæ¡†æ¶ä¸­IOCçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ(1). IoCï¼ˆInversion of Controlï¼‰æ˜¯æŒ‡å®¹å™¨æ§åˆ¶ç¨‹åºå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œâ½½ä¸æ˜¯ä¼ ç»Ÿå®ç°ä¸­ï¼Œç”±ç¨‹åºä»£ç ç›´æ¥æ“æ§ã€‚æ§åˆ¶æƒç”±åº”â½¤ä»£ç ä¸­è½¬åˆ°äº†å¤–éƒ¨å®¹å™¨ï¼Œæ§åˆ¶æƒçš„è½¬ç§»æ˜¯æ‰€è°“åè½¬ã€‚ å¯¹äºSpringâ½½â¾”ï¼Œå°±æ˜¯ç”±Springæ¥æ§åˆ¶å¯¹è±¡çš„â½£å‘½å‘¨æœŸå’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼›IoCè¿˜æœ‰å¦å¤–â¼€ä¸ªåå­—â€”â€”â€œä¾èµ–æ³¨â¼Šï¼ˆDependency Injectionï¼‰â€ã€‚ä»åå­—ä¸Šç†è§£ï¼Œæ‰€è°“ä¾èµ–æ³¨â¼Šï¼Œå³ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ç”±å®¹å™¨åœ¨è¿â¾æœŸå†³å®šï¼Œå³ç”±å®¹å™¨åŠ¨æ€åœ°å°†æŸç§ä¾èµ–å…³ç³»æ³¨â¼Šåˆ°ç»„ä»¶ä¹‹ä¸­ã€‚ \n(2). åœ¨Springçš„â¼¯ä½œâ½…å¼ä¸­ï¼Œæ‰€æœ‰çš„ç±»éƒ½ä¼šåœ¨springå®¹å™¨ä¸­ç™»è®°ï¼Œå‘Šè¯‰springè¿™æ˜¯ä¸ªä»€ä¹ˆä¸œâ»„ï¼Œä½ éœ€è¦ä»€ä¹ˆä¸œâ»„ï¼Œç„¶åspringä¼šåœ¨ç³»ç»Ÿè¿â¾åˆ°é€‚å½“çš„æ—¶å€™ï¼ŒæŠŠä½ è¦çš„ä¸œâ»„ä¸»åŠ¨ç»™ä½ ï¼ŒåŒæ—¶ä¹ŸæŠŠä½ äº¤ç»™å…¶ä»–éœ€è¦ä½ çš„ä¸œâ»„ã€‚æ‰€æœ‰çš„ç±»çš„åˆ›å»ºã€é”€æ¯éƒ½ç”±springæ¥æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æ§åˆ¶å¯¹è±¡â½£å­˜å‘¨æœŸçš„ä¸å†æ˜¯å¼•â½¤å®ƒçš„å¯¹è±¡ï¼Œâ½½æ˜¯springã€‚å¯¹äºæŸä¸ªå…·ä½“çš„å¯¹è±¡â½½â¾”ï¼Œä»¥å‰æ˜¯å®ƒæ§åˆ¶å…¶ä»–å¯¹è±¡ï¼Œç°åœ¨æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½è¢«springæ§åˆ¶ï¼Œæ‰€ä»¥è¿™å«æ§åˆ¶åè½¬ã€‚\n(3). åœ¨ç³»ç»Ÿè¿â¾ä¸­ï¼ŒåŠ¨æ€çš„å‘æŸä¸ªå¯¹è±¡æä¾›å®ƒæ‰€éœ€è¦çš„å…¶ä»–å¯¹è±¡ã€‚ \n(4). ä¾èµ–æ³¨â¼Šçš„æ€æƒ³æ˜¯é€šè¿‡åå°„æœºåˆ¶å®ç°çš„ï¼Œåœ¨å®ä¾‹åŒ–â¼€ä¸ªç±»æ—¶ï¼Œå®ƒé€šè¿‡åå°„è°ƒâ½¤ç±»ä¸­setâ½…æ³•å°†äº‹å…ˆä¿å­˜åœ¨HashMapä¸­çš„ç±»å±æ€§æ³¨â¼Šåˆ°ç±»ä¸­ã€‚ æ€»â½½â¾”ä¹‹ï¼Œåœ¨ä¼ ç»Ÿçš„å¯¹è±¡åˆ›å»ºâ½…å¼ä¸­ï¼Œé€šå¸¸ç”±è°ƒâ½¤è€…æ¥åˆ›å»ºè¢«è°ƒâ½¤è€…çš„å®ä¾‹ï¼Œâ½½åœ¨Springä¸­åˆ›å»ºè¢«è°ƒâ½¤è€…çš„â¼¯ä½œç”±Springæ¥å®Œæˆï¼Œç„¶åæ³¨â¼Šè°ƒâ½¤è€…ï¼Œå³æ‰€è°“çš„ä¾èµ–æ³¨â¼Šoræ§åˆ¶åè½¬ã€‚ æ³¨â¼Šâ½…å¼æœ‰ä¸¤ç§ï¼šä¾èµ–æ³¨â¼Šå’Œè®¾ç½®æ³¨â¼Šï¼› IoCçš„ä¼˜ç‚¹ï¼šé™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆï¼Œé™ä½äº†ä¸šåŠ¡å¯¹è±¡ä¹‹é—´æ›¿æ¢çš„å¤æ‚æ€§ï¼Œä½¿ä¹‹èƒ½å¤Ÿçµæ´»çš„ç®¡ç†å¯¹è±¡ã€‚\nCSFåˆ›å»ºç»„ä»¶æ–¹å¼ï¼š\nä½¿ç”¨BCFactoryå·¥å‚æ–¹å¼åˆ›å»ºï¼Œå…ˆåˆ›å»ºä¸€ä¸ªSERVICES_CACHEï¼Œå…ˆæ ¹æ®ç±»åä»é‡Œé¢å–ç»„ä»¶ï¼Œå¦‚æœæ²¡å–åˆ°ï¼Œå°±åˆ›å»ºä¹‹åæ”¾å…¥ç¼“å­˜ä¸­\n","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"springcloud","url":"/java4u/2021/09/21/4.2%E5%BE%AE%E6%9C%8D%E5%8A%A1--springcloud/","content":"å¾®æœåŠ¡â€“springcloud1.springcloudå’Œdubboæœ‰å“ªäº›åŒºåˆ«a. Dubboå…·æœ‰è°ƒåº¦ã€å‘ç°ã€ç›‘æ§ã€æ²»ç†ç­‰åŠŸèƒ½ï¼Œâ½€æŒç›¸å½“ä¸°å¯Œçš„æœåŠ¡æ²»ç†èƒ½â¼’ã€‚Dubboæ¶æ„ä¸‹ï¼Œæ³¨å†Œä¸­â¼¼å¯¹ç­‰é›†ç¾¤ï¼Œå¹¶ä¼šç¼“å­˜æœåŠ¡åˆ—è¡¨å·²è¢«æ•°æ®åº“å¤±æ•ˆæ—¶ç»§ç»­æä¾›å‘ç°åŠŸèƒ½ï¼Œæœ¬èº«çš„æœåŠ¡å‘ç°ç»“æ„æœ‰å¾ˆå¼ºçš„å¯â½¤æ€§ä¸å¥å£®æ€§ï¼Œâ¾œå¤Ÿâ½€æŒâ¾¼è®¿é—®é‡çš„â½¹ç«™ã€‚\nb. è™½ç„¶Dubbo â½€æŒçŸ­è¿æ¥â¼¤æ•°æ®é‡çš„æœåŠ¡æä¾›æ¨¡å¼ï¼Œä½†ç»â¼¤å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ä½¿â½¤â»“è¿æ¥â¼©æ•°æ®é‡çš„æ¨¡å¼æä¾›æœåŠ¡ä½¿â½¤çš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºç±»ä¼¼äºç”µå•†ç­‰åŒæ­¥è°ƒâ½¤åœºæ™¯å¤šå¹¶ä¸”èƒ½â½€æ’‘æ­å»ºDubbo è¿™å¥—â½è¾ƒå¤æ‚ç¯å¢ƒçš„æˆæœ¬çš„äº§å“â½½â¾”ï¼ŒDubbo ç¡®å®æ˜¯â¼€ä¸ªå¯ä»¥è€ƒè™‘çš„é€‰æ‹©ã€‚ä½†å¦‚æœäº§å“ä¸šåŠ¡ä¸­ç”±äºåå°ä¸šåŠ¡é€»è¾‘å¤æ‚ã€æ—¶é—´â»“â½½å¯¼è‡´å¼‚æ­¥é€»è¾‘â½è¾ƒå¤šçš„è¯ï¼Œå¯èƒ½Dubbo å¹¶ä¸åˆé€‚ã€‚åŒæ—¶ï¼Œå¯¹äºâ¼ˆâ¼¿ä¸â¾œçš„åˆåˆ›äº§å“â½½â¾”ï¼Œè¿™ä¹ˆé‡çš„æ¶æ„ç»´æŠ¤èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆâ½…ä¾¿ã€‚\nc. Spring Cloudç”±ä¼—å¤šâ¼¦é¡¹â½¬ç»„æˆï¼Œå¦‚Spring Cloud Configã€Spring Cloud Netflixã€Spring Cloud Consul ç­‰ï¼Œæä¾›äº†æ­å»ºåˆ†å¸ƒå¼ç³»ç»ŸåŠå¾®æœåŠ¡å¸¸â½¤çš„â¼¯å…·ï¼Œå¦‚é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ã€â¼€æ¬¡æ€§tokenã€å…¨å±€é”ã€é€‰ä¸»ã€åˆ†å¸ƒå¼ä¼šè¯å’Œé›†ç¾¤çŠ¶æ€ç­‰ï¼Œæ»¡â¾œäº†æ„å»ºå¾®æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰è§£å†³â½…æ¡ˆã€‚â½å¦‚ä½¿â½¤Spring Cloud Config å¯ä»¥å®ç°ç»Ÿâ¼€é…ç½®ä¸­â¼¼ï¼Œå¯¹é…ç½®è¿›â¾ç»Ÿâ¼€ç®¡ç†ï¼›ä½¿â½¤Spring Cloud Netflix å¯ä»¥å®ç°Netflix ç»„ä»¶çš„åŠŸèƒ½ - æœåŠ¡å‘ç°ï¼ˆEurekaï¼‰ã€æ™ºèƒ½è·¯ç”±ï¼ˆZuulï¼‰ã€å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰ã€‚\nd. dubboçš„å¼€å‘éš¾åº¦è¾ƒâ¼¤ï¼ŒåŸå› æ˜¯dubboçš„jaråŒ…ä¾èµ–é—®é¢˜å¾ˆå¤šâ¼¤å‹â¼¯ç¨‹â½†æ³•è§£å†³ã€‚\ne. Dubbo æä¾›äº†å„ç§ Filterï¼Œå¯¹äºä¸Šè¿°ä¸­â€œâ½†â€çš„è¦ç´ ï¼Œå¯ä»¥é€šè¿‡æ‰©å±• Filter æ¥å®Œå–„ã€‚\n2. ä»€ä¹ˆæ˜¯æœåŠ¡ç†”æ–­ï¼Œä»€ä¹ˆæ˜¯æœåŠ¡é™çº§a. æœåŠ¡ç†”æ–­ï¼šï¼ˆä¸ºé˜²æ­¢ç³»ç»Ÿå‡ºç°é›ªå´©æƒ…å†µï¼Œæš‚åœå¯¹æœåŠ¡çš„è°ƒç”¨ï¼‰\ni. å¦‚æœæ£€æŸ¥å‡ºæ¥é¢‘ç¹è¶…æ—¶ï¼Œå°±æŠŠconsumerè°ƒâ½¤providerçš„è¯·æ±‚ï¼Œç›´æ¥çŸ­è·¯æ‰ï¼Œä¸å®é™…è°ƒâ½¤ï¼Œâ½½æ˜¯ç›´æ¥è¿”å›â¼€ä¸ªmockçš„å€¼ã€‚\nb. æœåŠ¡é™çº§ï¼šï¼ˆè¿”å›ä¸€ä¸ªå¤„ç†å¥½çš„é”™è¯¯ä¿¡æ¯ï¼‰\ni. consumer ç«¯ï¼šconsumer å¦‚æœå‘ç°æŸä¸ªproviderå‡ºç°å¼‚å¸¸æƒ…å†µï¼Œâ½å¦‚ï¼Œç»å¸¸è¶…æ—¶(å¯èƒ½æ˜¯ç†”æ–­å¼•èµ·çš„é™çº§)ï¼Œæ•°æ®é”™è¯¯ï¼Œè¿™æ—¶ï¼Œconsumerå¯ä»¥é‡‡å–â¼€å®šçš„ç­–ç•¥ï¼Œé™çº§providerçš„é€»è¾‘ï¼ŒåŸºæœ¬çš„æœ‰ç›´æ¥è¿”å›å›ºå®šçš„æ•°æ®ã€‚\n\\2. provider ç«¯ï¼šå½“provider å‘ç°æµé‡æ¿€å¢çš„æ—¶å€™ï¼Œä¸ºäº†ä¿æŠ¤â¾ƒèº«çš„ç¨³å®šæ€§ï¼Œä¹Ÿå¯èƒ½è€ƒè™‘é™çº§æœåŠ¡ã€‚\nâ½å¦‚ï¼Œ1ï¼Œç›´æ¥ç»™consumerè¿”å›å›ºå®šæ•°æ®ï¼Œ2ï¼Œéœ€è¦å®æ—¶å†™â¼Šæ•°æ®åº“çš„ï¼Œå…ˆç¼“å­˜åˆ°é˜Ÿåˆ—â¾¥ï¼Œå¼‚æ­¥å†™â¼Šæ•°æ®åº“ã€‚\n3. å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹a. ä¼˜ç‚¹ï¼š\ni. å•â¼€èŒè´£ï¼šæ¯ä¸ªå¾®æœåŠ¡ä»…è´Ÿè´£â¾ƒâ¼°ä¸šåŠ¡é¢†åŸŸçš„åŠŸèƒ½ï¼›\nii. â¾ƒæ²»ï¼šâ¼€ä¸ªå¾®æœåŠ¡å°±æ˜¯â¼€ä¸ªç‹¬â½´çš„å®ä½“ï¼Œå®ƒå¯ä»¥ç‹¬â½´éƒ¨ç½²ã€å‡çº§ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´é€šè¿‡RESTç­‰å½¢å¼çš„æ ‡å‡†æ¥â¼è¿›â¾é€šä¿¡ï¼Œå¹¶ä¸”â¼€ä¸ªå¾®æœåŠ¡å®ä¾‹å¯ä»¥è¢«æ›¿æ¢æˆå¦â¼€ç§å®ç°ï¼Œâ½½å¯¹å…¶å®ƒçš„å¾®æœåŠ¡ä¸äº§â½£å½±å“ã€‚\niii. é€»è¾‘æ¸…æ™°ï¼šå¾®æœåŠ¡å•â¼€èŒè´£ç‰¹æ€§ä½¿å¾®æœåŠ¡çœ‹èµ·æ¥é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤ã€‚\niv. ç®€åŒ–éƒ¨ç½²ï¼šå•ç³»ç»Ÿä¸­ä¿®æ”¹â¼€å¤„éœ€è¦éƒ¨ç½²æ•´ä¸ªç³»ç»Ÿï¼Œâ½½å¾®æœåŠ¡ä¸­ä¿®æ”¹â¼€å¤„å¯å•ç‹¬éƒ¨ç½²â¼€ä¸ªæœåŠ¡ã€‚\nv. å¯æ‰©å±•ï¼šåº”å¯¹ç³»ç»Ÿä¸šåŠ¡å¢â»“çš„â½…æ³•é€šå¸¸é‡‡â½¤æ¨ªå‘ï¼ˆScale outï¼‰æˆ–çºµå‘ï¼ˆScale upï¼‰çš„â½…å‘è¿›â¾æ‰©å±•ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é€šå¸¸è¦é‡‡â½¤Scale outçš„â½…å¼è¿›â¾æ‰©å±•ã€‚\nvi. çµæ´»ç»„åˆï¼š\nvii. æŠ€æœ¯å¼‚æ„ï¼šä¸åŒçš„æœåŠ¡ä¹‹é—´ï¼Œå¯ä»¥æ ¹æ®â¾ƒâ¼°çš„ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©ä¸é€šçš„æŠ€æœ¯æ¶æ„ï¼Œå¦‚æ•°æ®åº“ç­‰ã€‚\nb. ç¼ºç‚¹ï¼š\ni. å¤æ‚åº¦â¾¼ï¼š\n\\1. æœåŠ¡è°ƒâ½¤è¦è€ƒè™‘è¢«è°ƒâ½¤â½…æ•…éšœã€è¿‡è½½ã€æ¶ˆæ¯ä¸¢å¤±ç­‰å„ç§å¼‚å¸¸æƒ…å†µï¼Œä»£ç é€»è¾‘æ›´åŠ å¤æ‚ï¼›\n\\2. å¯¹äºå¾®æœåŠ¡é—´çš„äº‹åŠ¡æ€§æ“ä½œï¼Œå› ä¸ºä¸åŒçš„å¾®æœåŠ¡é‡‡â½¤äº†ä¸åŒçš„æ•°æ®åº“ï¼Œå°†â½†æ³•åˆ©â½¤æ•°æ®åº“æœ¬èº«çš„äº‹åŠ¡æœºåˆ¶ä¿è¯â¼€è‡´æ€§ï¼Œéœ€è¦å¼•â¼Šâ¼†é˜¶æ®µæäº¤ç­‰æŠ€æœ¯ã€‚\nii. è¿ç»´å¤æ‚ï¼šç³»ç»Ÿç”±å¤šä¸ªç‹¬â½´è¿â¾çš„å¾®æœåŠ¡æ„æˆï¼Œéœ€è¦â¼€ä¸ªè®¾è®¡è‰¯å¥½çš„ç›‘æ§ç³»ç»Ÿå¯¹å„ä¸ªå¾®æœåŠ¡çš„è¿â¾çŠ¶æ€è¿›â¾ç›‘æ§ã€‚è¿ç»´â¼ˆå‘˜éœ€è¦å¯¹ç³»ç»Ÿæœ‰ç»†è‡´çš„äº†è§£æ‰å¯¹å¤Ÿæ›´å¥½çš„è¿ç»´ç³»ç»Ÿã€‚\niii. é€šä¿¡å»¶è¿Ÿï¼šå¾®æœåŠ¡ä¹‹é—´è°ƒâ½¤ä¼šæœ‰æ—¶é—´æŸè€—ï¼Œé€ æˆé€šä¿¡å»¶è¿Ÿã€‚\n4. åˆ—ä¸¾å¾®æœåŠ¡æŠ€æœ¯æ ˆa. æœåŠ¡â½¹å…³Zuul\nb. æœåŠ¡æ³¨å†Œå‘ç°Eureka+Ribbon\na. æœåŠ¡é…ç½®ä¸­â¼¼Apollo\nb. è®¤è¯æˆæƒä¸­â¼¼Spring Security OAuth2\nc. æœåŠ¡æ¡†æ¶Spring Boot\nd. æ•°æ®æ€»çº¿Kafka\ne. â½‡å¿—ç›‘æ§ELK\nf. è°ƒâ½¤é“¾ç›‘æ§CAT\ng. Metricsç›‘æ§KairosDB\nh. å¥åº·æ£€æŸ¥å’Œå‘Šè­¦ZMon\ni. é™æµç†”æ–­å’ŒæµèšåˆHystrix&#x2F;Turbine\n5. eurekaå’Œzookeeperéƒ½å¯ä»¥æä¾›æœåŠ¡çš„æ³¨å†Œä¸å‘ç°åŠŸèƒ½ï¼Œä»–ä»¬çš„åŒºåˆ«a. Zookeeperä¿è¯CPï¼ˆä¸€è‡´æ€§ã€åˆ†åŒºå®¹é”™ï¼‰\n å½“å‘æ³¨å†Œä¸­â¼¼æŸ¥è¯¢æœåŠ¡åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®¹å¿æ³¨å†Œä¸­â¼¼è¿”å›çš„æ˜¯â¼åˆ†é’Ÿä»¥å‰çš„æ³¨å†Œä¿¡æ¯ï¼Œä½†ä¸èƒ½æ¥å—æœåŠ¡ç›´æ¥downæ‰ä¸å¯â½¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡æ³¨å†ŒåŠŸèƒ½å¯¹å¯â½¤æ€§çš„è¦æ±‚è¦â¾¼äºâ¼€è‡´æ€§ã€‚ä½†æ˜¯zkä¼šå‡ºç°è¿™æ ·â¼€ç§æƒ…å†µï¼Œå½“masterèŠ‚ç‚¹å› ä¸ºâ½¹ç»œæ•…éšœä¸å…¶ä»–èŠ‚ç‚¹å¤±å»è”ç³»æ—¶ï¼Œå‰©ä½™èŠ‚ç‚¹ä¼šé‡æ–°è¿›â¾leaderé€‰ä¸¾ã€‚é—®é¢˜åœ¨äºï¼Œé€‰ä¸¾leaderçš„æ—¶é—´å¤ªâ»“ï¼Œ30 ~ 120s, ä¸”é€‰ä¸¾æœŸé—´æ•´ä¸ªzké›†ç¾¤éƒ½æ˜¯ä¸å¯â½¤çš„ï¼Œè¿™å°±å¯¼è‡´åœ¨é€‰ä¸¾æœŸé—´æ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚åœ¨äº‘éƒ¨ç½²çš„ç¯å¢ƒä¸‹ï¼Œå› â½¹ç»œé—®é¢˜ä½¿å¾—zké›†ç¾¤å¤±å»masterèŠ‚ç‚¹æ˜¯è¾ƒâ¼¤æ¦‚ç‡ä¼šå‘â½£çš„äº‹ï¼Œè™½ç„¶æœåŠ¡èƒ½å¤Ÿæœ€ç»ˆæ¢å¤ï¼Œä½†æ˜¯æ¼«â»“çš„é€‰ä¸¾æ—¶é—´å¯¼è‡´çš„æ³¨å†Œâ»“æœŸä¸å¯â½¤æ˜¯ä¸èƒ½å®¹å¿çš„ã€‚\nb. Eurekaä¿è¯APï¼ˆé«˜å¯ç”¨ã€åˆ†åŒºå®¹é”™ï¼‰\n Eurekaçœ‹æ˜â½©äº†è¿™â¼€ç‚¹ï¼Œå› æ­¤åœ¨è®¾è®¡æ—¶å°±ä¼˜å…ˆä¿è¯å¯â½¤æ€§ã€‚Eurekaå„ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œâ¼ä¸ªèŠ‚ç‚¹æŒ‚æ‰ä¸ä¼šå½±å“æ­£å¸¸èŠ‚ç‚¹çš„â¼¯ä½œï¼Œå‰©ä½™çš„èŠ‚ç‚¹ä¾ç„¶å¯ä»¥æä¾›æ³¨å†Œå’ŒæŸ¥è¯¢æœåŠ¡ã€‚â½½Eurekaçš„å®¢æˆ·ç«¯åœ¨å‘æŸä¸ªEurekaæ³¨å†Œæˆ–å¦‚æœå‘ç°è¿æ¥å¤±è´¥ï¼Œåˆ™ä¼šâ¾ƒåŠ¨åˆ‡æ¢â¾„å…¶å®ƒèŠ‚ç‚¹ï¼Œåªè¦æœ‰â¼€å°Eurekaè¿˜åœ¨ï¼Œå°±èƒ½ä¿è¯æ³¨å†ŒæœåŠ¡å¯â½¤(ä¿è¯å¯â½¤æ€§)ï¼Œåªä¸è¿‡æŸ¥åˆ°çš„ä¿¡æ¯å¯èƒ½ä¸æ˜¯æœ€æ–°çš„(ä¸ä¿è¯å¼ºâ¼€è‡´æ€§)ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒEurekaè¿˜æœ‰â¼€ç§â¾ƒæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œå¦‚æœåœ¨15åˆ†é’Ÿå†…è¶…è¿‡85%çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰æ­£å¸¸çš„â¼¼è·³ï¼Œé‚£ä¹ˆEurekaå°±è®¤ä¸ºå®¢æˆ·ç«¯ä¸æ³¨å†Œä¸­â¼¼å‡ºç°äº†â½¹ç»œæ•…éšœï¼Œæ­¤æ—¶ä¼šå‡ºç°ä»¥ä¸‹â¼ç§æƒ…å†µï¼š\n \\1. Eurekaä¸å†ä»æ³¨å†Œåˆ—è¡¨ä¸­ç§»é™¤å› ä¸ºâ»“æ—¶é—´æ²¡æ”¶åˆ°â¼¼è·³â½½åº”è¯¥è¿‡æœŸçš„æœåŠ¡\n \\2. Eurekaä»ç„¶èƒ½å¤Ÿæ¥å—æ–°æœåŠ¡çš„æ³¨å†Œå’ŒæŸ¥è¯¢è¯·æ±‚ï¼Œä½†æ˜¯ä¸ä¼šè¢«åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸Š(å³ä¿è¯å½“å‰èŠ‚ç‚¹ä¾ç„¶å¯â½¤)\n \\3. å½“â½¹ç»œç¨³å®šæ—¶ï¼Œå½“å‰å®ä¾‹æ–°çš„æ³¨å†Œä¿¡æ¯ä¼šè¢«åŒæ­¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸­\n å› æ­¤ï¼Œ Eurekaå¯ä»¥å¾ˆå¥½çš„åº”å¯¹å› â½¹ç»œæ•…éšœå¯¼è‡´éƒ¨åˆ†èŠ‚ç‚¹å¤±å»è”ç³»çš„æƒ…å†µï¼Œâ½½ä¸ä¼šåƒzookeeperé‚£æ ·ä½¿æ•´ä¸ªæ³¨å†ŒæœåŠ¡ç˜«ç—ªã€‚\n6. eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°åŸç†ï¼ša. æ¯30så‘é€â¼¼è·³æ£€æµ‹é‡æ–°è¿›â¾ç§Ÿçº¦ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸èƒ½å¤šæ¬¡æ›´æ–°ç§Ÿçº¦ï¼Œå®ƒå°†åœ¨90så†…ä»æœåŠ¡å™¨æ³¨å†Œä¸­â¼¼ç§»é™¤ã€‚\nb. æ³¨å†Œä¿¡æ¯å’Œæ›´æ–°ä¼šè¢«å¤åˆ¶åˆ°å…¶ä»–Eureka èŠ‚ç‚¹ï¼Œæ¥â¾ƒä»»ä½•åŒºåŸŸçš„å®¢æˆ·ç«¯å¯ä»¥æŸ¥æ‰¾åˆ°æ³¨å†Œä¸­â¼¼ä¿¡æ¯ï¼Œæ¯30så‘â½£â¼€æ¬¡å¤åˆ¶æ¥å®šä½ä»–ä»¬çš„æœåŠ¡ï¼Œå¹¶è¿›â¾è¿œç¨‹è°ƒâ½¤ã€‚\nc. å®¢æˆ·ç«¯è¿˜å¯ä»¥ç¼“å­˜â¼€äº›æœåŠ¡å®ä¾‹ä¿¡æ¯ï¼Œæ‰€ä»¥å³ä½¿Eurekaå…¨æŒ‚æ‰ï¼Œå®¢æˆ·ç«¯ä¹Ÿæ˜¯å¯ä»¥å®šä½åˆ°æœåŠ¡åœ°å€çš„ã€‚\n7.é™æµ1ã€httpé™æµï¼šæˆ‘ä»¬ä½¿â½¤nginxçš„limitzoneæ¥å®Œæˆï¼š &#x2F;&#x2F;è¿™ä¸ªè¡¨ç¤ºä½¿â½¤ipè¿›â¾é™æµ zoneåç§°ä¸ºreq_one åˆ†é…äº†10m ç©ºé—´ä½¿â½¤æ¼æ¡¶ç®—æ³• æ¯ç§’é’Ÿå…è®¸1ä¸ªè¯·æ±‚\nlimit_req_zone $binary_remote_addr zone&#x3D;req_one:10m rate&#x3D;1r&#x2F;s; \nè¿™è¾¹burstè¡¨ç¤ºå¯ä»¥ç¬é—´è¶…è¿‡20ä¸ªè¯·æ±‚ ç”±äºæ²¡æœ‰noDelayå‚æ•°å› æ­¤éœ€è¦æ’é˜Ÿ å¦‚æœè¶…è¿‡è¿™20ä¸ªé‚£ä¹ˆç›´æ¥è¿”å›503\nlimit_req zone&#x3D;req_three burst&#x3D;20; \n2ã€dubboé™æµï¼šdubboæä¾›äº†å¤šä¸ªå’Œè¯·æ±‚ç›¸å…³çš„filterï¼šActiveLimitFilter ExecuteLimitFilter TPSLimiterFilter\\1. ActiveLimitFilterï¼š \n@Activate(group &#x3D; Constants.CONSUMER, value &#x3D; Constants.ACTIVES_KEY)\nä½œâ½¤äºå®¢æˆ·ç«¯ï¼Œä¸»è¦ä½œâ½¤æ˜¯æ§åˆ¶å®¢æˆ·ç«¯â½…æ³•çš„å¹¶å‘åº¦ï¼›\nå½“è¶…è¿‡äº†æŒ‡å®šçš„activeå€¼ä¹‹åè¯¥è¯·æ±‚å°†ç­‰å¾…å‰â¾¯çš„è¯·æ±‚å®Œæˆã€ä½•æ—¶ç»“æŸå‘¢ï¼Ÿä¾èµ–äºè¯¥â½…æ³•çš„timeout å¦‚æœæ²¡æœ‰è®¾ç½®timeoutçš„è¯å¯èƒ½å°±æ˜¯å¤šä¸ªè¯·æ±‚â¼€ç›´è¢«é˜»å¡ç„¶åç­‰å¾…éšæœºå”¤é†’ã€‚\n\\2. ExecuteLimitFilterï¼š \n@Activate(group &#x3D; Constants.PROVIDER, value &#x3D; Constants.EXECUTES_KEY)\nä½œâ½¤äºæœåŠ¡ç«¯ï¼Œâ¼€æ—¦è¶…å‡ºæŒ‡å®šçš„æ•°â½¬ç›´æ¥æŠ¥é”™ å…¶å®æ˜¯æŒ‡åœ¨æœåŠ¡ç«¯çš„å¹¶â¾åº¦ã€éœ€è¦æ³¨æ„è¿™äº›éƒ½æ˜¯æŒ‡çš„æ˜¯åœ¨å•å°æœåŠ¡ä¸Šâ½½ä¸æ˜¯æ•´ä¸ªæœåŠ¡é›†ç¾¤ã€‘\n\\3. TPSLimiterFilterï¼š \n@Activate(group &#x3D; Constants.PROVIDER, value &#x3D; Constants.TPS_LIMIT_RATE_KEY)\nä½œâ½¤äºæœåŠ¡ç«¯ï¼Œæ§åˆ¶â¼€æ®µæ—¶é—´å†…çš„è¯·æ±‚æ•°ï¼›é»˜è®¤æƒ…å†µä¸‹å–å¾—tps.intervalå­—æ®µè¡¨ç¤ºè¯·æ±‚é—´éš” å¦‚æœâ½†æ³•æ‰¾åˆ°åˆ™ä½¿â½¤60s æ ¹æ®tpså­—æ®µè¡¨ç¤ºå…è®¸è°ƒâ½¤æ¬¡æ•°ã€‚ä½¿â½¤AtomicIntegerè¡¨ç¤ºå…è®¸è°ƒâ½¤çš„æ¬¡æ•° æ¯æ¬¡è°ƒâ½¤å‡å°‘1æ¬¡å½“ç»“æœâ¼©äº0ä¹‹åè¿”å›ä¸å…è®¸è°ƒâ½¤\n3ã€springcloudé™æµï¼š1ã€æˆ‘ä»¬å¯ä»¥é€šè¿‡semaphore.maxConcurrentRequests,coreSize,maxQueueSizeå’ŒqueueSizeRejectionThresholdè®¾ç½®ä¿¡å·é‡æ¨¡å¼ä¸‹çš„æœ€â¼¤å¹¶å‘é‡ã€çº¿ç¨‹æ± â¼¤â¼©ã€ç¼“å†²åŒºâ¼¤â¼©å’Œç¼“å†²åŒºé™çº§é˜ˆå€¼ã€‚ \n#ä¸è®¾ç½®ç¼“å†²åŒºï¼Œå½“è¯·æ±‚æ•°è¶…è¿‡coreSizeæ—¶ç›´æ¥é™çº§\nhystrix.threadpool.userThreadPool.maxQueueSize&#x3D;-1 \n#è¶…æ—¶æ—¶é—´â¼¤äºæˆ‘ä»¬çš„timeoutæ¥â¼è¿”å›æ—¶é—´\nhystrix.command.userCommandKey.execution.isolation.thread.timeoutInMilliseconds&#x3D;15000\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿ç»­å¤šæ¬¡è¯·æ±‚&#x2F;user&#x2F;command&#x2F;timeoutæ¥â¼ï¼Œåœ¨ç¬¬â¼€ä¸ªè¯·æ±‚è¿˜æ²¡æœ‰æˆåŠŸè¿”å›æ—¶ï¼ŒæŸ¥çœ‹è¾“å‡ºâ½‡å¿—å¯ä»¥å‘ç°åªæœ‰ç¬¬â¼€ä¸ªè¯·æ±‚æ­£å¸¸çš„è¿›â¼Šåˆ°user-serviceçš„æ¥â¼ä¸­ï¼Œå…¶å®ƒè¯·æ±‚ä¼šç›´æ¥è¿”å›é™çº§ä¿¡æ¯ã€‚è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†å¯¹æœåŠ¡è¯·æ±‚çš„é™æµã€‚\n2ã€æ¼æ¡¶ç®—æ³•ï¼šâ½”ï¼ˆè¯·æ±‚ï¼‰å…ˆè¿›â¼Šåˆ°æ¼æ¡¶â¾¥ï¼Œæ¼æ¡¶ä»¥â¼€å®šçš„é€Ÿåº¦å‡ºâ½”ï¼Œå½“â½”æµâ¼Šé€Ÿåº¦è¿‡â¼¤ä¼šç›´æ¥æº¢å‡ºï¼Œå¯ä»¥çœ‹å‡ºæ¼æ¡¶ç®—æ³•èƒ½å¼ºâ¾é™åˆ¶æ•°æ®çš„ä¼ è¾“é€Ÿç‡ã€‚\n\n3ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼šé™¤äº†è¦æ±‚èƒ½å¤Ÿé™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡å¤–ï¼Œè¿˜è¦æ±‚å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚è¿™æ—¶å€™æ¼æ¡¶ç®—æ³•å¯èƒ½å°±ä¸åˆé€‚äº†ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•æ›´ä¸ºé€‚åˆã€‚å¦‚å›¾2æ‰€ç¤ºï¼Œä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†æ˜¯ç³»ç»Ÿä¼šä»¥â¼€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶â¾¥æ”¾â¼Šä»¤ç‰Œï¼Œâ½½å¦‚æœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»æ¡¶â¾¥è·å–â¼€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶â¾¥æ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚\n\n4ã€redisè®¡æ•°å™¨é™æµï¼›\n8.springcloudæ ¸â¼¼ç»„ä»¶åŠå…¶ä½œâ½¤ï¼Œä»¥åŠspringcloudâ¼¯ä½œåŸç†ï¼š\nspringcloudç”±ä»¥ä¸‹â¼ä¸ªæ ¸â¼¼ç»„ä»¶æ„æˆï¼š\nEurekaï¼šå„ä¸ªæœåŠ¡å¯åŠ¨æ—¶ï¼ŒEureka Clientéƒ½ä¼šå°†æœåŠ¡æ³¨å†Œåˆ°Eureka Serverï¼Œå¹¶ä¸”Eureka Clientè¿˜å¯ä»¥åè¿‡æ¥ä»EurekaServeræ‹‰å–æ³¨å†Œè¡¨ï¼Œä»â½½çŸ¥é“å…¶ä»–æœåŠ¡åœ¨å“ªâ¾¥\nRibbonï¼šæœåŠ¡é—´å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼ŒåŸºäºRibbonåšè´Ÿè½½å‡è¡¡ï¼Œä»â¼€ä¸ªæœåŠ¡çš„å¤šå°æœºå™¨ä¸­é€‰æ‹©â¼€å°\nFeignï¼šåŸºäºFeignçš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œæ ¹æ®æ³¨è§£å’Œé€‰æ‹©çš„æœºå™¨ï¼Œæ‹¼æ¥è¯·æ±‚URLåœ°å€ï¼Œå‘èµ·è¯·æ±‚\nHystrixï¼šå‘èµ·è¯·æ±‚æ˜¯é€šè¿‡Hystrixçš„çº¿ç¨‹æ± æ¥â¾›çš„ï¼Œä¸åŒçš„æœåŠ¡â¾›ä¸åŒçš„çº¿ç¨‹æ± ï¼Œå®ç°äº†ä¸åŒæœåŠ¡è°ƒâ½¤çš„éš”ç¦»ï¼Œé¿å…äº†æœåŠ¡é›ªå´©çš„é—®é¢˜ï¼ˆCSFä¹Ÿä¼šé€šè¿‡Hystrixçº¿ç¨‹æ± å‘èµ·è¯·æ±‚ï¼‰\nZuulï¼šå¦‚æœå‰ç«¯ã€ç§»åŠ¨ç«¯è¦è°ƒâ½¤åç«¯ç³»ç»Ÿï¼Œç»Ÿâ¼€ä»Zuulâ½¹å…³è¿›â¼Šï¼Œç”±Zuulâ½¹å…³è½¬å‘è¯·æ±‚ç»™å¯¹åº”çš„æœåŠ¡\n9. eurekaç¼“å­˜æœºåˆ¶ï¼š\na. ç¬¬â¼€å±‚ç¼“å­˜ï¼šreadOnlyCacheMapï¼Œæœ¬è´¨ä¸Šæ˜¯ConcurrentHashMapï¼šè¿™æ˜¯â¼€ä¸ªJVMçš„CurrentHashMapåªè¯»ç¼“å­˜ï¼Œè¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†ä¾›å®¢æˆ·ç«¯è·å–æ³¨å†Œä¿¡æ¯æ—¶ä½¿â½¤ï¼Œå…¶ç¼“å­˜æ›´æ–°ï¼Œä¾èµ–äºå®šæ—¶å™¨çš„æ›´æ–°ï¼Œé€šè¿‡å’ŒreadWriteCacheMap çš„å€¼åšå¯¹â½ï¼Œå¦‚æœæ•°æ®ä¸â¼€è‡´ï¼Œåˆ™ä»¥readWriteCacheMap çš„æ•°æ®ä¸ºå‡†ã€‚readOnlyCacheMap ç¼“å­˜æ›´æ–°çš„å®šæ—¶å™¨æ—¶é—´é—´éš”ï¼Œé»˜è®¤ä¸º30ç§’ï¼ˆAICACHEçš„readOnlyCacheåŸºäºç›¸åŒçš„æœºåˆ¶ï¼‰\nb. ç¬¬â¼†å±‚ç¼“å­˜ï¼šreadWriteCacheMapï¼Œæœ¬è´¨ä¸Šæ˜¯Guavaç¼“å­˜ï¼šæ­¤å¤„å­˜æ”¾çš„æ˜¯æœ€ç»ˆçš„ç¼“å­˜ï¼Œ å½“æœåŠ¡ä¸‹çº¿ï¼Œè¿‡æœŸï¼Œæ³¨å†Œï¼ŒçŠ¶æ€å˜æ›´ï¼Œéƒ½ä¼šæ¥æ¸…é™¤è¿™ä¸ªç¼“å­˜â¾¥â¾¯çš„æ•°æ®ã€‚ ç„¶åé€šè¿‡CacheLoaderè¿›â¾ç¼“å­˜åŠ è½½ï¼Œåœ¨è¿›readWriteCacheMap.get(key)çš„æ—¶å€™ï¼Œâ¾¸å…ˆçœ‹è¿™ä¸ªç¼“å­˜â¾¥â¾¯æœ‰æ²¡æœ‰è¯¥æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™é€šè¿‡CacheLoaderçš„loadâ½…æ³•å»åŠ è½½ï¼ŒåŠ è½½æˆåŠŸä¹‹åå°†æ•°æ®æ”¾â¼Šç¼“å­˜ï¼ŒåŒæ—¶è¿”å›æ•°æ®ã€‚ readWriteCacheMap ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ä¸º 180 ç§’ ã€‚\nc. ç¼“å­˜æœºåˆ¶ï¼šè®¾ç½®äº†â¼€ä¸ªæ¯30ç§’æ‰§â¾â¼€æ¬¡çš„å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶å»æœåŠ¡ç«¯è·å–æ³¨å†Œä¿¡æ¯ã€‚è·å–ä¹‹åï¼Œå­˜â¼Šæœ¬åœ°å†…å­˜ã€‚\n10. ç†”æ–­çš„åŸç†ï¼Œä»¥åŠå¦‚ä½•æ¢å¤ï¼Ÿ\na. æœåŠ¡çš„å¥åº·çŠ¶å†µ &#x3D; è¯·æ±‚å¤±è´¥æ•° &#x2F; è¯·æ±‚æ€»æ•°.\nç†”æ–­å™¨å¼€å…³ç”±å…³é—­åˆ°æ‰“å¼€çš„çŠ¶æ€è½¬æ¢æ˜¯é€šè¿‡å½“å‰æœåŠ¡å¥åº·çŠ¶å†µå’Œè®¾å®šé˜ˆå€¼â½è¾ƒå†³å®šçš„.\ni. å½“ç†”æ–­å™¨å¼€å…³å…³é—­æ—¶, è¯·æ±‚è¢«å…è®¸é€šè¿‡ç†”æ–­å™¨. å¦‚æœå½“å‰å¥åº·çŠ¶å†µâ¾¼äºè®¾å®šé˜ˆå€¼, å¼€å…³ç»§ç»­ä¿æŒå…³é—­. å¦‚æœå½“å‰å¥åº·çŠ¶å†µä½äºè®¾å®šé˜ˆå€¼, å¼€å…³åˆ™åˆ‡æ¢ä¸ºæ‰“å¼€çŠ¶æ€.\nii. å½“ç†”æ–­å™¨å¼€å…³æ‰“å¼€æ—¶, è¯·æ±‚è¢«ç¦â½Œé€šè¿‡.\niii. å½“ç†”æ–­å™¨å¼€å…³å¤„äºæ‰“å¼€çŠ¶æ€, ç»è¿‡â¼€æ®µæ—¶é—´å, ç†”æ–­å™¨ä¼šâ¾ƒåŠ¨è¿›â¼ŠåŠå¼€çŠ¶æ€, è¿™æ—¶ç†”æ–­å™¨åªå…è®¸â¼€ä¸ªè¯·æ±‚é€šè¿‡. å½“è¯¥è¯·æ±‚è°ƒâ½¤æˆåŠŸæ—¶, ç†”æ–­å™¨æ¢å¤åˆ°å…³é—­çŠ¶æ€. è‹¥è¯¥è¯·æ±‚å¤±è´¥, ç†”æ–­å™¨ç»§ç»­ä¿æŒæ‰“å¼€çŠ¶æ€, æ¥ä¸‹æ¥çš„è¯·æ±‚è¢«ç¦â½Œé€šè¿‡.ç†”æ–­å™¨çš„å¼€å…³èƒ½ä¿è¯æœåŠ¡è°ƒâ½¤è€…åœ¨è°ƒâ½¤å¼‚å¸¸æœåŠ¡æ—¶, å¿«é€Ÿè¿”å›ç»“æœ, é¿å…â¼¤é‡çš„åŒæ­¥ç­‰å¾…. å¹¶ä¸”ç†”æ–­å™¨èƒ½åœ¨â¼€æ®µæ—¶é—´åç»§ç»­ä¾¦æµ‹è¯·æ±‚æ‰§â¾ç»“æœ, æä¾›æ¢å¤æœåŠ¡è°ƒâ½¤çš„å¯èƒ½.\nï¼ˆCSFä¼šç›‘æ§è¯·æ±‚è¿‡æ¥çš„è¯·æ±‚ï¼Œè¯·æ±‚ä¼šè¢«æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—å¤„ç†ï¼Œå½“é˜Ÿåˆ—çš„è¯·æ±‚å¤§äºè®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œæ‹’ç»è¯·æ±‚ï¼‰\n11. æœåŠ¡é›ªå´©ï¼Ÿé‡åˆ°è¿‡çš„é›ªå´©ï¼šæœåŠ¡é‡å¯æ—¶ï¼ŒæŸå°æœºä¸å¯ç”¨ï¼Œå½±å“åˆ°é›†ç¾¤ä¸­æ‰€æœ‰æœåŠ¡ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†è¯·æ±‚éƒ½ä¸å¯ç”¨ï¼ˆè¯·æ±‚é˜Ÿåˆ—æ»¡ï¼Œè¯·æ±‚è¢«æ‹’ç»ï¼‰\nå¯èƒ½åŸå› ï¼šå¤§é‡æ…¢SQLçš„æŸ¥è¯¢å †ç§¯ï¼Œå ç”¨äº†CSFæœåŠ¡å¯¼è‡´çº¿ç¨‹æ— æ³•é‡Šæ”¾ï¼Œæœ€åå½±å“åˆ°æ‰€æœ‰æœåŠ¡\n\na. ç®€ä»‹ï¼šæœåŠ¡é›ªå´©æ•ˆåº”æ˜¯â¼€ç§å›  æœåŠ¡æä¾›è€… çš„ä¸å¯â½¤å¯¼è‡´ æœåŠ¡è°ƒâ½¤è€… çš„ä¸å¯â½¤,å¹¶å°†ä¸å¯â½¤ é€æ¸æ”¾â¼¤ çš„è¿‡ç¨‹.\nb. å½¢æˆåŸå› ï¼š\ni. æœåŠ¡æä¾›è€…ä¸å¯â½¤\nii. é‡è¯•åŠ â¼¤æµé‡\niii. æœåŠ¡è°ƒâ½¤è€…ä¸å¯â½¤\nc. é‡‡â½¤ç­–ç•¥ï¼š\ni. æµé‡æ§åˆ¶\nii. æ”¹è¿›ç¼“å­˜æ¨¡å¼\niii. æœåŠ¡â¾ƒåŠ¨æ‰©å®¹\niv. æœåŠ¡è°ƒâ½¤è€…é™çº§æœåŠ¡\n12. æ¥â¼é™æµâ½…æ³•ï¼Ÿa. é™åˆ¶ æ€»å¹¶å‘æ•°ï¼ˆâ½å¦‚ æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ï¼‰\nb. é™åˆ¶ ç¬æ—¶å¹¶å‘æ•°ï¼ˆå¦‚ nginx çš„ limit_conn æ¨¡å—ï¼Œâ½¤æ¥é™åˆ¶ ç¬æ—¶å¹¶å‘è¿æ¥æ•°ï¼‰\nc. é™åˆ¶ æ—¶é—´çª—â¼å†…çš„å¹³å‡é€Ÿç‡ï¼ˆå¦‚ Guava çš„ RateLimiterã€nginx çš„ limit_reqæ¨¡å—ï¼Œé™åˆ¶æ¯ç§’çš„å¹³å‡é€Ÿç‡ï¼‰\nd. é™åˆ¶ è¿œç¨‹æ¥â¼ è°ƒâ½¤é€Ÿç‡\ne. é™åˆ¶ MQ çš„æ¶ˆè´¹é€Ÿç‡\nf. å¯ä»¥æ ¹æ® â½¹ç»œè¿æ¥æ•°ã€â½¹ç»œæµé‡ã€CPU æˆ– å†…å­˜è´Ÿè½½ ç­‰æ¥é™æµ\n","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"dubbo","url":"/java4u/2021/09/20/4.1%E5%BE%AE%E6%9C%8D%E5%8A%A1--dubbo/","content":"å¾®æœåŠ¡â€“dubbo\n1.Dubbo å’Œ Spring Cloud æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ1ï¼‰é€šä¿¡â½…å¼ä¸åŒ\n1ã€Dubbo ä½¿â½¤çš„æ˜¯ RPC é€šä¿¡ï¼Œâ½½ Spring Cloud ä½¿â½¤çš„æ˜¯ HTTP RESTFul â½…å¼ã€‚ \n2ã€dubboç”±äºæ˜¯â¼†è¿›åˆ¶çš„ä¼ è¾“ï¼Œå â½¤å¸¦å®½ä¼šæ›´å°‘ï¼ˆåŸºäºnettyç­‰ï¼‰ï¼›springCloudæ˜¯httpåè®®ä¼ è¾“ï¼Œå¸¦å®½ä¼šâ½è¾ƒå¤šï¼ŒåŒæ—¶ä½¿â½¤httpåè®®ï¼ˆhttp+restful apiï¼‰â¼€èˆ¬ä¼šä½¿â½¤JSONæŠ¥â½‚ï¼Œæ¶ˆè€—ä¼šæ›´â¼¤ã€‚\n3ã€dubboçš„å¼€å‘éš¾åº¦è¾ƒâ¼¤ï¼ŒåŸå› æ˜¯dubboçš„jaråŒ…ä¾èµ–ï¼ˆå­˜åœ¨ä»£ç çº§åˆ«çš„å¼ºä¾èµ–ï¼‰é—®é¢˜å¾ˆå¤šâ¼¤å‹â¼¯ç¨‹â½†æ³•è§£å†³ï¼›\nspringcloudçš„æ¥â¼åè®®çº¦å®šâ½è¾ƒâ¾ƒç”±ä¸”æ¾æ•£ï¼Œéœ€è¦æœ‰å¼ºæœ‰â¼’çš„â¾æ”¿æªæ–½æ¥é™åˆ¶æ¥â¼â½†åºå‡çº§ã€‚\n4ã€dubboçš„æ”¹è¿›æ˜¯é€šè¿‡dubbofilterï¼Œå¾ˆå¤šä¸œâ»„æ²¡æœ‰ï¼Œéœ€è¦â¾ƒâ¼°ç»§æ‰¿ï¼Œå¦‚ç›‘æ§ï¼Œå¦‚â½‡å¿—ï¼Œå¦‚é™æµï¼Œå¦‚è¿½è¸ªã€‚springcloudå…·æœ‰é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ã€â¼€æ¬¡æ€§tokenã€å…¨å±€é”ã€é€‰ä¸»ã€åˆ†å¸ƒå¼ä¼šè¯å’Œé›†ç¾¤çŠ¶æ€ç­‰ï¼Œæ»¡â¾œäº†æ„å»ºå¾®æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰è§£å†³â½…æ¡ˆã€‚\n2ï¼‰ç»„æˆä¸åŒ\n2.Dubboâ¾¥â¾¯æœ‰å“ªâ¼ç§èŠ‚ç‚¹â»†â¾Šï¼Ÿ\n3.DubboæœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹\n4.Dubboæœ‰å“ªâ¼ç§é›†ç¾¤å®¹é”™â½…æ¡ˆï¼Œé»˜è®¤æ˜¯å“ªç§ï¼Ÿ\n5.Dubboæœ‰å“ªâ¼ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé»˜è®¤æ˜¯å“ªç§ï¼Ÿ\n6.DubboæœåŠ¡ä¹‹é—´çš„è°ƒâ½¤æ˜¯é˜»å¡çš„å—ï¼Ÿé»˜è®¤æ˜¯åŒæ­¥ç­‰å¾…ç»“æœé˜»å¡çš„ï¼Œâ½€æŒå¼‚æ­¥è°ƒâ½¤ã€‚Dubbo æ˜¯åŸºäº NIO çš„â¾®é˜»å¡å®ç°å¹¶â¾è°ƒâ½¤ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨å¤šçº¿ç¨‹å³å¯å®Œæˆå¹¶â¾è°ƒâ½¤å¤šä¸ªè¿œç¨‹æœåŠ¡ï¼Œç›¸å¯¹å¤šçº¿ç¨‹å¼€é”€è¾ƒâ¼©ï¼Œå¼‚æ­¥è°ƒâ½¤ä¼šè¿”å›â¼€ä¸ª Future å¯¹è±¡ã€‚\nå¼‚æ­¥è°ƒâ½¤æµç¨‹å›¾å¦‚ä¸‹ã€‚\n\n7.è¯´è¯´ Dubbo æœåŠ¡æš´éœ²çš„è¿‡ç¨‹Dubbo ä¼šåœ¨ Spring å®ä¾‹åŒ–å®Œ bean ä¹‹åï¼Œåœ¨åˆ·æ–°å®¹å™¨æœ€åâ¼€æ­¥å‘å¸ƒ ContextRefreshEvent äº‹ä»¶çš„æ—¶å€™ï¼Œé€šçŸ¥å®ç°äº†ApplicationListener çš„ ServiceBean ç±»è¿›â¾å›è°ƒ onApplicationEvent äº‹ä»¶â½…æ³•ï¼ŒDubbo ä¼šåœ¨è¿™ä¸ªâ½…æ³•ä¸­è°ƒâ½¤ ServiceBean â½—ç±»ServiceConfig çš„ export â½…æ³•ï¼Œâ½½è¯¥â½…æ³•çœŸæ­£å®ç°äº†æœåŠ¡çš„ï¼ˆå¼‚æ­¥æˆ–è€…â¾®å¼‚æ­¥ï¼‰å‘å¸ƒã€‚\n8.æ³¨å†Œä¸­â¼¼æŒ‚äº†ï¼Œæ¶ˆè´¹è€…è¿˜èƒ½è°ƒâ½¤æœåŠ¡è€…å—ï¼Ÿ\\1. æ³¨å†Œä¸­â¼¼å¯¹ç­‰é›†ç¾¤ï¼Œä»»æ„â¼€å°å®•æ‰åï¼Œä¼šâ¾ƒåŠ¨åˆ‡æ¢åˆ°å¦â¼€å°\n\\2. æ³¨å†Œä¸­â¼¼å…¨éƒ¨å®•æ‰ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…ä»å¯ä»¥é€šè¿‡æœ¬åœ°ç¼“å­˜é€šè®¯\n\\3. æœåŠ¡æä¾›è€…â½†çŠ¶æ€ï¼Œä»»â¼€å° å®•æœºåï¼Œä¸å½±å“ä½¿â½¤\n\\4. æœåŠ¡æä¾›è€…å…¨éƒ¨å®•æœºï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¼šâ½†æ³•ä½¿â½¤ï¼Œå¹¶â½†é™æ¬¡é‡è¿ç­‰å¾…æœåŠ¡è€…æ¢å¤\n","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"æ‰˜æ”¶ç®—è´¹ä¼˜åŒ–","url":"/java4u/2021/09/16/%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%8C%96/","content":"åœºæ™¯ï¼šæ–°ä¸Šçº¿å¸¸å·åˆ†å…¬å¸çš„æ‰˜æ”¶ä»»åŠ¡ï¼ˆ20Wæ•°æ®ï¼‰ ç®—è´¹è¿‡æ…¢    ç›®æ ‡ï¼ˆæ¯åˆ†é’Ÿå¤„ç† 5000æ¡æ•°æ®ï¼‰\nåˆ†æï¼š\tä¸€æ¡æ•°æ®å…±è€—æ—¶ï¼š2719ms  æŸ¥è¯¢æ‰˜æ”¶å…³ç³»è¡¨\t1.  92ms  select * from AM_ENTRUST_RELATION where 1 = 1  and state = ? and ACCT_ID = ? \t--åŠ ç´¢å¼•ï¼Œgj2ç¯å¢ƒå·²ç»åŠ äº†\t2.  824ms   EntrustFunc.qryAcctAllStopServ ,åˆ¤æ–­æ˜¯å¦ä¸ºä¸»åŠ¨åœæœºç”¨æˆ·\t--å»ºè®®æŸ¥è¯¢è®¡è´¹ç”¨æˆ·çŠ¶æ€è¡¨\t3. 214ms ä»æ³¨å†Œä¸­å¿ƒè·å–è¿œç¨‹æœåŠ¡åœ°å€:OC.BC.person.IQryCustIdSV.checkCustExistsByType-&gt;http://10.97.114.108:10001/service\t--å»ºè®®æŸ¥è¯¢è®¡è´¹ç”¨æˆ·çŠ¶æ€è¡¨\t4. 542ms ä»æ³¨å†Œä¸­å¿ƒè·å–è¿œç¨‹æœåŠ¡åœ°å€:OC.person.IQueryScaInfoSV.queryUserCustAcctInfoByAccId-&gt;http://10.97.114.108:10001/service\t--å»ºè®®æŸ¥è¯¢è®¡è´¹ç”¨æˆ·çŠ¶æ€è¡¨\t5. 412ms select b.service_id,a.object_id,min(a.PRODUCT_STATUS) status_min,max(a.PRODUCT_STATUS) status_max,min(a.VALID_DATE) valid_date,max(a.EXPIRE_DATE) expire_date from CD.CO_PROD_STS_0523_1 a left join CD.CO_PROD_0523_1 b on a.PRODUCT_ID=b.PRODUCT_ID and b.service_id is not null where a.OBJECT_TYPE= 0 and a.PRODUCT_STATUS !=0 and a.EXPIRE_DATE&gt;=sysdate and a.OBJECT_ID in (108727164,108727147,102349814) group by a.object_id,b.SERVICE_ID \t--ä¼˜åŒ–ç´¢å¼•ï¼Œgj2ç¯å¢ƒå·²ç»åŠ äº†--50mså·¦å³\t6. 606ms æœ¬æ¬¡è°ƒç”¨æœåŠ¡asset_IPaymentCSV_queryOweFeeæ€»è€—æ—¶:606ms\t\t30åˆ†é’Ÿå¤§æ¦‚å¤„ç†4000æ¡æ•°æ®\n\nç¬¬ä¸€æ¬¡ä¼˜åŒ–ï¼š\t1.ä¼˜åŒ–è¡¨ï¼Œè¡¨åŠ ç´¢å¼•\t2.å‡å°‘å»ä¸‰æˆ·ä¿¡æ¯çš„è°ƒç”¨  æŸ¥è¡¨æ›¿ä»£\t3.ä¼˜åŒ–æŸ¥æ¬       æŸ¥æ¬ ä¸æŸ¥è¯¢ä¸‰æˆ·ä¿¡æ¯ï¼Œæ‰˜æ”¶ä¸éœ€è¦è·å–å®¢æˆ·çš„ä¸‰æˆ·ä¿¡æ¯\tç»“æœï¼š\tç›®å‰æ•ˆç‡ 1åˆ†é’Ÿ500æ¡     500 * 60 = 3Wæ¡\tå¤§éƒ¨åˆ†ä½¿ç”¨CPUï¼ˆ5-6ï¼‰  æœåŠ¡å™¨ï¼š32æ ¸\tæå‡çº¿ç¨‹æ•°ä¹Ÿä¸èƒ½æä¾›CPUçš„ä½¿ç”¨åˆ†æï¼š\tCPUå ç”¨ä¸Šä¸å»ï¼Œè¿›ç¨‹å¤ªå°‘\tå¤šçš„åˆ†å…¬å¸æœ‰20Wæ•°æ®ï¼Œä¼˜åŒ–æ‹†åˆ†é€»è¾‘ï¼Œå¯¹è´¦æˆ·è¿›è¡Œå–æ¨¡åˆ†å‘\tï¼ˆåˆ†å‘æ•°æ®å‰ä¿®æ”¹æŸ¥è¯¢æ–¹å¼ï¼‰\n\n\tç¬¬äºŒæ¬¡ä¼˜åŒ–ï¼š\t\tæ·»åŠ é€šé“ï¼Œå¯¹MOD(A.CUST_CODE,10000) 0-1999 2000-3999 4000-5999 6000-7999 8000-9999 åœ¨åˆ†5ä¸ªè¿›ç¨‹å¤„ç†\t\t\t\t\tç»“æœï¼š\t\tæ¯åˆ†é’Ÿå¤§æ¦‚3500æ¡\t\t\t\tåˆ†æï¼š[2021-09-21 14:55:33,715] [processor-6] (ClientStub.java:119)  INFO  - æœ¬æ¬¡è°ƒç”¨æœåŠ¡asset_ICycleCSV_querySysPreCycleæ€»è€—æ—¶:394ms[2021-09-21 14:55:34,124] [processor-6] (ClientStub.java:119)  INFO  - æœ¬æ¬¡è°ƒç”¨æœåŠ¡asset_ICycleCSV_querySysCurCycleæ€»è€—æ—¶:342ms[2021-09-21 14:55:34,377] [processor-6] (ClientStub.java:119)  INFO  - æœ¬æ¬¡è°ƒç”¨æœåŠ¡asset_ICycleCSV_querySysMaxCycleæ€»è€—æ—¶:250ms[2021-09-21 14:55:34,966] [processor-6] (ClientStub.java:119)  INFO  - æœ¬æ¬¡è°ƒç”¨æœåŠ¡acomp_ICommParamCSV_getListæ€»è€—æ—¶:570ms[2021-09-21 14:55:35,406] [processor-6] (ClientStub.java:119)  INFO  - æœ¬æ¬¡è°ƒç”¨æœåŠ¡acomp_ICommParamCSV_getListæ€»è€—æ—¶:435ms[2021-09-21 14:55:36,051] [processor-6] (ClientStub.java:119)  INFO  - æœ¬æ¬¡è°ƒç”¨æœåŠ¡asset_IEntrustDoCSV_doEntrustErræ€»è€—æ—¶:618ms\t\t\t\tå‘ç°å¤šæ¬¡å»è°ƒç”¨æœåŠ¡æŸ¥è¯¢è´¦æœŸï¼ˆæŸ¥è¯¢è™šé”€æ—¶éœ€è¦æŸ¥è¯¢è´¦æœŸï¼‰\t\tå®é™…è·å–çš„éƒ½æ˜¯ç³»ç»Ÿè´¦æœŸï¼ˆå½“å‰æ²¡æœ‰åˆ†åº“ï¼‰ï¼Œåªéœ€è¦æŸ¥è¯¢ä¸€æ¬¡å°±å¯ä»¥äº†\n\nç¬¬ä¸‰æ¬¡ä¼˜åŒ–ï¼š\tè¿›ç¨‹å¯åŠ¨æ—¶æŸ¥è¯¢è´¦æœŸæ•°æ®æ”¾å…¥ç¼“å­˜ï¼Œ\tæŸ¥æ¬ ä¿®æ”¹æ”¯æŒå¤–éƒ¨ä¼ å…¥è´¦æœŸï¼Œ\tè´¦æœŸåªæœ‰ç¬¬ä¸€æ¬¡éœ€è¦æŸ¥è¯¢ï¼Œä¹‹åç›´æ¥è·å–å³å¯\tç»“æœï¼š\t2å°ä¸»æœºï¼Œ30ä¸ªè¿›ç¨‹ï¼Œ10ä¸ªçº¿ç¨‹ï¼Œ5000æ¡/åˆ†é’Ÿ--7000æ¡/åˆ†é’Ÿ","categories":["è°ƒä¼˜"],"tags":["è¿›ç¨‹ä¼˜åŒ–"]},{"title":"å¤šçº¿ç¨‹","url":"/java4u/2021/09/03/4.%E5%A4%9A%E7%BA%BF%E7%A8%8B/","content":"1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ1ã€çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›â¾è¿ç®—è°ƒåº¦çš„æœ€â¼©å•ä½ï¼Œå®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ï¼Œå¯ä»¥ä½¿â½¤å¤šçº¿ç¨‹å¯¹è¿›â¾è¿ç®—æé€Ÿã€‚\n2.ä»€ä¹ˆæ˜¯â¾ƒæ—‹é”ï¼Ÿâ¾ƒæ—‹é”æ˜¯SMPæ¶æ„ä¸­çš„â¼€ç§low-levelçš„åŒæ­¥æœºåˆ¶ã€‚\n1ã€å½“çº¿ç¨‹Aæƒ³è¦è·å–â¼€æŠŠâ¾ƒæ—‹é”â½½è¯¥é”â¼œè¢«å…¶å®ƒçº¿ç¨‹é”æŒæœ‰æ—¶ï¼Œçº¿ç¨‹Aä¼šåœ¨â¼€ä¸ªå¾ªç¯ä¸­â¾ƒæ—‹ä»¥æ£€æµ‹é”æ˜¯ä¸æ˜¯å·²ç»å¯â½¤äº†ã€‚ \n2ã€â¾ƒé€‰é”éœ€è¦æ³¨æ„ï¼š\nç”±äºâ¾ƒæ—‹æ—¶ä¸é‡Šæ”¾CPUï¼Œå› â½½æŒæœ‰â¾ƒæ—‹é”çš„çº¿ç¨‹åº”è¯¥å°½å¿«é‡Šæ”¾â¾ƒæ—‹é”ï¼Œå¦åˆ™ç­‰å¾…è¯¥â¾ƒæ—‹é”çš„çº¿ç¨‹ä¼šâ¼€ç›´åœ¨é‚£â¾¥â¾ƒæ—‹ï¼Œè¿™å°±ä¼šæµªè´¹CPUæ—¶é—´ã€‚æŒæœ‰â¾ƒæ—‹é”çš„çº¿ç¨‹åœ¨sleepä¹‹å‰åº”è¯¥é‡Šæ”¾â¾ƒæ—‹é”ä»¥ä¾¿å…¶å®ƒçº¿ç¨‹å¯ä»¥è·å¾—â¾ƒæ—‹é”ã€‚\n3ã€â½¬å‰çš„JVMå®ç°â¾ƒæ—‹ä¼šæ¶ˆè€—CPUï¼Œå¦‚æœâ»“æ—¶é—´ä¸è°ƒâ½¤doNotifyâ½…æ³•ï¼ŒdoWaitâ½…æ³•ä¼šâ¼€ç›´â¾ƒæ—‹ï¼ŒCPUä¼šæ¶ˆè€—å¤ªâ¼¤\n4ã€â¾ƒæ—‹é”â½è¾ƒé€‚â½¤äºé”ä½¿â½¤è€…ä¿æŒé”æ—¶é—´â½è¾ƒçŸ­çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µâ¾ƒæ—‹é”çš„æ•ˆç‡â½è¾ƒâ¾¼ã€‚\n5ã€â¾ƒæ—‹é”æ˜¯â¼€ç§å¯¹å¤šå¤„ç†å™¨ç›¸å½“æœ‰æ•ˆçš„æœºåˆ¶ï¼Œâ½½åœ¨å•å¤„ç†å™¨â¾®æŠ¢å å¼çš„ç³»ç»Ÿä¸­åŸºæœ¬ä¸Šæ²¡æœ‰ä½œâ½¤ã€‚\n3. ä»€ä¹ˆæ˜¯CASï¼Ÿ1ã€CASï¼ˆcompare and swapï¼‰çš„ç¼©å†™ï¼Œä¸­â½‚ç¿»è¯‘æˆâ½è¾ƒå¹¶äº¤æ¢ã€‚\n2ã€CAS ä¸é€šè¿‡JVM,ç›´æ¥åˆ©â½¤javaæœ¬åœ°â½… JNIï¼ˆJava Native Interfaceä¸ºJAVAæœ¬åœ°è°ƒâ½¤ï¼‰,ç›´æ¥è°ƒâ½¤CPU çš„cmpxchgï¼ˆæ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼‰æŒ‡ä»¤ã€‚\n3ã€åˆ©â½¤CPUçš„CASæŒ‡ä»¤ï¼ŒåŒæ—¶å€ŸåŠ©JNIæ¥å®ŒæˆJavaçš„â¾®é˜»å¡ç®—æ³•,å®ç°åŸâ¼¦æ“ä½œã€‚å…¶å®ƒåŸâ¼¦æ“ä½œéƒ½æ˜¯åˆ©â½¤ç±»ä¼¼çš„ç‰¹æ€§å®Œæˆçš„ã€‚\n4ã€æ•´ä¸ªjava.util.concurrentéƒ½æ˜¯å»ºâ½´åœ¨CASä¹‹ä¸Šçš„ï¼Œå› æ­¤å¯¹äºsynchronizedé˜»å¡ç®—æ³•ï¼ŒJ.U.Cåœ¨æ€§èƒ½ä¸Šæœ‰äº†å¾ˆâ¼¤çš„æå‡ã€‚\n5ã€CASæ˜¯é¡¹ä¹è§‚é”æŠ€æœ¯ï¼Œå½“å¤šä¸ªçº¿ç¨‹å°è¯•ä½¿â½¤CASåŒæ—¶æ›´æ–°åŒâ¼€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰å…¶ä¸­â¼€ä¸ªçº¿ç¨‹èƒ½æ›´æ–°å˜é‡çš„å€¼ï¼Œâ½½å…¶å®ƒçº¿ç¨‹éƒ½å¤±è´¥ï¼Œå¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œâ½½æ˜¯è¢«å‘ŠçŸ¥è¿™æ¬¡ç«äº‰ä¸­å¤±è´¥ï¼Œå¹¶å¯ä»¥å†æ¬¡å°è¯•ã€‚\n\n1ã€ä½¿â½¤CASåœ¨çº¿ç¨‹å†²çªä¸¥é‡æ—¶ï¼Œä¼šâ¼¤å¹…é™ä½ç¨‹åºæ€§èƒ½ï¼›CASåªé€‚åˆäºçº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µä½¿â½¤ã€‚\n2ã€synchronizedåœ¨jdk1.6ä¹‹åï¼Œå·²ç»æ”¹è¿›ä¼˜åŒ–ã€‚synchronizedçš„åº•å±‚å®ç°ä¸»è¦ä¾é Lock-Freeçš„é˜Ÿåˆ—ï¼ŒåŸºæœ¬æ€è·¯æ˜¯â¾ƒæ—‹åé˜»å¡ï¼Œç«äº‰åˆ‡æ¢åç»§ç»­ç«äº‰é”ï¼Œç¨å¾®ç‰ºç‰²äº†å…¬å¹³æ€§ï¼Œä½†è·å¾—äº†â¾¼ååé‡ã€‚åœ¨çº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è·å¾—å’ŒCASç±»ä¼¼çš„æ€§èƒ½ï¼›â½½çº¿ç¨‹å†²çªä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¿œâ¾¼äºCASã€‚\n\n4. ä»€ä¹ˆæ˜¯AQSï¼Ÿ1ã€AbstractQueuedSynchronizerç®€ç§°AQSï¼Œæ˜¯â¼€ä¸ªâ½¤äºæ„å»ºé”å’ŒåŒæ­¥å®¹å™¨çš„æ¡†æ¶ã€‚äº‹å®ä¸ŠconcurrentåŒ…å†…è®¸å¤šç±»éƒ½æ˜¯åŸºäºAQSæ„å»ºï¼Œä¾‹å¦‚ReentrantLockï¼ŒSemaphoreï¼ŒCountDownLatchï¼ŒReentrantReadWriteLockï¼ŒFutureTaskç­‰ã€‚AQSè§£å†³äº†åœ¨å®ç°åŒæ­¥å®¹å™¨æ—¶è®¾è®¡çš„â¼¤é‡ç»†èŠ‚é—®é¢˜ã€‚2ã€AQSä½¿â½¤â¼€ä¸ªFIFOçš„é˜Ÿåˆ—è¡¨ç¤ºæ’é˜Ÿç­‰å¾…é”çš„çº¿ç¨‹ï¼Œé˜Ÿåˆ—å¤´èŠ‚ç‚¹ç§°ä½œâ€œå“¨å…µèŠ‚ç‚¹â€æˆ–è€…â€œå“‘èŠ‚ç‚¹â€ï¼Œå®ƒä¸ä¸ä»»ä½•çº¿ç¨‹å…³è”ã€‚å…¶ä»–çš„èŠ‚ç‚¹ä¸ç­‰å¾…çº¿ç¨‹å…³è”ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤â¼€ä¸ªç­‰å¾…çŠ¶æ€waitStatusã€‚\n5. ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿå¦‚ä½•ä½¿â½¤é˜»å¡é˜Ÿåˆ—æ¥å®ç°â½£äº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ1ã€JDK7æä¾›äº†7ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚ï¼ˆä¹Ÿå±äºå¹¶å‘å®¹å™¨ï¼‰\ni. ArrayBlockingQueue ï¼šâ¼€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\nii. LinkedBlockingQueue ï¼šâ¼€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\niii. PriorityBlockingQueue ï¼šâ¼€ä¸ªâ½€æŒä¼˜å…ˆçº§æ’åºçš„â½†ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\niv. DelayQueueï¼šâ¼€ä¸ªä½¿â½¤ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„â½†ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\nv. SynchronousQueueï¼šâ¼€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚\nvi. LinkedTransferQueueï¼šâ¼€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„â½†ç•Œé˜»å¡é˜Ÿåˆ—ã€‚\nvii. LinkedBlockingDequeï¼šâ¼€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚\n2ã€æ¦‚å¿µï¼šé˜»å¡é˜Ÿåˆ—æ˜¯â¼€ä¸ªåœ¨é˜Ÿåˆ—åŸºç¡€ä¸Šâ¼œâ½€æŒäº†ä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚ \n3ã€2ä¸ªé™„åŠ æ“ä½œï¼š\nâ½€æŒé˜»å¡çš„æ’â¼Šâ½…æ³•ï¼šé˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡æ’â¼Šå…ƒç´ çš„çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸æ»¡ã€‚\nâ½€æŒé˜»å¡çš„ç§»é™¤â½…æ³•ï¼šé˜Ÿåˆ—ç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºâ¾®ç©ºã€‚\n6. ä»€ä¹ˆæ˜¯Callableå’ŒFuture?1ã€Callable å’Œ Future æ˜¯â½è¾ƒæœ‰è¶£çš„â¼€å¯¹ç»„åˆã€‚å½“æˆ‘ä»¬éœ€è¦è·å–çº¿ç¨‹çš„æ‰§â¾ç»“æœæ—¶ï¼Œå°±éœ€è¦â½¤åˆ°å®ƒä»¬ã€‚Callableâ½¤äºäº§â½£ç»“æœï¼ŒFutureâ½¤äºè·å–ç»“æœã€‚\n2ã€Callableæ¥â¼ä½¿â½¤æ³›å‹å»å®šä¹‰å®ƒçš„è¿”å›ç±»å‹ã€‚Executorsç±»æä¾›äº†â¼€äº›æœ‰â½¤çš„â½…æ³•å»åœ¨çº¿ç¨‹æ± ä¸­æ‰§â¾Callableå†…çš„ä»»åŠ¡ã€‚ç”±äºCallableä»»åŠ¡æ˜¯å¹¶â¾çš„ï¼Œå¿…é¡»ç­‰å¾…å®ƒè¿”å›çš„ç»“æœã€‚java.util.concurrent.Futureå¯¹è±¡è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n3ã€åœ¨çº¿ç¨‹æ± æäº¤Callableä»»åŠ¡åè¿”å›äº†â¼€ä¸ªFutureå¯¹è±¡ï¼Œä½¿â½¤å®ƒå¯ä»¥çŸ¥é“Callableä»»åŠ¡çš„çŠ¶æ€å’Œå¾—åˆ°Callableè¿”å›çš„æ‰§â¾ç»“æœã€‚Futureæä¾›äº†get()â½…æ³•ï¼Œç­‰å¾…Callableç»“æŸå¹¶è·å–å®ƒçš„æ‰§â¾ç»“æœã€‚\n7. ä»€ä¹ˆæ˜¯FutureTask?1ã€FutureTaskå¯â½¤äºå¼‚æ­¥è·å–æ‰§â¾ç»“æœæˆ–å–æ¶ˆæ‰§â¾ä»»åŠ¡çš„åœºæ™¯ã€‚é€šè¿‡ä¼ â¼ŠRunnableæˆ–è€…Callableçš„ä»»åŠ¡ç»™FutureTaskï¼Œç›´æ¥è°ƒâ½¤å…¶runâ½…æ³•æˆ–è€…æ”¾â¼Šçº¿ç¨‹æ± æ‰§â¾ï¼Œä¹‹åå¯ä»¥åœ¨å¤–éƒ¨é€šè¿‡FutureTaskçš„getâ½…æ³•å¼‚æ­¥è·å–æ‰§â¾ç»“æœï¼Œå› æ­¤ï¼ŒFutureTaskâ¾®å¸¸é€‚åˆâ½¤äºè€—æ—¶çš„è®¡ç®—ï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨å®Œæˆâ¾ƒâ¼°çš„ä»»åŠ¡åï¼Œå†å»è·å–ç»“æœã€‚å¦å¤–ï¼ŒFutureTaskè¿˜å¯ä»¥ç¡®ä¿å³ä½¿è°ƒâ½¤äº†å¤šæ¬¡runâ½…æ³•ï¼Œå®ƒéƒ½åªä¼šæ‰§â¾â¼€æ¬¡Runnableæˆ–è€…Callableä»»åŠ¡ï¼Œæˆ–è€…é€šè¿‡cancelå–æ¶ˆFutureTaskçš„æ‰§â¾ç­‰ã€‚\n2ã€futuretaskå¯â½¤äºæ‰§â¾å¤šä»»åŠ¡ã€ä»¥åŠé¿å…â¾¼å¹¶å‘æƒ…å†µä¸‹å¤šæ¬¡åˆ›å»ºæ•°æ®æœºé”çš„å‡ºç°ã€‚\n8. ThreadLocalçš„è®¾è®¡ç†å¿µä¸ä½œâ½¤ï¼ŸJavaä¸­çš„ThreadLocalç±»å…è®¸æˆ‘ä»¬åˆ›å»ºåªèƒ½è¢«åŒâ¼€ä¸ªçº¿ç¨‹è¯»å†™çš„å˜é‡ã€‚å› æ­¤ï¼Œå¦‚æœâ¼€æ®µä»£ç å«æœ‰â¼€ä¸ªThreadLocalå˜é‡çš„å¼•â½¤ï¼Œå³ä½¿ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§â¾è¿™æ®µä»£ç ï¼Œå®ƒä»¬ä¹Ÿâ½†æ³•è®¿é—®åˆ°å¯¹â½…çš„ThreadLocalå˜é‡ã€‚\n 1ã€æ¦‚å¿µï¼šçº¿ç¨‹å±€éƒ¨å˜é‡ã€‚åœ¨å¹¶å‘ç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆå‘˜å˜é‡å¦‚æœä¸åšä»»ä½•å¤„ç†å…¶å®æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå„ä¸ªçº¿ç¨‹éƒ½åœ¨æ“ä½œåŒâ¼€ä¸ªå˜é‡ï¼Œæ˜¾ç„¶æ˜¯ä¸â¾çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹ŸçŸ¥é“volatileè¿™ä¸ªå…³é”®å­—ä¹Ÿæ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚é‚£ä¹ˆåœ¨æœ‰â¼€ç§æƒ…å†µä¹‹ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ»¡â¾œè¿™æ ·â¼€ä¸ªæ¡ä»¶ï¼šå˜é‡æ˜¯åŒâ¼€ä¸ªï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½ä½¿â½¤åŒâ¼€ä¸ªåˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯ä½¿â½¤åŒâ¼€ä¸ªå˜é‡çš„â¼€ä¸ªæ–°çš„å‰¯æœ¬ã€‚è¿™ç§æƒ…å†µä¹‹ä¸‹ThreadLocalå°±â¾®å¸¸é€‚â½¤ï¼Œâ½å¦‚è¯´DAOçš„æ•°æ®åº“è¿æ¥ï¼Œæˆ‘ä»¬çŸ¥é“DAOæ˜¯å•ä¾‹çš„ï¼Œé‚£ä¹ˆä»–çš„å±æ€§Connectionå°±ä¸æ˜¯â¼€ä¸ªçº¿ç¨‹å®‰å…¨çš„å˜é‡ã€‚â½½æˆ‘ä»¬æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦ä½¿â½¤ä»–ï¼Œå¹¶ä¸”å„â¾ƒä½¿â½¤å„â¾ƒçš„ã€‚è¿™ç§æƒ…å†µï¼ŒThreadLocalå°±â½è¾ƒå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n 2ã€åŸç†ï¼šä»æœ¬è´¨æ¥è®²ï¼Œå°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†â¼€ä¸ªmapï¼Œâ½½è¿™ä¸ªmapçš„keyå°±æ˜¯threadLocalï¼Œâ½½å€¼å°±æ˜¯æˆ‘ä»¬setçš„é‚£ä¸ªå€¼ï¼Œæ¯æ¬¡çº¿ç¨‹åœ¨getçš„æ—¶å€™ï¼Œéƒ½ä»â¾ƒâ¼°çš„å˜é‡ä¸­å–å€¼ï¼Œæ—¢ç„¶ä»â¾ƒâ¼°çš„å˜é‡ä¸­å–å€¼ï¼Œé‚£è‚¯å®šå°±ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ€»ä½“æ¥è®²ï¼ŒThreadLocalè¿™ä¸ªå˜é‡çš„çŠ¶æ€æ ¹æœ¬æ²¡æœ‰å‘â½£å˜åŒ–ï¼Œä»–ä»…ä»…æ˜¯å……å½“â¼€ä¸ªkeyçš„â»†â¾Šï¼Œå¦å¤–æä¾›ç»™æ¯â¼€ä¸ªçº¿ç¨‹â¼€ä¸ªåˆå§‹å€¼ã€‚\n 3ã€å®ç°æœºåˆ¶ï¼šæ¯ä¸ªThreadå¯¹è±¡å†…éƒ¨éƒ½ç»´æŠ¤äº†â¼€ä¸ªThreadLocalMapè¿™æ ·â¼€ä¸ªThreadLocalçš„Mapï¼Œå¯ä»¥å­˜æ”¾è‹¥â¼²ä¸ªThreadLocalã€‚ \n 4ã€åº”â½¤åœºæ™¯ï¼šå½“å¾ˆå¤šçº¿ç¨‹éœ€è¦å¤šæ¬¡ä½¿â½¤åŒâ¼€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦è¯¥å¯¹è±¡å…·æœ‰ç›¸åŒåˆå§‹åŒ–å€¼çš„æ—¶å€™æœ€é€‚åˆä½¿â½¤ThreadLocalã€‚\n9. synchronizedå’ŒReentrantLockçš„åŒºåˆ«ï¼Ÿ1ã€åŸºç¡€çŸ¥è¯†\nå¯é‡â¼Šé”ã€‚å¯é‡â¼Šé”æ˜¯æŒ‡åŒâ¼€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒâ¼€æŠŠé”ã€‚ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡â¼Šé”ã€‚\nå¯ä¸­æ–­é”ã€‚å¯ä¸­æ–­é”æ˜¯æŒ‡çº¿ç¨‹å°è¯•è·å–é”çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦å¯ä»¥å“åº”ä¸­æ–­ã€‚synchronizedæ˜¯ä¸å¯ä¸­æ–­é”ï¼Œâ½½ReentrantLockåˆ™æä¾›äº†ä¸­æ–­åŠŸèƒ½ã€‚\nå…¬å¹³é”ä¸â¾®å…¬å¹³é”ã€‚å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•è·å–åŒâ¼€æŠŠé”æ—¶ï¼Œè·å–é”çš„é¡ºåºæŒ‰ç…§çº¿ç¨‹è¾¾åˆ°çš„é¡ºåºï¼Œâ½½â¾®å…¬å¹³é”åˆ™å…è®¸çº¿ç¨‹â€œæ’é˜Ÿâ€ã€‚synchronizedæ˜¯â¾®å…¬å¹³é”ï¼Œâ½½ReentrantLockçš„é»˜è®¤å®ç°æ˜¯â¾®å…¬å¹³é”ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ã€‚\nCASæ“ä½œ(CompareAndSwap)ã€‚CASæ“ä½œç®€å•çš„è¯´å°±æ˜¯â½è¾ƒå¹¶äº¤æ¢ã€‚CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•° â€”â€” å†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼(B)ã€‚å¦‚æœå†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šâ¾ƒåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ã€‚å¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚â½†è®ºå“ªç§æƒ…å†µï¼Œå®ƒéƒ½ä¼šåœ¨ CAS æŒ‡ä»¤ä¹‹å‰è¿”å›è¯¥ä½ç½®çš„å€¼ã€‚CAS æœ‰æ•ˆåœ°è¯´æ˜äº†â€œæˆ‘è®¤ä¸ºä½ç½® V åº”è¯¥åŒ…å«å€¼ Aï¼›å¦‚æœåŒ…å«è¯¥å€¼ï¼Œåˆ™å°† B æ”¾åˆ°è¿™ä¸ªä½ç½®ï¼›å¦åˆ™ï¼Œä¸è¦æ›´æ”¹è¯¥ä½ç½®ï¼Œåªå‘Šè¯‰æˆ‘è¿™ä¸ªä½ç½®ç°åœ¨çš„å€¼å³å¯ã€‚â€ \n2ã€Synchronized\ni. synchronizedæ˜¯javaå†…ç½®çš„å…³é”®å­—ï¼Œå®ƒæä¾›äº†â¼€ç§ç‹¬å çš„åŠ é”â½…å¼ã€‚synchronizedçš„è·å–å’Œé‡Šæ”¾é”ç”±JVMå®ç°ï¼Œâ½¤æˆ·ä¸éœ€è¦æ˜¾ç¤ºçš„é‡Šæ”¾é”ï¼Œâ¾®å¸¸â½…ä¾¿ã€‚ç„¶â½½synchronizedä¹Ÿæœ‰â¼€å®šçš„å±€é™æ€§ï¼š\n\\1. å½“çº¿ç¨‹å°è¯•è·å–é”çš„æ—¶å€™ï¼Œå¦‚æœè·å–ä¸åˆ°é”ä¼šâ¼€ç›´é˜»å¡ã€‚\n\\2. å¦‚æœè·å–é”çš„çº¿ç¨‹è¿›â¼Šä¼‘çœ æˆ–è€…é˜»å¡ï¼Œé™¤â¾®å½“å‰çº¿ç¨‹å¼‚å¸¸ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹å°è¯•è·å–é”å¿…é¡»â¼€ç›´ç­‰å¾…ã€‚\n3ã€ReentrantLock\ni. ReentrantLockå®ƒæ˜¯JDK 1.5ä¹‹åæä¾›çš„APIå±‚â¾¯çš„äº’æ–¥é”ï¼Œéœ€è¦lock()å’Œunlock()â½…æ³•é…åˆtry&#x2F;finallyè¯­å¥å—æ¥å®Œæˆã€‚\nii. ç­‰å¾…å¯ä¸­æ–­é¿å…ï¼Œå‡ºç°æ­»é”çš„æƒ…å†µï¼ˆå¦‚æœåˆ«çš„çº¿ç¨‹æ­£æŒæœ‰é”ï¼Œä¼šç­‰å¾…å‚æ•°ç»™å®šçš„æ—¶é—´ï¼Œåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè·å–äº†é”å®šï¼Œå°±è¿”å›trueï¼Œå¦‚æœç­‰å¾…è¶…æ—¶ï¼Œè¿”å›falseï¼‰\niii. å…¬å¹³é”ä¸â¾®å…¬å¹³é”å¤šä¸ªçº¿ç¨‹ç­‰å¾…åŒâ¼€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºè·å¾—é”ï¼ŒSynchronizedé”â¾®å…¬å¹³é”ï¼ŒReentrantLocké»˜è®¤çš„æ„é€ å‡½æ•°æ˜¯åˆ›å»ºçš„â¾®å…¬å¹³é”ï¼Œå¯ä»¥é€šè¿‡å‚æ•°trueè®¾ä¸ºå…¬å¹³é”ï¼Œä½†å…¬å¹³é”è¡¨ç°çš„æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ã€‚\n10. â¾¼å¹¶å‘ã€ä»»åŠ¡æ‰§â¾æ—¶é—´çŸ­çš„ä¸šåŠ¡æ€æ ·ä½¿â½¤çº¿ç¨‹æ± ï¼Ÿå¹¶å‘ä¸â¾¼ã€ä»»åŠ¡æ‰§â¾æ—¶é—´â»“çš„ä¸šåŠ¡æ€æ ·ä½¿â½¤çº¿ç¨‹æ± ï¼Ÿå¹¶å‘â¾¼ã€ä¸šåŠ¡æ‰§â¾æ—¶é—´â»“çš„ä¸šåŠ¡æ€æ ·ä½¿â½¤çº¿ç¨‹æ± ï¼Ÿ\\1. â¾¼å¹¶å‘ã€ä»»åŠ¡æ‰§â¾æ—¶é—´çŸ­çš„ä¸šåŠ¡ï¼šçº¿ç¨‹æ± çº¿ç¨‹æ•°å¯ä»¥è®¾ç½®ä¸ºCPUæ ¸æ•°+1ï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹â½‚çš„åˆ‡æ¢ã€‚\n\\2. å¹¶å‘ä¸â¾¼ã€ä»»åŠ¡æ‰§â¾æ—¶é—´â»“çš„ä¸šåŠ¡è¦åŒºåˆ†å¼€çœ‹ï¼š\na. å‡å¦‚æ˜¯ä¸šåŠ¡æ—¶é—´â»“é›†ä¸­åœ¨IOæ“ä½œä¸Šï¼Œä¹Ÿå°±æ˜¯IOå¯†é›†å‹çš„ä»»åŠ¡ï¼Œå› ä¸ºIOæ“ä½œå¹¶ä¸å â½¤CPUï¼Œæ‰€ä»¥ä¸è¦è®©æ‰€æœ‰çš„CPU\né—²ä¸‹æ¥ï¼Œå¯ä»¥åŠ â¼¤çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°â½¬ï¼Œè®©CPUå¤„ç†æ›´å¤šçš„ä¸šåŠ¡\nb. å‡å¦‚æ˜¯ä¸šåŠ¡æ—¶é—´â»“é›†ä¸­åœ¨è®¡ç®—æ“ä½œä¸Šï¼Œä¹Ÿå°±æ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œè¿™ä¸ªå°±æ²¡åŠæ³•äº†ï¼Œå’Œï¼ˆ1ï¼‰â¼€æ ·å§ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è®¾ç½®å¾—å°‘â¼€äº›ï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹â½‚çš„åˆ‡æ¢\n\\3. å¹¶å‘â¾¼ã€ä¸šåŠ¡æ‰§â¾æ—¶é—´â»“ï¼Œè§£å†³è¿™ç§ç±»å‹ä»»åŠ¡çš„å…³é”®ä¸åœ¨äºçº¿ç¨‹æ± â½½åœ¨äºæ•´ä½“æ¶æ„çš„è®¾è®¡ï¼Œçœ‹çœ‹è¿™äº›ä¸šåŠ¡â¾¥â¾¯æŸäº›æ•°æ®æ˜¯å¦èƒ½åšç¼“å­˜æ˜¯ç¬¬â¼€æ­¥ï¼Œå¢åŠ æœåŠ¡å™¨æ˜¯ç¬¬â¼†æ­¥ï¼Œâ¾„äºçº¿ç¨‹æ± çš„è®¾ç½®ï¼Œè®¾ç½®å‚è€ƒï¼ˆ2ï¼‰ã€‚æœ€åï¼Œä¸šåŠ¡æ‰§â¾æ—¶é—´â»“çš„é—®é¢˜ï¼Œä¹Ÿå¯èƒ½éœ€è¦åˆ†æâ¼€ä¸‹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ä½¿â½¤ä¸­é—´ä»¶å¯¹ä»»åŠ¡è¿›â¾æ‹†åˆ†å’Œè§£è€¦ã€‚\n11. å¦‚ä½•æ£€æµ‹æ­»é”ï¼Ÿæ€ä¹ˆé¢„é˜²æ­»é”ï¼Ÿ1. æ¦‚å¿µï¼šæ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§â¾è¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºâ½½é€ æˆçš„â¼€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥â½†å¤–â¼’ä½œâ½¤ï¼Œå®ƒä»¬éƒ½å°†â½†æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”ï¼›\n2. æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼ši. äº’æ–¥æ¡ä»¶ï¼šè¿›ç¨‹å¯¹æ‰€åˆ†é…åˆ°çš„èµ„æºä¸å…è®¸å…¶ä»–è¿›ç¨‹è¿›â¾è®¿é—®ï¼Œè‹¥å…¶ä»–è¿›ç¨‹è®¿é—®è¯¥èµ„æºï¼Œåªèƒ½ç­‰å¾…ï¼Œç›´â¾„å æœ‰è¯¥èµ„æºçš„è¿›ç¨‹ä½¿â½¤å®Œæˆåé‡Šæ”¾è¯¥èµ„æº\nii. è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šè¿›ç¨‹è·å¾—â¼€å®šçš„èµ„æºä¹‹åï¼Œâ¼œå¯¹å…¶ä»–èµ„æºå‘å‡ºè¯·æ±‚ï¼Œä½†æ˜¯è¯¥èµ„æºå¯èƒ½è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚é˜»å¡ï¼Œä½†â¼œå¯¹â¾ƒâ¼°è·å¾—çš„èµ„æºä¿æŒä¸æ”¾\niii. ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼šæ˜¯æŒ‡è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªå®Œæˆä½¿â½¤ä¹‹å‰ï¼Œä¸å¯è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿â½¤å®Œåâ¾ƒâ¼°é‡Šæ”¾\niv. ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼šæ˜¯æŒ‡è¿›ç¨‹å‘â½£æ­»é”åï¼Œè‹¥â¼²è¿›ç¨‹ä¹‹é—´å½¢æˆâ¼€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»\n3. æ­»é”äº§â½£çš„åŸå› ï¼š1.å› ç«äº‰èµ„æºå‘â½£æ­»é” ç°è±¡ï¼šç³»ç»Ÿä¸­ä¾›å¤šä¸ªè¿›ç¨‹å…±äº«çš„èµ„æºçš„æ•°â½¬ä¸â¾œä»¥æ»¡â¾œå…¨éƒ¨è¿›ç¨‹çš„éœ€è¦æ—¶ï¼Œå°±ä¼šå¼•èµ·å¯¹è¯¸èµ„æºçš„ç«äº‰â½½å‘â½£æ­»é”ç°è±¡\n2.è¿›ç¨‹æ¨è¿›é¡ºåºä¸å½“å‘â½£æ­»é”\n4. æ£€æŸ¥æ­»é”i. æœ‰ä¸¤ä¸ªå®¹å™¨ï¼Œâ¼€ä¸ªâ½¤äºä¿å­˜çº¿ç¨‹æ­£åœ¨è¯·æ±‚çš„é”ï¼Œâ¼€ä¸ªâ½¤äºä¿å­˜çº¿ç¨‹å·²ç»æŒæœ‰çš„é”ã€‚æ¯æ¬¡åŠ é”ä¹‹å‰éƒ½ä¼šåšå¦‚ä¸‹æ£€æµ‹:\nii. æ£€æµ‹å½“å‰æ­£åœ¨è¯·æ±‚çš„é”æ˜¯å¦å·²ç»è¢«å…¶å®ƒçº¿ç¨‹æŒæœ‰,å¦‚æœæœ‰ï¼Œåˆ™æŠŠé‚£äº›çº¿ç¨‹æ‰¾å‡ºæ¥\niii. éå†ç¬¬â¼€æ­¥ä¸­è¿”å›çš„çº¿ç¨‹ï¼Œæ£€æŸ¥â¾ƒâ¼°æŒæœ‰çš„é”æ˜¯å¦æ­£è¢«å…¶ä¸­ä»»ä½•â¼€ä¸ªçº¿ç¨‹è¯·æ±‚ï¼Œå¦‚æœç¬¬â¼†æ­¥è¿”å›çœŸ,è¡¨ç¤ºå‡ºç°äº†æ­»é”\n5. æ­»é”çš„è§£é™¤ä¸é¢„é˜²ï¼šæ§åˆ¶ä¸è¦è®©å››ä¸ªå¿…è¦æ¡ä»¶æˆâ½´ã€‚12. çº¿ç¨‹æ± åŸç†ï¼š 1ã€ä½¿â½¤åœºæ™¯ï¼šå‡è®¾â¼€ä¸ªæœåŠ¡å™¨å®Œæˆâ¼€é¡¹ä»»åŠ¡æ‰€éœ€æ—¶é—´ä¸ºï¼šT1-åˆ›å»ºçº¿ç¨‹æ—¶é—´ï¼ŒT2-åœ¨çº¿ç¨‹ä¸­æ‰§â¾ä»»åŠ¡çš„æ—¶é—´ï¼ŒT3-é”€æ¯çº¿ç¨‹æ—¶é—´ã€‚å¦‚æœT1+T3è¿œâ¼¤äºT2ï¼Œåˆ™å¯ä»¥ä½¿â½¤çº¿ç¨‹æ± ï¼Œä»¥æâ¾¼æœåŠ¡å™¨æ€§èƒ½ï¼›\n 2ã€ç»„æˆï¼š\n 1ã€çº¿ç¨‹æ± ç®¡ç†å™¨ï¼ˆThreadPoolï¼‰ï¼šâ½¤äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬ åˆ›å»ºçº¿ç¨‹æ± ï¼Œé”€æ¯çº¿ç¨‹æ± ï¼Œæ·»åŠ æ–°ä»»åŠ¡ï¼›\n 2ã€â¼¯ä½œçº¿ç¨‹ï¼ˆPoolWorkerï¼‰ï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œåœ¨æ²¡æœ‰ä»»åŠ¡æ—¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¯ä»¥å¾ªç¯çš„æ‰§â¾ä»»åŠ¡ï¼›\n 3ã€ä»»åŠ¡æ¥â¼ï¼ˆTaskï¼‰ï¼šæ¯ä¸ªä»»åŠ¡å¿…é¡»å®ç°çš„æ¥â¼ï¼Œä»¥ä¾›â¼¯ä½œçº¿ç¨‹è°ƒåº¦ä»»åŠ¡çš„æ‰§â¾ï¼Œå®ƒä¸»è¦è§„å®šäº†ä»»åŠ¡çš„â¼Šâ¼ï¼Œä»»åŠ¡æ‰§â¾å®Œåçš„æ”¶å°¾â¼¯ä½œï¼Œä»»åŠ¡çš„æ‰§â¾çŠ¶æ€ç­‰ï¼›\n 4ã€ä»»åŠ¡é˜Ÿåˆ—ï¼ˆtaskQueueï¼‰ï¼šâ½¤äºå­˜æ”¾æ²¡æœ‰å¤„ç†çš„ä»»åŠ¡ã€‚æä¾›â¼€ç§ç¼“å†²æœºåˆ¶ã€‚\n 2ã€åŸç†ï¼šçº¿ç¨‹æ± æŠ€æœ¯æ­£æ˜¯å…³æ³¨å¦‚ä½•ç¼©çŸ­æˆ–è°ƒæ•´T1,T3æ—¶é—´çš„æŠ€æœ¯ï¼Œä»â½½æâ¾¼æœåŠ¡å™¨ç¨‹åºæ€§èƒ½çš„ã€‚å®ƒæŠŠT1ï¼ŒT3åˆ†åˆ«å®‰æ’åœ¨æœåŠ¡å™¨ç¨‹åºçš„å¯åŠ¨å’Œç»“æŸçš„æ—¶é—´æ®µæˆ–è€…â¼€äº›ç©ºé—²çš„æ—¶é—´æ®µï¼Œè¿™æ ·åœ¨æœåŠ¡å™¨ç¨‹åºå¤„ç†å®¢æˆ·è¯·æ±‚æ—¶ï¼Œä¸ä¼šæœ‰T1ï¼ŒT3çš„å¼€é”€äº†ã€‚ \n 3ã€â¼¯ä½œæµç¨‹ï¼š\n 1ã€çº¿ç¨‹æ± åˆšåˆ›å»ºæ—¶ï¼Œâ¾¥â¾¯æ²¡æœ‰â¼€ä¸ªçº¿ç¨‹(ä¹Ÿå¯ä»¥è®¾ç½®å‚æ•°prestartAllCoreThreadså¯åŠ¨é¢„æœŸæ•°é‡ä¸»çº¿ç¨‹)ã€‚ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä½œ\nä¸ºå‚æ•°ä¼ è¿›æ¥çš„ã€‚ä¸è¿‡ï¼Œå°±ç®—é˜Ÿåˆ—â¾¥â¾¯æœ‰ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¹Ÿä¸ä¼šâ»¢ä¸Šæ‰§â¾å®ƒä»¬ã€‚\n 2ã€å½“è°ƒâ½¤ execute() â½…æ³•æ·»åŠ â¼€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­ï¼š\n\\1. å¦‚æœæ­£åœ¨è¿â¾çš„çº¿ç¨‹æ•°é‡â¼©äº corePoolSizeï¼Œé‚£ä¹ˆâ»¢ä¸Šåˆ›å»ºçº¿ç¨‹è¿â¾è¿™ä¸ªä»»åŠ¡ï¼›\n\\2. å¦‚æœæ­£åœ¨è¿â¾çš„çº¿ç¨‹æ•°é‡â¼¤äºæˆ–ç­‰äº corePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾â¼Šé˜Ÿåˆ—ï¼›\n\\3. å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ï¼Œâ½½ä¸”æ­£åœ¨è¿â¾çš„çº¿ç¨‹æ•°é‡â¼©äº maximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºâ¾®æ ¸â¼¼çº¿ç¨‹â½´åˆ»è¿â¾è¿™ä¸ªä»»åŠ¡ï¼›\n\\4. å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œâ½½ä¸”æ­£åœ¨è¿â¾çš„çº¿ç¨‹æ•°é‡â¼¤äºæˆ–ç­‰äº maximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæŠ›å‡ºå¼‚å¸¸RejectExecutionExceptionã€‚\n 3ã€å½“â¼€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹â¼€ä¸ªä»»åŠ¡æ¥æ‰§â¾ã€‚\n 4ã€å½“â¼€ä¸ªçº¿ç¨‹â½†äº‹å¯åšï¼Œè¶…è¿‡â¼€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¿â¾çš„çº¿ç¨‹æ•°â¼¤äºcorePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ° corePoolSize çš„â¼¤â¼©ã€‚\n13ã€ThreadLocalä¸ºä»€ä¹ˆä¼šå‘â½£å†…å­˜æ³„æ¼ï¼Ÿ1ã€threadlocalåŸç†å›¾ï¼š\n\n2ã€OOMå®ç°ï¼š\n1ã€ThreadLocalçš„å®ç°æ˜¯è¿™æ ·çš„ï¼šæ¯ä¸ªThread ç»´æŠ¤â¼€ä¸ª ThreadLocalMap æ˜ å°„è¡¨ï¼Œè¿™ä¸ªæ˜ å°„è¡¨çš„ key æ˜¯ ThreadLocalå®ä¾‹æœ¬èº«ï¼Œvalue æ˜¯çœŸæ­£éœ€è¦å­˜å‚¨çš„ Objectã€‚ \n2ã€ä¹Ÿå°±æ˜¯è¯´ ThreadLocal æœ¬èº«å¹¶ä¸å­˜å‚¨å€¼ï¼Œå®ƒåªæ˜¯ä½œä¸ºâ¼€ä¸ª key æ¥è®©çº¿ç¨‹ä» ThreadLocalMap è·å– valueã€‚å€¼å¾—æ³¨æ„çš„æ˜¯å›¾ä¸­çš„è™šçº¿ï¼Œè¡¨ç¤º ThreadLocalMap æ˜¯ä½¿â½¤ ThreadLocal çš„å¼±å¼•â½¤ä½œä¸º Key çš„ï¼Œå¼±å¼•â½¤çš„å¯¹è±¡åœ¨ GC æ—¶ä¼šè¢«å›æ”¶ã€‚\n3ã€ThreadLocalMapä½¿â½¤ThreadLocalçš„å¼±å¼•â½¤ä½œä¸ºkeyï¼Œå¦‚æœâ¼€ä¸ªThreadLocalæ²¡æœ‰å¤–éƒ¨å¼ºå¼•â½¤æ¥å¼•â½¤å®ƒï¼Œé‚£ä¹ˆç³»ç»Ÿ GCçš„æ—¶å€™ï¼Œè¿™ä¸ªThreadLocalåŠ¿å¿…ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·â¼€æ¥ï¼ŒThreadLocalMapä¸­å°±ä¼šå‡ºç°keyä¸ºnullçš„Entryï¼Œå°±æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›keyä¸ºnullçš„Entryçš„valueï¼Œå¦‚æœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯ï¼Œè¿™äº›keyä¸ºnullçš„Entryçš„valueå°±ä¼šâ¼€ç›´å­˜åœ¨â¼€æ¡å¼ºå¼•â½¤é“¾ï¼šThread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; valueæ°¸è¿œâ½†æ³•å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\n3ã€é¢„é˜²åŠæ³•ï¼šåœ¨ThreadLocalçš„get(),set(),remove()çš„æ—¶å€™éƒ½ä¼šæ¸…é™¤çº¿ç¨‹ThreadLocalMapâ¾¥æ‰€æœ‰keyä¸ºnullçš„valueã€‚ä½†æ˜¯è¿™äº›è¢«åŠ¨çš„é¢„é˜²æªæ–½å¹¶ä¸èƒ½ä¿è¯ä¸ä¼šå†…å­˜æ³„æ¼ï¼š\nï¼ˆ1ï¼‰ä½¿â½¤staticçš„ThreadLocalï¼Œå»¶â»“äº†ThreadLocalçš„â½£å‘½å‘¨æœŸï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nï¼ˆ2ï¼‰åˆ†é…ä½¿â½¤äº†ThreadLocalâ¼œä¸å†è°ƒâ½¤get(),set(),remove()â½…æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºè¿™å—å†…å­˜â¼€ç›´å­˜åœ¨ã€‚\n14ã€â¾¼å¹¶å‘ç³»ç»Ÿå¦‚ä½•åšæ€§èƒ½ä¼˜åŒ–ï¼Ÿå¦‚ä½•é˜²â½Œåº“å­˜è¶…å–ï¼Ÿ1ã€â¾¼å¹¶å‘ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–ï¼š ä¼˜åŒ–ç¨‹åºï¼Œä¼˜åŒ–æœåŠ¡é…ç½®ï¼Œä¼˜åŒ–ç³»ç»Ÿé…ç½®\n 1.å°½é‡ä½¿â½¤ç¼“å­˜ï¼ŒåŒ…æ‹¬â½¤æˆ·ç¼“å­˜ï¼Œä¿¡æ¯ç¼“å­˜ç­‰ï¼Œå¤šèŠ±ç‚¹å†…å­˜æ¥åšç¼“å­˜ï¼Œå¯ä»¥â¼¤é‡å‡å°‘ä¸æ•°æ®åº“çš„äº¤äº’ï¼Œæâ¾¼æ€§èƒ½ã€‚\n 2.â½¤jprofilerç­‰â¼¯å…·æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆï¼Œå‡å°‘é¢å¤–çš„å¼€é”€ã€‚\n 3.ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼Œå‡å°‘ç›´æ¥ä½¿â½¤hibernateç­‰â¼¯å…·çš„ç›´æ¥â½£æˆè¯­å¥ï¼ˆä»…è€—æ—¶è¾ƒâ»“çš„æŸ¥è¯¢åšä¼˜åŒ–ï¼‰ã€‚\n 4.ä¼˜åŒ–æ•°æ®åº“ç»“æ„ï¼Œå¤šåšç´¢å¼•ï¼Œæâ¾¼æŸ¥è¯¢æ•ˆç‡ã€‚\n 5.ç»Ÿè®¡çš„åŠŸèƒ½å°½é‡åšç¼“å­˜ï¼Œæˆ–æŒ‰æ¯å¤©â¼€ç»Ÿè®¡æˆ–å®šæ—¶ç»Ÿè®¡ç›¸å…³æŠ¥è¡¨ï¼Œé¿å…éœ€è¦æ—¶è¿›â¾ç»Ÿè®¡çš„åŠŸèƒ½ã€‚\n 6.èƒ½ä½¿â½¤é™æ€â»šâ¾¯çš„åœ°â½…å°½é‡ä½¿â½¤ï¼Œå‡å°‘å®¹å™¨çš„è§£æï¼ˆå°½é‡å°†åŠ¨æ€å†…å®¹â½£æˆé™æ€htmlæ¥æ˜¾ç¤ºï¼‰ã€‚\n 7.è§£å†³ä»¥ä¸Šé—®é¢˜åï¼Œä½¿â½¤æœåŠ¡å™¨é›†ç¾¤æ¥è§£å†³å•å°çš„ç“¶é¢ˆé—®é¢˜ã€‚\n2ã€é˜²â½Œåº“å­˜è¶…å–ï¼š1ã€æ‚²è§‚é”ï¼šåœ¨æ›´æ–°åº“å­˜æœŸé—´åŠ é”ï¼Œä¸å…è®¸å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ï¼› 1ã€æ•°æ®åº“é”ï¼šselect xxx for updateï¼›\n 2ã€åˆ†å¸ƒå¼é”ï¼›\n2ã€ä¹è§‚é”ï¼šä½¿â½¤å¸¦ç‰ˆæœ¬å·çš„æ›´æ–°ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å¹¶å‘ä¿®æ”¹ï¼Œä½†åœ¨å¹¶å‘æ—¶ï¼Œåªæœ‰â¼€ä¸ªçº¿ç¨‹ä¼šä¿®æ”¹æˆåŠŸï¼Œå…¶å®ƒä¼šè¿”å›å¤±è´¥ã€‚ 1ã€redis watchï¼šç›‘è§†é”®å€¼å¯¹ï¼Œä½œâ½¤æ—¶å¦‚æœäº‹åŠ¡æäº¤execæ—¶å‘ç°ç›‘è§†çš„ç›‘è§†å¯¹å‘â½£å˜åŒ–ï¼Œäº‹åŠ¡å°†è¢«å–æ¶ˆã€‚\n3ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼šé€šè¿‡ FIFO é˜Ÿåˆ—ï¼Œä½¿ä¿®æ”¹åº“å­˜çš„æ“ä½œä¸²â¾åŒ–ã€‚ 4ã€æ€»ç»“ï¼šæ€»çš„æ¥è¯´ï¼Œä¸èƒ½æŠŠå‹â¼’æ”¾åœ¨æ•°æ®åº“ä¸Šï¼Œæ‰€ä»¥ä½¿â½¤ â€œselect xxx for updateâ€ çš„â½…å¼åœ¨â¾¼å¹¶å‘çš„åœºæ™¯ä¸‹æ˜¯ä¸å¯â¾çš„ã€‚FIFO åŒæ­¥é˜Ÿåˆ—çš„â½…å¼ï¼Œå¯ä»¥ç»“åˆåº“å­˜é™åˆ¶é˜Ÿåˆ—â»“ï¼Œä½†æ˜¯åœ¨åº“å­˜è¾ƒå¤šçš„åœºæ™¯ä¸‹ï¼Œâ¼œä¸å¤ªé€‚â½¤ã€‚æ‰€ä»¥ç›¸å¯¹æ¥è¯´ï¼Œæˆ‘ä¼šå€¾å‘äºé€‰æ‹©ï¼šä¹è§‚é” &#x2F; ç¼“å­˜é” &#x2F; åˆ†å¸ƒå¼é”çš„â½…å¼ã€‚\n15ã€è¯´è¯´javaåŒæ­¥æœºåˆ¶ï¼Œjavaæœ‰å“ªäº›é”ï¼Œæ¯ä¸ªé”çš„ç‰¹æ€§ï¼Ÿsynchronized  lock\n16ã€è¯´è¯´volatileå¦‚ä½•ä¿è¯å¯â»…æ€§ï¼Œä»cpuå±‚â¾¯åˆ†æï¼ŸåŠ å…¥volatileå…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ªlockå‰ç¼€æŒ‡ä»¤ï¼Œlockå‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼Œå®ƒæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š\n1.ç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤é‡æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœåé¢ï¼Œå³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼›2.å°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®ç«‹å³å†™å›ç³»ç»Ÿå†…å­˜ï¼ˆç”±volatileå…ˆè¡Œå‘ç”ŸåŸåˆ™ä¿è¯ï¼‰ï¼›3.è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šå¼•èµ·åœ¨å…¶ä»–CPUé‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆã€‚å†™å›æ“ä½œæ—¶è¦ç»è¿‡æ€»çº¿ä¼ æ’­æ•°æ®ï¼Œè€Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå½“å¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨è¦å¯¹è¿™ä¸ªå€¼è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œä¼šå¼ºåˆ¶é‡æ–°ä»ç³»ç»Ÿå†…å­˜é‡ŒæŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜(ä¹Ÿæ˜¯ç”±volatileå…ˆè¡Œå‘ç”ŸåŸåˆ™ä¿è¯)ï¼›\n","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"475. ä¾›æš–å™¨","url":"/java4u/2021/09/01/475.%20%E4%BE%9B%E6%9A%96%E5%99%A8/","content":"475. ä¾›æš–å™¨å†¬å­£å·²ç»æ¥ä¸´ã€‚ ä½ çš„ä»»åŠ¡æ˜¯è®¾è®¡ä¸€ä¸ªæœ‰å›ºå®šåŠ çƒ­åŠå¾„çš„ä¾›æš–å™¨å‘æ‰€æœ‰æˆ¿å±‹ä¾›æš–ã€‚\nåœ¨åŠ çƒ­å™¨çš„åŠ çƒ­åŠå¾„èŒƒå›´å†…çš„æ¯ä¸ªæˆ¿å±‹éƒ½å¯ä»¥è·å¾—ä¾›æš–ã€‚\nç°åœ¨ï¼Œç»™å‡ºä½äºä¸€æ¡æ°´å¹³çº¿ä¸Šçš„æˆ¿å±‹ houses å’Œä¾›æš–å™¨ heaters çš„ä½ç½®ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›å¯ä»¥è¦†ç›–æ‰€æœ‰æˆ¿å±‹çš„æœ€å°åŠ çƒ­åŠå¾„ã€‚\nè¯´æ˜ï¼šæ‰€æœ‰ä¾›æš–å™¨éƒ½éµå¾ªä½ çš„åŠå¾„æ ‡å‡†ï¼ŒåŠ çƒ­çš„åŠå¾„ä¹Ÿä¸€æ ·ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: houses &#x3D; [1,2,3], heaters &#x3D; [2]è¾“å‡º: 1è§£é‡Š: ä»…åœ¨ä½ç½®2ä¸Šæœ‰ä¸€ä¸ªä¾›æš–å™¨ã€‚å¦‚æœæˆ‘ä»¬å°†åŠ çƒ­åŠå¾„è®¾ä¸º1ï¼Œé‚£ä¹ˆæ‰€æœ‰æˆ¿å±‹å°±éƒ½èƒ½å¾—åˆ°ä¾›æš–ã€‚\nç¤ºä¾‹ 2:\nè¾“å…¥: houses &#x3D; [1,2,3,4], heaters &#x3D; [1,4]è¾“å‡º: 1è§£é‡Š: åœ¨ä½ç½®1, 4ä¸Šæœ‰ä¸¤ä¸ªä¾›æš–å™¨ã€‚æˆ‘ä»¬éœ€è¦å°†åŠ çƒ­åŠå¾„è®¾ä¸º1ï¼Œè¿™æ ·æ‰€æœ‰æˆ¿å±‹å°±éƒ½èƒ½å¾—åˆ°ä¾›æš–ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šhouses &#x3D; [1,5], heaters &#x3D; [2]è¾“å‡ºï¼š3\næç¤ºï¼š\n1 &lt;&#x3D; houses.length, heaters.length &lt;&#x3D; 3 * 10^41 &lt;&#x3D; houses[i], heaters[i] &lt;&#x3D; 10^9\né¢˜è§£/** * æ‰¾åˆ°ä¾›æš–æœŸå’Œæˆ¿å±‹è·ç¦»çš„æœ€å¤§å€¼ * 2 * 1 2 3 * &lt;p&gt; * 1     4 * 1 2 3 4 * &lt;p&gt; * 2 * 1       5 * * @param houses * @param heaters * @return */public int findRadius(int[] houses, int[] heaters) &#123;    //è¯¥æ³•èƒ½æˆç«‹çš„å…ˆå†³æ¡ä»¶ä¸ºä¸¤æ•°ç»„ä¸€å®šéƒ½è¦ä»å°åˆ°å¤§æ’å¥½åº    Arrays.sort(heaters);    Arrays.sort(houses);    int l = 0;    int r = Math.max(houses[houses.length - 1], heaters[heaters.length - 1]);    //å¼€å§‹äºŒåˆ†æšä¸¾    while (l &lt; r) &#123;        //æ— ç¬¦å·çš„å³ç§»        int mid = (l + r) &gt;&gt;&gt; 1;        //æˆç«‹æ—¶ï¼Œå³ç•Œç§»åŠ¨è‡³ä¸­å¿ƒ        if (Helper(houses, heaters, mid)) &#123;            r = mid;        &#125; else &#123;            //ä¸æˆç«‹æ—¶ï¼Œå·¦ç•Œç§»è‡³ä¸­å¿ƒ+1            //è¿™æ ·å¯ä»¥ä¿è¯æœ€åçš„è·³å‡ºå¾ªç¯lä¸€å®šä¸ºåŠå¾„æœ€å°            l = mid + 1;        &#125;    &#125;    return l;&#125;public boolean Helper(int[] houses, int[] heaters, int len) &#123;    int m = houses.length;    int index = 0;    for (int heater : heaters) &#123;        long l = heater - len, r = heater + len;        //è®¡ç®—èƒ½å¦å®Œå…¨è¦†ç›–æˆ¿å±‹        while (index &lt; m &amp;&amp; (long) houses[index] &gt;= l &amp;&amp; (long) houses[index] &lt;= r) &#123;            index++;        &#125;        if (index == m) return true;    &#125;    return false;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒåˆ†æ³•"]},{"title":"154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II","url":"/java4u/2021/08/31/154.%20%E5%AF%BB%E6%89%BE%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC%20II/","content":"154. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ IIå·²çŸ¥ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œé¢„å…ˆæŒ‰ç…§å‡åºæ’åˆ—ï¼Œç»ç”± 1 åˆ° n æ¬¡ æ—‹è½¬ åï¼Œå¾—åˆ°è¾“å…¥æ•°ç»„ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°ç»„ nums &#x3D; [0,1,4,4,5,6,7] åœ¨å˜åŒ–åå¯èƒ½å¾—åˆ°ï¼šè‹¥æ—‹è½¬ 4 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [4,5,6,7,0,1,4]è‹¥æ—‹è½¬ 7 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [0,1,4,4,5,6,7]æ³¨æ„ï¼Œæ•°ç»„ [a[0], a[1], a[2], â€¦, a[n-1]] æ—‹è½¬ä¸€æ¬¡ çš„ç»“æœä¸ºæ•°ç»„ [a[n-1], a[0], a[1], a[2], â€¦, a[n-2]] ã€‚\nç»™ä½ ä¸€ä¸ªå¯èƒ½å­˜åœ¨ é‡å¤ å…ƒç´ å€¼çš„æ•°ç»„ nums ï¼Œå®ƒåŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åˆ—çš„æ•°ç»„ï¼Œå¹¶æŒ‰ä¸Šè¿°æƒ…å½¢è¿›è¡Œäº†å¤šæ¬¡æ—‹è½¬ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ•°ç»„ä¸­çš„ æœ€å°å…ƒç´  ã€‚\nä½ å¿…é¡»å°½å¯èƒ½å‡å°‘æ•´ä¸ªè¿‡ç¨‹çš„æ“ä½œæ­¥éª¤ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1,3,5]è¾“å‡ºï¼š1\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [2,2,2,0,1]è¾“å‡ºï¼š0\næç¤ºï¼š\nn &#x3D;&#x3D; nums.length1 &lt;&#x3D; n &lt;&#x3D; 5000-5000 &lt;&#x3D; nums[i] &lt;&#x3D; 5000nums åŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åºçš„æ•°ç»„ï¼Œå¹¶è¿›è¡Œäº† 1 è‡³ n æ¬¡æ—‹è½¬\nè¿›é˜¶ï¼šè¿™é“é¢˜ä¸ å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ ç±»ä¼¼ï¼Œä½† nums å¯èƒ½åŒ…å«é‡å¤å…ƒç´ ã€‚å…è®¸é‡å¤ä¼šå½±å“ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å—ï¼Ÿä¼šå¦‚ä½•å½±å“ï¼Œä¸ºä»€ä¹ˆï¼Ÿ\né¢˜è§£/** * è¾“å…¥ï¼šnums = [2,2,2,0,1] * 2 2 2 *         1 *       0 * *     2 2 2 *   1 * 0 * @param nums * @return */public int findMin(int[] nums) &#123;    int left = 0;    int right = nums.length-1;    while (left &lt; right) &#123;        int mid = left + (right -left)/2;        if(nums[mid] &lt; nums[right])&#123;            right = mid;        &#125;else if(nums[mid] &gt; nums[right])&#123;            left = mid +1;        &#125;else &#123;            // 1 1 1 1 0 1 1            //       m     r            // 1 0 1 1 1 1 1            //       m     r            //æœ€å°å€¼å¯èƒ½åœ¨å·¦è¾¹æˆ–å³è¾¹ï¼Œä¸ä½¿ç”¨äºŒåˆ†æ³•ï¼Œåªèƒ½ç æ‰å³è¾¹ç•Œ            right--;        &#125;    &#125;    return nums[left];&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒåˆ†æ³•"]},{"title":"153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼","url":"/java4u/2021/08/27/153.%20%E5%AF%BB%E6%89%BE%E6%97%8B%E8%BD%AC%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC/","content":"153. å¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼å·²çŸ¥ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ï¼Œé¢„å…ˆæŒ‰ç…§å‡åºæ’åˆ—ï¼Œç»ç”± 1 åˆ° n æ¬¡ æ—‹è½¬ åï¼Œå¾—åˆ°è¾“å…¥æ•°ç»„ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°ç»„ nums &#x3D; [0,1,2,4,5,6,7] åœ¨å˜åŒ–åå¯èƒ½å¾—åˆ°ï¼šè‹¥æ—‹è½¬ 4 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [4,5,6,7,0,1,2]è‹¥æ—‹è½¬ 7 æ¬¡ï¼Œåˆ™å¯ä»¥å¾—åˆ° [0,1,2,4,5,6,7]æ³¨æ„ï¼Œæ•°ç»„ [a[0], a[1], a[2], â€¦, a[n-1]] æ—‹è½¬ä¸€æ¬¡ çš„ç»“æœä¸ºæ•°ç»„ [a[n-1], a[0], a[1], a[2], â€¦, a[n-2]] ã€‚\nç»™ä½ ä¸€ä¸ªå…ƒç´ å€¼ äº’ä¸ç›¸åŒ çš„æ•°ç»„ nums ï¼Œå®ƒåŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åˆ—çš„æ•°ç»„ï¼Œå¹¶æŒ‰ä¸Šè¿°æƒ…å½¢è¿›è¡Œäº†å¤šæ¬¡æ—‹è½¬ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ•°ç»„ä¸­çš„ æœ€å°å…ƒç´  ã€‚\nä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [3,4,5,1,2]è¾“å‡ºï¼š1è§£é‡Šï¼šåŸæ•°ç»„ä¸º [1,2,3,4,5] ï¼Œæ—‹è½¬ 3 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [4,5,6,7,0,1,2]è¾“å‡ºï¼š0è§£é‡Šï¼šåŸæ•°ç»„ä¸º [0,1,2,4,5,6,7] ï¼Œæ—‹è½¬ 4 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [11,13,15,17]è¾“å‡ºï¼š11è§£é‡Šï¼šåŸæ•°ç»„ä¸º [11,13,15,17] ï¼Œæ—‹è½¬ 4 æ¬¡å¾—åˆ°è¾“å…¥æ•°ç»„ã€‚\næç¤ºï¼š\nn &#x3D;&#x3D; nums.length1 &lt;&#x3D; n &lt;&#x3D; 5000-5000 &lt;&#x3D; nums[i] &lt;&#x3D; 5000nums ä¸­çš„æ‰€æœ‰æ•´æ•° äº’ä¸ç›¸åŒnums åŸæ¥æ˜¯ä¸€ä¸ªå‡åºæ’åºçš„æ•°ç»„ï¼Œå¹¶è¿›è¡Œäº† 1 è‡³ n æ¬¡æ—‹è½¬\né¢˜è§£/** * 3,4,5,1,2 *     5 *   4 * 3 *         2 *       1 * å–ä»»æ„ä¸­é—´æ•°ï¼Œå¦‚æœä¸­é—´æ•°å°äºå³è¾¹ï¼Œå¯çŸ¥ä¸­é—´æ•°ä½äºæ›²çº¿å³ä¾§ * å¦‚æœä¸­é—´æ•°å¤§äºå³è¾¹ï¼Œå¯çŸ¥ä¸­é—´æ•°ä½äºæ›²çº¿å·¦ä¾§ï¼Œå·¦ä¾§çš„æ•°éƒ½ä¸æ˜¯éœ€è¦çš„æœ€å°å€¼ï¼Œå°†ä¸­é—´æ•°+1 * å½“å·¦è¾¹lowå¤§äºå³ä¾§highæ—¶ï¼Œå³lowï¼Œhighå¤„äº5çš„ä½ç½®ï¼Œlow+1å³ä¸ºè¦å¾—åˆ°çš„æœ€å°å€¼ * @param nums * @return */public int findMin(int[] nums) &#123;    int left = 0;    int right = nums.length - 1;    while (left &lt; right) &#123;        int pivot = left + (right - left) / 2;        if (nums[pivot] &lt; nums[right]) &#123;            right = pivot;        &#125; else &#123;            //æ›²çº¿å·¦ä¾§çš„æ•°éƒ½éœ€è¦èˆå¼ƒ            left = pivot + 1;        &#125;    &#125;    return nums[left];&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒåˆ†æ³•"]},{"title":"278. ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬","url":"/java4u/2021/08/26/278.%20%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E7%9A%84%E7%89%88%E6%9C%AC/","content":"278. ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ä½ æ˜¯äº§å“ç»ç†ï¼Œç›®å‰æ­£åœ¨å¸¦é¢†ä¸€ä¸ªå›¢é˜Ÿå¼€å‘æ–°çš„äº§å“ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä½ çš„äº§å“çš„æœ€æ–°ç‰ˆæœ¬æ²¡æœ‰é€šè¿‡è´¨é‡æ£€æµ‹ã€‚ç”±äºæ¯ä¸ªç‰ˆæœ¬éƒ½æ˜¯åŸºäºä¹‹å‰çš„ç‰ˆæœ¬å¼€å‘çš„ï¼Œæ‰€ä»¥é”™è¯¯çš„ç‰ˆæœ¬ä¹‹åçš„æ‰€æœ‰ç‰ˆæœ¬éƒ½æ˜¯é”™çš„ã€‚\nå‡è®¾ä½ æœ‰ n ä¸ªç‰ˆæœ¬ [1, 2, â€¦, n]ï¼Œä½ æƒ³æ‰¾å‡ºå¯¼è‡´ä¹‹åæ‰€æœ‰ç‰ˆæœ¬å‡ºé”™çš„ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚\nä½ å¯ä»¥é€šè¿‡è°ƒç”¨ bool isBadVersion(version) æ¥å£æ¥åˆ¤æ–­ç‰ˆæœ¬å· version æ˜¯å¦åœ¨å•å…ƒæµ‹è¯•ä¸­å‡ºé”™ã€‚å®ç°ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚ä½ åº”è¯¥å°½é‡å‡å°‘å¯¹è°ƒç”¨ API çš„æ¬¡æ•°ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šn &#x3D; 5, bad &#x3D; 4è¾“å‡ºï¼š4è§£é‡Šï¼šè°ƒç”¨ isBadVersion(3) -&gt; falseè°ƒç”¨ isBadVersion(5) -&gt; trueè°ƒç”¨ isBadVersion(4) -&gt; trueæ‰€ä»¥ï¼Œ4 æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šn &#x3D; 1, bad &#x3D; 1è¾“å‡ºï¼š1\næç¤ºï¼š\n1 &lt;&#x3D; bad &lt;&#x3D; n &lt;&#x3D; 2^31 - 1\né¢˜è§£\nå¦‚æœä¸­é—´çš„midå¦‚æœæ˜¯é”™è¯¯ç‰ˆæœ¬ï¼Œé‚£æˆ‘ä»¬å°±çŸ¥é“ mid å³ä¾§éƒ½ä¸å¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬ã€‚é‚£æˆ‘ä»¬å°±ä»¤ right &#x3D; midï¼Œå¦‚æœmidæ˜¯æ­£ç¡®ç‰ˆæœ¬åˆ™midåŠmidå·¦è¾¹éƒ½ä¸å¯èƒ½æ˜¯é”™è¯¯ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä»¤left&#x3D;mid+1ï¼ŒæŠŠä¸‹ä¸€æ¬¡æœç´¢ç©ºé—´å˜æˆ[left, mid]ï¼Œç„¶åè‡ªç„¶æˆ‘ä»¬å¾ˆé¡ºåˆ©æŸ¥æ‰¾åˆ°ç›®æ ‡ã€‚\n\npublic int firstBadVersion(int n) &#123;    int left = 1;    int right = n;    while (left &lt; right) &#123;        int mid = left + (right - left) / 2;        if (isBadVersion(mid)) &#123;            right = mid;        &#125; else &#123;            left = mid + 1;        &#125;    &#125;    return left;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒåˆ†æ³•"]},{"title":"69. x çš„å¹³æ–¹æ ¹","url":"/java4u/2021/08/25/69.%20x%20%E7%9A%84%E5%B9%B3%E6%96%B9%E6%A0%B9/","content":"69. x çš„å¹³æ–¹æ ¹ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•° x ï¼Œè®¡ç®—å¹¶è¿”å› x çš„ ç®—æœ¯å¹³æ–¹æ ¹ ã€‚\nç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™ æ•´æ•°éƒ¨åˆ† ï¼Œå°æ•°éƒ¨åˆ†å°†è¢« èˆå» ã€‚\næ³¨æ„ï¼šä¸å…è®¸ä½¿ç”¨ä»»ä½•å†…ç½®æŒ‡æ•°å‡½æ•°å’Œç®—ç¬¦ï¼Œä¾‹å¦‚ pow(x, 0.5) æˆ–è€… x ** 0.5 ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šx &#x3D; 4è¾“å‡ºï¼š2\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šx &#x3D; 8è¾“å‡ºï¼š2è§£é‡Šï¼š8 çš„ç®—æœ¯å¹³æ–¹æ ¹æ˜¯ 2.82842â€¦, ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚\næç¤ºï¼š\n0 &lt;&#x3D; x &lt;&#x3D; 2^31 - 1\né¢˜è§£public int mySqrt(int x) &#123;    if(x == 0) return 0;    //å°†è¾¹ç•Œè®¾ä¸ºlong é˜²æ­¢è¶…å‡ºç•Œé™    long left = 1;    long right = x;    long res = 0;    while (left &lt;= right) &#123;        long mid = left + (right - left)/2;        if(mid*mid &lt; x) &#123;            res = Math.max(res, mid);            left = mid+1;        &#125; else if(mid*mid == x)&#123;            return (int)mid;        &#125; else &#123;            right = mid-1;        &#125;    &#125;    return (int)res;&#125;public int mySqrt2(int x) &#123;    if (x == 0) return 0;    long left = 1;    long right = x / 2;    while (left &lt; right) &#123;        //æ³¨æ„è¿™ä¸€è¡Œä»£ç         //2.828*2.828=8  å–æ•´åŠ 1  midå–3        long mid = (right + left) / 2 + 1;        if (mid &gt; x / mid) &#123;            //ç»“æœå¤§äº å³3è¿™ä¸ªå€¼ä¸è€ƒè™‘ï¼Œä¹Ÿéœ€è¦èˆå¼ƒ            right = mid - 1;        &#125; else &#123;            left = mid;        &#125;    &#125;    return (int) left;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒåˆ†æ³•"]},{"title":"875. çˆ±åƒé¦™è•‰çš„ç‚ç‚","url":"/java4u/2021/08/24/875.%20%E7%88%B1%E5%90%83%E9%A6%99%E8%95%89%E7%9A%84%E7%8F%82%E7%8F%82/","content":"875. çˆ±åƒé¦™è•‰çš„ç‚ç‚ç‚ç‚å–œæ¬¢åƒé¦™è•‰ã€‚è¿™é‡Œæœ‰ n å †é¦™è•‰ï¼Œç¬¬ i å †ä¸­æœ‰ piles[i] æ ¹é¦™è•‰ã€‚è­¦å«å·²ç»ç¦»å¼€äº†ï¼Œå°†åœ¨ h å°æ—¶åå›æ¥ã€‚\nç‚ç‚å¯ä»¥å†³å®šå¥¹åƒé¦™è•‰çš„é€Ÿåº¦ k ï¼ˆå•ä½ï¼šæ ¹&#x2F;å°æ—¶ï¼‰ã€‚æ¯ä¸ªå°æ—¶ï¼Œå¥¹å°†ä¼šé€‰æ‹©ä¸€å †é¦™è•‰ï¼Œä»ä¸­åƒæ‰ k æ ¹ã€‚å¦‚æœè¿™å †é¦™è•‰å°‘äº k æ ¹ï¼Œå¥¹å°†åƒæ‰è¿™å †çš„æ‰€æœ‰é¦™è•‰ï¼Œç„¶åè¿™ä¸€å°æ—¶å†…ä¸ä¼šå†åƒæ›´å¤šçš„é¦™è•‰ã€‚  \nç‚ç‚å–œæ¬¢æ…¢æ…¢åƒï¼Œä½†ä»ç„¶æƒ³åœ¨è­¦å«å›æ¥å‰åƒæ‰æ‰€æœ‰çš„é¦™è•‰ã€‚\nè¿”å›å¥¹å¯ä»¥åœ¨ h å°æ—¶å†…åƒæ‰æ‰€æœ‰é¦™è•‰çš„æœ€å°é€Ÿåº¦ kï¼ˆk ä¸ºæ•´æ•°ï¼‰ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼špiles &#x3D; [3,6,7,11], h &#x3D; 8è¾“å‡ºï¼š4\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼špiles &#x3D; [30,11,23,4,20], h &#x3D; 5è¾“å‡ºï¼š30\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼špiles &#x3D; [30,11,23,4,20], h &#x3D; 6è¾“å‡ºï¼š23\næç¤ºï¼š\n1 &lt;&#x3D; piles.length &lt;&#x3D; 10^4piles.length &lt;&#x3D; h &lt;&#x3D; 10^91 &lt;&#x3D; piles[i] &lt;&#x3D; 10^9\né¢˜è§£/** * å¤§éƒ¨åˆ†çš„äºŒåˆ†æŸ¥æ‰¾ï¼ŒåŸºæœ¬éƒ½ç”±ä»¥ä¸‹ä¸‰æ­¥ç»„æˆï¼š * é¢„å¤„ç†è¿‡ç¨‹ï¼ˆå¤§éƒ¨åˆ†åœºæ™¯å°±æ˜¯å¯¹æœªæ’åºçš„é›†åˆè¿›è¡Œæ’åºï¼‰ * äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹ï¼ˆæ‰¾åˆ°åˆé€‚çš„å¾ªç¯æ¡ä»¶ï¼Œæ¯ä¸€æ¬¡å°†æŸ¥æ‰¾ç©ºé—´ä¸€åˆ†ä¸ºäºŒï¼‰ * åå¤„ç†è¿‡ç¨‹ï¼ˆåœ¨å‰©ä½™çš„ç©ºé—´ä¸­ï¼Œæ‰¾åˆ°åˆé€‚çš„ç›®æ ‡å€¼ï¼‰ * * åˆå§‹æ¡ä»¶ï¼šleft = 0, right = length-1 * ç»ˆæ­¢ï¼šleft &gt; right * å‘å·¦æŸ¥æ‰¾ï¼šright = mid-1 * å‘å³æŸ¥æ‰¾ï¼šleft = mid +1 */public int binarySearch(int[] array, int des) &#123;    int low = 0, high = array.length - 1;    while (low &lt;= high) &#123;        int mid = low + (high - low) / 2;        if (des == array[mid]) &#123;            return mid;        &#125; else if (des &lt; array[mid]) &#123;            high = mid - 1;        &#125; else &#123;            low = mid + 1;        &#125;    &#125;    return -1;&#125;public int minEatingSpeed(int[] piles, int h) &#123;    if(piles.length == 0)return 0;    //æ’åºæ•°ç»„    Arrays.sort(piles);    //è·å–å·¦å³è¾¹ç•Œ    int left = 1;    int right = piles[piles.length-1];    int min = Integer.MAX_VALUE;    while (left &lt;= right) &#123;        int mid = left + (right - left) / 2;        if (eatHours(piles, mid) &lt;= h)&#123;            min = Math.min(min, mid);            right = mid - 1;        &#125; else &#123;            left = mid + 1;        &#125;    &#125;    return min;&#125;private int eatHours(int[] piles, int speed)&#123;    int h = 0;    for (int pile : piles) &#123;        //å‘ä¸Šå–æ•´        h += Math.ceil(pile * 1.0 / speed);    &#125;    return h;&#125;/** * éå†é¦™è•‰å †ç›´æ¥è·å–æœ€å¤§å€¼ï¼Œå°±æ˜¯æœ€å¤§åƒé¦™è•‰çš„é€Ÿåº¦ï¼ˆè¶…è¿‡è¿˜æ˜¯1å°æ—¶åƒä¸€å †ï¼‰ï¼Œå¯ä»¥ä¸éœ€è¦æ’åºé¦™è•‰å † * @param piles * @param H * @return */public int minEatingSpeed2(int[] piles, int H) &#123;    int maxVal = 1;    for (int pile : piles) &#123;        maxVal = Math.max(maxVal, pile);    &#125;    int left = 1;    int right = maxVal;    while (left &lt; right) &#123;        int mid = (left + right) &gt;&gt; 1;        if (canEat(piles, mid, H)) &#123;            //ä¸èƒ½åƒå®Œï¼ŒåŒ…å«Midå’Œå·¦è¾¹çš„éƒ½èˆå¼ƒ            left = mid + 1;        &#125; else &#123;            right = mid;        &#125;    &#125;    //ä¸æ»¡è¶³çš„å·¦è¾¹ç•Œéƒ½è¢«èˆå¼ƒï¼Œleftå°±æ˜¯æ»¡è¶³çš„æ¡ä»¶    return left;&#125;/** * * @param piles * @param speed * @param H * @return  true  ä¸èƒ½åƒå®Œ    false èƒ½åƒå®Œ */private boolean canEat(int[] piles, int speed, int H) &#123;    int sum = 0;    for (int pile : piles) &#123;        //å‘ä¸Šå–æ•´        sum += Math.ceil(pile * 1.0 / speed);    &#125;    return sum &gt; H;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒåˆ†æ³•"]},{"title":"è®¾è®¡æ¨¡å¼","url":"/java4u/2021/08/20/3.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","content":"1.å·¥å‚æ–¹æ³•æ¨¡å¼public class SendFactory &#123;    public Sender produceMail()&#123;return new MailSender();&#125;        public Sender produceSms()&#123;return new SmsSender();&#125;&#125;\n\né™æ€â¼¯â¼šâ½…æ³•æ¨¡å¼ï¼šå°†ä¸Šâ¾¯çš„å¤šä¸ªâ¼¯â¼šâ½…æ³•ç½®ä¸ºé™æ€çš„ï¼Œä¸éœ€è¦åˆ›å»ºâ¼¯â¼šå®ä¾‹ï¼Œç›´æ¥è°ƒâ½¤å³å¯ï¼›\né€‚â½¤åœºæ™¯ï¼šå‡¡æ˜¯å‡ºç°äº†â¼¤é‡ä¸åŒç§ç±»çš„äº§å“éœ€è¦åˆ›å»ºï¼Œå¹¶ä¸”å…·æœ‰å…±åŒçš„æ¥â¼æ—¶ï¼Œå¯ä»¥é€šè¿‡â¼¯â¼šâ½…æ³•æ¨¡å¼è¿›â¾åˆ›å»ºã€‚â¼¤å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰â½¤â€”â€”é™æ€â¼¯â¼šâ½…æ³•æ¨¡å¼ã€‚\n2.æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºå¤šä¸ªâ¼¯â¼šç±»ï¼Œï¼ˆç”Ÿäº§ä¸€ä¸ªç³»åˆ—å•†å“ï¼‰æâ¾¼â¼¯â¼šçš„æ‰©å±•æ€§ï¼Œä¸â½¤åƒä¸Šâ¾¯â¼€æ ·å¦‚æœå¢åŠ äº§å“åˆ™è¦å»ä¿®æ”¹å”¯â¼€çš„â¼¯â¼šç±»ï¼›\n3.å•ä¾‹æ¨¡å¼ä¿è¯åœ¨â¼€ä¸ªJVMä¸­ï¼Œè¯¥å¯¹è±¡åªæœ‰â¼€ä¸ªå®ä¾‹å­˜åœ¨ï¼›\npublic class Singleton &#123;    /* æŒæœ‰ç§æœ‰é™æ€å®ä¾‹ï¼Œé˜²â½Œè¢«å¼•â½¤ï¼Œæ­¤å¤„èµ‹å€¼ä¸ºnullï¼Œâ½¬çš„æ˜¯å®ç°å»¶è¿ŸåŠ è½½ */    private state Singleton instance = null;    /* ç§æœ‰æ„é€ â½…æ³•ï¼Œé˜²â½Œè¢«å®ä¾‹åŒ– */    private Singleton()&#123;&#125;    /* é™æ€â¼¯ç¨‹â½…æ³•ï¼Œåˆ›å»ºå®ä¾‹ */    public static Singleton getInstance()&#123;        if(instance == null)&#123;            instance = new Singleton();        &#125;        return instance;    &#125;&#125;\n\n1ã€é¥¿æ±‰å¼ï¼šç±»åˆå§‹åŒ–æ—¶åˆ›å»ºå•ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œé€‚â½¤äºå•ä¾‹å å†…å­˜â¼©çš„åœºæ™¯ï¼Œå¦åˆ™æ¨èä½¿â½¤æ‡’æ±‰å¼å»¶è¿ŸåŠ è½½ï¼›\npublic class Singleton &#123;    private static Singleton instance = new Singleton();    private Singleton()&#123;&#125;    public static Singleton getInstance()&#123;return instance;&#125;&#125;\n\n2ã€æ‡’æ±‰å¼ï¼šéœ€è¦åˆ›å»ºå•ä¾‹å®ä¾‹çš„æ—¶å€™å†åˆ›å»ºï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨(æ€§èƒ½ä¸å¤ªå¥½)ï¼š\npublic class Singleton&#123;    private static Singleton instance = null;    private Singleton()&#123;&#125;    public static synchronized Singleton getInstance()&#123;        if(null == instance)&#123;            instance = new Singleton();        &#125;        return instance;    &#125;&#125;\n\n3ã€åŒé‡æ£€éªŒé”ï¼šæ•ˆç‡â¾¼ï¼›(è§£å†³é—®é¢˜ï¼šå‡å¦‚ä¸¤ä¸ªçº¿ç¨‹Aã€Bï¼ŒAæ‰§â¾äº†if (instance &#x3D;&#x3D; null)è¯­å¥ï¼Œå®ƒä¼šè®¤ä¸ºå•ä¾‹å¯¹è±¡æ²¡æœ‰åˆ›å»ºï¼Œæ­¤æ—¶çº¿ç¨‹åˆ‡åˆ°Bä¹Ÿæ‰§â¾äº†åŒæ ·çš„è¯­å¥ï¼ŒBä¹Ÿè®¤ä¸ºå•ä¾‹å¯¹è±¡æ²¡æœ‰åˆ›å»ºï¼Œç„¶åä¸¤ä¸ªçº¿ç¨‹ä¾æ¬¡æ‰§â¾åŒæ­¥ä»£ç å—ï¼Œå¹¶åˆ†åˆ«åˆ›å»ºäº†â¼€ä¸ªå•ä¾‹å¯¹è±¡ã€‚)\npublic class Singleton &#123;    private static volatile Singleton instance = null;//volatileçš„â¼€ä¸ªè¯­ä¹‰æ˜¯ç¦â½ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–    private Singleton()&#123;&#125;    public static Singleton getInstance() &#123;        if(instance == null)&#123;            synchronized(Singleton.class)&#123;                if(instance == null)&#123;                    instance = new Singleton();                &#125;            &#125;        &#125;        return instance;    &#125;&#125;\n\n4ã€é™æ€å†…éƒ¨ç±»â½…å¼ï¼šå¯ä»¥åŒæ—¶ä¿è¯å»¶è¿ŸåŠ è½½å’Œçº¿ç¨‹å®‰å…¨ã€‚\npublic class Singleton &#123;    private static class SingletonHolder&#123;        public static Singleton instance = new Singleton();    &#125;    private Singleton()&#123;&#125;    public static Singleton getInstance()&#123;        return SingletonHolder.instance;    &#125;&#125;\n\n5ã€æšä¸¾ï¼šä½¿â½¤æšä¸¾é™¤äº†çº¿ç¨‹å®‰å…¨å’Œé˜²â½Œåå°„è°ƒâ½¤æ„é€ å™¨ä¹‹å¤–ï¼Œè¿˜æä¾›äº†â¾ƒåŠ¨åºåˆ—åŒ–æœºåˆ¶ï¼Œé˜²â½Œååºåˆ—åŒ–çš„æ—¶å€™åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚\npublic enum Singleton&#123;    instance;    public void mothod()&#123;&#125;&#125;\n\n4.åŸå‹æ¨¡å¼(å¯¹â¼€ä¸ªåŸå‹å¯¹è±¡è¿›â¾å¤åˆ¶ã€å…‹éš†äº§â½£ç±»ä¼¼æ–°å¯¹è±¡)ï¼šå°†â¼€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œå¯¹å…¶è¿›â¾å¤åˆ¶ã€å…‹éš†ï¼Œäº§â½£â¼€ä¸ªå’Œå…ƒå¯¹è±¡ç±»ä¼¼çš„æ–°å¯¹è±¡ï¼›\n 1ã€æ ¸â¼¼ï¼šå®ƒçš„æ ¸â¼¼æ˜¯åŸå‹ç±»Prototypeï¼Œéœ€è¦å®ç°Cloneableæ¥â¼ï¼Œå’Œé‡å†™Objectç±»ä¸­çš„cloneâ½…æ³•ï¼›\n 2ã€ä½œâ½¤ï¼šä½¿â½¤åŸå‹æ¨¡å¼åˆ›å»ºå¯¹è±¡â½ç›´æ¥newâ¼€ä¸ªå¯¹è±¡åœ¨æ€§èƒ½ä¸Šè¦å¥½çš„å¤šï¼Œå› ä¸ºObjectç±»çš„cloneâ½…æ³•æ˜¯â¼€ä¸ªæœ¬åœ°â½…æ³•ï¼Œå®ƒç›´æ¥æ“ä½œå†…å­˜ä¸­çš„â¼†è¿›åˆ¶æµï¼Œç‰¹åˆ«æ˜¯å¤åˆ¶â¼¤å¯¹è±¡æ—¶ï¼Œæ€§èƒ½çš„å·®åˆ«â¾®å¸¸æ˜æ˜¾ã€‚\n5.é€‚é…å™¨æ¨¡å¼å°†æŸä¸ªç±»çš„æ¥â¼è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦â¼€ä¸ªæ¥â¼è¡¨ç¤ºï¼Œâ½¬çš„æ˜¯æ¶ˆé™¤ç”±äºæ¥â¼ä¸åŒ¹é…æ‰€é€ æˆçš„ç±»çš„å…¼å®¹æ€§é—®é¢˜\n1ã€ç±»çš„é€‚é…å™¨æ¨¡å¼ï¼š\nSourceæ‹¥æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œç›®æ ‡æ¥å£Targetable,é€šè¿‡Adapterç±»ï¼Œå°†SourceåŠŸèƒ½æ‰©å±•åˆ°Targetable\npublic class Source&#123;    public void method1()&#123;        System.out.println(&quot;this is original method!&quot;);    &#125;&#125;public interface Targetable &#123;    //ä¸åŸç±»ä¸­æ–¹æ³•ç›¸åŒ    public void method1();    //æ–°ç±»çš„æ–¹æ³•    public void method2();&#125;public class Adapter extends Source implements Targetable &#123;    @Override    public void method2()&#123;        System.out.println(&quot;this is the targetable method!&quot;);    &#125;&#125;\n\n2ã€å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ï¼š\npublic class Wrapper implements Targetable &#123;    private Source source;        public Wrapper(Source source)&#123;        super();        this.source = source;    &#125;        @Override    public void method2()&#123;        System.out.println(&quot;this is the targetable method!&quot;);    &#125;&#125;\n\n3ã€æ¥â¼çš„é€‚é…å™¨æ¨¡å¼ï¼š\npublic interface Sourceable &#123;    public void method1();    public void method2();    public void method3();&#125;public abstract class Wrapper2 implements Sourceable &#123;    public void method1()&#123;&#125;    public void method2()&#123;&#125;    public void method3()&#123;&#125;&#125;public class SourceSub1 extends Wrapper2 &#123;    public void method1()&#123;        System.out.println(&quot;the sourceable interface&#x27;s first Sub1!&quot;)    &#125;&#125;public class SourceSub2 extends Wrapper2 &#123;    public void method2()&#123;        System.out.println(&quot;the sourceable interface&#x27;s second Sub2!&quot;)    &#125;&#125;\n\n 4ã€ä½¿â½¤åœºæ™¯ï¼š\n 1ã€ç±»çš„é€‚é…å™¨æ¨¡å¼ï¼šå½“å¸Œæœ›å°†â¼€ä¸ªç±»è½¬æ¢æˆæ»¡â¾œå¦â¼€ä¸ªæ–°æ¥â¼çš„ç±»æ—¶ï¼Œå¯ä»¥ä½¿â½¤ç±»çš„é€‚é…å™¨æ¨¡å¼ï¼Œåˆ›å»ºâ¼€ä¸ªæ–°ç±»ï¼Œç»§æ‰¿åŸæœ‰çš„ç±»ï¼Œå®ç°æ–°çš„æ¥â¼å³å¯ã€‚\n 2ã€å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ï¼šå½“å¸Œæœ›å°†â¼€ä¸ªå¯¹è±¡è½¬æ¢æˆæ»¡â¾œå¦â¼€ä¸ªæ–°æ¥â¼çš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥åˆ›å»ºâ¼€ä¸ªWrapperç±»ï¼ŒæŒæœ‰åŸç±»çš„â¼€ä¸ªå®ä¾‹ï¼Œåœ¨Wrapperç±»çš„â½…æ³•ä¸­ï¼Œè°ƒâ½¤å®ä¾‹çš„â½…æ³•å°±â¾ã€‚\n 3ã€æ¥â¼çš„é€‚é…å™¨æ¨¡å¼ï¼šå½“ä¸å¸Œæœ›å®ç°â¼€ä¸ªæ¥â¼ä¸­æ‰€æœ‰çš„â½…æ³•æ—¶ï¼Œå¯ä»¥åˆ›å»ºâ¼€ä¸ªæŠ½è±¡ç±»Wrapperï¼Œå®ç°æ‰€æœ‰â½…æ³•ï¼Œæˆ‘ä»¬å†™åˆ«çš„ç±»çš„æ—¶å€™ï¼Œç»§æ‰¿æŠ½è±¡ç±»å³å¯ã€‚ \n","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"268. ä¸¢å¤±çš„æ•°å­—","url":"/java4u/2021/08/20/268.%20%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%95%B0%E5%AD%97/","content":"268. ä¸¢å¤±çš„æ•°å­—ç»™å®šä¸€ä¸ªåŒ…å« [0, n] ä¸­ n ä¸ªæ•°çš„æ•°ç»„ nums ï¼Œæ‰¾å‡º [0, n] è¿™ä¸ªèŒƒå›´å†…æ²¡æœ‰å‡ºç°åœ¨æ•°ç»„ä¸­çš„é‚£ä¸ªæ•°ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [3,0,1]è¾“å‡ºï¼š2è§£é‡Šï¼šn &#x3D; 3ï¼Œå› ä¸ºæœ‰ 3 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,3] å†…ã€‚2 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0,1]è¾“å‡ºï¼š2è§£é‡Šï¼šn &#x3D; 2ï¼Œå› ä¸ºæœ‰ 2 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,2] å†…ã€‚2 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [9,6,4,2,3,5,7,0,1]è¾“å‡ºï¼š8è§£é‡Šï¼šn &#x3D; 9ï¼Œå› ä¸ºæœ‰ 9 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,9] å†…ã€‚8 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚\nç¤ºä¾‹ 4ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0]è¾“å‡ºï¼š1è§£é‡Šï¼šn &#x3D; 1ï¼Œå› ä¸ºæœ‰ 1 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,1] å†…ã€‚1 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚\næç¤ºï¼š\nn &#x3D;&#x3D; nums.length1 &lt;&#x3D; n &lt;&#x3D; 10^40 &lt;&#x3D; nums[i] &lt;&#x3D; nnums ä¸­çš„æ‰€æœ‰æ•°å­—éƒ½ ç‹¬ä¸€æ— äºŒ\nè¿›é˜¶ï¼šä½ èƒ½å¦å®ç°çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€ä»…ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜?\né¢˜è§£/** * 0~nçš„åˆè®¡ä¸º (1+n)*n/2 * åˆè®¡å€¼å‡å»æ•°ç»„çš„å€¼ï¼Œç»“æœå³ä¸ºä¸¢å¤±çš„å€¼ * @param nums * @return */public int missingNumber(int[] nums) &#123;    int n = nums.length;    int sum = (n + 1) * n / 2;    for(int i : nums)&#123;        sum -= i;    &#125;    return sum;&#125;/** * 2ä¸ªç›¸åŒçš„æ•°å¯ä»¥ä½¿ç”¨å¼‚æˆ–æ¶ˆé™¤ * [3,0,1] * 0^3^1^0^2^1 * 0^0 1^1 res^2 3^nums.length * * @param nums * @return */public int missingNumber2(int[] nums) &#123;    int res = 0;    for(int i = 0; i &lt; nums.length; i++ )        res ^= nums[i] ^ i;    return res ^ nums.length;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","ä½è¿ç®—"]},{"title":"137. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— II","url":"/java4u/2021/08/19/137.%20%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97%20II/","content":"137. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— IIç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œé™¤æŸä¸ªå…ƒç´ ä»…å‡ºç° ä¸€æ¬¡ å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ éƒ½æ°å‡ºç° ä¸‰æ¬¡ ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›é‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [2,2,3,2]è¾“å‡ºï¼š3ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0,1,0,1,0,1,99]è¾“å‡ºï¼š99\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 3 * 10^4-2^31 &lt;&#x3D; nums[i] &lt;&#x3D; 2^31 - 1nums ä¸­ï¼Œé™¤æŸä¸ªå…ƒç´ ä»…å‡ºç° ä¸€æ¬¡ å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ éƒ½æ°å‡ºç° ä¸‰æ¬¡\nè¿›é˜¶ï¼šä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ\né¢˜è§£/** * è§‚å¯Ÿ[a,a,a,b,b,b,c,c,c]ä¸[a,a,a,b,b,b,c]ä¹‹é—´ç›¸å·®2ä¸ªc * å¯ä»¥å°†æ•°ç»„çš„æ•°å­—å»é‡ï¼Œå†ä¹˜ä»¥3ï¼Œåœ¨å‡å»ä¹‹å‰çš„æ•°ç»„ï¼Œå¾—åˆ°çš„å€¼å°±æ˜¯2å€çš„ç›®æ ‡å€¼ * @param nums * @return */public int singleNumber(int[] nums) &#123;    long sum = Arrays.stream(nums).distinct().mapToLong(num -&gt; (long) num).sum() * 3;    long sum1 = Arrays.stream(nums).mapToLong(num -&gt; (long) num).sum();    return (int)((sum-sum1)/2);&#125;/** * å°†æ•°ç»„æ’åºï¼Œä¹‹åéå† * å½“nums[n]==nums[n+1]ï¼Œå¯ä»¥è·³è¿‡å3ä¸ª * @param nums * @return */public int singleNumber2(int[] nums) &#123;    Arrays.sort(nums);    int n = nums.length;    for (int i = 0; i &lt; n; i+=3) &#123;        if(i == n-1 || nums[i] != nums[i+1])&#123;            return nums[i];        &#125;    &#125;    return 0;&#125;/** * ç”±äºæ•°ç»„ä¸­çš„å…ƒç´ éƒ½åœ¨ intï¼ˆå³ 32 ä½æ•´æ•°ï¼‰èŒƒå›´å†…ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¾æ¬¡è®¡ç®—ç­”æ¡ˆçš„æ¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½æ˜¯ 0 è¿˜æ˜¯ 1ã€‚ * å…·ä½“åœ°ï¼Œè€ƒè™‘ç­”æ¡ˆçš„ç¬¬ i ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆi ä» 0 å¼€å§‹ç¼–å·ï¼‰ï¼Œå®ƒå¯èƒ½ä¸º 0 æˆ– 1ã€‚å¯¹äºæ•°ç»„ä¸­éç­”æ¡ˆçš„å…ƒç´ ï¼Œ * æ¯ä¸€ä¸ªå…ƒç´ éƒ½å‡ºç°äº† 3 æ¬¡ï¼Œå¯¹åº”ç€ç¬¬ i ä¸ªäºŒè¿›åˆ¶ä½çš„ 3 ä¸ª 0 æˆ– 3 ä¸ª 1ï¼Œæ— è®ºæ˜¯å“ªä¸€ç§æƒ…å†µï¼Œ * å®ƒä»¬çš„å’Œéƒ½æ˜¯ 3 çš„å€æ•°ï¼ˆå³å’Œä¸º 0 æˆ– 3ï¼‰ã€‚å› æ­¤ï¼š * ç­”æ¡ˆçš„ç¬¬ i ä¸ªäºŒè¿›åˆ¶ä½å°±æ˜¯æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ çš„ç¬¬ i ä¸ªäºŒè¿›åˆ¶ä½ä¹‹å’Œé™¤ä»¥ 3 çš„ä½™æ•°ã€‚ * è¿™æ ·ä¸€æ¥ï¼Œå¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´  xï¼Œæˆ‘ä»¬ä½¿ç”¨ä½è¿ç®— (xÂ &gt;&gt;Â i)Â &amp;Â 1 å¾—åˆ° x çš„ç¬¬ i ä¸ªäºŒè¿›åˆ¶ä½ï¼Œ * å¹¶å°†å®ƒä»¬ç›¸åŠ å†å¯¹ 3 å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœä¸€å®šä¸º 0 æˆ– 1ï¼Œå³ä¸ºç­”æ¡ˆçš„ç¬¬ i ä¸ªäºŒè¿›åˆ¶ä½ã€‚ * @param nums * @return */public int singleNumber3(int[] nums) &#123;    int ans = 0;    for (int i = 0; i &lt; 32; ++i) &#123;        int total = 0;        for (int num: nums) &#123;            //ä»æœ€åä¸€ä½ä¸æ–­å‘å‰å–æœ«ä½çš„å€¼            total += ((num &gt;&gt; i) &amp; 1);        &#125;        if (total % 3 != 0) &#123;            //å°†æ¨¡3çš„å€¼åŠ åˆ°ç»“æœä¸Š            ans |= (1 &lt;&lt; i);        &#125;    &#125;    return ans;&#125;/** * æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªã€Œé»‘ç›’ã€å­˜å‚¨å½“å‰éå†è¿‡çš„æ‰€æœ‰æ•´æ•°ã€‚ã€Œé»‘ç›’ã€çš„ç¬¬ i ä½ä¸º &#123;0,1,2&#125; ä¸‰è€…ä¹‹ä¸€ï¼Œè¡¨ç¤ºå½“å‰éå†è¿‡çš„æ‰€æœ‰æ•´æ•°çš„ç¬¬ i ä½ä¹‹å’Œé™¤ä»¥ 3 çš„ä½™æ•°ã€‚ * ä½†ç”±äºäºŒè¿›åˆ¶è¡¨ç¤ºä¸­åªæœ‰ 0 å’Œ 1 è€Œæ²¡æœ‰ 2ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘åœ¨ã€Œé»‘ç›’ã€ä¸­ä½¿ç”¨ä¸¤ä¸ªæ•´æ•°æ¥è¿›è¡Œå­˜å‚¨ï¼Œå³ï¼š * é»‘ç›’ä¸­å­˜å‚¨äº†ä¸¤ä¸ªæ•´æ•° a å’Œ bï¼Œä¸”ä¼šæœ‰ä¸‰ç§æƒ…å†µï¼š * a çš„ç¬¬ i ä½ä¸º 0 ä¸” bb çš„ç¬¬ i ä½ä¸º 0ï¼Œè¡¨ç¤º 0ï¼› * a çš„ç¬¬ i ä½ä¸º 0 ä¸” b çš„ç¬¬ i ä½ä¸º 1ï¼Œè¡¨ç¤º 1ï¼› * a çš„ç¬¬ i ä½ä¸º 1 ä¸” b çš„ç¬¬ i ä½ä¸º 0ï¼Œè¡¨ç¤º 2ã€‚ * ä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œæˆ‘ä»¬ç”¨ (00) è¡¨ç¤º a çš„ç¬¬ i ä½ä¸º 0 ä¸” b çš„ç¬¬ i ä½ä¸º 0ï¼Œå…¶ä½™çš„æƒ…å†µç±»ä¼¼ã€‚ * å½“æˆ‘ä»¬éå†åˆ°ä¸€ä¸ªæ–°çš„æ•´æ•° x æ—¶ï¼Œå¯¹äº x çš„ç¬¬ i ä½ ixï¼Œå¦‚æœ ix=0ï¼Œé‚£ä¹ˆ a å’Œ b çš„ç¬¬ i ä½ä¸å˜ï¼› * å¦‚æœ ix=1ï¼Œé‚£ä¹ˆ a å’Œ b çš„ç¬¬ i ä½æŒ‰ç…§ (00)â†’(01)â†’(10)â†’(00) è¿™ä¸€å¾ªç¯è¿›è¡Œå˜åŒ– * * TODOæŠ„çš„ç­”æ¡ˆï¼Œæœ¨æœ‰ç†è§£ * * @param nums * @return */public int singleNumber4(int[] nums) &#123;    int a = 0, b = 0, tmp = 0;    for (int next : nums) &#123;        tmp = (a &amp; ~next) | (b &amp; next);        b = (~a &amp; ~b &amp; next) | (b &amp; ~next);        a = tmp;    &#125;    return b;&#125;public int singleNumber5(int[] nums) &#123;    int a = 0, b = 0;    for (int next : nums) &#123;        b = (b ^ next) &amp; ~a;        a = (a ^ next) &amp; ~b;    &#125;    return b;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","ä½è¿ç®—"]},{"title":"136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—","url":"/java4u/2021/08/18/136.%20%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/","content":"136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚\nè¯´æ˜ï¼š\nä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ\nç¤ºä¾‹ 1:\nè¾“å…¥: [2,2,1]è¾“å‡º: 1\nç¤ºä¾‹ 2:\nè¾“å…¥: [4,1,2,1,2]è¾“å‡º: 4\né¢˜è§£/** * å¼‚åŸŸä¸­åŒä½å¦‚æœå€¼ç›¸åŒï¼ˆéƒ½æ˜¯0æˆ–è€…éƒ½æ˜¯1ï¼‰åˆ™ä¸º0ï¼Œä¸åŒï¼ˆä¸€ä¸ªæ˜¯0ï¼Œä¸€ä¸ªæ˜¯1ï¼‰ä¸º1 * 5    0 0 0 1 0 1 * 3    0 0 0 0 1 1 * 5^3  0 0 0 1 1 0 * * å·²çŸ¥ä»»ä½•æ•°aä¸0å¼‚æˆ–å¾—åˆ°è¯¥æ•°   a^0=a *     ä»»ä½•æ•°aä¸aå¼‚æˆ–å¾—0      a^a=0 * å¼‚æˆ–æ“ä½œæ»¡è¶³äº¤æ¢å¾‹å’Œç»“åˆå¾‹    a^b^a=(a^a)^b=0^b=b * é€šè¿‡äº¤æ¢å¾‹å°†å‡ºç°ä¸€æ¬¡çš„æ•´æ•°ç§»åˆ°æ•°ç»„æœ«å°¾ï¼Œ * ä¸æ–­è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œå°†ä¸€ç›´å¾—åˆ°0ï¼Œæœ€åå¾—åˆ°çš„å€¼å°±æ˜¯å”¯ä¸€å‡ºç°ä¸€æ¬¡çš„å€¼ * @param nums * @return */public int singleNumber(int[] nums) &#123;    int res = 0;    for(int num : nums)&#123;        res ^=num;    &#125;    return res;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","ä½è¿ç®—"]},{"title":"191. ä½1çš„ä¸ªæ•°","url":"/java4u/2021/08/17/191.%20%E4%BD%8D1%E7%9A%84%E4%B8%AA%E6%95%B0/","content":"191. ä½1çš„ä¸ªæ•°ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼ˆä»¥äºŒè¿›åˆ¶ä¸²çš„å½¢å¼ï¼‰ï¼Œè¿”å›å…¶äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­æ•°å­—ä½æ•°ä¸º â€˜1â€™ çš„ä¸ªæ•°ï¼ˆä¹Ÿè¢«ç§°ä¸ºæ±‰æ˜é‡é‡ï¼‰ã€‚\næç¤ºï¼š\nè¯·æ³¨æ„ï¼Œåœ¨æŸäº›è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ä¸­ï¼Œæ²¡æœ‰æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½å°†è¢«æŒ‡å®šä¸ºæœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå¹¶ä¸”ä¸åº”å½±å“æ‚¨çš„å®ç°ï¼Œå› ä¸ºæ— è®ºæ•´æ•°æ˜¯æœ‰ç¬¦å·çš„è¿˜æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶å†…éƒ¨çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼éƒ½æ˜¯ç›¸åŒçš„ã€‚åœ¨ Java ä¸­ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç è®°æ³•æ¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ ç¤ºä¾‹ 3 ä¸­ï¼Œè¾“å…¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•° -3ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼š00000000000000000000000000001011è¾“å‡ºï¼š3è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000000001011 ä¸­ï¼Œå…±æœ‰ä¸‰ä½ä¸º â€˜1â€™ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼š00000000000000000000000010000000è¾“å‡ºï¼š1è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000010000000 ä¸­ï¼Œå…±æœ‰ä¸€ä½ä¸º â€˜1â€™ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼š11111111111111111111111111111101è¾“å‡ºï¼š31è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 11111111111111111111111111111101 ä¸­ï¼Œå…±æœ‰ 31 ä½ä¸º â€˜1â€™ã€‚\næç¤ºï¼š\nè¾“å…¥å¿…é¡»æ˜¯é•¿åº¦ä¸º 32 çš„ äºŒè¿›åˆ¶ä¸² ã€‚\nè¿›é˜¶ï¼š\nå¦‚æœå¤šæ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ\né¢˜è§£/** * æˆ‘ä»¬åªéœ€è¦è®©è¿™ä¸ªæ©ç æ¯æ¬¡å‘å·¦ç§»åŠ¨ä¸€ä½ï¼Œç„¶åä¸ç›®æ ‡å€¼æ±‚â€œ&amp;â€ï¼Œå°±å¯ä»¥åˆ¤æ–­ç›®æ ‡å€¼çš„å½“å‰ä½æ˜¯ä¸æ˜¯1 * æ¯”å¦‚21çš„äºŒè¿›åˆ¶    00010101   ç§»åˆ°æ©ç å’Œå½“å‰ä½è¿›è¡Œè®¡ç®— *     00010101 *     00000001 * *     00010101 *     00000010 * *     00010101 *     00000100 * è¿™é‡Œåˆ¤æ–­ n&amp;mask çš„æ—¶å€™ï¼Œåƒä¸‡ä¸è¦é”™å†™æˆ (n&amp;mask) == 1ï¼Œå› ä¸ºè¿™é‡Œä½ å¯¹æ¯”çš„æ˜¯åè¿›åˆ¶æ•° * @param n * @return */public int hammingWeight(int n) &#123;    int result = 0;    //åˆå§‹åŒ–æ©ç ä¸º1    int mask = 1;    for (int i = 0; i &lt; 32; i++) &#123;        //å¯¹æ¯”çš„æ˜¯åè¿›åˆ¶æ•°,ä¸ä¸º0å°±è¡¨ç¤ºå½“å‰ä½ä¸º1        if ((n &amp; mask) != 0) &#123;            result++;        &#125;        mask = mask &lt;&lt; 1;    &#125;    return result;&#125;/** * å¯¹äºä»»æ„ä¸€ä¸ªæ•°ï¼Œå°† n å’Œ n-1 è¿›è¡Œ &amp; è¿ç®—ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŠŠ n ä¸­æœ€ä½ä½çš„ 1 å˜æˆ 0 * 31     0011111 * 30     0011110 * 31&amp;30  0011110 * * 28     0011100 * 27     0011011 * 28&amp;27  0011000 * ä¸æ–­è¿›è¡Œæ“ä½œå³å¯ */public int hammingWeight2(int n) &#123;    int res = 0;    //è€ƒè™‘è´Ÿæ•°è¡¥ç çš„é—®é¢˜    while (n != 0)&#123;        n = n &amp; (n-1);        res++;    &#125;    return res;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","ä½è¿ç®—"]},{"title":"JVM","url":"/java4u/2021/08/16/2.jvm/","content":"1ã€jvmè°ƒä¼˜ï¼š\\1. è°ƒä¼˜æ—¶æœºï¼š\na. heap å†…å­˜ï¼ˆâ½¼å¹´ä»£ï¼‰æŒç»­ä¸Šæ¶¨è¾¾åˆ°è®¾ç½®çš„æœ€â¼¤å†…å­˜å€¼ï¼›\nb. Full GC æ¬¡æ•°é¢‘ç¹ï¼›\nc. GC åœé¡¿æ—¶é—´è¿‡â»“ï¼ˆè¶…è¿‡1ç§’ï¼‰ï¼›\nd. åº”â½¤å‡ºç°OutOfMemory ç­‰å†…å­˜å¼‚å¸¸ï¼›\ne. åº”â½¤ä¸­æœ‰ä½¿â½¤æœ¬åœ°ç¼“å­˜ä¸”å â½¤â¼¤é‡å†…å­˜ç©ºé—´ï¼›\nf. ç³»ç»Ÿååé‡ä¸å“åº”æ€§èƒ½ä¸â¾¼æˆ–ä¸‹é™ã€‚\n\\2. è°ƒä¼˜åŸåˆ™ï¼š\na. å¤šæ•°çš„Javaåº”â½¤ä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿›â¾JVMä¼˜åŒ–ï¼›\nb. å¤šæ•°å¯¼è‡´GCé—®é¢˜çš„Javaåº”â½¤ï¼Œéƒ½ä¸æ˜¯å› ä¸ºæˆ‘ä»¬å‚æ•°è®¾ç½®é”™è¯¯ï¼Œâ½½æ˜¯ä»£ç é—®é¢˜ï¼›\nc. åœ¨åº”â½¤ä¸Šçº¿ä¹‹å‰ï¼Œå…ˆè€ƒè™‘å°†æœºå™¨çš„JVMå‚æ•°è®¾ç½®åˆ°æœ€ä¼˜ï¼ˆæœ€é€‚åˆï¼‰ï¼›\nd. å‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼›\ne. å‡å°‘ä½¿â½¤å…¨å±€å˜é‡å’Œâ¼¤å¯¹è±¡ï¼›\nf. JVMä¼˜åŒ–æ˜¯åˆ°æœ€åä¸å¾—å·²æ‰é‡‡â½¤çš„â¼¿æ®µï¼›\ng. åœ¨å®é™…ä½¿â½¤ä¸­ï¼Œåˆ†æGCæƒ…å†µä¼˜åŒ–ä»£ç â½ä¼˜åŒ–JVMå‚æ•°æ›´å¥½ï¼›\n\\3. è°ƒä¼˜â½¬æ ‡ï¼š\na. GCä½åœé¡¿ï¼›\nb. GCä½é¢‘ç‡ï¼›\nc. ä½å†…å­˜å â½¤ï¼›\nd. â¾¼ååé‡ï¼›\n\\4. è°ƒä¼˜æ­¥éª¤ï¼š\na. åˆ†æGCâ½‡å¿—åŠdumpâ½‚ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–ï¼Œç¡®å®šç“¶é¢ˆé—®é¢˜ç‚¹ï¼›\nb. ç¡®å®šjvmè°ƒä¼˜é‡åŒ–â½¬æ ‡ï¼›\nc. ç¡®å®šjvmè°ƒä¼˜å‚æ•°ï¼ˆæ ¹æ®å†å²jvmå‚æ•°æ¥è°ƒæ•´ï¼‰ï¼›\nd. è°ƒä¼˜â¼€å°æœåŠ¡å™¨ï¼Œå¯¹â½è§‚å¯Ÿè°ƒä¼˜å‰åçš„å·®å¼‚ï¼›\ne. ä¸æ–­çš„åˆ†æå’Œè°ƒæ•´ï¼ŒçŸ¥é“æ‰¾åˆ°åˆé€‚çš„jvmå‚æ•°é…ç½®ï¼›\nf. æ‰¾åˆ°æœ€åˆé€‚çš„å‚æ•°ï¼Œå°†è¿™äº›å‚æ•°åº”â½¤åˆ°æ‰€æœ‰æœåŠ¡å™¨ï¼Œå¹¶è¿›â¾åç»­è·Ÿè¸ªã€‚\n2ã€jvmè°ƒä¼˜å‚æ•°ï¼š\\1. è®¾å®šå †å†…å­˜â¼¤â¼©ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„ã€‚\n\\2. -Xmsï¼šå¯åŠ¨JVMæ—¶çš„å †å†…å­˜ç©ºé—´ã€‚\n\\3. -Xmxï¼šå †å†…å­˜æœ€â¼¤é™åˆ¶ã€‚\n\\4. è®¾å®šæ–°â½£ä»£â¼¤â¼©ã€‚\n\\5. æ–°â½£ä»£ä¸å®œå¤ªâ¼©ï¼Œå¦åˆ™ä¼šæœ‰â¼¤é‡å¯¹è±¡æ¶Œâ¼Šâ½¼å¹´ä»£ã€‚\n\\6. -XX:NewRatioï¼šæ–°â½£ä»£å’Œâ½¼å¹´ä»£çš„å â½ã€‚\n\\7. -XX:NewSizeï¼šæ–°â½£ä»£ç©ºé—´ã€‚\n\\8. -XX:SurvivorRatioï¼šä¼Šç”¸å›­ç©ºé—´å’Œå¹¸å­˜è€…ç©ºé—´çš„å â½ã€‚\n\\9. -XX:MaxTenuringThresholdï¼šå¯¹è±¡è¿›â¼Šâ½¼å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ã€‚\n\\10. è®¾å®šåƒåœ¾å›æ”¶å™¨\nå¹´è½»ä»£ï¼š-XX:+UseParNewGCã€‚\nâ½¼å¹´ä»£ï¼š-XX:+UseConcMarkSweepGCã€‚\nCMSå¯ä»¥å°†STWæ—¶é—´é™åˆ°æœ€ä½ï¼Œä½†æ˜¯ä¸å¯¹å†…å­˜è¿›â¾å‹ç¼©ï¼Œæœ‰å¯èƒ½å‡ºç°â€œå¹¶â¾æ¨¡å¼å¤±è´¥â€ã€‚â½å¦‚â½¼å¹´ä»£ç©ºé—´è¿˜æœ‰300MBç©ºé—´ï¼Œä½†æ˜¯â¼€äº›10MBçš„å¯¹è±¡â½†æ³•è¢«é¡ºåºçš„å­˜å‚¨ã€‚è¿™æ—¶å€™ä¼šè§¦å‘å‹ç¼©å¤„ç†ï¼Œä½†æ˜¯CMS GCæ¨¡å¼ä¸‹çš„å‹ç¼©å¤„ç†æ—¶é—´è¦â½Parallel GCâ»“å¾ˆå¤šã€‚G1é‡‡â½¤â€æ ‡è®°-æ•´ç†â€œç®—æ³•ï¼Œè§£å†³äº†å†…å­˜ç¢â½šé—®é¢˜ï¼Œå»ºâ½´äº†å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´ç±»å‹ï¼Œèƒ½è®©ä½¿â½¤è€…æŒ‡å®šåœ¨â¼€ä¸ªâ»“åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ã€‚\n3ã€è§¦å‘full gcçš„åœºæ™¯åŠåº”å¯¹ç­–ç•¥ï¼š\\1. System.gc()â½…æ³•çš„è°ƒâ½¤ï¼Œåº”å¯¹ç­–ç•¥ï¼šé€šè¿‡-XX:+DisableExplicitGCæ¥ç¦â½Œè°ƒâ½¤System.gc ;\n\\2. â½¼å¹´ä»£ä»£ç©ºé—´ä¸â¾œï¼Œåº”å¯¹ç­–ç•¥ï¼šè®©å¯¹è±¡åœ¨Minor GCé˜¶æ®µè¢«å›æ”¶ï¼Œè®©å¯¹è±¡åœ¨æ–°â½£ä»£å¤šå­˜æ´»â¼€æ®µæ—¶é—´ï¼Œä¸è¦åˆ›å»ºè¿‡â¼¤çš„å¯¹è±¡åŠæ•°ç»„;\n\\3. æ°¸â½£åŒºç©ºé—´ä¸â¾œï¼Œåº”å¯¹ç­–ç•¥ï¼šå¢â¼¤PermGenç©ºé—´ï¼›\n\\4. GCæ—¶å‡ºç°promotionfailedå’Œconcurrent mode failureï¼Œåº”å¯¹ç­–ç•¥ï¼šå¢â¼¤survivor spaceï¼›\n\\5. Minor GCåæ™‹å‡åˆ°æ—§â½£ä»£çš„å¯¹è±¡â¼¤â¼©â¼¤äºâ½¼å¹´ä»£çš„å‰©ä½™ç©ºé—´ï¼Œåº”å¯¹ç­–ç•¥ï¼šå¢â¼¤Tenured space æˆ–ä¸‹è°ƒCMSInitiatingOccupancyFraction&#x3D;60ï¼›\n\\6. å†…å­˜æŒç»­å¢æ¶¨è¾¾åˆ°ä¸Šé™å¯¼è‡´Full GCï¼Œåº”å¯¹ç­–ç•¥ï¼šé€šè¿‡dumpheap åˆ†ææ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ã€‚\n4ã€å¦‚ä½•æŸ¥çœ‹jvmå†…å­˜ä½¿â½¤æƒ…å†µï¼šå¯ä»¥ä½¿â½¤JDKâ¾ƒå¸¦çš„JConsoleã€JVisualVMã€JMapã€JHatç­‰â¼¯å…·ï¼Œæˆ–è€…ä½¿â½¤ç¬¬ä¸‰â½…â¼¯å…·ï¼Œâ½å¦‚ Eclipse Memory Analyzer\n5ã€jvmä¸­å“ªäº›åœ°â½…ä¼šå‡ºç°oomï¼Ÿåˆ†åˆ«è¯´è¯´oomçš„å¯èƒ½åŸå› ï¼Ÿ1. javaå †æº¢å‡ºï¼ˆheapï¼‰ï¼ša. Javaå †å†…å­˜ä¸»è¦â½¤æ¥å­˜æ”¾è¿â¾è¿‡ç¨‹ä¸­æ‰€ä»¥çš„å¯¹è±¡ï¼Œè¯¥åŒºåŸŸOOMå¼‚å¸¸â¼€èˆ¬ä¼šæœ‰å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š\njava.lang.OutofMemoryError:Java heap space\nb. æ­¤ç±»é”™è¯¯â¼€èˆ¬é€šè¿‡Eclipse Memory Analyzeråˆ†æOOMæ—¶dumpçš„å†…å­˜å¿«ç…§å°±èƒ½åˆ†æå‡ºæ¥ï¼Œåˆ°åº•æ˜¯ç”±äºç¨‹åºåŸå› å¯¼è‡´çš„å†…å­˜æ³„éœ²ï¼Œè¿˜æ˜¯ç”±äºæ²¡æœ‰ä¼°è®¡å¥½JVMå†…å­˜çš„â¼¤â¼©â½½å¯¼è‡´çš„å†…å­˜æº¢å‡ºã€‚\nc. å¦å¤–ï¼ŒJavaå †å¸¸â½¤çš„JVMå‚æ•°ï¼š\n1 -Xmsï¼šåˆå§‹å †â¼¤â¼©ï¼Œé»˜è®¤å€¼ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;64(&lt;1GB)ï¼Œé»˜è®¤(MinHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜â¼©äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢â¼¤å †ç›´åˆ°\n2 -Xmxï¼šæœ€â¼¤å †â¼¤â¼©ï¼Œé»˜è®¤å€¼ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;4(&lt;1GB)ï¼Œé»˜è®¤(MaxHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜â¼¤äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ°\n3 -Xmnï¼šå¹´è½»ä»£â¼¤â¼©(1.4or lator)ï¼Œæ­¤å¤„çš„â¼¤â¼©æ˜¯ï¼ˆeden + 2 survivor space)ï¼Œä¸jmap -heapä¸­æ˜¾ç¤ºçš„New genæ˜¯ä¸åŒçš„ã€‚\n2. æ ˆæº¢å‡ºï¼ˆstackï¼‰ï¼ša. æ ˆâ½¤æ¥å­˜å‚¨çº¿ç¨‹çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€â½…æ³•å‡ºâ¼ç­‰ä¿¡æ¯ã€‚å¦‚æœè¯·æ±‚æ ˆçš„æ·±åº¦ä¸â¾œæ—¶æŠ›å‡ºçš„é”™è¯¯ä¼šåŒ…å«ç±»ä¼¼ä¸‹â¾¯çš„ä¿¡æ¯ï¼š\n1 java.lang.StackOverflowErrorã€‚\nb. å¦å¤–ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹å çš„å†…å­˜â¼¤æ¦‚ä¸º1Mï¼Œå› æ­¤çº¿ç¨‹çš„åˆ›å»ºä¹Ÿéœ€è¦å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»Ÿå¯â½¤å†…å­˜-Xmx-MaxPermSizeå³æ˜¯æ ˆå¯â½¤çš„å†…å­˜ï¼Œå¦‚æœç”³è¯·åˆ›å»ºçš„çº¿ç¨‹â½è¾ƒå¤šè¶…è¿‡å‰©ä½™å†…å­˜çš„æ—¶å€™ï¼Œä¹Ÿä¼šæŠ›å‡ºå¦‚ä¸‹ç±»ä¼¼é”™è¯¯ï¼šjava.lang.OutofMemoryError: unable to create new native thread\nc. ç›¸å…³çš„JVMå‚æ•°æœ‰ï¼š\n1 -Xss: æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆâ¼¤â¼©,JDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆâ¼¤â¼©ä¸º1M,ä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆâ¼¤â¼©ä¸º256K. \n2 åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹,å‡â¼©è¿™ä¸ªå€¼èƒ½â½£æˆæ›´å¤šçš„çº¿ç¨‹.ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹â¼€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„,ä¸èƒ½â½†é™â½£æˆ,ç»éªŒå€¼åœ¨3000~5000\nd. å¯èƒ½åŸå› ï¼š\ni. é€’å½’ï¼šé€’å½’â¾¥â½¤åˆ°çš„å±€éƒ¨å˜é‡å­˜å‚¨åœ¨å †æ ˆä¸­ï¼Œå †æ ˆçš„è®¿é—®æ•ˆç‡â¾¼ï¼Œé€Ÿåº¦å¿«ï¼Œä½†ç©ºé—´æœ‰é™ï¼Œé€’å½’å¤ªå¤šå˜é‡éœ€è¦â¼€ç›´â¼Šæ ˆâ½½ä¸å‡ºæ ˆï¼Œå¯¼è‡´éœ€è¦çš„å†…å­˜ç©ºé—´â¼¤äºå †æ ˆçš„ç©ºé—´ï¼Œæ ˆç©ºé—´æ˜¯2Mï¼Œå †ç©ºé—´å†…å­˜ç©ºé—´ã€‚\n3. è¿â¾æ—¶å¸¸é‡æº¢å‡ºï¼ˆconstantï¼‰ï¼ša. è¿â¾æ—¶å¸¸é‡ä¿å­˜åœ¨â½…æ³•åŒºï¼Œå­˜æ”¾çš„ä¸»è¦æ˜¯ç¼–è¯‘å™¨â½£æˆçš„å„ç§å­—â¾¯é‡å’Œç¬¦å·å¼•â½¤ï¼Œä½†æ˜¯è¿â¾æœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾â¼Šæ± ä¸­ï¼Œâ½å¦‚Stringç±»çš„internâ½…æ³•ã€‚å¦‚æœè¯¥åŒºåŸŸOOMï¼Œé”™è¯¯ç»“æœä¼šåŒ…å«ç±»ä¼¼ä¸‹â¾¯çš„ä¿¡æ¯ï¼š\n1 java.lang.OutofMemoryError: PermGen space\nb. ç›¸å…³çš„JVMå‚æ•°æœ‰ï¼š\n1 -XX:PermSizeï¼šè®¾ç½®æŒä¹…ä»£(perm gen)åˆå§‹å€¼ï¼Œé»˜è®¤å€¼ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;64\n2 -XX:MaxPermSizeï¼šè®¾ç½®æŒä¹…ä»£æœ€â¼¤å€¼ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;4\n4. â½…æ³•åŒºæº¢å‡ºï¼ša. â½…æ³•åŒºä¸»è¦å­˜å‚¨è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¦‚ç±»åã€è®¿é—®ä¿®é¥°ç¬¦ã€å¸¸é‡æ± ã€å­—æ®µæè¿°ã€â½…æ³•æè¿°ç­‰ã€‚ç†è®ºä¸Šåœ¨JVMå¯åŠ¨åè¯¥åŒºåŸŸâ¼¤â¼©åº”è¯¥â½è¾ƒç¨³å®šï¼Œä½†æ˜¯â½¬å‰å¾ˆå¤šæ¡†æ¶ï¼Œâ½å¦‚Springå’ŒHibernateç­‰åœ¨è¿â¾è¿‡ç¨‹ä¸­éƒ½ä¼šåŠ¨æ€â½£æˆç±»ï¼Œå› æ­¤ä¹Ÿå­˜åœ¨OOMçš„â»›é™©ã€‚å¦‚æœè¯¥åŒºåŸŸOOMï¼Œé”™è¯¯ç»“æœä¼šåŒ…å«ç±»ä¼¼ä¸‹â¾¯çš„ä¿¡æ¯ï¼š1 java.lang.OutofMemoryError: PermGen space\nb. ç›¸å…³çš„JVMå‚æ•°æœ‰ï¼š\n1 -XX:PermSizeï¼šè®¾ç½®æŒä¹…ä»£(perm gen)åˆå§‹å€¼ï¼Œé»˜è®¤å€¼ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;64\n2 -XX:MaxPermSizeï¼šè®¾ç½®æŒä¹…ä»£æœ€â¼¤å€¼ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;4\n6ã€synchronizedå’ŒReentrantLockçš„å®ç°æœºåˆ¶ï¼Ÿsynchronizedâ½¤çš„é”æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´â¾¥çš„\nä¸€ã€‚synchronizedå±äºç‹¬å å¼æ‚²è§‚é”é€šè¿‡JVMéšå¼å®ç°ï¼Œåªå…è®¸åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œèµ„æºã€‚\nJavaä¸­æ¯ä¸ªå¯¹è±¡éƒ½éšå¼åŒ…å«ä¸€ä¸ªmonitorï¼ˆç›‘è§†å™¨ï¼‰å¯¹è±¡åŠ é”çš„è¿‡ç¨‹å…¶å®å°±æ˜¯ç«äº‰monitorçš„è¿‡ç¨‹ï¼Œå½“çº¿ç¨‹è¿›å…¥å­—èŠ‚ç monitiorenteræŒ‡ä»¤åçº¿ç¨‹å°†æŒæœ‰monitorå¯¹è±¡ï¼Œæ‰§è¡Œmonitorexitæ—¶é‡Šæ”¾monitorå¯¹è±¡å½“å…¶ä»–çº¿ç¨‹æ²¡æœ‰æ‹¿åˆ°monitorå¯¹è±¡æ—¶ï¼Œåˆ™éœ€è¦é˜»å¡ç­‰å¾…è·å–è¯¥å¯¹è±¡ã€‚\näºŒã€‚ReentrantLockæ˜¯Lockçš„é»˜è®¤å®ç°æ–¹å¼ä¹‹ä¸€\næ˜¯åŸºäºAQS(Abstrack Queued Synchronizer,é˜Ÿåˆ—åŒæ­¥å™¨) å®ç°çš„é»˜è®¤æ˜¯é€šè¿‡éå…¬å¹³é”å®ç°çš„ï¼Œå®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªstateçš„çŠ¶æ€å­—æ®µç”¨äºè¡¨ç¤ºé”æ˜¯å¦è¢«å ç”¨ï¼Œå¦‚æœ0åˆ™è¡¨ç¤ºé”æœªè¢«å ç”¨ï¼Œæ­¤æ—¶çº¿ç¨‹å°±å¯ä»¥å§stateæ”¹ä¸º1ï¼Œå¹¶æˆåŠŸè·å¾—é”è€Œå…¶ä»–æœªè·å¾—é”çš„çº¿ç¨‹åªèƒ½å»æ’é˜Ÿç­‰å¾…è·å–èµ„æº\né”å‡çº§ï¼šé”å‡çº§å°±æ˜¯ä»åå‘é”åˆ°è½»é‡çº§é”å†åˆ°é‡é‡çº§é”å‡çº§çš„è¿‡ç¨‹ ï¼Œè¿™æ˜¯JDK1.6æä¾›çš„ä¼˜åŒ–åŠŸèƒ½ï¼Œä¹Ÿç§°ä¹‹ä¸ºé”è†¨èƒ€ã€‚åå‘é”ï¼šæŒ‡åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹è®¾ç½®çš„ä¸€ç§é”çŠ¶æ€ï¼Œæ„æ€æ˜¯ä»–ä¼šåå‘äºç¬¬ä¸€ä¸ªè·å–å®ƒçš„çº¿ç¨‹ï¼Œå½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«è·å–åˆ°ä¹‹åï¼Œä¼šåœ¨æ­¤å¯¹è±¡å¤´ä¸­è®¾ç½®æ ‡ç¤ºä¸ºâ€œ01â€,æ ‡ç¤ºåå‘é”æ¨¡å¼ï¼Œå¹¶ä¸”åœ¨å¯¹è±¡å¤´ä¸­è®°å½•æ­¤çº¿ç¨‹çš„IDåå‘é”å¯ä»¥æé«˜å¸¦æœ‰åŒæ­¥ï¼Œä½†æ— ç«äº‰çš„ç¨‹åºæ€§èƒ½ï¼Œä½†å¦‚æœåœ¨å¤šæ•°é”æ€»ä¼šè¢«ä¸åŒçš„çº¿ç¨‹è®¿é—®æ—¶ï¼Œåå‘é”æ¨¡å¼å°±æ¯”è¾ƒå¤šä½™äº†\nåœ¨jdk1.6ä¹‹å‰ï¼Œsynchronizedæ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿçš„äº’æ–¥é‡ï¼ˆmutex lockï¼‰æ¥å®ç°çš„ï¼Œè¿™ç§å®ç°æ–¹å¼éœ€è¦å†ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€ä¹‹é—´åšè½¬æ¢ï¼Œæœ‰å¾ˆå¤§çš„æ€§èƒ½æ¶ˆè€—ï¼Œè¿™ç§ä¼ ç»Ÿå®ç°é”çš„æ–¹å¼è¢«ç§°ä¹‹ä¸ºé‡é‡é”ã€‚è½»é‡é”æ˜¯é€šè¿‡æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCASï¼ŒCompare and Swapï¼‰ æ¥å®ç°çš„ å®ƒå¯¹æ¯”çš„æ˜¯çº¿ç¨‹å’Œå¯¹è±¡çš„MarkWord(å¯¹è±¡å¤´ä¸­çš„ä¸€ä¸ªåŒºåŸŸ)ï¼Œå¦‚æœæ›´æ–°æˆåŠŸåˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹æˆåŠŸæ‹¥æœ‰æ­¤é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè™šæ‹Ÿæœºä¼šå…ˆæ£€æŸ¥å¯¹è±¡çš„MarkWordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹æ ˆå¸§ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰æ­¤é”ï¼Œå¦åˆ™ï¼Œåˆ™è¯´æ˜æ­¤é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹å ç”¨ã€‚\n","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"231. 2 çš„å¹‚","url":"/java4u/2021/08/16/231.%202%20%E7%9A%84%E5%B9%82/","content":"231. 2 çš„å¹‚ç»™ä½ ä¸€ä¸ªæ•´æ•° nï¼Œè¯·ä½ åˆ¤æ–­è¯¥æ•´æ•°æ˜¯å¦æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚\nå¦‚æœå­˜åœ¨ä¸€ä¸ªæ•´æ•° x ä½¿å¾— n &#x3D;&#x3D; 2^x ï¼Œåˆ™è®¤ä¸º n æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šn &#x3D; 1è¾“å‡ºï¼štrueè§£é‡Šï¼š2^0 &#x3D; 1\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šn &#x3D; 16è¾“å‡ºï¼štrueè§£é‡Šï¼š2^4 &#x3D; 16\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šn &#x3D; 3è¾“å‡ºï¼šfalseç¤ºä¾‹ 4ï¼š\nè¾“å…¥ï¼šn &#x3D; 4è¾“å‡ºï¼štrue\nç¤ºä¾‹ 5ï¼š\nè¾“å…¥ï¼šn &#x3D; 5è¾“å‡ºï¼šfalse\næç¤ºï¼š\n-2^31 &lt;&#x3D; n &lt;&#x3D; 2^31 - 1\nè¿›é˜¶ï¼šä½ èƒ½å¤Ÿä¸ä½¿ç”¨å¾ªç¯&#x2F;é€’å½’è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ\né¢˜è§£/** * è§‚å¯Ÿ2çš„å¹‚æ¬¡æ•°ï¼Œé™¤äº†æœ€é«˜ä½éƒ½æ˜¯0 * 1        1 * 2       10 * 4      100 * 8     1000 * 16   10000 * * å¯¹åº”å¹‚æ¬¡æ•°å‡å»1çš„æ•° * 0        0 * 1        1 * 3       11 * 7      111 * 15    1111 * * 2ç»„æ•°æ±‚ä½è¿ç®— *       1 &amp; 0 = 0 *      10 &amp; 01 = 00 *     100 &amp; 011 = 000 *    1000 &amp; 0111 = 0000 *   10000 &amp; 01111 = 00000 * * å¯¹äºNä¸º2çš„å¹‚çš„æ•°ï¼Œéƒ½æœ‰ N&amp;(N-1)==0 * @param n * @return */public boolean isPowerOfTwo(int n) &#123;    if(n &lt; 1)return false;    return (n&amp;(n-1))==0;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","ä½è¿ç®—"]},{"title":"è¿ç»­nä¸ªæ•°çš„å’Œ","url":"/java4u/2021/08/16/%E8%BF%9E%E7%BB%ADn%E4%B8%AA%E6%95%B0%E7%9A%84%E5%92%8C/","content":"è¿ç»­nä¸ªæ•°çš„å’Œæ±‚ 1 2 â€¦ n ï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨ä¹˜é™¤æ³•ã€forã€whileã€ifã€elseã€switchã€caseç­‰å…³é”®å­—åŠæ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆA?B:Cï¼‰ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥: n &#x3D; 3 è¾“å‡º: 6\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥: n &#x3D; 9 è¾“å‡º: 45\né™åˆ¶ï¼š\n1 &lt;&#x3D; n &lt;&#x3D; 10000\né¢˜è§£/** * è¿ç»­åŠ åˆå¯ä»¥ä½¿ç”¨é€’å½’ * &amp;&amp;çš„ç‰¹æ€§,A&amp;&amp;B * å¦‚æœAä¸ºtrueï¼Œè¿”å›Bçš„å¸ƒå°”å€¼ï¼ˆç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼‰ * å¦‚æœAä¸ºfalseï¼Œç›´æ¥è¿”å›falseï¼ˆç›¸å½“äºçŸ­è·¯ï¼‰ * @param n * @return */public int sumNums(int n) &#123;    System.out.println(&quot;start:&quot;+n);    boolean b = n &gt; 0 &amp;&amp; ((n  += sumNums(n - 1)) &gt; 0);    System.out.println(&quot;end:&quot;+n);    return n;&#125;/** * n(n+1)/2 * @param n * @return */public int sumNums2(int n) &#123;    return ((int)(Math.pow(n, 2)+n)&gt;&gt;1);&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","ä½è¿ç®—"]},{"title":"å‰‘æŒ‡ Offer 57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—","url":"/java4u/2021/08/12/%E5%89%91%E6%8C%87%20Offer%2057%20-%20II.%20%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97/","content":"å‰‘æŒ‡ Offer 57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•° target ï¼Œè¾“å‡ºæ‰€æœ‰å’Œä¸º target çš„è¿ç»­æ­£æ•´æ•°åºåˆ—ï¼ˆè‡³å°‘å«æœ‰ä¸¤ä¸ªæ•°ï¼‰ã€‚\nåºåˆ—å†…çš„æ•°å­—ç”±å°åˆ°å¤§æ’åˆ—ï¼Œä¸åŒåºåˆ—æŒ‰ç…§é¦–ä¸ªæ•°å­—ä»å°åˆ°å¤§æ’åˆ—ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼štarget &#x3D; 9è¾“å‡ºï¼š[[2,3,4],[4,5]]\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼štarget &#x3D; 15è¾“å‡ºï¼š[[1,2,3,4,5],[4,5,6],[7,8]]\né™åˆ¶ï¼š\n1 &lt;&#x3D; target &lt;&#x3D; 10^5\né¢˜è§£/** * ç»´æŒä¸€ä¸ªæ»‘åŠ¨çš„çª—å£ï¼Œå°äºç›®æ ‡å€¼å°±å³ç§»å³æŒ‡é’ˆï¼Œå¤§äºç›®æ ‡å€¼å°±å³ç§»å·¦æŒ‡é’ˆ * æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå°±è®°å½•ä»å·¦åˆ°å³çš„å€¼ï¼Œä¹‹åå·¦ç§»å·¦æŒ‡é’ˆï¼Œå¾ªç¯æ“ä½œ * å¯¹äºä»»æ„ä¸€ä¸ªæ­£æ•´æ•°ï¼Œæ€»æ˜¯å°äºå®ƒçš„ä¸­å€¼ä¸ä¸­å€¼+1çš„å’Œï¼Œå½“å·¦æŒ‡é’ˆå¤§äºç›®æ ‡å€¼ä¸€åŠæ—¶ï¼Œåœæ­¢æ“ä½œ * @param target * @return */public int[][] findContinuousSequence(int target) &#123;    int l = 1;    int r = 1;    //çª—å£åˆè®¡å€¼    int win = 0;    List&lt;int[]&gt; list = new ArrayList&lt;&gt;();    while (l &lt;= target/2)&#123;        if(win &lt; target)&#123;            win += r;            r++;        &#125; else if(win &gt; target)&#123;            win -= l;            l++;        &#125; else &#123;            int[] arr = new int[r-l];            for (int i = l; i &lt; r; i++) &#123;                arr[i-l] = i;            &#125;            list.add(arr);            win -= l;            l++;        &#125;    &#125;    return list.toArray(new int[list.size()][]);&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ»‘åŠ¨çª—å£"]},{"title":"438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯","url":"/java4u/2021/08/10/438.%20%E6%89%BE%E5%88%B0%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E6%89%80%E6%9C%89%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D/","content":"438. æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ pï¼Œæ‰¾åˆ° s ä¸­æ‰€æœ‰ p çš„ å¼‚ä½è¯ çš„å­ä¸²ï¼Œè¿”å›è¿™äº›å­ä¸²çš„èµ·å§‹ç´¢å¼•ã€‚ä¸è€ƒè™‘ç­”æ¡ˆè¾“å‡ºçš„é¡ºåºã€‚\nå¼‚ä½è¯ æŒ‡ç”±ç›¸åŒå­—æ¯é‡æ’åˆ—å½¢æˆçš„å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬ç›¸åŒçš„å­—ç¬¦ä¸²ï¼‰ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: s &#x3D; â€œcbaebabacdâ€, p &#x3D; â€œabcâ€è¾“å‡º: [0,6]è§£é‡Š:èµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ â€œcbaâ€, å®ƒæ˜¯ â€œabcâ€ çš„å¼‚ä½è¯ã€‚èµ·å§‹ç´¢å¼•ç­‰äº 6 çš„å­ä¸²æ˜¯ â€œbacâ€, å®ƒæ˜¯ â€œabcâ€ çš„å¼‚ä½è¯ã€‚\n ç¤ºä¾‹ 2:\nè¾“å…¥: s &#x3D; â€œababâ€, p &#x3D; â€œabâ€è¾“å‡º: [0,1,2]è§£é‡Š:èµ·å§‹ç´¢å¼•ç­‰äº 0 çš„å­ä¸²æ˜¯ â€œabâ€, å®ƒæ˜¯ â€œabâ€ çš„å¼‚ä½è¯ã€‚èµ·å§‹ç´¢å¼•ç­‰äº 1 çš„å­ä¸²æ˜¯ â€œbaâ€, å®ƒæ˜¯ â€œabâ€ çš„å¼‚ä½è¯ã€‚èµ·å§‹ç´¢å¼•ç­‰äº 2 çš„å­ä¸²æ˜¯ â€œabâ€, å®ƒæ˜¯ â€œabâ€ çš„å¼‚ä½è¯ã€‚\næç¤º:\n1 &lt;&#x3D; s.length, p.length &lt;&#x3D; 3 * 10^4s å’Œ p ä»…åŒ…å«å°å†™å­—æ¯\né¢˜è§£/** * ä½¿ç”¨mapå­˜å‚¨ç»è¿‡çš„å­—ç¬¦ * æ¯”è¾ƒ2ä¸ªmapæ˜¯å¦ç›¸ç­‰ * @param s * @param p * @return */public List&lt;Integer&gt; findAnagrams3(String s, String p) &#123;    List&lt;Integer&gt; res = new LinkedList&lt;&gt;();    int m = s.length(), n = p.length();    if (m &lt; n) return res;    Map&lt;Character, Integer&gt; s_map = new HashMap&lt;&gt;();    Map&lt;Character, Integer&gt; p_map = new HashMap&lt;&gt;();    for (int i = 0; i &lt; n; i++) &#123;        s_map.put(s.charAt(i), s_map.getOrDefault(s.charAt(i), 0) + 1);        p_map.put(p.charAt(i), p_map.getOrDefault(p.charAt(i), 0) + 1);    &#125;    for (int i = -1; i &lt; m - n; i++) &#123;        if (i &gt;= 0) &#123;            s_map.put(s.charAt(i), s_map.get(s.charAt(i)) - 1);            s_map.put(s.charAt(i + n), s_map.getOrDefault(s.charAt(i + n), 0) + 1);        &#125;        boolean isAnagrams = true;        for (Map.Entry&lt;Character, Integer&gt; entry : p_map.entrySet()) &#123;            if(s_map.containsKey(entry.getKey()))&#123;                isAnagrams = s_map.get(entry.getKey()).equals(entry.getValue());            &#125;else&#123;                isAnagrams = false;            &#125;            if (!isAnagrams) break;        &#125;        if (isAnagrams) res.add(i + 1);    &#125;    return res;&#125;/** * åˆ¤æ–­å­—æ¯å¼‚ä½è¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯çª—å£ä¸­çš„å­—æ¯å‡ºç°æ¬¡æ•°ä¸ç›®æ ‡ä¸²ä¸­çš„å­—æ¯å‡ºç°æ¬¡æ•°ä¸€è‡´ã€‚ * è¿™é‡Œå› ä¸ºå­—æ¯åªæœ‰26ä¸ªï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„æ¥æ›¿ä»£mapè¿›è¡Œå­˜å‚¨ * @param s * @param p * @return */public List&lt;Integer&gt; findAnagrams2(String s, String p) &#123;    if (s == null || p == null || s.length() &lt; p.length()) return new ArrayList&lt;&gt;();    List&lt;Integer&gt; list = new ArrayList&lt;&gt;();    int[] pArr = new int[26];    int[] sArr = new int[26];    for (int i = 0; i &lt; p.length(); i++) &#123;        sArr[s.charAt(i) - &#x27;a&#x27;]++;        pArr[p.charAt(i) - &#x27;a&#x27;]++;    &#125;    int i = 0;    int j = p.length();    // çª—å£å¤§å°å›ºå®šä¸ºpçš„é•¿åº¦    while (j &lt; s.length()) &#123;        if (isSame(pArr, sArr))            list.add(i);        //sArr[s.charAt(i) - &#x27;a&#x27;]-- åŸå·¦æŒ‡é’ˆä½ç½®å¤„å­—æ¯å‡1ï¼Œè¡¨ç¤ºå­—æ¯ç§»å‡º        sArr[s.charAt(i) - &#x27;a&#x27;]--;        i++;        //sArr[s.charAt(j) - &#x27;a&#x27;]++ åŸå³æŒ‡é’ˆä½ç½®å¤„å­—æ¯åŠ 1ï¼Œè¡¨ç¤ºå­—æ¯ç§»å…¥        sArr[s.charAt(j) - &#x27;a&#x27;]++;        j++;    &#125;    // j=s.length-1å°¾éƒ¨çš„æƒ…å†µéœ€è¦åˆ¤æ–­    if (isSame( pArr, sArr))        list.add(i);    return list;&#125;public boolean isSame(int[] arr1, int[] arr2) &#123;    for (int i = 0; i &lt; arr1.length; ++i)        if (arr1[i] != arr2[i])            return false;    return true;&#125;/** * ä½¿ç”¨mapå‚¨å­˜å­—ç¬¦çš„å‡ºç°æ¬¡æ•°ï¼ˆä¼šè¶…æ—¶ï¼‰ * @param s * @param p * @return */public List&lt;Integer&gt; findAnagrams(String s, String p) &#123;    List&lt;Integer&gt; ret = new ArrayList&lt;&gt;();    int len = s.length();    int k = p.length();    if(len &lt; k)return ret;    int l = 0;    int r = k -1;    while (r &lt; len)&#123;        //éå†å·¦æŒ‡é’ˆåˆ°å³æŒ‡é’ˆæ‰€æœ‰çš„å­—ç¬¦        String str = s.substring(l,r+1);        Map&lt;Character, Integer&gt; map = new HashMap&lt;&gt;();        for(Character c : str.toCharArray())&#123;            map.merge(c, 1, Integer::sum);        &#125;        if(isSame(map, p))&#123;            ret.add(l);        &#125;        l++;        r++;    &#125;    return ret;&#125;private boolean isSame(Map&lt;Character, Integer&gt; map, String p)&#123;    for(Character c : p.toCharArray())&#123;        if(map.get(c) == null || map.get(c) == 0)&#123;            return false;        &#125;else&#123;            map.put(c, map.get(c)-1);        &#125;    &#125;    return true;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ»‘åŠ¨çª—å£"]},{"title":"239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼","url":"/java4u/2021/08/06/239.%20%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC/","content":"239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚\nè¿”å› æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1,3,-1,-3,5,3,6,7], k &#x3D; 3è¾“å‡ºï¼š[3,3,5,5,6,7]è§£é‡Šï¼šæ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼\n---------------               -----[1  3  -1] -3  5  3  6  7       3 1 [3  -1  -3] 5  3  6  7       3 1  3 [-1  -3  5] 3  6  7       5 1  3  -1 [-3  5  3] 6  7       5 1  3  -1  -3 [5  3  6] 7       6 1  3  -1  -3  5 [3  6  7]      7\n\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1], k &#x3D; 1è¾“å‡ºï¼š[1]\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 10^5-10^4 &lt;&#x3D; nums[i] &lt;&#x3D; 10^41 &lt;&#x3D; k &lt;&#x3D; nums.length\né¢˜è§£åªè¦éå†è¯¥æ•°ç»„ï¼ŒåŒæ—¶åœ¨åŒç«¯é˜Ÿåˆ—çš„å¤´å»ç»´æŠ¤å½“å‰çª—å£çš„æœ€å¤§å€¼ï¼ˆåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå‘ç°å½“å‰å…ƒç´ æ¯”é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¤§ï¼Œå°±å°†åŸæ¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ ç¥­å¤©ï¼‰ï¼Œåœ¨æ•´ä¸ªéå†çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å†è®°å½•ä¸‹æ¯ä¸€ä¸ªçª—å£çš„æœ€å¤§å€¼åˆ°ç»“æœæ•°ç»„ä¸­ã€‚æœ€ç»ˆç»“æœæ•°ç»„å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ•´ä½“å›¾è§£å¦‚ä¸‹ã€‚\nå‡è®¾ nums &#x3D; [1,3,-1,-3,5,3,6,7]ï¼Œå’Œ k &#x3D; 3\n\n/** * éå†æ•°ç»„çš„åŒæ—¶ï¼Œåœ¨åŒç«¯é˜Ÿåˆ—çš„å¤´éƒ¨ç»´æŠ¤å½“å‰çª—å£çš„æœ€å¤§å€¼ï¼Œéå†çš„åŒæ—¶ã€‚å‘ç°å½“å‰å…ƒç´ æ¯”é˜Ÿåˆ—çš„å…ƒç´ å¤§ * å°±å°†åŸé˜Ÿåˆ—å…ƒç´ ç¥­å¤© * åœ¨åŒå‘é˜Ÿåˆ—ä¸­ç»´æŠ¤ä¸€ä¸ªä»å¤§åˆ°å°çš„æ’åºï¼ˆæ•°ç»„çš„ä¸‹æ ‡ï¼Œä¹‹åè¦é€šè¿‡ä¸‹æ ‡åˆ¤æ–­é˜Ÿé¦–æ˜¯å¦åœ¨çª—å£å†…ï¼‰ * * å‡è®¾ nums = [1,3,-1,-3,5,3,6,7]ï¼Œå’Œ k = 3 * æ•°ç»„                   åŒç«¯é˜Ÿåˆ—        RESULT * 1 3,-1,-3,5,3,6,7        1 * 1 3 -1,-3,5,3,6,7        3 * 1,3 -1 -3,5,3,6,7        3,-1        3 * 1,3,-1 -3 5,3,6,7      3,-1,-1       3,3 * 1,3,-1,-3 5 3,6,7        5           3,3,5 * 1,3,-1,-3,5 3 6,7        5,3         3,3,5,5 * 1,3,-1,-3,5,3 6 7        6           3,3,5,5,6 * 1,3,-1,-3,5,3,6 7        7           3,3,5,5,6,7 * @param nums * @param k * @return */public int[] maxSlidingWindow(int[] nums, int k) &#123;    if(nums == null || nums.length &lt; 2) return nums;    // åŒå‘é˜Ÿåˆ— ä¿å­˜å½“å‰çª—å£æœ€å¤§å€¼çš„æ•°ç»„ä½ç½® ä¿è¯é˜Ÿåˆ—ä¸­æ•°ç»„ä½ç½®çš„æ•°å€¼æŒ‰ä»å¤§åˆ°å°æ’åº    LinkedList&lt;Integer&gt; queue = new LinkedList();    // ç»“æœæ•°ç»„    int[] result = new int[nums.length-k+1];    // éå†numsæ•°ç»„    for(int i = 0;i &lt; nums.length;i++)&#123;        // ä¿è¯ä»å¤§åˆ°å° å¦‚æœå‰é¢æ•°å°åˆ™éœ€è¦ä¾æ¬¡å¼¹å‡ºï¼Œç›´è‡³æ»¡è¶³è¦æ±‚        while(!queue.isEmpty() &amp;&amp; nums[queue.peekLast()] &lt;= nums[i])&#123;            queue.pollLast();        &#125;        // æ·»åŠ å½“å‰å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡        queue.addLast(i);        // åˆ¤æ–­å½“å‰é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„å€¼æ˜¯å¦æœ‰æ•ˆ        if(queue.peek() &lt;= i-k)&#123;            queue.poll();        &#125;        // å½“çª—å£é•¿åº¦ä¸ºkæ—¶ ä¿å­˜å½“å‰çª—å£ä¸­æœ€å¤§å€¼        if(i+1 &gt;= k)&#123;            result[i+1-k] = nums[queue.peek()];        &#125;    &#125;    return result;&#125;public int[] maxSlidingWindow2(int[] nums, int k) &#123;    int n = nums.length;    Deque&lt;Integer&gt; deque = new LinkedList&lt;Integer&gt;();    for (int i = 0; i &lt; k; ++i) &#123;        while (!deque.isEmpty() &amp;&amp; nums[i] &gt;= nums[deque.peekLast()]) &#123;            deque.pollLast();        &#125;        deque.offerLast(i);    &#125;    int[] ans = new int[n - k + 1];    ans[0] = nums[deque.peekFirst()];    for (int i = k; i &lt; n; ++i) &#123;        while (!deque.isEmpty() &amp;&amp; nums[i] &gt;= nums[deque.peekLast()]) &#123;            deque.pollLast();        &#125;        deque.offerLast(i);        while (deque.peekFirst() &lt;= i - k) &#123;            deque.pollFirst();        &#125;        ans[i - k + 1] = nums[deque.peekFirst()];    &#125;    return ans;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ»‘åŠ¨çª—å£"]},{"title":"46. å…¨æ’åˆ—","url":"/java4u/2021/08/05/46.%20%E5%85%A8%E6%8E%92%E5%88%97/","content":"46. å…¨æ’åˆ—ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1,2,3]è¾“å‡ºï¼š[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0,1]è¾“å‡ºï¼š[[0,1],[1,0]]\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1]è¾“å‡ºï¼š[[1]]\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 6-10 &lt;&#x3D; nums[i] &lt;&#x3D; 10nums ä¸­çš„æ‰€æœ‰æ•´æ•° äº’ä¸ç›¸åŒ\né¢˜è§£List&lt;List&lt;Integer&gt;&gt; ans = new ArrayList&lt;&gt;();/** * å›æº¯å°±æ˜¯çŠ¶æ€æšä¸¾å’ŒçŠ¶æ€å¤åŸ * ä½¿ç”¨DFSå®ç°å›æº¯ * for é€‰æ‹©in é€‰æ‹©åˆ—è¡¨: *     # åšé€‰æ‹© *     å°†è¯¥é€‰æ‹©ä»é€‰æ‹©åˆ—è¡¨ç§»é™¤ *     è·¯å¾„.add(é€‰æ‹©) *     backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨) *     # æ’¤é”€é€‰æ‹© *     è·¯å¾„.remove(é€‰æ‹©) *     å°†è¯¥é€‰æ‹©å†åŠ å…¥é€‰æ‹©åˆ—è¡¨ * @param nums * @return */public List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) &#123;    dfs(nums, new ArrayList&lt;&gt;());    return ans;&#125;private void dfs(int[] nums, List&lt;Integer&gt; tmp) &#123;    System.out.println(Arrays.toString(nums) + &quot;,&quot; + tmp);    if (tmp.size() == nums.length) &#123;        ans.add(new ArrayList&lt;&gt;(tmp));    &#125; else &#123;        for (int num : nums) &#123;            //ä¸èƒ½é€‰æ‹©å·²ç»é€‰æ‹©äº†çš„æ•°å­—  æ’é™¤ä¸åˆæ³•çš„é€‰æ‹©            if (!tmp.contains(num)) &#123;                // åšé€‰æ‹©                tmp.add(num);                // è¿›å…¥ä¸‹ä¸€å±‚å†³ç­–æ ‘                dfs(nums, tmp);                //å›åˆ°ä¸Šä¸€ä½æ—¶ï¼Œæˆ‘ä»¬è¦å°±æŠŠä¸Šä¸€æ¬¡çš„é€‰æ‹©ç»“æœæ’¤é”€æ‰   å–æ¶ˆé€‰æ‹©                tmp.remove(tmp.size() - 1);            &#125;        &#125;    &#125;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å›æº¯"]},{"title":"814. äºŒå‰æ ‘å‰ªæ","url":"/java4u/2021/08/04/814.%20%E4%BA%8C%E5%8F%89%E6%A0%91%E5%89%AA%E6%9E%9D/","content":"814. äºŒå‰æ ‘å‰ªæç»™ä½ äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ root ï¼Œæ­¤å¤–æ ‘çš„æ¯ä¸ªç»“ç‚¹çš„å€¼è¦ä¹ˆæ˜¯ 0 ï¼Œè¦ä¹ˆæ˜¯ 1 ã€‚\nè¿”å›ç§»é™¤äº†æ‰€æœ‰ä¸åŒ…å« 1 çš„å­æ ‘çš„åŸäºŒå‰æ ‘ã€‚\nèŠ‚ç‚¹ node çš„å­æ ‘ä¸º node æœ¬èº«åŠ ä¸Šæ‰€æœ‰ node çš„åä»£ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šroot &#x3D; [1,null,0,0,1]è¾“å‡ºï¼š[1,null,0,null,1]è§£é‡Šï¼šåªæœ‰çº¢è‰²èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶â€œæ‰€æœ‰ä¸åŒ…å« 1 çš„å­æ ‘â€ã€‚ å³å›¾ä¸ºè¿”å›çš„ç­”æ¡ˆã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šroot &#x3D; [1,0,1,0,0,0,1]è¾“å‡ºï¼š[1,null,1,null,1]\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šroot &#x3D; [1,1,0,1,1,0,1,0]è¾“å‡ºï¼š[1,1,0,1,1,null,1]\næç¤ºï¼š\næ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [1, 200] å†…Node.val ä¸º 0 æˆ– 1\né¢˜è§£/** * è¿­ä»£èŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹å·¦å³å­æ ‘ä¸ºç©ºä¸”èŠ‚ç‚¹å€¼ä¸º0ï¼Œéœ€è¦å‰ªæ * å‰åºéå†  æ ¹åœ¨å‰ï¼Œä»å·¦å¾€å³ * ä¸­åºéå†  æ ¹åœ¨ä¸­ï¼Œä»å·¦å¾€å³ * ååºéå†  æ ¹åœ¨åï¼Œä»å·¦å¾€å³ * @param root * @return */public TreeNode pruneTree(TreeNode root) &#123;    return deal(root);&#125;private TreeNode deal(TreeNode root) &#123;    if(root == null) return null;    //éœ€è¦ä½¿ç”¨ååºéå†ï¼Œæœ€ååˆ é™¤æ ¹èŠ‚ç‚¹    //æå‰åˆ é™¤æ ¹èŠ‚ç‚¹ä¼šå¯¼è‡´æ— æ³•è·å–åˆ°å³èŠ‚ç‚¹    root.left = deal(root.left);    root.right = deal(root.right);    if(root.left == null &amp;&amp; root.right == null &amp;&amp; root.val == 0)&#123;        root = null;    &#125;    return root;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°","url":"/java4u/2021/08/03/222.%20%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E8%8A%82%E7%82%B9%E4%B8%AA%E6%95%B0/","content":"222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ç»™ä½ ä¸€æ£µ å®Œå…¨äºŒå‰æ ‘ çš„æ ¹èŠ‚ç‚¹ root ï¼Œæ±‚å‡ºè¯¥æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚\nå®Œå…¨äºŒå‰æ ‘ çš„å®šä¹‰å¦‚ä¸‹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2h ä¸ªèŠ‚ç‚¹ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šroot &#x3D; [1,2,3,4,5,6]è¾“å‡ºï¼š6\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šroot &#x3D; []è¾“å‡ºï¼š0\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šroot &#x3D; [1]è¾“å‡ºï¼š1\næç¤ºï¼š\næ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯[0, 5 * 10^4]0 &lt;&#x3D; Node.val &lt;&#x3D; 5 * 10^4é¢˜ç›®æ•°æ®ä¿è¯è¾“å…¥çš„æ ‘æ˜¯ å®Œå…¨äºŒå‰æ ‘\nè¿›é˜¶ï¼šéå†æ ‘æ¥ç»Ÿè®¡èŠ‚ç‚¹æ˜¯ä¸€ç§æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®€å•è§£å†³æ–¹æ¡ˆã€‚ä½ å¯ä»¥è®¾è®¡ä¸€ä¸ªæ›´å¿«çš„ç®—æ³•å—ï¼Ÿ\né¢˜è§£/** * å¯¹äºå®Œå…¨äºŒå‰æ ‘ï¼Œå‰h-1å±‚ä¸€å®šä¸ºæ»¡äºŒå‰æ ‘ï¼Œå‰h-1å±‚èŠ‚ç‚¹æ•°ä¸º 2^h-1 * åˆ™hå±‚ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç¼–å·ä¸º 2^h  å¯¹åº”çš„äºŒè¿›åˆ¶è¡¨ç¤ºç¬¬hä½ä¸º1å…¶ä½™ä½éƒ½ä¸º0 * 2^1  2  10 * 2^2  4  100 * 2^3  8  1000 * 2^4 16  10000 * 2^h     100.....000 * æœ€åº•å±‚èŠ‚ç‚¹æ•°åœ¨2^h 2^(h+1)-1ä¹‹é—´ * *     1            h = 0 *    / \\ *   2   3          h = 1 *  / \\  / * 4  5 6           h = 2 * ç°åœ¨è¿™ä¸ªæ ‘ä¸­çš„å€¼éƒ½æ˜¯èŠ‚ç‚¹çš„ç¼–å·ï¼Œæœ€åº•ä¸‹çš„ä¸€å±‚çš„ç¼–å·æ˜¯[2^h ï¼Œ2^h - 1]ï¼Œç°åœ¨h = 2ï¼Œä¹Ÿå°±æ˜¯4, 5, 6, 7ã€‚ * 4, 5, 6, 7å¯¹åº”äºŒè¿›åˆ¶åˆ†åˆ«ä¸º 100 101 110 111 ä¸çœ‹æœ€å·¦è¾¹çš„1ï¼Œä»ç¬¬äºŒä½å¼€å§‹ï¼Œ0è¡¨ç¤ºå‘å·¦ï¼Œ1è¡¨ç¤ºå‘å³ï¼Œ * æ­£å¥½å¯ä»¥è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹ç›¸å¯¹äºæ ¹èŠ‚ç‚¹çš„ä½ç½®ã€‚ * æ¯”å¦‚4çš„ 00 å°±è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹ å‘å·¦ å†å‘å·¦ã€‚6çš„ 10 å°±è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹ å‘å³ å†å‘å·¦ * * é‚£ä¹ˆæƒ³è®¿é—®æœ€åä¸€å±‚çš„èŠ‚ç‚¹å°±å¯ä»¥ä»èŠ‚ç‚¹çš„ç¼–å·çš„äºŒè¿›åˆ¶å…¥æ‰‹ã€‚ä»ç¬¬äºŒä½å¼€å§‹çš„äºŒè¿›åˆ¶ä½è¡¨ç¤ºäº†æœ€åä¸€å±‚çš„èŠ‚ç‚¹ç›¸å¯¹äºæ ¹èŠ‚ç‚¹çš„ä½ç½®ã€‚ * é‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªbits = 2^(h - 1) ä¸Šé¢ä¾‹å­ä¸­çš„bitså°±æ˜¯2ï¼Œå¯¹åº”äºŒè¿›åˆ¶ä¸º010ã€‚è¿™æ ·å°±å¯ä»¥ä»ç¬¬äºŒä½å¼€å§‹åˆ¤æ–­ã€‚ * ï¼ˆæ ‘ä¸‰å±‚é«˜ï¼Œéœ€è¦å‘å·¦æˆ–å‘å³èµ°ä¸¤æ¬¡æ‰èƒ½åˆ°å¶å­ï¼‰ * æ¯”å¦‚çœ‹5è¿™ä¸ªèŠ‚ç‚¹å­˜ä¸å­˜åœ¨ï¼Œå…ˆé€šè¿‡ä½è¿ç®—æ‰¾åˆ°ç¼–å·ä¸º5çš„èŠ‚ç‚¹ç›¸å¯¹äºæ ¹èŠ‚ç‚¹çš„ä½ç½®ã€‚010 &amp; 101 å‘ç°ç¬¬äºŒä½æ˜¯0ï¼Œ * è¯´æ˜ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œç¬¬ä¸€æ­¥å‘å·¦èµ°ã€‚ä¹‹åå°†bitå³ç§»ä¸€ä½ï¼Œå˜æˆ001ã€‚001 &amp; 101 å‘ç°ç¬¬ä¸‰ä½æ˜¯1ï¼Œé‚£ä¹ˆç¬¬äºŒæ­¥å‘å³èµ°ã€‚ * æœ€åbitä¸º0ï¼Œè¯´æ˜å·²ç»æ‰¾åˆ°ç¼–å·ä¸º5çš„è¿™ä¸ªèŠ‚ç‚¹ç›¸å¯¹äºæ ¹èŠ‚ç‚¹çš„ä½ç½®ï¼Œçœ‹è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯ç©ºï¼Œä¸æ˜¯è¯´æ˜å­˜åœ¨ï¼Œexistè¿”å›çœŸ * ç¼–å·ä¸º5çš„èŠ‚ç‚¹å­˜åœ¨ï¼Œè¯´æ˜æ€»èŠ‚ç‚¹æ•°é‡ä¸€å®šå¤§äºç­‰äº5ã€‚æ‰€ä»¥äºŒåˆ†é‚£é‡Œlow = mid * * å†æ¯”å¦‚çœ‹7å­˜ä¸å­˜åœ¨ï¼Œ010 &amp; 111 ç¬¬äºŒä½ä¸º1ï¼Œç¬¬ä¸€éƒ¨ä»æ ¹èŠ‚ç‚¹å‘å³ï¼›001 &amp; 111 ç¬¬ä¸‰ä½ä¹Ÿä¸º1ï¼Œç¬¬äºŒæ­¥ç»§ç»­å‘å³ã€‚ * ç„¶ååˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯ä¸æ˜¯nullï¼Œå‘ç°æ˜¯nullï¼Œexistè¿”å›å‡ã€‚ * ç¼–å·ä¸º7çš„èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œè¯´æ˜æ€»èŠ‚ç‚¹æ•°é‡ä¸€å®šå°äº7ã€‚æ‰€ä»¥high = mid - 1 * @param root */public int countNodes2(TreeNode root) &#123;    if (root == null) &#123;        return 0;    &#125;    int level = 0;    TreeNode node = root;    while (node.left != null) &#123;        level++;        node = node.left;    &#125;    int low = 1 &lt;&lt; level, high = (1 &lt;&lt; (level + 1)) - 1;    while (low &lt; high) &#123;        int mid = (high - low + 1) / 2 + low;        if (exists(root, level, mid)) &#123;            low = mid;        &#125; else &#123;            high = mid - 1;        &#125;    &#125;    return low;&#125;public boolean exists(TreeNode root, int level, int k) &#123;    int bits = 1 &lt;&lt; (level - 1);    TreeNode node = root;    while (node != null &amp;&amp; bits &gt; 0) &#123;        if ((bits &amp; k) == 0) &#123;            node = node.left;        &#125; else &#123;            node = node.right;        &#125;        bits &gt;&gt;= 1;    &#125;    return node != null;&#125;/** * æ¯”è¾ƒäºŒå‰æ ‘å·¦å³å­æ ‘é«˜åº¦ * å¦‚æœç›¸ç­‰ï¼ˆå·¦å­æ ‘å¿…ç„¶è¢«å¡«æ»¡ï¼‰åˆ™å·¦å­æ ‘ä¸ºæ»¡çš„äºŒå‰æ ‘ èŠ‚ç‚¹æ•°é‡ä¸º 2^h-1,è¿­ä»£å³å­æ ‘ * å¦‚æœä¸ç›¸ç­‰åˆ™å³å­æ ‘ä¸ºæ»¡äºŒå‰æ ‘ï¼Œè¿­ä»£å·¦å­æ ‘ * * 1 &lt;&lt; h  ==&gt;   1 * 2^h * * @param root * @return */public int countNodes(TreeNode root) &#123;    if (root == null) return 0;    int rightHigh = countHigh(root.right);    int leftHigh = countHigh(root.left);    if (leftHigh == rightHigh) &#123;        return (1 &lt;&lt; leftHigh) + countNodes(root.right);    &#125; else &#123;        return countNodes(root.left) + (1 &lt;&lt; rightHigh);    &#125;&#125;/** * è®¡ç®—æ»¡äºŒå‰æ ‘çš„é«˜åº¦ * * @param root * @return */private int countHigh(TreeNode root) &#123;    int high = 0;    while (root != null) &#123;        high++;        root = root.left;    &#125;    return high;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹","url":"/java4u/2021/08/03/450.%20%E5%88%A0%E9%99%A4%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9/","content":"450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªå€¼ keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„ key å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›äºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤èŠ‚ç‚¹å¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š\n\né¦–å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼›\nå¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ é™¤å®ƒã€‚\n\nç¤ºä¾‹ 1:\nè¾“å…¥ï¼šroot &#x3D; [5,3,6,2,4,null,7], key &#x3D; 3è¾“å‡ºï¼š[5,4,6,2,null,null,7]è§£é‡Šï¼šç»™å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹å€¼æ˜¯ 3ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ° 3 è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤å®ƒã€‚ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ [5,4,6,2,null,null,7]å¦ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆæ˜¯ [5,2,6,null,4,null,7]ã€‚  \nç¤ºä¾‹ 2:\nè¾“å…¥: root &#x3D; [5,3,6,2,4,null,7], key &#x3D; 0è¾“å‡º: [5,3,6,2,4,null,7]è§£é‡Š: äºŒå‰æ ‘ä¸åŒ…å«å€¼ä¸º 0 çš„èŠ‚ç‚¹\nç¤ºä¾‹ 3:\nè¾“å…¥: root &#x3D; [], key &#x3D; 0è¾“å‡º: []\næç¤º:\nèŠ‚ç‚¹æ•°çš„èŒƒå›´ [0, 10^4]-10^5 &lt;&#x3D; Node.val &lt;&#x3D; 10^5èŠ‚ç‚¹å€¼å”¯ä¸€root æ˜¯åˆæ³•çš„äºŒå‰æœç´¢æ ‘-10^5 &lt;&#x3D; key &lt;&#x3D; 10^5\nè¿›é˜¶ï¼š è¦æ±‚ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(h)ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ã€‚\né¢˜è§£public TreeNode deleteNode2(TreeNode root, int key) &#123;    if (root == null) &#123;        return null;    &#125;    // Find the target node    TreeNode cur = root, prev = null;    while (cur != null) &#123;        if (cur.val == key) &#123;            break;        &#125; else &#123;            prev = cur;            cur = cur.val &lt; key ? cur.right : cur.left;        &#125;    &#125;    if (cur == null) &#123;        return root;    &#125;    // Find replacement, the rightest node in left subtree    TreeNode rep;    if (cur.left == null) &#123;        rep = cur.right;    &#125; else &#123;        if (cur.left.right == null) &#123;            cur.left.right = cur.right;            rep = cur.left;        &#125; else &#123;            TreeNode repPrev = cur;            rep = cur.left;            while (rep.right != null) &#123;                repPrev = rep;                rep = rep.right;            &#125;            repPrev.right = rep.left;            rep.left = cur.left;            rep.right = cur.right;        &#125;    &#125;    if (prev != null) &#123;        if (prev.left == cur) &#123;            prev.left = rep;        &#125; else &#123;            prev.right = rep;        &#125;    &#125;    return root.val == key ? rep : root;&#125;public TreeNode deleteNode(TreeNode root, int key) &#123;    if (root == null) return null;    // delete from the right subtree    if (key &gt; root.val) root.right = deleteNode(root.right, key);        // delete from the left subtree    else if (key &lt; root.val) root.left = deleteNode(root.left, key);        // delete the current node    else &#123;        // the node is a leaf        if (root.left == null &amp;&amp; root.right == null) root = null;            // the node is not a leaf and has a right child        else if (root.right != null) &#123;            //ç”¨åç»§èŠ‚ç‚¹æ›¿ä»£å½“å‰èŠ‚ç‚¹çš„å€¼            root.val = successor(root);            //ä»å½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹å¼€å§‹æ‰¾åç»§èŠ‚ç‚¹åˆ é™¤            root.right = deleteNode(root.right, root.val);        &#125;        // the node is not a leaf, has no right child, and has a left child        else &#123;            root.val = predecessor(root);            root.left = deleteNode(root.left, root.val);        &#125;    &#125;    return root;&#125;/** * è·å–èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ * å¤§äºå½“å‰èŠ‚ç‚¹æœ€å°çš„èŠ‚ç‚¹ * @param root * @return */public int successor(TreeNode root) &#123;    root = root.right;    while (root.left != null) root = root.left;    return root.val;&#125;/** * å‰ç»§èŠ‚ç‚¹ * æ¯”èŠ‚ç‚¹å°çš„æœ€å¤§èŠ‚ç‚¹ * @param root * @return */public int predecessor(TreeNode root) &#123;    root = root.left;    while (root.right != null) root = root.right;    return root.val;&#125;/** * æ‰¾åˆ°è¦è¢«åˆ é™¤çš„èŠ‚ç‚¹ * ä¸‰ç§æƒ…å†µï¼š * 1.è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ * 2.è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ä¸”æ‹¥æœ‰å³èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹å¯ä»¥ç”±è¯¥èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹è¿›è¡Œæ›¿ä»£ï¼Œ * è¯¥åç»§èŠ‚ç‚¹ä½äºå³å­æ ‘ä¸­è¾ƒä½çš„ä½ç½®ã€‚ç„¶åå¯ä»¥ä»åç»§èŠ‚ç‚¹çš„ä½ç½®é€’å½’å‘ä¸‹æ“ä½œä»¥åˆ é™¤åç»§èŠ‚ç‚¹ã€‚ * 3.è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œä¸”æ²¡æœ‰å³èŠ‚ç‚¹ä½†æ˜¯æœ‰å·¦èŠ‚ç‚¹ã€‚è¿™æ„å‘³ç€å®ƒçš„åç»§èŠ‚ç‚¹åœ¨å®ƒçš„ä¸Šé¢ï¼Œ * ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸æƒ³è¿”å›ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒçš„å‰é©±èŠ‚ç‚¹è¿›è¡Œæ›¿ä»£ï¼Œç„¶åå†é€’å½’çš„å‘ä¸‹åˆ é™¤å‰é©±èŠ‚ç‚¹ã€‚ * * ä¸é€šè¿‡ * ä½¿ç”¨åç»§èŠ‚ç‚¹ä»£æ›¿è¯¥èŠ‚ç‚¹åï¼Œå¹¶æ²¡æœ‰åˆ é™¤æ‰åç»§èŠ‚ç‚¹ * * @param root * @param key * @return */public TreeNode deleteNode3(TreeNode root, int key) &#123;    if (root == null) return null;    TreeNode cur = root,pre = root;    //æ‰¾åˆ°è¢«åˆ é™¤èŠ‚ç‚¹    while (cur != null) &#123;        if(cur.val == key) &#123;            break;        &#125;else if(cur.val &gt; key) &#123;            pre = cur;            cur = cur.left;        &#125;else &#123;            pre = cur;            cur = cur.right;        &#125;    &#125;    if(cur == null)return null;    if(cur.right == null &amp;&amp; cur.left == null) &#123;        cur = null;        //æ‹¥æœ‰å³èŠ‚ç‚¹ï¼Œç”¨åç»§èŠ‚ç‚¹ä»£æ›¿è¯¥èŠ‚ç‚¹    &#125;else if(cur.right != null)&#123;        TreeNode successor = successorNode(cur);    &#125;else&#123;        TreeNode predecessor = predecessorNode(cur);    &#125;    return root;&#125;public TreeNode successorNode(TreeNode root) &#123;    root = root.right;    while (root.left != null) root = root.left;    return root;&#125;public TreeNode predecessorNode(TreeNode root) &#123;    root = root.left;    while (root.right != null) root = root.right;    return root;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"700. äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢","url":"/java4u/2021/07/28/700.%20%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E4%B8%AD%E7%9A%84%E6%90%9C%E7%B4%A2/","content":"700. äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªæ•´æ•°å€¼ valã€‚\nä½ éœ€è¦åœ¨ BST ä¸­æ‰¾åˆ°èŠ‚ç‚¹å€¼ç­‰äº val çš„èŠ‚ç‚¹ã€‚ è¿”å›ä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ã€‚ å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› null ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥ï¼šroot &#x3D; [4,2,7,1,3], val &#x3D; 2è¾“å‡ºï¼š[2,1,3]\nç¤ºä¾‹ 2:\nè¾“å…¥ï¼šroot &#x3D; [4,2,7,1,3], val &#x3D; 5è¾“å‡ºï¼š[]\næç¤ºï¼š\næ•°ä¸­èŠ‚ç‚¹æ•°åœ¨ [1, 5000] èŒƒå›´å†…1 &lt;&#x3D; Node.val &lt;&#x3D; 10^7root æ˜¯äºŒå‰æœç´¢æ ‘1 &lt;&#x3D; val &lt;&#x3D; 10^7\né¢˜è§£//é€’å½’ï¼šé‡å¤è°ƒç”¨å‡½æ•°è‡ªèº«å®ç°å¾ªç¯ç§°ä¸ºé€’å½’ï¼›//è¿­ä»£ï¼šåˆ©ç”¨å˜é‡çš„åŸå€¼æ¨å‡ºæ–°å€¼ç§°ä¸ºè¿­ä»£ï¼Œæˆ–è€…è¯´è¿­ä»£æ˜¯å‡½æ•°å†…æŸæ®µä»£ç å®ç°å¾ªç¯ï¼›//é€’å½’public TreeNode searchBST(TreeNode root, int val) &#123;    if(root == null)return null;    if(root.val &gt; val)&#123;        return searchBST(root.left, val);    &#125;else if(root.val &lt; val)&#123;        return searchBST(root.right, val);    &#125;else &#123;        return root;    &#125;&#125;//è¿­ä»£public TreeNode searchBST2(TreeNode root, int val) &#123;    while (root != null) &#123;        if (root.val == val) &#123;            return root;        &#125; else if (root.val &gt; val) &#123;            root = root.left;        &#125; else &#123;            root = root.right;        &#125;    &#125;    return null;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"98. éªŒè¯äºŒå‰æœç´¢æ ‘","url":"/java4u/2021/07/28/98.%20%E9%AA%8C%E8%AF%81%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/","content":"98. éªŒè¯äºŒå‰æœç´¢æ ‘ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚\næœ‰æ•ˆ äºŒå‰æœç´¢æ ‘å®šä¹‰å¦‚ä¸‹ï¼š\n\nèŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å« å°äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚\nèŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å« å¤§äº å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚\næ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚\n\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šroot &#x3D; [2,1,3]è¾“å‡ºï¼štrue\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šroot &#x3D; [5,1,4,null,null,3,6]è¾“å‡ºï¼šfalseè§£é‡Šï¼šæ ¹èŠ‚ç‚¹çš„å€¼æ˜¯ 5 ï¼Œä½†æ˜¯å³å­èŠ‚ç‚¹çš„å€¼æ˜¯ 4 ã€‚\næç¤ºï¼š\næ ‘ä¸­èŠ‚ç‚¹æ•°ç›®èŒƒå›´åœ¨[1, 10^4] å†…-2^31 &lt;&#x3D; Node.val &lt;&#x3D; 2^31 - 1\né¢˜è§£/** * é™¤äº†éªŒè¯å·¦èŠ‚ç‚¹å°äºæ ¹èŠ‚ç‚¹ï¼Œè¿˜éœ€ä¼ å…¥ä¸Šç•Œå’Œä¸‹ç•Œé™åˆ¶ * å­èŠ‚ç‚¹ä¸èƒ½è¶…è¿‡æ‰€æœ‰çˆ¶èŠ‚ç‚¹çš„é™åˆ¶ * å‘ä¸‹éå†æ—¶ï¼Œå·¦èŠ‚ç‚¹ä¸Šç•Œç¼©å°ï¼Œå·¦èŠ‚ç‚¹ä¸èƒ½å¤§äºçˆ¶èŠ‚ç‚¹ * å³èŠ‚ç‚¹ä¸‹ç•Œæ‰©å¤§ï¼Œå³èŠ‚ç‚¹ä¸èƒ½å°äºçˆ¶èŠ‚ç‚¹ * @param root * @return */public boolean isValidBST(TreeNode root) &#123;    long min = Long.MIN_VALUE;    long max = Long.MAX_VALUE;    return validBST(root, min, max);&#125;private boolean validBST(TreeNode root, long min, long max)&#123;    if(root == null) return true;    if(root.val &lt;= min || root.val &gt;= max) return false;    return validBST(root.left, min, root.val) &amp;&amp; validBST(root.right, root.val, max);&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"102. äºŒå‰æ ‘çš„å±‚åºéå†","url":"/java4u/2021/07/27/102.%20%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/","content":"102. äºŒå‰æ ‘çš„å±‚åºéå†ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„ å±‚åºéå† ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šroot &#x3D; [3,9,20,null,null,15,7]è¾“å‡ºï¼š[[3],[9,20],[15,7]]\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šroot &#x3D; [1]è¾“å‡ºï¼š[[1]]\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šroot &#x3D; []è¾“å‡ºï¼š[]\næç¤ºï¼š\næ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [0, 2000] å†…-1000 &lt;&#x3D; Node.val &lt;&#x3D; 1000\né¢˜è§£/** * BFSä½¿ç”¨é˜Ÿåˆ—å®ç° * å°†æ ¹èŠ‚ç‚¹å­˜å…¥é˜Ÿåˆ—ï¼Œé€šè¿‡æ¶ˆè€—é˜Ÿå°¾ï¼Œæ’å…¥é˜Ÿå¤´çš„æ–¹å¼éå†äºŒå‰æ ‘ * @param root * @return */public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123;    if(root == null) return new ArrayList&lt;&gt;();    List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;();    Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;();    //é˜Ÿå°¾æ’å…¥    queue.offer(root);    while (!queue.isEmpty()) &#123;        int len = queue.size();        List&lt;Integer&gt; list = new ArrayList&lt;&gt;();        for (int i = 1; i &lt;= len; i++) &#123;            //é˜Ÿé¦–å–å‡º            TreeNode treeNode = queue.poll();            if (treeNode.left != null) &#123;                queue.offer(treeNode.left);            &#125;            if (treeNode.right != null) &#123;                queue.offer(treeNode.right);            &#125;            list.add(treeNode.val);        &#125;        res.add(list);    &#125;    return res;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"58. æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦","url":"/java4u/2021/07/24/58.%20%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E7%9A%84%E9%95%BF%E5%BA%A6/","content":"58. æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œç”±è‹¥å¹²å•è¯ç»„æˆï¼Œå•è¯å‰åç”¨ä¸€äº›ç©ºæ ¼å­—ç¬¦éš”å¼€ã€‚è¿”å›å­—ç¬¦ä¸²ä¸­ æœ€åä¸€ä¸ª å•è¯çš„é•¿åº¦ã€‚\nå•è¯ æ˜¯æŒ‡ä»…ç”±å­—æ¯ç»„æˆã€ä¸åŒ…å«ä»»ä½•ç©ºæ ¼å­—ç¬¦çš„æœ€å¤§å­å­—ç¬¦ä¸²ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs &#x3D; â€œHello Worldâ€è¾“å‡ºï¼š5è§£é‡Šï¼šæœ€åä¸€ä¸ªå•è¯æ˜¯â€œWorldâ€ï¼Œé•¿åº¦ä¸º5ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šs &#x3D; â€œ   fly me   to   the moon  â€œè¾“å‡ºï¼š4è§£é‡Šï¼šæœ€åä¸€ä¸ªå•è¯æ˜¯â€œmoonâ€ï¼Œé•¿åº¦ä¸º4ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šs &#x3D; â€œluffy is still joyboyâ€è¾“å‡ºï¼š6è§£é‡Šï¼šæœ€åä¸€ä¸ªå•è¯æ˜¯é•¿åº¦ä¸º6çš„â€œjoyboyâ€ã€‚\næç¤ºï¼š\n1 &lt;&#x3D; s.length &lt;&#x3D; 10^4s ä»…æœ‰è‹±æ–‡å­—æ¯å’Œç©ºæ ¼ â€˜ â€˜ ç»„æˆs ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªå•è¯\né¢˜è§£public int lengthOfLastWord(String s) &#123;    if (s.length() == 0) return 0;    int len = s.length();    int count = 0;    for (int i = len - 1; i &gt;= 0; i--) &#123;        if (s.charAt(i) == &#x27; &#x27;) &#123;            //å­—ç¬¦æœ«å°¾ä¹Ÿå¯èƒ½å­˜åœ¨ç©ºæ ¼            //é‡åˆ°ç©ºæ ¼å¯ä»¥ç›´æ¥è·³è¿‡            if (count == 0) continue;            break;        &#125;        count++;    &#125;    return count;&#125;public int lengthOfLastWord2(String s) &#123;    s = s.trim();    int start = s.lastIndexOf(&quot; &quot;) + 1;    return s.substring(start).length();&#125;public int lengthOfLastWord3(String s) &#123;    String[] words = s.split(&quot; &quot;);    if (words.length &lt; 1) return 0;    return words[words.length - 1].length();&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å­—ç¬¦ä¸²"]},{"title":"796. æ—‹è½¬å­—ç¬¦ä¸²","url":"/java4u/2021/07/24/796.%20%E6%97%8B%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2/","content":"796. æ—‹è½¬å­—ç¬¦ä¸²ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸², s å’Œ goalã€‚å¦‚æœåœ¨è‹¥å¹²æ¬¡æ—‹è½¬æ“ä½œä¹‹åï¼Œs èƒ½å˜æˆ goal ï¼Œé‚£ä¹ˆè¿”å› true ã€‚\ns çš„ æ—‹è½¬æ“ä½œ å°±æ˜¯å°† s æœ€å·¦è¾¹çš„å­—ç¬¦ç§»åŠ¨åˆ°æœ€å³è¾¹ã€‚\nä¾‹å¦‚, è‹¥ s &#x3D; â€˜abcdeâ€™ï¼Œåœ¨æ—‹è½¬ä¸€æ¬¡ä¹‹åç»“æœå°±æ˜¯â€™bcdeaâ€™ ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: s &#x3D; â€œabcdeâ€, goal &#x3D; â€œcdeabâ€è¾“å‡º: true\nç¤ºä¾‹ 2:\nè¾“å…¥: s &#x3D; â€œabcdeâ€, goal &#x3D; â€œabcedâ€è¾“å‡º: false\næç¤º:\n1 &lt;&#x3D; s.length, goal.length &lt;&#x3D; 100s å’Œ goal ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ\né¢˜è§£/** * æš´åŠ›è§£æ³•ï¼Œä¸æ–­ç§»åˆ°ç›®æ ‡å­—ç¬¦ * * @param s * @param goal * @return */public boolean rotateString(String s, String goal) &#123;    if (s.length() == 0 &amp;&amp; goal.length() == 0) return true;    int len = s.length();    for (int i = 0; i &lt; len; i++) &#123;        String first = s.substring(0, i);        String last = s.substring(i, len);        if ((last + first).equals(goal)) &#123;            return true;        &#125;    &#125;    return false;&#125;/** * è§‚å¯Ÿå­—ç¬¦ä¸²    a b c d e * b c d e a * c d e a b * d e a b c * e a b c d * a b c d e * a b c d e a b c d e      A+A åŒ…å«æ‰€æœ‰Aé€šè¿‡æ—‹è½¬å¾—åˆ°çš„æ‰€æœ‰æƒ…å†µ * åªéœ€è¦åˆ¤æ–­ B æ˜¯å¦ä¸º A + A çš„å­ä¸²å°±å¯ä»¥äº† * * @param s * @param goal * @return */public boolean rotateString2(String s, String goal) &#123;    return s.length() == goal.length() &amp;&amp; (s + s).contains(goal);&#125;/** * é€šè¿‡ä¸Šé¢çš„è§£é¢˜ï¼Œå¯ä»¥è½¬æ¢ä¸º Bæ˜¯å¦ä¸º A+Açš„å­ä¸² * é€šè¿‡KMPè§£é¢˜ * * @param A ç›®æ ‡ä¸² * @param B æ¨¡å¼ä¸² * @return */public boolean rotateString3(String A, String B) &#123;    int N = A.length();    if (N != B.length()) return false;    if (N == 0) return true;    //Compute shift table    int[] shifts = new int[N + 1];    Arrays.fill(shifts, 1);    int left = -1;    for (int right = 0; right &lt; N; ++right) &#123;        while (left &gt;= 0 &amp;&amp; (B.charAt(left) != B.charAt(right)))            left -= shifts[left];        shifts[right + 1] = right - left++;    &#125;    //Find match of B in A+A    int matchLen = 0;    for (char c : (A + A).toCharArray()) &#123;        while (matchLen &gt;= 0 &amp;&amp; B.charAt(matchLen) != c)            matchLen -= shifts[matchLen];        if (++matchLen == N) return true;    &#125;    return false;&#125;public int KMP(String ts, String ps) &#123;    char[] t = ts.toCharArray();    char[] p = ps.toCharArray();    int i = 0; // ä¸»ä¸²çš„ä½ç½®    int j = 0; // æ¨¡å¼ä¸²çš„ä½ç½®    int[] next = getNext(ps);    while (i &lt; t.length &amp;&amp; j &lt; p.length) &#123;        if (j == -1 || t[i] == p[j]) &#123; // å½“jä¸º-1æ—¶ï¼Œè¦ç§»åŠ¨çš„æ˜¯iï¼Œå½“ç„¶jä¹Ÿè¦å½’0            i++;            j++;        &#125; else &#123;            // iä¸éœ€è¦å›æº¯äº†            // i = i - j + 1;            j = next[j]; // jå›åˆ°æŒ‡å®šä½ç½®        &#125;    &#125;    if (j == p.length) &#123;        return i - j;    &#125; else &#123;        return -1;    &#125;&#125;/** * è·å–æ¨¡å¼ä¸²çš„nextè¡¨ *  i * abaabcac *  abaabcac *  j * @param p * @return */private int[] getNext(String p) &#123;    int[] next = new int[p.length() + 1];    next[0] = -1;    int i = 0, j = -1;    while (i &lt; p.length()) &#123;        if (j == -1 || p.charAt(i) == p.charAt(j)) &#123;            //å¦‚æœåŒ¹é…ä¸Šï¼Œæˆ‘ä»¬æŠŠ i å’Œ j éƒ½åŠ ä¸€,å¹¶ä¸”å†™è¡¨            ++i;            ++j;            next[i] = j;        &#125; else &#123;            //å¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šï¼Œå°±æŠŠ j å›æº¯åˆ° j å½“å‰æŒ‡å‘çš„å‰ä¸€ä¸ªä½ç½®çš„ index å¤„            j = next[j];        &#125;    &#125;    return next;&#125;\n\nKMP\nå¦‚æœæŒ‰ç…§æš´åŠ›åŒ¹é…ã€‚æ­¤æ—¶ç›®æ ‡ä¸²æˆ‘ä»¬åº”è¯¥å›åˆ° B è¿™ä¸ªä½ç½®ï¼Œæ¨¡å¼ä¸²åº”ç›´æ¥å›åˆ°å¤´ã€‚ä½†æ˜¯æŒ‰ç…§ KMP çš„æ€è·¯ï¼Œåœ¨æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…åï¼Œå› ä¸º BC åŒ¹é…æˆåŠŸäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“äº† BC ä¸ç­‰äº Aé‚£æ—¢ç„¶å·²çŸ¥äº† BC ä¸ç­‰äº Aï¼Œæˆ‘ä»¬å°±æ²¡å¿…è¦ç”¨ A å’Œ BC è¿›è¡ŒåŒ¹é…äº†ã€‚é‚£æˆ‘ä»¬ç›´æ¥ç”¨ A è¶Šè¿‡å‰é¢ä¸éœ€è¦åŒ¹é…çš„ BCï¼š\n\nä¸æ–­å‘åç§»åŠ¨ï¼Œç›´åˆ°åŒ¹é…\n\nåœ¨KMPä¸­ï¼Œå¦‚æœæ¨¡å¼ä¸²å’Œç›®æ ‡ä¸²æ²¡æœ‰åŒ¹é…æˆåŠŸï¼Œç›®æ ‡ä¸²ä¸å›æº¯åœ¨åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œè·³è¿‡ä¸å¯èƒ½æˆåŠŸçš„å°è¯•ï¼ˆnextæ•°ç»„ï¼‰\n\n\n\n\nåºå·\n0\n1\n2\n3\n4\n5\n6\n7\n\n\n\næ¨¡å¼ä¸²\na\nb\na\na\nb\nc\na\nc\n\n\nshift\n1\n1\n2\n2\n3\n3\n6\n6\n\n\npmt\n0\n0\n1\n1\n2\n0\n1\n0\n\n\nnext\n-1\n0\n0\n1\n1\n2\n0\n1\n\n\nindex-shift&#x3D;next\nnextè¡¨è¡¨ç¤ºæ¨¡å¼ä¸²çœŸå‰ç¼€ï¼ˆä¸å«æ‹¬è‡ªèº«ï¼‰å’ŒçœŸåç¼€åŒ¹é…çš„æ•°é‡ï¼Œç§»åŠ¨æ—¶å°±å¯ä»¥å°†å‰ç¼€å’Œåç¼€å¯¹é½å³å¯ï¼Œå¦‚å›¾ï¼š\n\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å­—ç¬¦ä¸²"]},{"title":"å‰‘æŒ‡ Offer 17. æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°","url":"/java4u/2021/07/21/%E5%89%91%E6%8C%87%20Offer%2017.%20%E6%89%93%E5%8D%B0%E4%BB%8E1%E5%88%B0%E6%9C%80%E5%A4%A7%E7%9A%84n%E4%BD%8D%E6%95%B0/","content":"å‰‘æŒ‡ Offer 17. æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°è¾“å…¥æ•°å­— nï¼ŒæŒ‰é¡ºåºæ‰“å°å‡ºä» 1 åˆ°æœ€å¤§çš„ n ä½åè¿›åˆ¶æ•°ã€‚æ¯”å¦‚è¾“å…¥ 3ï¼Œåˆ™æ‰“å°å‡º 1ã€2ã€3 ä¸€ç›´åˆ°æœ€å¤§çš„ 3 ä½æ•° 999ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: n &#x3D; 1è¾“å‡º: [1,2,3,4,5,6,7,8,9]\nè¯´æ˜ï¼š\nç”¨è¿”å›ä¸€ä¸ªæ•´æ•°åˆ—è¡¨æ¥ä»£æ›¿æ‰“å°n ä¸ºæ­£æ•´æ•°\né¢˜è§£/**     * ç®€å•è§£æ³•ï¼Œè·å–æœ€é«˜ä½ï¼Œä¸€ç›´æ‰“å°     * å¯èƒ½çš„é—®é¢˜ï¼šè¶…è¿‡intèŒƒå›´çš„å¤§æ•°ï¼Ÿ     */    public int[] printNumbers2(int n) &#123;        int len = (int) Math.pow(10, n);        int[] res = new int[len - 1];        for (int i = 1; i &lt; len; i++) &#123;            res[i - 1] = i;        &#125;        return res;    &#125;    /**     * ä½¿ç”¨å­—ç¬¦å­˜æ”¾å¤§æ•°ï¼Œå¯¹æœ€ä½ä½çš„å€¼ä¸æ–­é€’å¢     * å¯¹æœ€ä½ä½ nSum çš„å€¼é€’å¢ï¼ˆä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²åŠ 1è¿ç®—ï¼‰ï¼Œå½“å¤§äºç­‰äº10æ—¶ï¼Œ     * æˆ‘ä»¬æŠŠè¿›ä½æ ‡è¯†æ”¹ä¸º1ï¼ŒåŒæ—¶æ¢å¤å¯¹ nSum å‡10ï¼ˆ29-31ï¼‰     * é€šè¿‡åˆ¤æ–­é¦–ä½æ˜¯å¦è¿›ä½æ¥åˆ¤æ–­åˆ°è¾¾æœ€å¤§çš„nä½æ•°æƒ…å†µã€‚æ¯”å¦‚ n=4ï¼Œåªæœ‰å¯¹ 9999 åŠ  1ï¼Œæ‰ä¼šå¯¹ç¬¬ä¸€ä¸ªå­—ç¬¦è¿›ä½     *     * @param n     */    public void printNumbers(int n) &#123;        //å£°æ˜å­—ç¬¦æ•°ç»„,ç”¨æ¥å­˜æ”¾ä¸€ä¸ªå¤§æ•°        char[] number = new char[n];        Arrays.fill(number, &#x27;0&#x27;);        while (!incrementNumber(number)) &#123;            saveNumber(number); //å­˜å‚¨æ•°å€¼        &#125;    &#125;    private boolean incrementNumber(char[] number) &#123;        //å¾ªç¯ä½“é€€å‡ºæ ‡è¯†        boolean isBreak = false;        //è¿›ä½æ ‡è¯†        int carryFlag = 0;        int l = number.length;        for (int i = l - 1; i &gt;= 0; i--) &#123;            //å–ç¬¬iä½çš„æ•°å­—è½¬åŒ–ä½int            int nSum = number[i] - &#x27;0&#x27; + carryFlag;            if (i == l - 1) &#123;                //æœ€ä½ä½åŠ 1                ++nSum;            &#125;            if (nSum &gt;= 10) &#123;                //å½“iä¸º0æ—¶ï¼Œè¯´æ˜å·²ç»åˆ°äº†å­—ç¬¦æœ€å‰ç«¯ 999 9999                //è¿›ä½çš„æ•°ä¸éœ€è¦æ‰“å°ï¼Œå¾ªç¯åœæ­¢                if (i == 0) &#123;                    isBreak = true;                &#125; else &#123;                    //è¿›ä½ä¹‹åå‡10ï¼Œå¹¶æŠŠè¿›ä½æ ‡è¯†è®¾ç½®ä¸º1                    nSum -= 10;                    carryFlag = 1;                    number[i] = (char) (&#x27;0&#x27; + nSum);                &#125;            &#125; else &#123;                number[i] = (char) (nSum + &#x27;0&#x27;);                break;            &#125;        &#125;        return isBreak;    &#125;    private void saveNumber(char[] number) &#123;        boolean isBegin0 = true;        for (char c : number) &#123;            if (isBegin0 &amp;&amp; c != &#x27;0&#x27;) &#123;                isBegin0 = false;            &#125;            if (!isBegin0) &#123;                // åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»§ç»­å¾€ä¸‹å®ç°ä¸€ä¸ªå­˜å‚¨æ•°ç»„çš„ç‰ˆæœ¬ï¼Œæ˜¯å› ä¸ºåŸé¢˜å…¶å®å°±æ˜¯è¦æ±‚æ‰“å°æ•°å€¼ã€‚                // è¿™é“é¢˜ç›®åœ¨leetcodeä¸Šè¢«æ”¹åŠ¨æˆè¿”å›intæ•°ç»„çš„å½¢å¼ï¼Œä¹Ÿåªæ˜¯ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œ                // æœ¬èº«leetcodeå¹¶æ²¡æœ‰æä¾›å¯¹åº”çš„å¤§æ•°æµ‹è¯•æ ·ä¾‹ï¼Œä¹Ÿæ˜¯æ‹…å¿ƒå…¶å†…å­˜æº¢å‡ºã€‚                // æ€»ä¹‹å¤§å®¶çŸ¥é“æœ¬é¢˜çš„è€ƒå¯Ÿç‚¹æ‰€åœ¨å°±å¯ä»¥äº†ã€‚                System.out.print(c);            &#125;        &#125;        System.out.println();    &#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å­—ç¬¦ä¸²"]},{"title":"æ”¯ä»˜å¹³å°æ–¹æ¡ˆ","url":"/java4u/2021/07/07/%E6%94%AF%E4%BB%98%E5%B9%B3%E5%8F%B0%E6%96%B9%E6%A1%88/","content":"åœºæ™¯ï¼šé‡åº†å¹¿ç”µå¯¹æ¥ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ï¼ˆè¯šæ¯…ï¼‰çš„æµç¨‹ä¸æ–¹æ¡ˆ\n1.é¡µé¢æ•´ä½“ä¿®æ”¹\n1ï¼‰é¡µé¢æä¾›å®šæ—¶è½®è¯¢ï¼ŒæŸ¥è¯¢è®¢å•çŠ¶æ€    æŒç»­è½®è¯¢    æ”¯ä»˜æˆåŠŸï¼šæŒ‰é’®ä¿®æ”¹ä¸ºå…³é—­é¡µé¢\n2ï¼‰é¡µé¢ä¸‹æ–¹æä¾›ä¸€ä¸ªå¯å˜åŒ–çš„æŒ‰é’®ï¼Œæ ¹æ®è®¢å•çŠ¶æ€ä¿®æ”¹æŒ‰é’®æ ·å¼\n\n2.åç«¯æœåŠ¡\n1ï¼‰è¡¨è®¾è®¡  æ·»åŠ ä¸šåŠ¡å¤„ç†çŠ¶æ€\n2ï¼‰å¯¹å¤–æä¾›ä¿®æ”¹è®¢å•çš„æœåŠ¡\n3ï¼‰ä¸šåŠ¡å®Œæˆæ›´æ–°ä¸šåŠ¡å¤„ç†çŠ¶æ€\n\n3.è¡¥å¿   å¯¹å¤–æ¥å£   CSFæœåŠ¡\n1ï¼‰æ”¯ä»˜æˆåŠŸä¿®æ”¹è®¢å•çŠ¶æ€    è½®è¯¢ è®¢å•è¡¨   ä¸šåŠ¡æœªå¤„ç†  å·²å……å€¼  â€“ã€‹è¡¥å¿ï¼ˆé¢„å­˜ï¼‰\n2ï¼‰é€€è´¹é¡µé¢\nè½®è¯¢è¡¨ä¸­çš„æ•°æ®å¯¹äºè¶…å‡ºæŸä¸ªæ—¶é—´çš„æ•°æ®å±äºå¼‚å¸¸æ•°æ®ï¼Œå¯¹å¼‚å¸¸æ•°æ®è¿›è¡Œé€€è´¹å¤„ç†ï¼ˆåŒæ—¶æ·»åŠ é€€è´¹é¡µé¢ï¼‰\n\n","categories":["æ–¹æ¡ˆ"],"tags":["æ”¯ä»˜"]},{"title":"28. å®ç° strStr()","url":"/java4u/2021/06/29/28.%20%E5%AE%9E%E7%8E%B0%20strStr()/","content":"28. å®ç° strStr()å®ç° strStr() å‡½æ•°ã€‚\nç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›  -1 ã€‚\nè¯´æ˜ï¼š\nå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚\nå¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸ C è¯­è¨€çš„ strstr() ä»¥åŠ Java çš„ indexOf() å®šä¹‰ç›¸ç¬¦ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šhaystack &#x3D; â€œhelloâ€, needle &#x3D; â€œllâ€è¾“å‡ºï¼š2\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šhaystack &#x3D; â€œaaaaaâ€, needle &#x3D; â€œbbaâ€è¾“å‡ºï¼š-1\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šhaystack &#x3D; â€œâ€, needle &#x3D; â€œâ€è¾“å‡ºï¼š0\næç¤ºï¼š\n1 &lt;&#x3D; haystack.length, needle.length &lt;&#x3D; 10^4haystack å’Œ needle ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆ\nSundayåŒ¹é…å‡è‹¥æˆ‘ä»¬çš„ç›®æ ‡ä¸²ä¸ºï¼šHere is a little Haoæ¨¡å¼ä¸²ä¸ºï¼šlittleä¸€èˆ¬æ¥è®²ï¼Œå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ç¬¬ä¸€æ­¥ï¼Œéƒ½æ˜¯æŠŠç›®æ ‡ä¸²å’Œæ¨¡å¼ä¸²å¯¹é½\n\nè€Œå¯¹äºSUNDAYç®—æ³•ï¼Œæˆ‘ä»¬ä»å¤´éƒ¨å¼€å§‹æ¯”è¾ƒï¼Œä¸€æ—¦å‘ç°ä¸åŒ¹é…ï¼Œç›´æ¥æ‰¾åˆ°ä¸»ä¸²ä¸­ä½äºæ¨¡å¼ä¸²åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œå³ä¸‹é¢ç»¿è‰²çš„ â€œsâ€ã€‚ï¼ˆè¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæ˜¯æ‰¾æ¨¡å¼ä¸²åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚åœ¨æŠŠæ¨¡å¼ä¸²å’Œç›®æ ‡ä¸²å¯¹é½åï¼Œå¦‚æœå‘ç°ä¸åŒ¹é…ï¼Œé‚£è‚¯å®šéœ€è¦ç§»åŠ¨æ¨¡å¼ä¸²ã€‚é—®é¢˜æ˜¯éœ€è¦ç§»åŠ¨å¤šå°‘æ­¥ã€‚å„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ä¹‹é—´çš„å·®åˆ«ä¹Ÿæ¥è‡ªäºè¿™ä¸ªåœ°æ–¹ï¼Œå¯¹äºKMPï¼Œæ˜¯å»ºç«‹éƒ¨åˆ†åŒ¹é…è¡¨æ¥è®¡ç®—ã€‚BMï¼Œæ˜¯åå‘æ¯”è¾ƒè®¡ç®—ç§»åŠ¨é‡ã€‚å¯¹äºSUNDAYï¼Œå°±æ˜¯æ‰¾åˆ°æ¨¡å¼ä¸²åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚å› ä¸ºï¼Œæ— è®ºæ¨¡å¼ä¸²ç§»åŠ¨å¤šå°‘æ­¥ï¼Œæ¨¡å¼ä¸²åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦éƒ½è¦å‚ä¸ä¸‹ä¸€æ¬¡æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ â€œsâ€ï¼‰\n\næ‰¾åˆ°äº†æ¨¡å¼ä¸²åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ â€œsâ€ï¼Œæ¥ä¸‹æ¥è¯¥æ€ä¹ˆåšï¼Ÿæˆ‘ä»¬éœ€è¦æŸ¥çœ‹æ¨¡å¼ä¸²ä¸­æ˜¯å¦åŒ…å«è¿™ä¸ªå…ƒç´ ï¼Œå¦‚æœä¸åŒ…å«é‚£å°±å¯ä»¥è·³è¿‡ä¸€å¤§ç‰‡ï¼Œä»è¯¥å­—ç¬¦çš„ä¸‹ä¸€ä¸ªå­—ç¬¦å¼€å§‹æ¯”è¾ƒã€‚\n\nå› ä¸ºä»ç„¶ä¸åŒ¹é…ï¼ˆç©ºæ ¼å’Œlï¼‰ï¼Œæˆ‘ä»¬ç»§ç»­é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ã€‚æ‰¾åˆ°æ¨¡å¼ä¸²çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼št\n\nç°åœ¨æœ‰æ„æ€äº†ï¼Œæˆ‘ä»¬å‘ç° t è¢«åŒ…å«äºæ¨¡å¼ä¸²ä¸­ï¼Œå¹¶ä¸” t å‡ºç°åœ¨æ¨¡å¼ä¸²å€’æ•°ç¬¬3ä¸ªã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠæ¨¡å¼ä¸²å‘å‰ç§»åŠ¨3ä¸ªå•ä½ï¼š\n\nåŒ¹é…æˆåŠŸï¼Œæ€»ç»“ï¼š\n\nå¯¹é½ç›®æ ‡ä¸²å’Œæ¨¡å¼ä¸²ï¼Œä»å‰å‘ååŒ¹é…\nå…³æ³¨ä¸»ä¸²ä¸­ä½äºæ¨¡å¼ä¸²åé¢çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆæ ¸å¿ƒï¼‰\nå¦‚æœå…³æ³¨çš„å­—ç¬¦æ²¡æœ‰åœ¨å­ä¸²ä¸­å‡ºç°åˆ™ç›´æ¥è·³è¿‡\nå¦åˆ™å¼€å§‹ç§»åŠ¨æ¨¡å¼ä¸²ï¼Œç§»åŠ¨ä½æ•° &#x3D; å­ä¸²é•¿åº¦ - è¯¥å­—ç¬¦æœ€å³å‡ºç°çš„ä½ç½®(ä»¥0å¼€å§‹)\n\né¢˜è§£/**     * Sunday åŒ¹é…     * å¯¹é½ç›®æ ‡ä¸²å’Œæ¨¡å¼ä¸²ï¼Œä»å‰å‘ååŒ¹é…     * å…³æ³¨ä¸»ä¸²ä¸­ä½äºæ¨¡å¼ä¸²åé¢çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆæ ¸å¿ƒï¼‰     * å¦‚æœå…³æ³¨çš„å­—ç¬¦æ²¡æœ‰åœ¨å­ä¸²ä¸­å‡ºç°åˆ™ç›´æ¥è·³è¿‡     * å¦åˆ™å¼€å§‹ç§»åŠ¨æ¨¡å¼ä¸²ï¼Œç§»åŠ¨ä½æ•° = å­ä¸²é•¿åº¦ - è¯¥å­—ç¬¦æœ€å³å‡ºç°çš„ä½ç½®(ä»¥0å¼€å§‹)     *                     01234567890123456789     * @param origin ç›®æ ‡ä¸² Here is a little Hao     * @param aim    æ¨¡å¼ä¸² little     * @return     */    public int strStr(String origin, String aim) &#123;        if (origin == null || aim == null) &#123;            return 0;        &#125;        if (origin.length() &lt; aim.length()) &#123;            return -1;        &#125;        //ç›®æ ‡ä¸²åŒ¹é…ç´¢        int originIndex = 0;        //æ¨¡å¼ä¸²åŒ¹é…ç´¢å¼•        int aimIndex = 0;        // æˆåŠŸåŒ¹é…å®Œç»ˆæ­¢æ¡ä»¶ï¼šæ‰€æœ‰aimå‡æˆåŠŸåŒ¹é…        while (aimIndex &lt; aim.length()) &#123;            // é’ˆå¯¹originåŒ¹é…å®Œï¼Œä½†aimæœªåŒ¹é…å®Œæƒ…å†µå¤„ç† å¦‚ mississippi sippia            if (originIndex &gt; origin.length() - 1) &#123;                return -1;            &#125;            if (origin.charAt(originIndex) == aim.charAt(aimIndex)) &#123;                // åŒ¹é…åˆ™indexå‡åŠ 1                originIndex++;                aimIndex++;            &#125; else &#123;                //åœ¨æˆ‘ä»¬ä¸Šé¢çš„æ ·ä¾‹ä¸­ï¼Œç¬¬ä¸€æ¬¡è®¡ç®—å€¼ä¸º6(s)ï¼Œç¬¬äºŒæ¬¡å€¼ä¸º13(t)                int nextCharIndex = originIndex - aimIndex + aim.length();                //åˆ¤æ–­ä¸‹ä¸€ä¸ªç›®æ ‡å­—ç¬¦ï¼ˆä¸Šé¢å›¾é‡Œçš„é‚£ä¸ªç»¿æ¡†æ¡†ï¼‰æ˜¯å¦å­˜åœ¨ã€‚                if (nextCharIndex &lt; origin.length()) &#123;                    // åˆ¤æ–­ç›®æ ‡å­—ç¬¦åœ¨æ¨¡å¼ä¸²ä¸­åŒ¹é…åˆ°ï¼Œè¿”å›æœ€åä¸€ä¸ªåŒ¹é…çš„index                    int step = aim.lastIndexOf(origin.charAt(nextCharIndex));                    if (step == -1) &#123;                        // ä¸å­˜åœ¨çš„è¯ï¼Œè®¾ç½®åˆ°ç›®æ ‡å­—ç¬¦çš„ä¸‹ä¸€ä¸ªå…ƒç´                         originIndex = nextCharIndex + 1;                    &#125; else &#123;                        // å­˜åœ¨çš„è¯ï¼Œç§»åŠ¨å¯¹åº”çš„æ•°å­—ï¼ˆå‚è€ƒä¸Šæ–‡ä¸­çš„å­˜åœ¨å…¬å¼ï¼‰                        originIndex = nextCharIndex - step;                    &#125;                    //æ¨¡å¼ä¸²æ€»æ˜¯ä»ç¬¬ä¸€ä¸ªå¼€å§‹åŒ¹é…                    aimIndex = 0;                &#125; else &#123;                    return -1;                &#125;            &#125;        &#125;        return originIndex - aimIndex;    &#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å­—ç¬¦ä¸²"]},{"title":"387. å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦","url":"/java4u/2021/06/28/387.%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80%E5%AD%97%E7%AC%A6/","content":"387. å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå”¯ä¸€å­—ç¬¦ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œæ‰¾åˆ° å®ƒçš„ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ï¼Œå¹¶è¿”å›å®ƒçš„ç´¢å¼• ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1 ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥: s &#x3D; â€œleetcodeâ€è¾“å‡º: 0\nç¤ºä¾‹ 2:\nè¾“å…¥: s &#x3D; â€œloveleetcodeâ€è¾“å‡º: 2\nç¤ºä¾‹ 3:\nè¾“å…¥: s &#x3D; â€œaabbâ€è¾“å‡º: -1\næç¤º:\n1 &lt;&#x3D; s.length &lt;&#x3D; 10^5s åªåŒ…å«å°å†™å­—æ¯\né¢˜è§£/** * éå†å­—ç¬¦ä¸²ï¼Œè®°å½•å­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½® * å½“å­—ç¬¦å†æ¬¡å‡ºç°ï¼Œå°†å­—ç¬¦çš„ä½ç½®ç½®ä¸º-1 * æœ€åéå†æ•°ç»„ï¼ŒæŸ¥æ‰¾ä¸æ˜¯0æˆ–-1çš„å­—ç¬¦ * * @param s * @return */public int firstUniqChar(String s) &#123;    if (s == null || s.length() == 0) return -1;    int[] arr = new int[26];    char[] chars = s.toCharArray();    for (int i = 0; i &lt; chars.length; i++) &#123;        char ch = chars[i];        if (arr[ch - &#x27;a&#x27;] != 0) &#123;            arr[ch - &#x27;a&#x27;] = -1;        &#125; else &#123;            //å­˜æ”¾å­—ç¬¦çš„ä½ç½®å‘å³ç§»åŠ¨1ä½ï¼Œè®©ç¬¬ä¸€ä½å’Œåˆå§‹åŒºåˆ†            arr[ch - &#x27;a&#x27;] = i + 1;        &#125;    &#125;    //éœ€è¦æ‰¾åˆ°ä¸æ˜¯0æˆ–-1 çš„æœ€å°å€¼    int min = Integer.MAX_VALUE;    for (int j : arr) &#123;        if (j != 0 &amp;&amp; j != -1) &#123;            min = Math.min(min, --j);        &#125;    &#125;    return min == Integer.MAX_VALUE ? -1 : min;&#125;/** * åªåŒ…å«å°å†™å­—æ¯ï¼Œå¯ä»¥ç”³æ˜ä¸€ä¸ª26çš„æ•°ç»„ * ç¬¬ä¸€æ¬¡éå†è®°å½•æ¯ä¸ªå­—æ¯æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½® * ç¬¬äºŒæ¬¡éå†è·å–å­—æ¯ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¸åŒä¸º-1ï¼Œç›¸åŒå³ä¸ºè¦æ‰¾çš„ä½ç½® * * @param s * @return */public int firstUniqChar2(String s) &#123;    if (s == null || s.length() == 0) return -1;    int[] arr = new int[26];    char[] chars = s.toCharArray();    //ç¬¬ä¸€æ¬¡éå† è®°å½•æ¯ä¸ªå­—æ¯æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®    for (int i = 0; i &lt; chars.length; i++) &#123;        char ch = chars[i];        arr[ch - &#x27;a&#x27;] = i;    &#125;    //ç¬¬äºŒæ¬¡éå†è·å–å­—æ¯ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½® ä¸ æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®è¿›è¡Œæ¯”è¾ƒ    for (int j = 0; j &lt; chars.length; j++) &#123;        char ch2 = chars[j];        if (arr[ch2 - &#x27;a&#x27;] == j) &#123;            return j;        &#125; else &#123;            arr[ch2 - &#x27;a&#x27;] = -1;        &#125;    &#125;    return -1;&#125;/** * æˆ‘ä»¬å¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¸¤æ¬¡éå†ã€‚ * &lt;p&gt; * åœ¨ç¬¬ä¸€æ¬¡éå†æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œæ˜ å°„ç»Ÿè®¡å‡ºå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚ * åœ¨ç¬¬äºŒæ¬¡éå†æ—¶ï¼Œæˆ‘ä»¬åªè¦éå†åˆ°äº†ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ï¼Œé‚£ä¹ˆå°±è¿”å›å®ƒçš„ç´¢å¼•ï¼Œå¦åˆ™åœ¨éå†ç»“æŸåè¿”å› -1âˆ’1ã€‚ * * @param s * @return */public int firstUniqChar3(String s) &#123;    Map&lt;Character, Integer&gt; frequency = new HashMap&lt;Character, Integer&gt;();    for (int i = 0; i &lt; s.length(); ++i) &#123;        char ch = s.charAt(i);        frequency.put(ch, frequency.getOrDefault(ch, 0) + 1);    &#125;    for (int i = 0; i &lt; s.length(); ++i) &#123;        if (frequency.get(s.charAt(i)) == 1) &#123;            return i;        &#125;    &#125;    return -1;&#125;/** * æˆ‘ä»¬å¯ä»¥å¯¹æ–¹æ³•ä¸€è¿›è¡Œä¿®æ”¹ï¼Œä½¿å¾—ç¬¬äºŒæ¬¡éå†çš„å¯¹è±¡ä»å­—ç¬¦ä¸²å˜ä¸ºå“ˆå¸Œæ˜ å°„ã€‚ * å…·ä½“åœ°ï¼Œå¯¹äºå“ˆå¸Œæ˜ å°„ä¸­çš„æ¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå€¼è¡¨ç¤ºå®ƒçš„é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼ˆå¦‚æœè¯¥å­—ç¬¦åªå‡ºç°ä¸€æ¬¡ï¼‰ * æˆ–è€… âˆ’1ï¼ˆå¦‚æœè¯¥å­—ç¬¦å‡ºç°å¤šæ¬¡ï¼‰ã€‚å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡éå†å­—ç¬¦ä¸²æ—¶ï¼Œè®¾å½“å‰éå†åˆ°çš„å­—ç¬¦ä¸º cï¼Œå¦‚æœ c ä¸åœ¨å“ˆå¸Œæ˜ å°„ä¸­ï¼Œ * æˆ‘ä»¬å°±å°† c ä¸å®ƒçš„ç´¢å¼•ä½œä¸ºä¸€ä¸ªé”®å€¼å¯¹åŠ å…¥å“ˆå¸Œæ˜ å°„ä¸­ï¼Œ * å¦åˆ™æˆ‘ä»¬å°† c åœ¨å“ˆå¸Œæ˜ å°„ä¸­å¯¹åº”çš„å€¼ä¿®æ”¹ä¸º âˆ’1ã€‚ * åœ¨ç¬¬ä¸€æ¬¡éå†ç»“æŸåï¼Œæˆ‘ä»¬åªéœ€è¦å†éå†ä¸€æ¬¡å“ˆå¸Œæ˜ å°„ä¸­çš„æ‰€æœ‰å€¼ï¼Œæ‰¾å‡ºå…¶ä¸­ä¸ä¸º âˆ’1 çš„æœ€å°å€¼ï¼Œ * å³ä¸ºç¬¬ä¸€ä¸ªä¸é‡å¤å­—ç¬¦çš„ç´¢å¼•ã€‚å¦‚æœå“ˆå¸Œæ˜ å°„ä¸­çš„æ‰€æœ‰å€¼å‡ä¸º âˆ’1ï¼Œæˆ‘ä»¬å°±è¿”å› âˆ’1ã€‚ * * @param s * @return */public int firstUniqChar4(String s) &#123;    Map&lt;Character, Integer&gt; position = new HashMap&lt;Character, Integer&gt;();    int n = s.length();    for (int i = 0; i &lt; n; ++i) &#123;        char ch = s.charAt(i);        if (position.containsKey(ch)) &#123;            position.put(ch, -1);        &#125; else &#123;            position.put(ch, i);        &#125;    &#125;    int first = n;    for (Map.Entry&lt;Character, Integer&gt; entry : position.entrySet()) &#123;        int pos = entry.getValue();        if (pos != -1 &amp;&amp; pos &lt; first) &#123;            first = pos;        &#125;    &#125;    if (first == n) &#123;        first = -1;    &#125;    return first;&#125;    ","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å­—ç¬¦ä¸²"]},{"title":"344. åè½¬å­—ç¬¦ä¸²","url":"/java4u/2021/06/26/344.%20%E5%8F%8D%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2/","content":"344. åè½¬å­—ç¬¦ä¸²ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ s çš„å½¢å¼ç»™å‡ºã€‚\nä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs &#x3D; [â€œhâ€,â€eâ€,â€lâ€,â€lâ€,â€oâ€]è¾“å‡ºï¼š[â€œoâ€,â€lâ€,â€lâ€,â€eâ€,â€hâ€]\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šs &#x3D; [â€œHâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€hâ€]è¾“å‡ºï¼š[â€œhâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€Hâ€]\næç¤ºï¼š\n1 &lt;&#x3D; s.length &lt;&#x3D; 10^5s[i] éƒ½æ˜¯ ASCII ç è¡¨ä¸­çš„å¯æ‰“å°å­—ç¬¦\né¢˜è§£//ä½¿ç”¨åŒæŒ‡é’ˆäº¤æ¢å­—ç¬¦public void reverseString(char[] s) &#123;    if(s == null || s.length == 0)return;    int left = 0;    int right = s.length-1;    while (left &lt; right)&#123;        char temp = s[left];        s[left] = s[right];        s[right] = temp;        left++;        right--;    &#125;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å­—ç¬¦ä¸²"]},{"title":"120. ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ","url":"/java4u/2021/06/23/120.%20%E4%B8%89%E8%A7%92%E5%BD%A2%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E5%92%8C/","content":"120. ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œç»™å®šä¸€ä¸ªä¸‰è§’å½¢ triangle ï¼Œæ‰¾å‡ºè‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œã€‚\næ¯ä¸€æ­¥åªèƒ½ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œä¸­ç›¸é‚»çš„ç»“ç‚¹ä¸Šã€‚ç›¸é‚»çš„ç»“ç‚¹ åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯ ä¸‹æ ‡ ä¸ ä¸Šä¸€å±‚ç»“ç‚¹ä¸‹æ ‡ ç›¸åŒæˆ–è€…ç­‰äº ä¸Šä¸€å±‚ç»“ç‚¹ä¸‹æ ‡ + 1 çš„ä¸¤ä¸ªç»“ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ­£ä½äºå½“å‰è¡Œçš„ä¸‹æ ‡ i ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥å¯ä»¥ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œçš„ä¸‹æ ‡ i æˆ– i + 1 ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼štriangle &#x3D; [[2],[3,4],[6,5,7],[4,1,8,3]]è¾“å‡ºï¼š11è§£é‡Šï¼šå¦‚ä¸‹é¢ç®€å›¾æ‰€ç¤ºï¼š\n   2  3 4 6 5 74 1 8 3\nè‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œä¸º 11ï¼ˆå³ï¼Œ2 + 3 + 5 + 1 &#x3D; 11ï¼‰ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼štriangle &#x3D; [[-10]]è¾“å‡ºï¼š-10\næç¤ºï¼š\n1 &lt;&#x3D; triangle.length &lt;&#x3D; 200triangle[0].length &#x3D;&#x3D; 1triangle[i].length &#x3D;&#x3D; triangle[i - 1].length + 1-10^4 &lt;&#x3D; triangle[i][j] &lt;&#x3D; 10^4\nè¿›é˜¶ï¼š\nä½ å¯ä»¥åªä½¿ç”¨ O(n) çš„é¢å¤–ç©ºé—´ï¼ˆn ä¸ºä¸‰è§’å½¢çš„æ€»è¡Œæ•°ï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ\né¢˜è§£/** *    2             2 *   3 4    è½¬æ¢ä¸‹   3 4 *  6 5 7           6 5 7 * 4 1 8 3          4 1 8 3 * å³æ¯å±‚çš„è·¯å¾„å°±æ˜¯ä¸Šå±‚å’Œä¸Šå±‚å·¦è¾¹çš„ä½ç½®ç§»åŠ¨æ¥ * dp[i][j]è¡¨ç¤ºæ¯æ ¼æœ€å°è·¯å¾„å’Œ * æˆ‘ä»¬ç”¨ f[i][j] è¡¨ç¤ºä»ä¸‰è§’å½¢é¡¶éƒ¨èµ°åˆ°ä½ç½® (i,j) çš„æœ€å°è·¯å¾„å’Œã€‚è¿™é‡Œçš„ä½ç½® (i,j) * æŒ‡çš„æ˜¯ä¸‰è§’å½¢ä¸­ç¬¬ i è¡Œç¬¬ j åˆ—ï¼ˆå‡ä» 0 å¼€å§‹ç¼–å·ï¼‰çš„ä½ç½®ã€‚ * ç”±äºæ¯ä¸€æ­¥åªèƒ½ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œã€Œç›¸é‚»çš„èŠ‚ç‚¹ã€ä¸Šï¼Œå› æ­¤è¦æƒ³èµ°åˆ°ä½ç½® (i,j)ï¼Œ * ä¸Šä¸€æ­¥å°±åªèƒ½åœ¨ä½ç½® (iâˆ’1,jâˆ’1) æˆ–è€…ä½ç½® (iâˆ’1,j)ã€‚ * æˆ‘ä»¬åœ¨è¿™ä¸¤ä¸ªä½ç½®ä¸­é€‰æ‹©ä¸€ä¸ªè·¯å¾„å’Œè¾ƒå°çš„æ¥è¿›è¡Œè½¬ç§»ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š * f[i][j]=min(f[iâˆ’1][jâˆ’1],f[iâˆ’1][j])+c[i][j] * å…¶ä¸­ c[i][j] è¡¨ç¤ºä½ç½® (i,j) å¯¹åº”çš„å…ƒç´ å€¼ã€‚ * æ³¨æ„ç¬¬ i è¡Œæœ‰ i+1 ä¸ªå…ƒç´ ï¼Œå®ƒä»¬å¯¹åº”çš„ j çš„èŒƒå›´ä¸º [0,i]ã€‚ * å½“ j=0 æˆ– j=i æ—¶ï¼Œä¸Šè¿°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­æœ‰ä¸€äº›é¡¹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ * ä¾‹å¦‚å½“ j=0 æ—¶ï¼Œf[iâˆ’1][jâˆ’1] æ²¡æœ‰æ„ä¹‰ï¼Œå› æ­¤çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š * f[i][0]=f[iâˆ’1][0]+c[i][0] * å³å½“æˆ‘ä»¬åœ¨ç¬¬ i è¡Œçš„æœ€å·¦ä¾§æ—¶ï¼Œæˆ‘ä»¬åªèƒ½ä»ç¬¬ iâˆ’1 è¡Œçš„æœ€å·¦ä¾§ç§»åŠ¨è¿‡æ¥ã€‚ * å½“ j=i æ—¶ï¼Œf[iâˆ’1][j] æ²¡æœ‰æ„ä¹‰ï¼Œå› æ­¤çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š * f[i][i]=f[iâˆ’1][iâˆ’1]+c[i][i] * å³å½“æˆ‘ä»¬åœ¨ç¬¬ i è¡Œçš„æœ€å³ä¾§æ—¶ï¼Œæˆ‘ä»¬åªèƒ½ä»ç¬¬ iâˆ’1 è¡Œçš„æœ€å³ä¾§ç§»åŠ¨è¿‡æ¥ã€‚ * æœ€ç»ˆçš„ç­”æ¡ˆå³ä¸º f[nâˆ’1][0] åˆ° f[nâˆ’1][nâˆ’1] ä¸­çš„æœ€å°å€¼ï¼Œå…¶ä¸­ n æ˜¯ä¸‰è§’å½¢çš„è¡Œæ•°ã€‚ * * @param triangle * @return */public int minimumTotal(List&lt;List&lt;Integer&gt;&gt; triangle) &#123;    int h = triangle.size();    int l = triangle.get(h-1).size();    int[][] dp = new int[h][l];    int pre = triangle.get(0).get(0);    dp[0][0] = pre;    for (int i = 1; i &lt; h; i++) &#123;        List&lt;Integer&gt; t = triangle.get(i);        for (int j = 0; j &lt; t.size(); j++) &#123;            if(j == 0)&#123;                dp[i][j] = dp[i-1][j] + t.get(j);            &#125;else if(j == t.size()-1)&#123;                dp[i][j] = dp[i-1][j-1] + t.get(j);            &#125;else&#123;                dp[i][j] = Math.min(dp[i-1][j], dp[i-1][j-1]) + t.get(j);            &#125;        &#125;    &#125;    int min = Integer.MAX_VALUE;    for (int k = 0; k &lt; l; k++) &#123;        min = Math.min(min, dp[h - 1][k]);    &#125;    return min;&#125;//æ¢ä¸€ç§å†™æ³• çœ‹ä¸Šå»æ›´å¥½çœ‹public int minimumTotal2(List&lt;List&lt;Integer&gt;&gt; triangle) &#123;    int n = triangle.size();    int[][] f = new int[n][n];    f[0][0] = triangle.get(0).get(0);    for (int i = 1; i &lt; n; ++i) &#123;        f[i][0] = f[i - 1][0] + triangle.get(i).get(0);        for (int j = 1; j &lt; i; ++j) &#123;            f[i][j] = Math.min(f[i - 1][j - 1], f[i - 1][j]) + triangle.get(i).get(j);        &#125;        f[i][i] = f[i - 1][i - 1] + triangle.get(i).get(i);    &#125;    int minTotal = f[n - 1][0];    for (int i = 1; i &lt; n; ++i) &#123;        minTotal = Math.min(minTotal, f[n - 1][i]);    &#125;    return minTotal;&#125;/** * åŠ¨æ€è§„åˆ™éƒ½å¯ä»¥å°†äºŒç»´æ•°ç»„å‹ç¼©æˆä¸€ç»´æ•°ç»„ï¼Œå‡å°‘ç©ºé—´ * ä¸‰è§’å½¢è‡ªé¡¶è€Œä¸‹è®¡ç®—ï¼Œå…¶å®åªéœ€è¦ä¸Šä¸€å±‚çš„æ•°æ®å°±å¯ä»¥è¿›è¡Œè®¡ç®— * * ä¸é€šè¿‡ * ä¸‹å±‚dpç”±ä¸Šå±‚è®¡ç®—è€Œæ¥ï¼Œæ‰€ä»¥æ¯æ¬¡è®¡ç®—ä¸‹å±‚çš„dpéƒ½ä¼šè¢«ä¸Šå±‚å·¦ä¾§çš„ç»“æœå½±å“ * éœ€è¦ä¿ç•™æœ€è¿‘çš„ä¸€æ¬¡è®¡ç®—ç»“æœå³ç»´æŒä¸€ä¸ªäºŒç»´æ•°ç»„ * @param triangle * @return */public int minimumTotal3(List&lt;List&lt;Integer&gt;&gt; triangle) &#123;    int h = triangle.size();    int l = triangle.get(h-1).size();    int[] dp = new int[l];    dp[0]=triangle.get(0).get(0);    for (int i = 1; i &lt; h; ++i) &#123;        List&lt;Integer&gt; t = triangle.get(i);        for (int j = 0; j &lt; t.size(); j++) &#123;            if(j==0)&#123;                dp[j]+=triangle.get(i).get(j);            &#125;else if(j==t.size()-1)&#123;                dp[j]=dp[j-1]+triangle.get(i).get(j);            &#125;else&#123;                dp[j]=Math.min(dp[j-1],dp[j])+triangle.get(i).get(j);            &#125;        &#125;    &#125;    int min = dp[0];    for (int k = 0; k &lt; l; k++) &#123;        min = Math.min(min, dp[k]);    &#125;    return min;&#125;//ä½¿ç”¨äºŒç»´æ•°ç»„å‹ç¼©//åˆ¤æ–­æœ‰ç‚¹å¤šï¼Œåªæ˜¯åˆ¤æ–­è¡Œçš„å¥‡å¶æ€§ï¼Œå¯ä»¥å–æ¨¡ä¼˜åŒ–public int minimumTotal4(List&lt;List&lt;Integer&gt;&gt; triangle) &#123;    int h = triangle.size();    int l = triangle.get(h-1).size();    int[][] dp = new int[2][l];    dp[0][0]=triangle.get(0).get(0);    if(h==1)return dp[0][0];    dp[1][0]=dp[0][0]+triangle.get(1).get(0);    dp[1][1]=dp[0][0]+triangle.get(1).get(1);    if(h==2)return Math.min(dp[1][0],dp[1][1]);    for (int i = 2; i &lt; h; ++i) &#123;        List&lt;Integer&gt; t = triangle.get(i);        for (int j = 0; j &lt; t.size(); j++) &#123;            if(j==0)&#123;                if(i%2==1)&#123;                    dp[1][j]=dp[0][j]+triangle.get(i).get(j);                &#125;else&#123;                    dp[0][j]=dp[1][j]+triangle.get(i).get(j);                &#125;            &#125;else if(j==t.size()-1)&#123;                if(i%2==1)&#123;                    dp[1][j]=dp[0][j-1]+triangle.get(i).get(j);                &#125;else&#123;                    dp[0][j]=dp[1][j-1]+triangle.get(i).get(j);                &#125;            &#125;else&#123;                if(i%2==1)&#123;                    dp[1][j]=Math.min(dp[0][j-1],dp[0][j])+triangle.get(i).get(j);                &#125;else&#123;                    dp[0][j]=Math.min(dp[1][j-1],dp[1][j])+triangle.get(i).get(j);                &#125;            &#125;        &#125;    &#125;    int min = Integer.MAX_VALUE;    if(h%2==0)&#123;        for (int k = 0; k &lt; l; k++) &#123;            min = Math.min(min, dp[1][k]);        &#125;    &#125;else&#123;        for (int k = 0; k &lt; l; k++) &#123;            min = Math.min(min, dp[0][k]);        &#125;    &#125;    return min;&#125;public int minimumTotal5(List&lt;List&lt;Integer&gt;&gt; triangle) &#123;    int n = triangle.size();    int[][] f = new int[2][n];    f[0][0] = triangle.get(0).get(0);    for (int i = 1; i &lt; n; ++i) &#123;        //ç”¨ 1-å½“å‰è¡Œæ•°æ¨¡2 æ¥ç¡®å®šæ•°æ®æ”¾åœ¨å“ªè¡Œ        int curr = i % 2;        int prev = 1 - curr;        f[curr][0] = f[prev][0] + triangle.get(i).get(0);        for (int j = 1; j &lt; i; ++j) &#123;            f[curr][j] = Math.min(f[prev][j - 1], f[prev][j]) + triangle.get(i).get(j);        &#125;        f[curr][i] = f[prev][i - 1] + triangle.get(i).get(i);    &#125;    int minTotal = f[(n - 1) % 2][0];    for (int i = 1; i &lt; n; ++i) &#123;        minTotal = Math.min(minTotal, f[(n - 1) % 2][i]);    &#125;    return minTotal;&#125;//è¿˜æ˜¯å¯ä»¥å‹ç¼©æˆ1ç»´æ•°ç»„//æ¯æ¬¡è®¡ç®—çš„æ—¶å€™ä»è¯¥è¡Œæœ€åå¼€å§‹è®¡ç®—//å› ä¸ºdpè®¡ç®—ç»“æœæ˜¯ä»ä¸Šé¢å’Œå·¦ä¾§è®¡ç®—æ¥çš„ï¼Œå³ä¾§ç»“æœä¸ä¼šå½±å“public int minimumTotal6(List&lt;List&lt;Integer&gt;&gt; triangle) &#123;    int n = triangle.size();    int[] f = new int[n];    f[0] = triangle.get(0).get(0);    for (int i = 1; i &lt; n; ++i) &#123;        f[i] = f[i - 1] + triangle.get(i).get(i);        for (int j = i - 1; j &gt; 0; --j) &#123;            f[j] = Math.min(f[j - 1], f[j]) + triangle.get(i).get(j);        &#125;        f[0] += triangle.get(i).get(0);    &#125;    int minTotal = f[0];    for (int i = 1; i &lt; n; ++i) &#123;        minTotal = Math.min(minTotal, f[i]);    &#125;    return minTotal;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"300. æœ€é•¿é€’å¢å­åºåˆ—","url":"/java4u/2021/06/22/300.%20%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/","content":"300. æœ€é•¿é€’å¢å­åºåˆ—ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚\nå­åºåˆ— æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ[3,6,2,7] æ˜¯æ•°ç»„ [0,3,1,6,2,2,7] çš„å­åºåˆ—ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [10,9,2,5,3,7,101,18]è¾“å‡ºï¼š4è§£é‡Šï¼šæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå› æ­¤é•¿åº¦ä¸º 4 ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0,1,0,3,2,3]è¾“å‡ºï¼š4\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [7,7,7,7,7,7,7]è¾“å‡ºï¼š1\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 2500-104 &lt;&#x3D; nums[i] &lt;&#x3D; 104\nè¿›é˜¶ï¼š\nä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° O(n log(n)) å—?\né¢˜è§£/** * å®šä¹‰ dp[i] ä¸ºè€ƒè™‘å‰ i ä¸ªå…ƒç´ ï¼Œä»¥ç¬¬ i ä¸ªæ•°å­—ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ï¼Œ * æ³¨æ„ nums[i] å¿…é¡»è¢«é€‰å–ã€‚ * è¢«é€‰ä¸­çš„nums[i]å¯èƒ½å¤§äºç­‰äºæˆ–å°äºå‰é¢çš„æ•° * å³ä»¥nums[i]ç»“å°¾çš„æœ€é•¿åºåˆ—æ˜¯ç”±å‰é¢å­é›†æœ€ä¼˜è§£æ¨ç®—å‡ºæ¥ * * æˆ‘ä»¬ä»å°åˆ°å¤§è®¡ç®— dp æ•°ç»„çš„å€¼ï¼Œåœ¨è®¡ç®— dp[i] ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»è®¡ç®—å‡º dp[0â€¦iâˆ’1] çš„å€¼ï¼Œåˆ™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š * dp[i]=max(dp[j])+1,å…¶ä¸­0â‰¤j&lt;iä¸”num[j]&lt;num[i] * å³è€ƒè™‘å¾€ dp[0â€¦iâˆ’1] ä¸­æœ€é•¿çš„ä¸Šå‡å­åºåˆ—åé¢å†åŠ ä¸€ä¸ª nums[i]ã€‚ * ç”±äº dp[j] ä»£è¡¨ nums[0â€¦j] ä¸­ä»¥ nums[j] ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼Œ * æ‰€ä»¥å¦‚æœèƒ½ä» dp[j] è¿™ä¸ªçŠ¶æ€è½¬ç§»è¿‡æ¥ï¼Œé‚£ä¹ˆ nums[i] å¿…ç„¶è¦å¤§äº nums[j]ï¼Œ * æ‰èƒ½å°† nums[i] æ”¾åœ¨ nums[j] åé¢ä»¥å½¢æˆæ›´é•¿çš„ä¸Šå‡å­åºåˆ—ã€‚ * * æœ€åï¼Œæ•´ä¸ªæ•°ç»„çš„æœ€é•¿ä¸Šå‡å­åºåˆ—å³æ‰€æœ‰ dp[i] ä¸­çš„æœ€å¤§å€¼ã€‚ * LISlength=max(dp[i]),å…¶ä¸­0â‰¤i&lt;n * * @param nums * @return */public int lengthOfLIS(int[] nums) &#123;    if (nums.length == 0) &#123;        return 0;    &#125;    int[] dp = new int[nums.length];    dp[0] = 1;    int maxans = 1;    for (int i = 1; i &lt; nums.length; i++) &#123;        dp[i] = 1;        //dp[i]çš„å€¼ç”±ä¹‹å‰dp[j](0&lt;j&lt;i)å¾—åˆ°        //åªè¦å½“nums[i]&gt;nums[j]æ—¶ï¼Œå¯ä»¥å°†iæ‹¼åœ¨åºåˆ—å        //å½“nums[i]&lt;=nums[j]æ—¶ï¼Œæ— æ³•å°†iæ‹¼åœ¨åºåˆ—åï¼Œ        //ä¸æ»¡è¶³nums[i]è¢«é€‰ä¸­çš„æ¡ä»¶ï¼Œä¸è€ƒè™‘        for (int j = 0; j &lt; i; j++) &#123;            if (nums[i] &gt; nums[j]) &#123;                //dp[i]æ˜¯dp[j]+1çš„æœ€å¤§å€¼                dp[i] = Math.max(dp[i], dp[j] + 1);            &#125;        &#125;        maxans = Math.max(maxans, dp[i]);    &#125;    return maxans;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"53. æœ€å¤§å­æ•°ç»„å’Œ","url":"/java4u/2021/06/19/53.%20%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84%E5%92%8C/","content":"53. æœ€å¤§å­æ•°ç»„å’Œç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚\nå­æ•°ç»„ æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [-2,1,-3,4,-1,2,1,-5,4]è¾“å‡ºï¼š6è§£é‡Šï¼šè¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6 ã€‚ç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1]è¾“å‡ºï¼š1ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [5,4,-1,7,8]è¾“å‡ºï¼š23\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 105-104 &lt;&#x3D; nums[i] &lt;&#x3D; 104\nè¿›é˜¶ï¼šå¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„ åˆ†æ²»æ³• æ±‚è§£ã€‚\né¢˜è§£/** * dp[i]ï¼šè¡¨ç¤ºä»¥ nums[i] ç»“å°¾çš„è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ * dp[n]è¡¨ç¤ºå½“å‰æœ€å¤§å­åºå’Œï¼Œä»–ç”±dp[n-1]å’Œnums[n]è®¡ç®—æ¥ * dp[n]=dp[n-1]+nums[n] * ä½†å¦‚æœdp[n-1]å°äº0ï¼Œåˆ™å½“å‰ç»“æœè¿˜ä¼šå˜å° * ç”±äºæ˜¯è¿ç»­çš„å­åºï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­æ˜¯ä¹‹å‰çš„dp[n-1]ä¸å½“å‰æ•°ç›¸åŠ ï¼Œè¿˜æ˜¯ nums[n]ç‹¬è‡ªæˆåº * å¾—åˆ°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š * dp[i] = Math.max(dp[i - 1] + nums[i], nums[i]) * å¾—åˆ°æ¯ä¸ªä»¥nums[i]ç»“å°¾çš„å’Œï¼Œéœ€è¦å¾—åˆ°æœ€å¤§çš„å’Œï¼Œéœ€è¦éå† * @param nums * @return */public int maxSubArray(int[] nums) &#123;    int max = Integer.MIN_VALUE;    int len = nums.length;    int[]dp = new int[len];    dp[0]=nums[0];    for (int i = 1; i &lt; len; i++) &#123;        dp[i] = Math.max(dp[i - 1] + nums[i], nums[i]);    &#125;    for (int j = 0; j &lt; len; j++) &#123;        max = Math.max(max, dp[j]);    &#125;    return max;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"70. çˆ¬æ¥¼æ¢¯","url":"/java4u/2021/06/19/70.%20%E7%88%AC%E6%A5%BC%E6%A2%AF/","content":"70. çˆ¬æ¥¼æ¢¯å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚\næ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šn &#x3D; 2è¾“å‡ºï¼š2è§£é‡Šï¼šæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚\n\n1 é˜¶ + 1 é˜¶\n2 é˜¶\n\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šn &#x3D; 3è¾“å‡ºï¼š3è§£é‡Šï¼šæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚\n\n1 é˜¶ + 1 é˜¶ + 1 é˜¶\n1 é˜¶ + 2 é˜¶\n2 é˜¶ + 1 é˜¶\n\næç¤ºï¼š\n1 &lt;&#x3D; n &lt;&#x3D; 45\né¢˜è§£/**     * æˆ‘ä»¬ç”¨ f(x) è¡¨ç¤ºçˆ¬åˆ°ç¬¬ x-1 çº§å°é˜¶çš„æ–¹æ¡ˆæ•°ï¼Œè€ƒè™‘æœ€åä¸€æ­¥å¯èƒ½è·¨äº†ä¸€çº§å°é˜¶ï¼Œä¹Ÿå¯èƒ½è·¨äº†ä¸¤çº§å°é˜¶ï¼Œ     * æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ—å‡ºå¦‚ä¸‹å¼å­ï¼š     * f(x)=f(xâˆ’1)+f(xâˆ’2)     * @param n     * @return     */    public int climbStairs(int n) &#123;        if(n&lt;2)return 1;        int[]dp=new int[n];        dp[0]=1;        dp[1]=2;        for(int i=2;i&lt;n;i++)&#123;            dp[i]=dp[i-1]+dp[i-2];        &#125;        return dp[n-1];    &#125;    /**     * f(x) åªå’Œ f(xâˆ’1) ä¸ f(xâˆ’2) æœ‰å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ã€Œæ»šåŠ¨æ•°ç»„æ€æƒ³ã€æŠŠç©ºé—´å¤æ‚åº¦ä¼˜åŒ–æˆ O(1)     * @param n     * @return     */    public int climbStairs2(int n) &#123;        int first = 0, second = 0, third = 1;        for (int i = 1; i &lt;= n; ++i) &#123;            first = second;            second = third;            third = first + second;        &#125;        return third;    &#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"é«˜é¢‘é¢˜","url":"/java4u/2021/06/18/0.%E9%AB%98%E9%A2%91%E9%A2%98/","content":"1.å¿…é¡»æ·±å…¥äº†è§£çš„çŸ¥è¯†ç‚¹a. javaé›†åˆæ•°æ®ç»“æ„b.jvmï¼šgcã€å†…å­˜æ¨¡å‹ã€å †åˆ†ä»£1ï¼‰jstatæŸ¥çœ‹ gcå®æ—¶æ‰§è¡Œæƒ…å†µ  jstat -gc 12538 5000æ¯5 ç§’ä¸€æ¬¡æ˜¾ç¤ºè¿›ç¨‹å·ä¸º 12538çš„ javaè¿›æˆçš„ GCæƒ…å†µ S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT32256.0 2560.0  0.0   2463.4 106496.0 101729.1  175104.0   53176.1   53808.0 52602.9 6192.0 5861.0     11    0.260   2      0.114    0.37432256.0 2560.0  0.0   2463.4 106496.0 102152.2  175104.0   53176.1   53808.0 52602.9 6192.0 5861.0     11    0.260   2      0.114    0.37432256.0 2560.0  0.0   2463.4 106496.0 102152.2  175104.0   53176.1   53808.0 52602.9 6192.0 5861.0     11    0.260   2      0.114    0.37432256.0 2560.0  0.0   2463.4 106496.0 102217.7  175104.0   53176.1   53808.0 52602.9 6192.0 5861.0     11    0.260   2      0.114    0.37432256.0 2560.0  0.0   2463.4 106496.0 102217.7  175104.0   53176.1   53808.0 52602.9 6192.0 5861.0     11    0.260   2      0.114    0.374\nS0Cå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivoråŒºçš„å®¹é‡ (å­—èŠ‚)S1Cå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivoråŒºçš„å®¹é‡ (å­—èŠ‚)S0Uå¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivoråŒºç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚)S1Uå¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivoråŒºç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚)ECå¹´è½»ä»£ä¸­Edençš„å®¹é‡ (å­—èŠ‚)EUå¹´è½»ä»£ä¸­Edenç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚)OCOldä»£çš„å®¹é‡ (å­—èŠ‚)OUOldä»£ç›®å‰å·²ä½¿ç”¨ç©ºé—´ (å­—èŠ‚)YGCä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ¬¡æ•°YGCTä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ‰€ç”¨æ—¶é—´(s)FGCä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ¬¡æ•°FGCTä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ‰€ç”¨æ—¶é—´(s)GCTä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶gcç”¨çš„æ€»æ—¶é—´(s)\n    jstat -gccapacity 2060    å †å†…å­˜ç»Ÿè®¡\n\n    2ï¼‰ä½¿ç”¨  jmap -heap pid ï¼Œå¯ä»¥æŸ¥çœ‹å„ä¸ªä»£çš„å†…å­˜ä½¿ç”¨æƒ…å†µ\n\nc. å¤šçº¿ç¨‹ï¼švolatileã€java.util.concurrentåŒ…d. springï¼šå¯åŠ¨ã€æ—¶é—´e. redisï¼šåˆ†å¸ƒå¼é”ã€luaä¿è¯åŸâ¼¦æ€§ã€é›†ç¾¤redisæ”¯æŒçš„æ•°æ®ç»“æ„ï¼š\n\nBinary-safe strings.\n\nLists: collections of string elements sorted according to the order of insertion. They are basically linked lists.\n\nSets: collections of unique, unsorted string elements.\n\nSorted sets, similar to Sets but where every string element is associated to a floating number value, called score. The elements are always taken sorted by their score, so unlike Sets it is possible to retrieve a range of elements (for example you may ask: give me the top 10, or the bottom 10).\n\nHashes, which are maps composed of fields associated with values. Both the field and the value are strings. This is very similar to Ruby or Python hashes.\n\nRediså®ç°åˆ†å¸ƒå¼é”Redisä¸ºå•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼ï¼Œé‡‡ç”¨é˜Ÿåˆ—æ¨¡å¼å°†å¹¶å‘è®¿é—®å˜æˆä¸²è¡Œè®¿é—®ï¼Œä¸”å¤šå®¢æˆ·ç«¯å¯¹Redisçš„è¿æ¥å¹¶ä¸å­˜åœ¨ç«äº‰å…³ç³»Redisä¸­å¯ä»¥ä½¿ç”¨SETNXå‘½ä»¤å®ç°åˆ†å¸ƒå¼é”ã€‚\nå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨ï¼Œå°† key çš„å€¼è®¾ä¸º valueã€‚è‹¥ç»™å®šçš„ key å·²ç»å­˜åœ¨ï¼Œåˆ™ SETNX ä¸åšä»»ä½•åŠ¨ä½œ\nSETNX æ˜¯ã€SET if Not eXistsã€(å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ SET)çš„ç®€å†™ã€‚\nè¿”å›å€¼ï¼šè®¾ç½®æˆåŠŸï¼Œè¿”å› 1 ã€‚è®¾ç½®å¤±è´¥ï¼Œè¿”å› 0 ã€‚\n\nä½¿ç”¨SETNXå®ŒæˆåŒæ­¥é”çš„æµç¨‹åŠäº‹é¡¹å¦‚ä¸‹ï¼š\nä½¿ç”¨SETNXå‘½ä»¤è·å–é”ï¼Œè‹¥è¿”å›0ï¼ˆkeyå·²å­˜åœ¨ï¼Œé”å·²å­˜åœ¨ï¼‰åˆ™è·å–å¤±è´¥ï¼Œåä¹‹è·å–æˆåŠŸ\nä¸ºäº†é˜²æ­¢è·å–é”åç¨‹åºå‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹&#x2F;è¿›ç¨‹è°ƒç”¨SETNXå‘½ä»¤æ€»æ˜¯è¿”å›0è€Œè¿›å…¥æ­»é”çŠ¶æ€ï¼Œéœ€è¦ä¸ºè¯¥keyè®¾ç½®ä¸€ä¸ªâ€œåˆç†â€çš„è¿‡æœŸæ—¶é—´\né‡Šæ”¾é”ï¼Œä½¿ç”¨DELå‘½ä»¤å°†é”æ•°æ®åˆ é™¤\n\n\nf. æ¶ˆæ¯é˜Ÿåˆ—ï¼škafkag. Springcloudh. mysqlæœç´¢å¼•æ“ï¼Œç´¢å¼•B+tree2. javaåŸºç¡€ï¼ša. nioæ¨¡å‹b. javaåå°„c. java8ç‰¹æ€§d. javaä¸­æœ‰å“ªäº›é›†åˆï¼Ÿå„â¾ƒçš„æ•°æ®ç»“æ„ï¼Ÿe. è¯´è¯´ä½ â½¤è¿‡çš„è®¾è®¡æ¨¡å¼â€‹\tå•ä¾‹æ¨¡å¼\nâ€‹\tæ¨¡æ¿æ¨¡å¼\nf. jdkä»¥åŠspringä¸­çœ‹è¿‡å“ªäº›è®¾è®¡æ¨¡å¼å·¥å‚æ¨¡å¼ï¼š\nâ€‹\tJDKæ„é€ çº¿ç¨‹æ± \nâ€‹\tspringåˆ›å»ºBEAN\n3. jvmï¼ša. jvmç»“æ„ï¼Œä»¥åŠæ¯â¼€éƒ¨åˆ†çš„ä½œâ½¤b. jvmä¸­å“ªäº›éƒ¨åˆ†ä¼šå‡ºç°oomï¼Œå‡ºç°çš„å¯èƒ½åŸå› \njava.lang.OutOfMemoryError: Java heap space â€”â€”&gt;javaå †å†…å­˜æº¢å‡ºï¼Œæ­¤ç§æƒ…å†µæœ€å¸¸è§ï¼Œä¸€èˆ¬ç”±äºå†…å­˜æ³„éœ²æˆ–è€…å †çš„å¤§å°è®¾ç½®ä¸å½“å¼•èµ·ã€‚å¯¹äºå†…å­˜æ³„éœ²ï¼Œéœ€è¦é€šè¿‡å†…å­˜ç›‘æ§è½¯ä»¶æŸ¥æ‰¾ç¨‹åºä¸­çš„æ³„éœ²ä»£ç ï¼Œè€Œå †å¤§å°å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•°-Xms,-Xmxç­‰ä¿®æ”¹ã€‚\njava.lang.OutOfMemoryError: PermGen space æˆ– java.lang.OutOfMemoryErrorï¼šMetaSpace â€”â€”&gt;javaæ–¹æ³•åŒºï¼Œï¼ˆjava8 å…ƒç©ºé—´ï¼‰æº¢å‡ºäº†ï¼Œä¸€èˆ¬å‡ºç°äºå¤§é‡Classæˆ–è€…jspé¡µé¢ï¼Œæˆ–è€…é‡‡ç”¨cglibç­‰åå°„æœºåˆ¶çš„æƒ…å†µï¼Œå› ä¸ºä¸Šè¿°æƒ…å†µä¼šäº§ç”Ÿå¤§é‡çš„Classä¿¡æ¯å­˜å‚¨äºæ–¹æ³•åŒºã€‚æ­¤ç§æƒ…å†µå¯ä»¥é€šè¿‡æ›´æ”¹æ–¹æ³•åŒºçš„å¤§å°æ¥è§£å†³ï¼Œä½¿ç”¨ç±»ä¼¼-XX:PermSize&#x3D;64m -XX:MaxPermSize&#x3D;256mçš„å½¢å¼ä¿®æ”¹ã€‚å¦å¤–ï¼Œè¿‡å¤šçš„å¸¸é‡å°¤å…¶æ˜¯å­—ç¬¦ä¸²ä¹Ÿä¼šå¯¼è‡´æ–¹æ³•åŒºæº¢å‡ºã€‚\njava.lang.StackOverflowError â€”â€”&gt; ä¸ä¼šæŠ›OOM errorï¼Œä½†ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„Javaå†…å­˜æº¢å‡ºã€‚JAVAè™šæ‹Ÿæœºæ ˆæº¢å‡ºï¼Œä¸€èˆ¬æ˜¯ç”±äºç¨‹åºä¸­å­˜åœ¨æ­»å¾ªç¯æˆ–è€…æ·±åº¦é€’å½’è°ƒç”¨é€ æˆçš„ï¼Œæ ˆå¤§å°è®¾ç½®å¤ªå°ä¹Ÿä¼šå‡ºç°æ­¤ç§æº¢å‡ºã€‚å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•°-Xssæ¥è®¾ç½®æ ˆçš„å¤§å°ã€‚\n\nc. å“ªäº›å¯¹è±¡ä¼šè¢«å­˜æ”¾åˆ°â½¼å¹´ä»£ï¼ŸJVM - song.yan - åšå®¢å›­ (cnblogs.com)\nd. ä»€ä¹ˆæ—¶å€™è§¦å‘full gcï¼Ÿe. GCç®—æ³•åˆ†ç±»f. ç±»åŠ è½½æœºåˆ¶ä»¥åŠç±»åŠ è½½å™¨ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶ã€‚g. â¼€ä¸ªå¯¹è±¡è¢«å®ä¾‹åŒ–åï¼Œåœ¨å †ä¸­çš„æµè½¬æµç¨‹ï¼ˆå †ç»“æ„ä»¥åŠGCæµç¨‹ï¼‰h. jvmè°ƒä¼˜ï¼Œå†™è°ƒä¼˜å‚æ•°ã€‚4. springï¼ša. spring beançš„â½£å‘½å‘¨æœŸb. å¦‚ä½•å®ç°spring aopï¼Ÿc. springbootå¯åŠ¨æµç¨‹ï¼Ÿd. Springä¸­BeanFactoryå’ŒFactoryBeanæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒfactorybeanåŸç†ï¼Ÿe. springäº‹ä»¶f. ä½œâ½¤åŸŸspringï¼Œå¦‚æœæ˜¯requestâ½…å¼ï¼Œaä¾èµ–bï¼Œaæ˜¯å•ä¾‹â½…å¼ï¼Œbæ˜¯requestï¼Œå›æ€ä¹ˆæ ·5. å¤šçº¿ç¨‹ï¼ša. ä¹è§‚é”ã€æ‚²è§‚é”b. ä¸‰ç§åˆ†å¸ƒå¼é”åŸç†1ï¼‰åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”ï¼š\nè¦å®ç°åˆ†å¸ƒå¼é”ï¼Œæœ€ç®€å•çš„æ–¹å¼å¯èƒ½å°±æ˜¯ç›´æ¥åˆ›å»ºä¸€å¼ é”è¡¨ï¼Œç„¶åé€šè¿‡æ“ä½œè¯¥è¡¨ä¸­çš„æ•°æ®æ¥å®ç°äº†ã€‚\n2ï¼‰åŸºäºç¼“å­˜ï¼ˆredisï¼Œmemcachedï¼Œtairï¼‰å®ç°åˆ†å¸ƒå¼é”3ï¼‰åŸºäºZookeeperå®ç°åˆ†å¸ƒå¼é”\nc. çº¿ç¨‹æ± åŸç†ï¼Œjavaæœ‰å“ªâ¼ç§çº¿ç¨‹æ± ï¼Ÿå¦‚ä½•åˆ›å»ºï¼Ÿd. synchronizedç‰¹æ€§1ï¼‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡æ‰§è¡Œ synchronized ï¼Œé‡å¤è·å–åŒä¸€æŠŠé”\nsynchronized æ˜¯å¯é‡å…¥é”ï¼Œæ¯éƒ¨é”å¯¹è±¡ä¸­ä¼šæœ‰ä¸€ä¸ªè®¡æ•°å™¨è®°å½•çº¿ç¨‹è·å–å‡ æ¬¡é”å•¦ï¼Œåœ¨æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—æ—¶ï¼Œè®¡æ•°å™¨çš„æ•°é‡ä¼š -1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„æ•°é‡ä¸º0ï¼Œå°±é‡Šæ”¾è¿™ä¸ªé”ï¼›\n2ï¼‰ä¸å¯ä¸­æ–­æ˜¯æŒ‡ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…æˆ–é˜»å¡çŠ¶æ€ï¼Œå‰ä¸€ä¸ªçº¿ç¨‹ä¸é‡Šæ”¾é”ï¼Œåä¸€ä¸ªçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡æˆ–ç­‰å¾…ï¼Œä¸å¯è¢«ä¸­æ–­ï¼›\ne. volatileåŸç†f. ThreadlocalThreadLocalçš„é™æ€å†…éƒ¨ç±»ThreadLocalMapä¸ºæ¯ä¸ªThreadéƒ½ç»´æŠ¤äº†ä¸€ä¸ªæ•°ç»„tableï¼ŒThreadLocalç¡®å®šäº†ä¸€ä¸ªæ•°ç»„ä¸‹æ ‡ï¼Œè€Œè¿™ä¸ªä¸‹æ ‡å°±æ˜¯valueå­˜å‚¨çš„å¯¹åº”ä½ç½®\n//set æ–¹æ³•public void set(T value) &#123;      //è·å–å½“å‰çº¿ç¨‹      Thread t = Thread.currentThread();      //å®é™…å­˜å‚¨çš„æ•°æ®ç»“æ„ç±»å‹      ThreadLocalMap map = getMap(t);      //å¦‚æœå­˜åœ¨mapå°±ç›´æ¥setï¼Œæ²¡æœ‰åˆ™åˆ›å»ºmapå¹¶set      if (map != null)          map.set(this, value);      else          createMap(t, value);  &#125;  //getMapæ–¹æ³•ThreadLocalMap getMap(Thread t) &#123;      //thredä¸­ç»´æŠ¤äº†ä¸€ä¸ªThreadLocalMap      return t.threadLocals; &#125; //createMapvoid createMap(Thread t, T firstValue) &#123;      //å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„ThreadLocalMapï¼Œå¹¶èµ‹å€¼ç»™çº¿ç¨‹çš„æˆå‘˜å˜é‡threadLocals      t.threadLocals = new ThreadLocalMap(this, firstValue);&#125;\n\n//Entryä¸ºThreadLocalMapé™æ€å†…éƒ¨ç±»ï¼Œå¯¹ThreadLocalçš„è‹¥å¼•ç”¨//åŒæ—¶è®©ThreadLocalå’Œå‚¨å€¼å½¢æˆkey-valueçš„å…³ç³»static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123;    /** The value associated with this ThreadLocal. */    Object value;    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;           super(k);            value = v;    &#125;&#125;//ThreadLocalMapæ„é€ æ–¹æ³•ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;        //å†…éƒ¨æˆå‘˜æ•°ç»„ï¼ŒINITIAL_CAPACITYå€¼ä¸º16çš„å¸¸é‡        table = new Entry[INITIAL_CAPACITY];        //ä½è¿ç®—ï¼Œç»“æœä¸å–æ¨¡ç›¸åŒï¼Œè®¡ç®—å‡ºéœ€è¦å­˜æ”¾çš„ä½ç½®        //threadLocalHashCodeæ¯”è¾ƒæœ‰è¶£        int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);        table[i] = new Entry(firstKey, firstValue);        size = 1;        setThreshold(INITIAL_CAPACITY);&#125;\n\nThreadLocalMapæ—¶åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º16çš„Entryæ•°ç»„ã€‚é€šè¿‡hashCodeä¸lengthä½è¿ç®—ç¡®å®šå‡ºä¸€ä¸ªç´¢å¼•å€¼iï¼Œè¿™ä¸ªiå°±æ˜¯è¢«å­˜å‚¨åœ¨tableæ•°ç»„ä¸­çš„ä½ç½®\ng. ConcurrentHashMap(3æ¡æ¶ˆæ¯) HashMapï¼ŸConcurrentHashMapï¼Ÿç›¸ä¿¡çœ‹å®Œè¿™ç¯‡æ²¡äººèƒ½éš¾ä½ä½ ï¼_Javaå›¢é•¿çš„åšå®¢-CSDNåšå®¢\nh. HashMapä¸ºä½•çº¿ç¨‹ä¸å®‰å…¨i. java.util.concurrentåŒ…ä¸‹æœ‰å“ªäº›ç±»ï¼Ÿ6. æ•°æ®ç»“æ„ï¼ša. HashMapæ•°æ®ç»“æ„ï¼Ÿb. ConcurrentHashMapæ•°æ®ç»“æ„ï¼ˆjdk1.7 &amp;1.8ï¼‰ï¼Ÿc. â¼†å‰æ ‘ã€å¹³è¡¡æ ‘ã€çº¢â¿Šæ ‘d. B-treeã€B+treee. TreeMap(çº¢é»‘æ ‘)7. å¾®æœåŠ¡ï¼ša. ç”»springcloudâ¼¯ä½œåŸç†å›¾b. æè¿°å„ä¸ªç»„ä»¶çš„ä½œâ½¤åŠåŸç†c. â¼¼è·³æœºåˆ¶åœ¨åº”ç”¨å¯åŠ¨åï¼ŒèŠ‚ç‚¹ä»¬å°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³,é»˜è®¤å‘¨æœŸä¸º30ç§’ï¼Œå¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤(é»˜è®¤90ç§’)ã€‚\nd. é™æµâ½…æ³•ï¼šè®°æœ¯å™¨ï¼šè®¡ç®—å•å…ƒåˆ°æ—¶é—´å†…è®¿é—®æ¥å£çš„æ¬¡æ•°ï¼Œå¦‚æœè¾¾åˆ°æ¬¡æ•°ï¼Œåˆ™é™åˆ¶è®¿é—®ã€‚\nä»¤ç‰Œæ¡¶ï¼šä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯ä¸€ä¸ªå­˜æ”¾å›ºå®šå®¹é‡ä»¤ç‰Œçš„æ¡¶ï¼ŒæŒ‰ç…§å›ºå®šé€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œã€‚å¯æ§åˆ¶æµé‡ä¹Ÿå¯ä»¥æ§åˆ¶å¹¶å‘é‡ã€‚\næ¼æ¡¶ï¼šæ¼æ¡¶æ˜¯ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¡¶ï¼ŒæŒ‰ç…§å›ºå®šçš„é€Ÿç‡æµå‡ºï¼Œå¯ä»¥ä»¥ä»»æ„çš„é€Ÿç‡æµå…¥åˆ°æ¼æ¡¶ä¸­ï¼Œè¶…å‡ºäº†æ¼æ¡¶çš„å®¹é‡å°±è¢«ä¸¢å¼ƒï¼Œæ€»å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯è¾“å‡ºçš„é€Ÿç‡æ˜¯å›ºå®šçš„ï¼Œæ— è®ºä½ ä¸Šé¢çš„æµå…¥çš„å¤šå¿«ï¼Œä¸‹é¢çš„å‡ºå£åªæœ‰è¿™ä¹ˆå¤§ï¼Œå°±åƒæ°´åå¼€é—¸æ”¾æ°´ä¸€æ ·\ne. æœåŠ¡ç†”æ–­ã€é™çº§ä¸éš”ç¦»çš„å®ç°åŸç†f. eurekaä¼˜ç¼ºç‚¹g. dubboçš„è´Ÿè½½å‡è¡¡â½…å¼8. æ•°æ®åº“ï¼ša. mysqlå­˜å‚¨å¼•æ“æœ‰å“ªäº›ï¼Ÿä»–ä»¬çš„åŒºåˆ«ï¼Ÿb. æ•°æ®åº“éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Œå¹¶è¯´ä¸‹ä»€ä¹ˆæ˜¯è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼Ÿc. æ•°æ®åº“äº‹åŠ¡çš„å››â¼¤ç‰¹æ€§ACIDï¼Ÿd. mysqlè°ƒä¼˜â½…æ¡ˆï¼Ÿe. åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•å®ç°äº‹åŠ¡ï¼Ÿf. å¦‚æœåœ¨â¼€ä¸ªäº‹åŠ¡ä¸­ï¼Œä»£ç ä¸šåŠ¡æµç¨‹å¾ˆâ»“ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼Ÿ9. zookeeperï¼ša. é€‰ä¸¾ç®—æ³•b. åˆ†å¸ƒå¼é”å®ç°åŸç†ã€ä¼˜ç¼ºç‚¹\nåˆ©ç”¨èŠ‚ç‚¹åç§°çš„å”¯ä¸€æ€§æ¥å®ç°äº’æ–¥é”\n\nZooKeeperæŠ½è±¡å‡ºæ¥çš„èŠ‚ç‚¹ç»“æ„æ˜¯ä¸€ä¸ªå’Œunixæ–‡ä»¶ç³»ç»Ÿç±»ä¼¼çš„å°å‹çš„æ ‘çŠ¶çš„ç›®å½•ç»“æ„ã€‚ZooKeeperæœºåˆ¶è§„å®šï¼šåŒä¸€ä¸ªç›®å½•ä¸‹åªèƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶åã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬åœ¨Zookeeperç›®å½•&#x2F;testç›®å½•ä¸‹åˆ›å»ºï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªåä¸ºLockèŠ‚ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªèƒ½å¤ŸæˆåŠŸã€‚\nç®—æ³•æ€è·¯: åˆ©ç”¨åç§°å”¯ä¸€æ€§ï¼ŒåŠ é”æ“ä½œæ—¶ï¼Œåªéœ€è¦æ‰€æœ‰å®¢æˆ·ç«¯ä¸€èµ·åˆ›å»º&#x2F;test&#x2F;LockèŠ‚ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªåˆ›å»ºæˆåŠŸï¼ŒæˆåŠŸè€…è·å¾—é”ã€‚è§£é”æ—¶ï¼Œåªéœ€åˆ é™¤&#x2F;test&#x2F;LockèŠ‚ç‚¹ï¼Œå…¶ä½™å®¢æˆ·ç«¯å†æ¬¡è¿›å…¥ç«äº‰åˆ›å»ºèŠ‚ç‚¹ï¼Œç›´åˆ°æ‰€æœ‰å®¢æˆ·ç«¯éƒ½è·å¾—é”ã€‚ç”±ä¸Šè¿°ç®—æ³•å®¹æ˜“çœ‹å‡ºï¼Œç”±äºå®¢æˆ·ç«¯ä¼šåŒæ—¶æ”¶åˆ°&#x2F;test&#x2F;Lockè¢«åˆ é™¤çš„é€šçŸ¥ï¼Œé‡æ–°è¿›å…¥ç«äº‰åˆ›å»ºèŠ‚ç‚¹ï¼Œæ•…å­˜åœ¨â€æƒŠç¾¤ç°è±¡â€ã€‚\n\nåˆ©ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”çš„ä¸€èˆ¬åšæ³•\n\né¦–å…ˆä»‹ç»ä¸€ä¸‹ï¼ŒZookeeperä¸­æœ‰ä¸€ç§èŠ‚ç‚¹å«åšé¡ºåºèŠ‚ç‚¹ï¼Œæ•…åæ€è®®ï¼Œå‡å¦‚æˆ‘ä»¬åœ¨&#x2F;lock&#x2F;ç›®å½•ä¸‹åˆ›å»ºèŠ‚3ä¸ªç‚¹ï¼ŒZooKeeperé›†ç¾¤ä¼šæŒ‰ç…§æèµ·åˆ›å»ºçš„é¡ºåºæ¥åˆ›å»ºèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åˆ†åˆ«ä¸º&#x2F;lock&#x2F;0000000001ã€&#x2F;lock&#x2F;0000000002ã€&#x2F;lock&#x2F;0000000003é‡Šæ”¾é”æ—¶ï¼Œåˆ¤æ–­å½“å‰è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œç›´è‡³ä¸‹æ¬¡é€šçŸ¥\nç¼ºç‚¹ï¼šå®¢æˆ·ç«¯æ— ç«¯çš„æ¥å—åˆ°è¿‡å¤šçš„å’Œè‡ªå·±ä¸ç›¸å…³çš„äº‹ä»¶é€šçŸ¥\n\nåˆ©ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å®ç°äº’æ–¥é”çš„æ”¹è¿›å®ç°\n\nä¸‹é¢æ˜¯æ”¹è¿›åçš„åˆ†å¸ƒå¼é”å®ç°ï¼Œå’Œä¹‹å‰çš„å®ç°æ–¹å¼å”¯ä¸€ä¸åŒä¹‹å¤„åœ¨äºï¼Œè¿™é‡Œè®¾è®¡æˆæ¯ä¸ªé”ç«äº‰è€…ï¼Œåªéœ€è¦å…³æ³¨â€locknodeâ€èŠ‚ç‚¹ä¸‹åºå·æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨å³å¯ã€‚\nç®—æ³•æ€è·¯ï¼šå¯¹äºåŠ é”æ“ä½œï¼Œå¯ä»¥è®©æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å»&#x2F;lockç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œå¦‚æœåˆ›å»ºçš„å®¢æˆ·ç«¯å‘ç°è‡ªèº«åˆ›å»ºèŠ‚ç‚¹åºåˆ—å·æ˜¯&#x2F;lock&#x2F;ç›®å½•ä¸‹æœ€å°çš„èŠ‚ç‚¹ï¼Œåˆ™è·å¾—é”ã€‚å¦åˆ™ï¼Œç›‘è§†æ¯”è‡ªå·±åˆ›å»ºèŠ‚ç‚¹çš„åºåˆ—å·å°çš„èŠ‚ç‚¹ï¼ˆæ¯”è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹å°çš„æœ€å¤§èŠ‚ç‚¹ï¼‰ï¼Œè¿›å…¥ç­‰å¾…\nc. æœåŠ¡å‘ç°ä¸ç§»é™¤åŸç†Zookeeperçš„Watchæœºåˆ¶\nå®¢æˆ·ç«¯è°ƒç”¨getDataæ–¹æ³•å‘æœåŠ¡å™¨è·å–æŸä¸ªZnodeèŠ‚ç‚¹çš„æ•°æ®æ—¶ï¼Œè®¾ç½®watchä¸ºtrueã€‚æœåŠ¡ç«¯æ¥åˆ°è¯·æ±‚åï¼Œè¿”å›èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¹¶åœ¨ç»´æŠ¤çš„WatchTableä¸­æ’å…¥è¢«Watchçš„Znodeè·¯å¾„ä»¥åŠWatcherï¼ˆwatchè¯¥Znodeçš„å®¢æˆ·ç«¯ï¼‰ï¼›\nå½“è¢«Watchçš„Znodeè¢«åˆ é™¤æˆ–è€…æ›´æ–°ä¹‹åï¼ŒZookeeperæœåŠ¡å™¨ä¼šæŸ¥æ‰¾Watch Tableï¼Œæ‰¾åˆ°åœ¨Znodeä¸Šå¯¹åº”çš„æ‰€æœ‰Watcherï¼Œå¼‚æ­¥é€šçŸ¥å¯¹åº”çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”åˆ é™¤Watch Tableä¸­å¯¹åº”çš„Keyï¼šValue\nZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹æµ…æZookeeperçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œä¸»è¦åº”ç”¨çš„æ˜¯Zookeeperçš„Znodeæ•°æ®æ¨¡å‹å’ŒWatcheræœºåˆ¶ï¼Œä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\næœåŠ¡æ³¨å†Œï¼šæœåŠ¡æä¾›è€…ï¼ˆProviderï¼‰å¯åŠ¨æ—¶ï¼Œä¼šå‘ZookeeperæœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡ä¿¡æ¯ï¼Œå³ä¼šåœ¨ZookeeperæœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œå¹¶åœ¨èŠ‚ç‚¹ä¸Šå­˜å‚¨æœåŠ¡çš„ç›¸å…³æ•°æ®ï¼ˆå¦‚æœåŠ¡æä¾›è€…çš„ipåœ°å€ã€ç«¯å£ç­‰ï¼‰ï¼Œæ¯”å¦‚æ³¨å†Œä¸€ä¸ªç”¨æˆ·æ³¨å†ŒæœåŠ¡ï¼ˆuser&#x2F;registerï¼‰:\næœåŠ¡å‘ç°ï¼šæœåŠ¡æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰å¯åŠ¨æ—¶ï¼Œä¼šæ ¹æ®æœ¬èº«ä¾èµ–çš„æœåŠ¡ä¿¡æ¯ï¼Œå‘ZookeeperæœåŠ¡ç«¯è·å–æ³¨å†Œçš„æœåŠ¡ä¿¡æ¯å¹¶è®¾ç½®Watchï¼Œè·å–åˆ°æ³¨å†Œçš„æœåŠ¡ä¿¡æ¯ä¹‹åå°†æœåŠ¡æä¾›è€…ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°ï¼Œè°ƒç”¨æœåŠ¡æ—¶ç›´æ¥æ ¹æ®ä»Zookeeperæ³¨å†Œä¸­å¿ƒè·å–åˆ°çš„æœåŠ¡æ³¨å†Œä¿¡æ¯è°ƒç”¨æœåŠ¡ï¼Œæ¯”å¦‚å‘ç°ç”¨æˆ·æ³¨å†ŒæœåŠ¡ï¼ˆuser&#x2F;registerï¼‰å¹¶è°ƒç”¨ã€‚\n\næœåŠ¡é€šçŸ¥ï¼šå½“æœåŠ¡æä¾›è€…å› ä¸ºæŸç§åŸå› å®•æœºæˆ–ä¸æä¾›æœåŠ¡ä¹‹åï¼ŒZookeeperæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„å¯¹åº”æœåŠ¡èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºæœåŠ¡æ¶ˆè´¹è€…åœ¨è·å–æœåŠ¡ä¿¡æ¯çš„æ—¶å€™åœ¨å¯¹åº”èŠ‚ç‚¹ä¸Šè®¾ç½®äº†Watchï¼Œå› æ­¤èŠ‚ç‚¹åˆ é™¤ä¹‹åä¼šè§¦å‘å¯¹åº”çš„Watcherï¼ŒZookeeperæ³¨å†Œä¸­å¿ƒä¼šå¼‚æ­¥å‘æœåŠ¡æ‰€å…³è”çš„æ‰€æœ‰æœåŠ¡æ¶ˆè´¹è€…å‘å‡ºèŠ‚ç‚¹åˆ é™¤çš„é€šçŸ¥ï¼ŒæœåŠ¡æ¶ˆè´¹è€…æ ¹æ®æ”¶åˆ°çš„é€šçŸ¥æ›´æ–°ç¼“å­˜çš„æœåŠ¡åˆ—è¡¨ã€‚\n10. redisï¼ša. å®ç°æœºåˆ¶b. åˆ†å¸ƒå¼é”ï¼Œä»¥åŠè¦è€ƒè™‘çš„é—®é¢˜c. é™¤äº†åŠ é”ï¼Œå¦‚ä½•ä½¿å¤šä¸ªrediså‘½ä»¤å…·æœ‰åŸâ¼¦æ€§ï¼ˆluaè„šæœ¬ï¼‰d. redisæŒä¹…åŒ–çš„åŸç†e. åˆ†å¸ƒå¼é”ï¼Œä½¿â½¤redisçš„â½…å¼ï¼Œä½†æ˜¯redisæ˜¯é›†ç¾¤çš„ï¼Œä¼šæœ‰ä¸åŒæ­¥çš„é—®é¢˜ï¼Œå®˜â½…â½‚æ¡£æ˜¯æ€ä¹ˆè§£å†³çš„11. æ¶ˆæ¯ä¸­é—´ä»¶ï¼ša. å¸¸â»…æ¶ˆæ¯ä¸­é—´ä»¶çš„åŒºåˆ«b. kafkaçš„å®ç°åŸç†ä¸€ä¸ªå…¸å‹çš„kafkaé›†ç¾¤åŒ…å«è‹¥å¹²Producerï¼ˆå¯ä»¥æ˜¯åº”ç”¨èŠ‚ç‚¹äº§ç”Ÿçš„æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡Flumeæ”¶é›†æ—¥å¿—äº§ç”Ÿçš„äº‹ä»¶ï¼‰ï¼Œè‹¥å¹²ä¸ªBrokerï¼ˆkafkaæ”¯æŒæ°´å¹³æ‰©å±•ï¼‰ã€è‹¥å¹²ä¸ªConsumer Groupï¼Œä»¥åŠä¸€ä¸ªzookeeperé›†ç¾¤ã€‚kafkaé€šè¿‡zookeeperç®¡ç†é›†ç¾¤é…ç½®åŠæœåŠ¡ååŒã€‚Producerä½¿ç”¨pushæ¨¡å¼å°†æ¶ˆæ¯å‘å¸ƒåˆ°brokerï¼Œconsumeré€šè¿‡ç›‘å¬ä½¿ç”¨pullæ¨¡å¼ä»brokerè®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚\n\n1ï¼‰Broker Kafkaé›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼Œè¿™ç§æœåŠ¡å™¨è¢«ç§°ä¸ºbrokerã€‚brokerç«¯ä¸ç»´æŠ¤æ•°æ®çš„æ¶ˆè´¹çŠ¶æ€ï¼Œæå‡äº†æ€§èƒ½ã€‚ç›´æ¥ä½¿ç”¨ç£ç›˜è¿›è¡Œå­˜å‚¨ï¼Œçº¿æ€§è¯»å†™ï¼Œé€Ÿåº¦å¿«ï¼šé¿å…äº†æ•°æ®åœ¨JVMå†…å­˜å’Œç³»ç»Ÿå†…å­˜ä¹‹é—´çš„å¤åˆ¶ï¼Œå‡å°‘è€—æ€§èƒ½çš„åˆ›å»ºå¯¹è±¡å’Œåƒåœ¾å›æ”¶ã€‚ 2ï¼‰Producer è´Ÿè´£å‘å¸ƒæ¶ˆæ¯åˆ°Kafka broker 3ï¼‰Consumer æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘Kafka brokerè¯»å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼Œconsumerä»brokeræ‹‰å–(pull)æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚ 4ï¼‰Topic æ¯æ¡å‘å¸ƒåˆ°Kafkaé›†ç¾¤çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸ºTopicã€‚ï¼ˆç‰©ç†ä¸Šä¸åŒTopicçš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ªTopicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbrokerä¸Šä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„Topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼‰ 5ï¼‰Partition Paritionæ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ªTopicåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªPartition. 6ï¼‰Consumer Group æ¯ä¸ªConsumerå±äºä¸€ä¸ªç‰¹å®šçš„Consumer Groupï¼ˆå¯ä¸ºæ¯ä¸ªConsumeræŒ‡å®šgroup nameï¼Œè‹¥ä¸æŒ‡å®šgroup nameåˆ™å±äºé»˜è®¤çš„groupï¼‰ 7ï¼‰Topic &amp; Partition Topicåœ¨é€»è¾‘ä¸Šå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªqueueï¼Œæ¯æ¡æ¶ˆè´¹éƒ½å¿…é¡»æŒ‡å®šå®ƒçš„Topicï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå¿…é¡»æŒ‡æ˜æŠŠè¿™æ¡æ¶ˆæ¯æ”¾è¿›å“ªä¸ªqueueé‡Œã€‚ä¸ºäº†ä½¿å¾—Kafkaçš„ååç‡å¯ä»¥çº¿æ€§æé«˜ï¼Œç‰©ç†ä¸ŠæŠŠTopicåˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionåœ¨ç‰©ç†ä¸Šå¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹å­˜å‚¨è¿™ä¸ªPartitionçš„æ‰€æœ‰æ¶ˆæ¯å’Œç´¢å¼•æ–‡ä»¶ã€‚è‹¥åˆ›å»ºtopic1å’Œtopic2ä¸¤ä¸ªtopicï¼Œä¸”åˆ†åˆ«æœ‰13ä¸ªå’Œ19ä¸ªåˆ†åŒºï¼Œåˆ™æ•´ä¸ªé›†ç¾¤ä¸Šä¼šç›¸åº”ä¼šç”Ÿæˆå…±32ä¸ªæ–‡ä»¶å¤¹ï¼ˆæœ¬æ–‡æ‰€ç”¨é›†ç¾¤å…±8ä¸ªèŠ‚ç‚¹ï¼Œæ­¤å¤„topic1å’Œtopic2 replication-factorå‡ä¸º1ï¼‰ã€‚\nc. RabbitMQæ¶ˆæ¯æ¨¡å‹1.åŸºæœ¬æ¶ˆæ¯æ¨¡å‹ simple\n2.workæ¶ˆæ¯æ¨¡å‹ å·¥ä½œé˜Ÿåˆ—æˆ–è€…ç«äº‰æ¶ˆè´¹è€…æ¨¡å¼\n3.è®¢é˜…æ¨¡å‹ï¼ˆ1ï¼‰è®¢é˜…æ¨¡å‹-Fanout   å¹¿æ’­ï¼ˆ2ï¼‰è®¢é˜…æ¨¡å‹-Direct:\nï¼ˆ3ï¼‰è®¢é˜…æ¨¡å‹-Topic\nd. RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§\nä»å›¾ä¸Šæˆ‘ä»¬å¤§æ¦‚å¯ä»¥çœ‹å‡ºæ¥ä¸€ä¸ªæ¶ˆæ¯ä¼šç»å†å››ä¸ªèŠ‚ç‚¹ï¼Œåªæœ‰ä¿è¯è¿™å››ä¸ªèŠ‚ç‚¹çš„å¯é æ€§æ‰èƒ½ä¿è¯æ•´ä¸ªç³»ç»Ÿçš„å¯é æ€§ã€‚\n1.ç”Ÿäº§è€…å‘å‡ºåä¿è¯åˆ°è¾¾äº†MQã€‚\n2.MQæ”¶åˆ°æ¶ˆæ¯ä¿è¯åˆ†å‘åˆ°äº†æ¶ˆæ¯å¯¹åº”çš„Exchangeã€‚\n3.Exchangeåˆ†å‘æ¶ˆæ¯å…¥é˜Ÿä¹‹åä¿è¯æ¶ˆæ¯çš„æŒä¹…æ€§ã€‚\n4.æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯ä¹‹åä¿è¯æ¶ˆæ¯çš„æ­£ç¡®æ¶ˆè´¹ã€‚\nğŸ”ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°MQå¤±è´¥RabbitMQå¼•å…¥äº†äº‹åŠ¡æœºåˆ¶å’Œå‘é€æ–¹ç¡®è®¤æœºåˆ¶ï¼ˆpublisher confirmï¼‰ï¼Œç”±äºäº‹åŠ¡æœºåˆ¶è¿‡äºè€—è´¹æ€§èƒ½æ‰€ä»¥ä¸€èˆ¬ä¸ç”¨ï¼Œè¿™é‡Œæˆ‘ç€é‡è®²è¿°å‘é€æ–¹ç¡®è®¤æœºåˆ¶\nğŸ“”MQæ¥æ”¶å¤±è´¥æˆ–è€…è·¯ç”±å¤±è´¥\næ¶ˆæ¯æ‰¾ä¸åˆ°å¯¹åº”çš„Exchangeã€‚\næ‰¾åˆ°äº†Exchangeä½†æ˜¯æ‰¾ä¸åˆ°å¯¹åº”çš„Queueã€‚\n\nè¿™ä¸¤ç§æƒ…å†µéƒ½å¯ä»¥ç”¨RabbitMQæä¾›çš„mandatoryå‚æ•°æ¥è§£å†³ï¼Œå®ƒä¼šè®¾ç½®æ¶ˆæ¯æŠ•é€’å¤±è´¥çš„ç­–ç•¥ï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼šè‡ªåŠ¨åˆ é™¤æˆ–è¿”å›åˆ°å®¢æˆ·ç«¯ã€‚\næˆ‘ä»¬æ—¢ç„¶è¦åšå¯é æ€§ï¼Œå½“ç„¶æ˜¯è®¾ç½®ä¸ºè¿”å›åˆ°å®¢æˆ·ç«¯(trueæ˜¯è¿”å›å®¢æˆ·ç«¯ï¼Œfalseæ˜¯è‡ªåŠ¨åˆ é™¤)ã€‚\nğŸ“‘æ¶ˆæ¯å…¥é˜Ÿä¹‹åMQå®•æœºæ¶ˆæ¯çš„æŒä¹…åŒ–è¦åšï¼Œä½†æ˜¯ä¸èƒ½åªåšæ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œè¿˜è¦åšé˜Ÿåˆ—çš„æŒä¹…åŒ–å’ŒExchangeçš„æŒä¹…åŒ–ã€‚\nğŸ“Œæ¶ˆè´¹è€…æ— æ³•æ­£å¸¸æ¶ˆè´¹æ‰“å¼€æ‰‹åŠ¨æ¶ˆæ¯ç¡®è®¤ä¹‹åï¼Œåªè¦æˆ‘ä»¬è¿™æ¡æ¶ˆæ¯æ²¡æœ‰æˆåŠŸæ¶ˆè´¹ï¼Œæ— è®ºä¸­é—´æ˜¯å‡ºç°æ¶ˆè´¹è€…å®•æœºè¿˜æ˜¯ä»£ç å¼‚å¸¸ï¼Œåªè¦è¿æ¥æ–­å¼€ä¹‹åè¿™æ¡ä¿¡æ¯è¿˜æ²¡æœ‰è¢«æ¶ˆè´¹é‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°±ä¼šè¢«é‡æ–°æ”¾å…¥é˜Ÿåˆ—å†æ¬¡è¢«æ¶ˆè´¹\nğŸ’¡æ¶ˆæ¯å¯é æ€§æ¡ˆä¾‹\n12. åˆ†å¸ƒå¼ï¼ša. ä»‹ç»â¼ç§åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä»¥åŠä¼˜ç¼ºç‚¹ã€‚2PC2PCï¼ˆTwo-phase commit protocolï¼‰ï¼Œä¸­æ–‡å«äºŒé˜¶æ®µæäº¤ã€‚ äºŒé˜¶æ®µæäº¤æ˜¯ä¸€ç§å¼ºä¸€è‡´æ€§è®¾è®¡ï¼Œ2PC å¼•å…¥ä¸€ä¸ªäº‹åŠ¡åè°ƒè€…çš„è§’è‰²æ¥åè°ƒç®¡ç†å„å‚ä¸è€…ï¼ˆä¹Ÿå¯ç§°ä¹‹ä¸ºå„æœ¬åœ°èµ„æºï¼‰çš„æäº¤å’Œå›æ»šï¼ŒäºŒé˜¶æ®µåˆ†åˆ«æŒ‡çš„æ˜¯å‡†å¤‡ï¼ˆæŠ•ç¥¨ï¼‰å’Œæäº¤ä¸¤ä¸ªé˜¶æ®µã€‚\n\n2PC æ˜¯ä¸€ç§å°½é‡ä¿è¯å¼ºä¸€è‡´æ€§çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå› æ­¤å®ƒæ˜¯åŒæ­¥é˜»å¡çš„ï¼Œè€ŒåŒæ­¥é˜»å¡å°±å¯¼è‡´é•¿ä¹…çš„èµ„æºé”å®šé—®é¢˜ï¼Œæ€»ä½“è€Œè¨€æ•ˆç‡ä½ï¼Œå¹¶ä¸”å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œåœ¨æç«¯æ¡ä»¶ä¸‹å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚\n3PC 3PC ç›¸å¯¹äº 2PC åšäº†ä¸€å®šçš„æ”¹è¿›ï¼šå¼•å…¥äº†å‚ä¸è€…è¶…æ—¶æœºåˆ¶ï¼Œå¹¶ä¸”å¢åŠ äº†é¢„æäº¤é˜¶æ®µä½¿å¾—æ•…éšœæ¢å¤ä¹‹ååè°ƒè€…çš„å†³ç­–å¤æ‚åº¦é™ä½ï¼Œä½†æ•´ä½“çš„äº¤äº’è¿‡ç¨‹æ›´é•¿äº†ï¼Œæ€§èƒ½æœ‰æ‰€ä¸‹é™ï¼Œå¹¶ä¸”è¿˜æ˜¯ä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚\nTCCTCC æŒ‡çš„æ˜¯Try - Confirm - Cancelã€‚\n\nTry æŒ‡çš„æ˜¯é¢„ç•™ï¼Œå³èµ„æºçš„é¢„ç•™å’Œé”å®šï¼Œæ³¨æ„æ˜¯é¢„ç•™ã€‚\nConfirm æŒ‡çš„æ˜¯ç¡®è®¤æ“ä½œï¼Œè¿™ä¸€æ­¥å…¶å®å°±æ˜¯çœŸæ­£çš„æ‰§è¡Œäº†ã€‚\nCancel æŒ‡çš„æ˜¯æ’¤é”€æ“ä½œï¼Œå¯ä»¥ç†è§£ä¸ºæŠŠé¢„ç•™é˜¶æ®µçš„åŠ¨ä½œæ’¤é”€äº†ã€‚\n\næœ¬åœ°æ¶ˆæ¯è¡¨æ¶ˆæ¯äº‹åŠ¡\nb. åˆ†å¸ƒå¼æœåŠ¡çš„åŸåˆ™ï¼Œä»€ä¹ˆæƒ…å†µä¸‹è¦ä½¿â½¤åˆ†å¸ƒå¼å¼€å‘ã€‚c. ä½¿â½¤â¾ƒå¢IDå’ŒUUIDä½œä¸ºä¸»é”®æœ‰ä»€ä¹ˆä¸åŒ13. æºç ï¼šè¯´è¯´ä½ çœ‹è¿‡çš„æºç ï¼Œå…¶ä¸­æœ‰â½¤åˆ°ä»€ä¹ˆæ€æƒ³ï¼Œä»¥åŠè®¾è®¡æ¨¡å¼ï¼ŸCSFè°ƒç”¨ï¼š\n1.åˆ¤æ–­æ˜¯å¦æœ‰æœ¬åœ°é…ç½®é…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡è¿”å›ç»“æœï¼Œæœ‰ç›´æ¥è¿”å›ç»“æœ\n2.æ ¡éªŒæ“ä½œå‘˜ä¿¡æ¯\n3.è·å–è¿œç¨‹è°ƒç”¨ç±»Caller\n4.åˆ›å»ºè¯·æ±‚ï¼ˆå­˜å…¥å…¥å‚ï¼Œæ“ä½œå‘˜ä¿¡æ¯ï¼Œåˆ†é¡µä¿¡æ¯ï¼‰\n5.ç”±StubAdapterè·å–Client\n6.å¼€å§‹è¿œç¨‹è°ƒç”¨\n7.é€šè¿‡HystrixCommandå¼€å§‹è°ƒç”¨\nç†”æ–­å™¨ç›¸å…³é…ç½®\n&lt;CircuitBreaker&gt;   &lt;!-- ç†”æ–­å™¨å¼€å…³ --&gt;   &lt;Item name=&quot;enable&quot; value=&quot;false&quot; /&gt;   &lt;!-- ä¸»æœºç†”æ–­æ—¶é—´çª—å£å†…è¯·æ±‚å¤±è´¥ç‡ --&gt;   &lt;Item name=&quot;host.error.threshold.percentage&quot; value=&quot;80&quot; /&gt;   &lt;!-- æœåŠ¡ç†”æ–­æ—¶é—´çª—å£è¯·æ±‚å¤±è´¥ç‡ --&gt;   &lt;Item name=&quot;service.error.threshold.percentage&quot; value=&quot;80&quot; /&gt;   &lt;!-- ç†”æ–­å™¨ç»Ÿè®¡æ—¶é—´çª—å£ --&gt;   &lt;Item name=&quot;statistics.window&quot; value=&quot;10000&quot; /&gt;   &lt;!-- æ—¶é—´çª—å£å†…è§¦å‘ç†”æ–­è¯·æ±‚æ¬¡æ•°å¼€å…³ --&gt;   &lt;Item name=&quot;request.volume.threshold&quot; value=&quot;30&quot; /&gt;   &lt;!-- æ˜¯å¦å¼€å¯çº¿ç¨‹æ± éš”ç¦»æ¨¡å¼ --&gt;   &lt;Item name=&quot;thread.isolation.enable&quot; value=&quot;true&quot; /&gt;&lt;/CircuitBreaker&gt;\n\n14.â½¹ç»œç›¸å…³ï¼ša. tcpä¸‰æ¬¡æ¡â¼¿ã€å››æ¬¡æŒ¥â¼¿\nç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€synåŒ…ï¼ˆsyn&#x3D;jï¼‰åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼›SYNï¼šåŒæ­¥åºåˆ—ç¼–å·ï¼ˆSynchronize Sequence Numbersï¼‰ã€‚\nç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack&#x3D;j+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆsyn&#x3D;kï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ï¼›\nç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack&#x3D;k+1ï¼‰ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚\n\n1ï¼‰å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN&#x3D;1ï¼Œå…¶åºåˆ—å·ä¸ºseq&#x3D;uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚2ï¼‰æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK&#x3D;1ï¼Œack&#x3D;u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq&#x3D;vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚3ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚4ï¼‰æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN&#x3D;1ï¼Œack&#x3D;u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq&#x3D;wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚5ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK&#x3D;1ï¼Œack&#x3D;w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq&#x3D;u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ—âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚6ï¼‰æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚\nb. httpæœºåˆ¶c. httpsæœºåˆ¶15.é¡¹â½¬äº®ç‚¹ï¼š16.ç”»æ¶æ„å›¾ï¼š17.å¹³æ—¶çœ‹è¿‡ä»€ä¹ˆä¹¦ï¼Ÿ","categories":["é¢è¯•"],"tags":["å­¦ä¹ "]},{"title":"141. ç¯å½¢é“¾è¡¨","url":"/java4u/2021/06/18/141.%20%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8/","content":"141. ç¯å½¢é“¾è¡¨ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚\nå¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚\nå¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ ï¼Œåˆ™è¿”å› true ã€‚ å¦åˆ™ï¼Œè¿”å› false ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šhead &#x3D; [3,2,0,-4], pos &#x3D; 1è¾“å‡ºï¼štrueè§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šhead &#x3D; [1,2], pos &#x3D; 0è¾“å‡ºï¼štrueè§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šhead &#x3D; [1], pos &#x3D; -1è¾“å‡ºï¼šfalseè§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚\næç¤ºï¼š\né“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [0, 10^4]-10^5 &lt;&#x3D; Node.val &lt;&#x3D; 10^5pos ä¸º -1 æˆ–è€…é“¾è¡¨ä¸­çš„ä¸€ä¸ª æœ‰æ•ˆç´¢å¼• ã€‚\nè¿›é˜¶ï¼šä½ èƒ½ç”¨ O(1)ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ\né¢˜è§£/** * ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆå»éå†é“¾è¡¨ * å¿«æŒ‡é’ˆåœ¨æ…¢æŒ‡é’ˆå‰é¢çš„ä½ç½®ï¼Œç§»åŠ¨å¿«æ…¢æŒ‡é’ˆï¼Œåˆ¤æ–­ä¸¤æŒ‡é’ˆæ˜¯å¦ç›¸é‡ * @param head * @return */public boolean hasCycle(ListNode head) &#123;    if (head == null || head.next == null) &#123;        return false;    &#125;    ListNode slow = head;    ListNode fast = head.next;    //å¿«æ…¢æŒ‡é’ˆåœ¨ä¸åŒä½ç½®ï¼Œå°±å¯ä»¥æ ¹æ®2æŒ‡é’ˆæ˜¯å¦ç›¸ç­‰æ¥åˆ¤æ–­ç›¸é‡    while (slow != fast) &#123;        if (fast == null || fast.next == null) &#123;            return false;        &#125;        slow = slow.next;        fast = fast.next.next;    &#125;    return true;&#125;/** * å“ˆå¸Œè¡¨ * HashSetä¸èƒ½æ·»åŠ é‡å¤çš„å…ƒç´ ï¼Œå½“è°ƒç”¨addï¼ˆObjectï¼‰æ–¹æ³•æ—¶å€™ï¼Œ * é¦–å…ˆä¼šè°ƒç”¨Objectçš„hashCodeæ–¹æ³•åˆ¤hashCodeæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚ä¸å­˜åœ¨åˆ™ç›´æ¥æ’å…¥å…ƒç´ ï¼› * å¦‚æœå·²å­˜åœ¨åˆ™è°ƒç”¨Objectå¯¹è±¡çš„equalsæ–¹æ³•åˆ¤æ–­æ˜¯å¦è¿”å›trueï¼Œå¦‚æœä¸ºtrueåˆ™è¯´æ˜å…ƒç´ å·²ç»å­˜åœ¨ï¼Œå¦‚ä¸ºfalseåˆ™æ’å…¥å…ƒç´ ã€‚ * @param head * @return */public boolean hasCycle2(ListNode head) &#123;    Set&lt;ListNode&gt; seen = new HashSet&lt;ListNode&gt;();    while (head != null) &#123;        if (!seen.add(head)) &#123;            return true;        &#125;        head = head.next;    &#125;    return false;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","é“¾è¡¨"]},{"title":"19.åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹","url":"/java4u/2021/06/17/19.%20%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E7%9A%84%E5%80%92%E6%95%B0%E7%AC%AC%20N%20%E4%B8%AA%E7%BB%93%E7%82%B9/","content":"19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šhead &#x3D; [1,2,3,4,5], n &#x3D; 2è¾“å‡ºï¼š[1,2,3,5]\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šhead &#x3D; [1], n &#x3D; 1è¾“å‡ºï¼š[]\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šhead &#x3D; [1,2], n &#x3D; 1è¾“å‡ºï¼š[1]\næç¤ºï¼š\né“¾è¡¨ä¸­ç»“ç‚¹çš„æ•°ç›®ä¸º sz1 &lt;&#x3D; sz &lt;&#x3D; 300 &lt;&#x3D; Node.val &lt;&#x3D; 1001 &lt;&#x3D; n &lt;&#x3D; sz\nè¿›é˜¶ï¼šä½ èƒ½å°è¯•ä½¿ç”¨ä¸€è¶Ÿæ‰«æå®ç°å—ï¼Ÿ\nå“¨å…µèŠ‚ç‚¹å“¨å…µèŠ‚ç‚¹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé™„åŠ åœ¨åŸé“¾è¡¨æœ€å‰é¢ç”¨æ¥ç®€åŒ–è¾¹ç•Œæ¡ä»¶çš„é™„åŠ èŠ‚ç‚¹ï¼Œå®ƒçš„å€¼åŸŸä¸å­˜å‚¨ä»»ä½•ä¸œè¥¿ï¼Œåªæ˜¯ä¸ºäº†æ“ä½œæ–¹ä¾¿è€Œå¼•å…¥ã€‚\næ¯”å¦‚åŸé“¾è¡¨ä¸ºa-&gt;b-&gt;cï¼Œåˆ™åŠ äº†å“¨å…µèŠ‚ç‚¹çš„é“¾è¡¨å³ä¸ºx-&gt;a-&gt;b&gt;cï¼Œ\né‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥å“¨å…µèŠ‚ç‚¹å‘¢?ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åˆ é™¤æŸé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¸¸è§çš„åˆ é™¤é“¾è¡¨çš„æ“ä½œæ˜¯æ‰¾åˆ°è¦åˆ å…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ ï¼Œå‡å¦‚æˆ‘ä»¬è®°ä¸º preã€‚æˆ‘ä»¬é€šè¿‡ï¼š\npre.Next &#x3D; pre.Next.Nextæ¥è¿›è¡Œåˆ é™¤é“¾è¡¨çš„æ“ä½œã€‚ä½†æ˜¯æ­¤æ—¶è‹¥æ˜¯åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ çš„è¯ï¼Œä½ å°±å¾ˆéš¾è¿›è¡Œäº†ï¼Œå› ä¸ºæŒ‰é“ç†æ¥è®²ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ å°±æ˜¯nilï¼ˆç©ºçš„ï¼‰ï¼Œå¦‚æœä½¿ç”¨preå°±ä¼šæŠ¥é”™ã€‚é‚£å¦‚æœæ­¤æ—¶ä½ è®¾ç½®äº†å“¨å…µèŠ‚ç‚¹çš„è¯ï¼Œæ­¤æ—¶çš„preå°±æ˜¯å“¨å…µèŠ‚ç‚¹äº†ã€‚è¿™æ ·å¯¹äºé“¾è¡¨ä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ï¼Œä½ è¦åˆ é™¤éƒ½å¯ä»¥é€šè¿‡pre.Next&#x3D;pre.Next.Nextçš„æ–¹å¼æ¥è¿›è¡Œï¼Œè¿™å°±æ˜¯å“¨å…µèŠ‚ç‚¹çš„ä½œç”¨ã€‚\n\né¢˜è§£/** * é¦–å…ˆæˆ‘ä»¬å®šä¹‰å¥½å“¨å…µèŠ‚ç‚¹resultï¼ŒæŒ‡å‘å“¨å…µèŠ‚ç‚¹çš„ç›®æ ‡å…ƒç´ æŒ‡é’ˆcurï¼Œä»¥åŠç›®æ ‡æŒ‡é’ˆcurçš„å‰ä¸€ä¸ªæŒ‡é’ˆpreï¼Œæ­¤æ—¶preæŒ‡å‘nilã€‚ * æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹éå†æ•´ä¸ªé“¾è¡¨ã€‚ * å½“headç§»åŠ¨åˆ°è·ç¦»ç›®æ ‡å…ƒç´ curçš„è·ç¦»ä¸ºN-1æ—¶ï¼ŒåŒæ—¶å¼€å§‹ç§»åŠ¨curã€‚ * å½“é“¾è¡¨éå†å®Œä¹‹åï¼Œæ­¤æ—¶headæŒ‡å‘nilï¼Œè¿™æ—¶çš„curå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å¾…åˆ é™¤çš„ç›®æ ‡å…ƒç´ ã€‚ * æœ€åæˆ‘ä»¬é€šè¿‡pre.Next = pre.Next.Nextå®Œæˆåˆ é™¤æ“ä½œï¼Œå°±å®Œæˆäº†æ•´ä¸ªè§£é¢˜è¿‡ç¨‹ã€‚ * @param head * @param n * @return */public ListNode removeNthFromEnd(ListNode head, int n) &#123;    //å“¨å…µèŠ‚ç‚¹    ListNode result = new ListNode(0);    result.next = head;    //è¦è¢«åˆ é™¤çš„èŠ‚ç‚¹    ListNode cur = result;    //è¢«åˆ é™¤èŠ‚ç‚¹å‰ä¸€ä¸ªèŠ‚ç‚¹    ListNode pre = null;    //å…ˆå°†headç§»åŠ¨åˆ°è·ç¦»curä¸ºn-1çš„ä½ç½®    for(int i =0;i&lt;n-1;i++)&#123;        head = head.next;    &#125;    //å°†curå’ŒheadèŠ‚ç‚¹åŒæ—¶åç§»ï¼Œç›´åˆ°headæŒ‡å‘é“¾è¡¨èŠ‚å°¾    while (head != null)&#123;        head = head.next;        pre = cur;        cur = cur.next;    &#125;    //æ­¤æ—¶curå°±æ˜¯è¦è¢«åˆ é™¤çš„èŠ‚ç‚¹    pre.next = pre.next.next;    return result.next;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","é“¾è¡¨"]},{"title":"21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","url":"/java4u/2021/06/17/21.%20%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/","content":"21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ å‡åº é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ \nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šl1 &#x3D; [1,2,4], l2 &#x3D; [1,3,4]è¾“å‡ºï¼š[1,1,2,3,4,4]\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šl1 &#x3D; [], l2 &#x3D; []è¾“å‡ºï¼š[]\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šl1 &#x3D; [], l2 &#x3D; [0]è¾“å‡ºï¼š[0]\næç¤ºï¼š\nä¸¤ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹æ•°ç›®èŒƒå›´æ˜¯ [0, 50]-100 &lt;&#x3D; Node.val &lt;&#x3D; 100l1 å’Œ l2 å‡æŒ‰ éé€’å‡é¡ºåº æ’åˆ—\né¢˜è§£/** * å–ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ä¸ºåˆå§‹èŠ‚ç‚¹ï¼Œæ¯”è¾ƒåé¢èŠ‚ç‚¹çš„å¤§å°ï¼Œé‚£ä¸ªå°ï¼Œå°†å°çš„èŠ‚ç‚¹æ”¾åœ¨å“¨å…µèŠ‚ç‚¹åé¢ * @param l1 * @param l2 * @return */public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123;    ListNode preHead = new ListNode(0);    ListNode cur = preHead;    int n1 = 0;    int n2 = 0;    while (l1 != null || l2 != null) &#123;        if(l1 == null)&#123;            preHead.next = l2;            break;        &#125;        if (l2 == null)&#123;            preHead.next = l1;            break;        &#125;        n1 = l1.val;        n2 = l2.val;        if(n1 &lt; n2)&#123;            preHead.next = new ListNode(n1);            l1 = l1.next;        &#125;else&#123;            preHead.next = new ListNode(n2);            l2 = l2.next;        &#125;        preHead = preHead.next;    &#125;    return cur.next;&#125;//ä¸éœ€è¦å–å‡ºè¦æ‹¼æ¥çš„èŠ‚ç‚¹æ•°æ®å»æ–°å»ºèŠ‚ç‚¹//ç›´æ¥å°†å€¼å¤§çš„èŠ‚ç‚¹æ‹¼æ¥åˆ°å½“å‰èŠ‚ç‚¹//æœ€ååˆå¹¶æœªåˆå¹¶å®Œçš„èŠ‚ç‚¹å³å¯public ListNode mergeTwoLists2(ListNode l1, ListNode l2) &#123;    ListNode prehead = new ListNode(-1);    ListNode prev = prehead;    while (l1 != null &amp;&amp; l2 != null) &#123;        if (l1.val &lt;= l2.val) &#123;            prev.next = l1;            l1 = l1.next;        &#125; else &#123;            prev.next = l2;            l2 = l2.next;        &#125;        prev = prev.next;    &#125;    // åˆå¹¶å l1 å’Œ l2 æœ€å¤šåªæœ‰ä¸€ä¸ªè¿˜æœªè¢«åˆå¹¶å®Œï¼Œæˆ‘ä»¬ç›´æ¥å°†é“¾è¡¨æœ«å°¾æŒ‡å‘æœªåˆå¹¶å®Œçš„é“¾è¡¨å³å¯    prev.next = l1 == null ? l2 : l1;    return prehead.next;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","é“¾è¡¨"]},{"title":"66. åŠ ä¸€","url":"/java4u/2021/06/10/66.%20%E5%8A%A0%E4%B8%80/","content":"66. åŠ ä¸€ç»™å®šä¸€ä¸ªç”± æ•´æ•° ç»„æˆçš„ éç©º æ•°ç»„æ‰€è¡¨ç¤ºçš„éè´Ÿæ•´æ•°ï¼Œåœ¨è¯¥æ•°çš„åŸºç¡€ä¸ŠåŠ ä¸€ã€‚\næœ€é«˜ä½æ•°å­—å­˜æ”¾åœ¨æ•°ç»„çš„é¦–ä½ï¼Œ æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åªå­˜å‚¨å•ä¸ªæ•°å­—ã€‚\nä½ å¯ä»¥å‡è®¾é™¤äº†æ•´æ•° 0 ä¹‹å¤–ï¼Œè¿™ä¸ªæ•´æ•°ä¸ä¼šä»¥é›¶å¼€å¤´ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šdigits &#x3D; [1,2,3]è¾“å‡ºï¼š[1,2,4]è§£é‡Šï¼šè¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 123ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šdigits &#x3D; [4,3,2,1]è¾“å‡ºï¼š[4,3,2,2]è§£é‡Šï¼šè¾“å…¥æ•°ç»„è¡¨ç¤ºæ•°å­— 4321ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šdigits &#x3D; [0]è¾“å‡ºï¼š[1]\næç¤ºï¼š\n1 &lt;&#x3D; digits.length &lt;&#x3D; 1000 &lt;&#x3D; digits[i] &lt;&#x3D; 9\né¢˜è§£public int[] plusOne(int[] digits) &#123;    //æº¢å‡ºå€¼    int y = 1;    int len = digits.length;    for (int i = len -1; i &gt;= 0; i--) &#123;        int cur = digits[i] + y;        if(y&gt;0)&#123;            y--;        &#125;        if(cur &gt;= 10)&#123;            digits[i] = 0;            y++;        &#125;else&#123;            digits[i] = cur;        &#125;    &#125;    if(y&gt;0)&#123;        int[] ret = new int[len+1];        System.arraycopy(ret,0,ret,1,len);        ret[0] = 1;        return ret;    &#125;else&#123;        return digits;    &#125;&#125;/** * é™¤ 9 ä¹‹å¤–çš„æ•°å­—åŠ ä¸€ï¼› * æ•°å­— 9ã€‚ * åªæœ‰9ã€99ç­‰ç‰¹æ®Šæ•°å­—éœ€è¦è¿›ä½ * @param digits * @return */public int[] plusOne2(int[] digits) &#123;    for (int i = digits.length - 1; i &gt;= 0; i--) &#123;        digits[i]++;        digits[i] = digits[i] % 10;        //æ²¡æœ‰å‘ç”Ÿè¿›ä½çš„æƒ…å†µï¼Œç›´æ¥è¿”å›æ•°ç»„   å¦‚ 9+1=10    99+1=100        if (digits[i] != 0) return digits;    &#125;    //è¿›ä½åˆ™ç›´æ¥æ–°å»ºæ•°ç»„    digits = new int[digits.length + 1];    digits[0] = 1;    return digits;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"27. ç§»é™¤å…ƒç´ ","url":"/java4u/2021/06/09/27.%20%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/","content":"27. ç§»é™¤å…ƒç´ ç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦ åŸåœ° ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚\nä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¹¶ åŸåœ° ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚\nå…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\nè¯´æ˜:\nä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢?\nè¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥ã€Œå¼•ç”¨ã€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚\nä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:\n&#x2F;&#x2F; nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚ä½œä»»ä½•æ‹·è´int len &#x3D; removeElement(nums, val);\n&#x2F;&#x2F; åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚&#x2F;&#x2F; æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­ è¯¥é•¿åº¦èŒƒå›´å†… çš„æ‰€æœ‰å…ƒç´ ã€‚for (int i &#x3D; 0; i &lt; len; i++) {    print(nums[i]);}\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [3,2,2,3], val &#x3D; 3è¾“å‡ºï¼š2, nums &#x3D; [2,2]è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°è¿”å›çš„æ–°é•¿åº¦ä¸º 2 ï¼Œè€Œ nums &#x3D; [2,2,3,3] æˆ– nums &#x3D; [2,2,0,0]ï¼Œä¹Ÿä¼šè¢«è§†ä½œæ­£ç¡®ç­”æ¡ˆã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0,1,2,2,3,0,4,2], val &#x3D; 2è¾“å‡ºï¼š5, nums &#x3D; [0,1,4,0,3]è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚\næç¤ºï¼š\n0 &lt;&#x3D; nums.length &lt;&#x3D; 1000 &lt;&#x3D; nums[i] &lt;&#x3D; 500 &lt;&#x3D; val &lt;&#x3D; 100\né¢˜è§£/**     * åŒæŒ‡é’ˆ     * æ€è·¯åŠç®—æ³•     *     * ç”±äºé¢˜ç›®è¦æ±‚åˆ é™¤æ•°ç»„ä¸­ç­‰äº val çš„å…ƒç´ ï¼Œå› æ­¤è¾“å‡ºæ•°ç»„çš„é•¿åº¦ä¸€å®šå°äºç­‰äºè¾“å…¥æ•°ç»„çš„é•¿åº¦ï¼Œ     * æˆ‘ä»¬å¯ä»¥æŠŠè¾“å‡ºçš„æ•°ç»„ç›´æ¥å†™åœ¨è¾“å…¥æ•°ç»„ä¸Šã€‚å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆï¼š     * å³æŒ‡é’ˆ right æŒ‡å‘å½“å‰å°†è¦å¤„ç†çš„å…ƒç´ ï¼Œå·¦æŒ‡é’ˆ left æŒ‡å‘ä¸‹ä¸€ä¸ªå°†è¦èµ‹å€¼çš„ä½ç½®ã€‚     * å¦‚æœå³æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ä¸ç­‰äº valï¼Œå®ƒä¸€å®šæ˜¯è¾“å‡ºæ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å°±å°†å³æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ å¤åˆ¶åˆ°å·¦æŒ‡é’ˆä½ç½®ï¼Œ     * ç„¶åå°†å·¦å³æŒ‡é’ˆåŒæ—¶å³ç§»ï¼›     * å¦‚æœå³æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ç­‰äº valï¼Œå®ƒä¸èƒ½åœ¨è¾“å‡ºæ•°ç»„é‡Œï¼Œæ­¤æ—¶å·¦æŒ‡é’ˆä¸åŠ¨ï¼Œå³æŒ‡é’ˆå³ç§»ä¸€ä½ã€‚     * æ•´ä¸ªè¿‡ç¨‹ä¿æŒä¸å˜çš„æ€§è´¨æ˜¯ï¼šåŒºé—´ [0,left) ä¸­çš„å…ƒç´ éƒ½ä¸ç­‰äº valã€‚å½“å·¦å³æŒ‡é’ˆéå†å®Œè¾“å…¥æ•°ç»„ä»¥åï¼Œ     * left çš„å€¼å°±æ˜¯è¾“å‡ºæ•°ç»„çš„é•¿åº¦ã€‚     * è¿™æ ·çš„ç®—æ³•åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆè¾“å…¥æ•°ç»„ä¸­æ²¡æœ‰å…ƒç´ ç­‰äº valï¼‰ï¼Œå·¦å³æŒ‡é’ˆå„éå†äº†æ•°ç»„ä¸€æ¬¡ã€‚     *     * @param nums     * @param val     * @return     */    public int removeElement2(int[] nums, int val) &#123;        int n = nums.length;        int left = 0;        for (int right = 0; right &lt; n; right++) &#123;            if (nums[right] != val) &#123;                nums[left] = nums[right];                left++;            &#125;        &#125;        return left;    &#125;    /**     * åŒæŒ‡é’ˆä¼˜åŒ–     * æ€è·¯     *     * å¦‚æœè¦ç§»é™¤çš„å…ƒç´ æ°å¥½åœ¨æ•°ç»„çš„å¼€å¤´ï¼Œä¾‹å¦‚åºåˆ— [1,2,3,4,5]ï¼Œå½“ val ä¸º 1 æ—¶ï¼Œ     * æˆ‘ä»¬éœ€è¦æŠŠæ¯ä¸€ä¸ªå…ƒç´ éƒ½å·¦ç§»ä¸€ä½ã€‚æ³¨æ„åˆ°é¢˜ç›®ä¸­è¯´ï¼šã€Œå…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€ã€‚     * å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†æœ€åä¸€ä¸ªå…ƒç´  5 ç§»åŠ¨åˆ°åºåˆ—å¼€å¤´ï¼Œå–ä»£å…ƒç´  1ï¼Œå¾—åˆ°åºåˆ— [5,2,3,4]ï¼Œ     * åŒæ ·æ»¡è¶³é¢˜ç›®è¦æ±‚ã€‚è¿™ä¸ªä¼˜åŒ–åœ¨åºåˆ—ä¸­ val å…ƒç´ çš„æ•°é‡è¾ƒå°‘æ—¶éå¸¸æœ‰æ•ˆã€‚     * å®ç°æ–¹é¢ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨åŒæŒ‡é’ˆï¼Œä¸¤ä¸ªæŒ‡é’ˆåˆå§‹æ—¶åˆ†åˆ«ä½äºæ•°ç»„çš„é¦–å°¾ï¼Œå‘ä¸­é—´ç§»åŠ¨éå†è¯¥åºåˆ—ã€‚     *     * ç®—æ³•     * å¦‚æœå·¦æŒ‡é’ˆ left æŒ‡å‘çš„å…ƒç´ ç­‰äº valï¼Œæ­¤æ—¶å°†å³æŒ‡é’ˆ right æŒ‡å‘çš„å…ƒç´ å¤åˆ¶åˆ°å·¦æŒ‡é’ˆ left çš„ä½ç½®ï¼Œ     * ç„¶åå³æŒ‡é’ˆ right å·¦ç§»ä¸€ä½ã€‚å¦‚æœèµ‹å€¼è¿‡æ¥çš„å…ƒç´ æ°å¥½ä¹Ÿç­‰äº valï¼Œå¯ä»¥ç»§ç»­æŠŠå³æŒ‡é’ˆ right æŒ‡å‘çš„å…ƒç´ çš„     * å€¼èµ‹å€¼è¿‡æ¥ï¼ˆå·¦æŒ‡é’ˆ left æŒ‡å‘çš„ç­‰äº val çš„å…ƒç´ çš„ä½ç½®ç»§ç»­è¢«è¦†ç›–ï¼‰ï¼Œç›´åˆ°å·¦æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ çš„å€¼     * ä¸ç­‰äº val ä¸ºæ­¢ã€‚     * å½“å·¦æŒ‡é’ˆ left å’Œå³æŒ‡é’ˆ right é‡åˆçš„æ—¶å€™ï¼Œå·¦å³æŒ‡é’ˆéå†å®Œæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ ã€‚     * è¿™æ ·çš„æ–¹æ³•ä¸¤ä¸ªæŒ‡é’ˆåœ¨æœ€åçš„æƒ…å†µä¸‹åˆèµ·æ¥åªéå†äº†æ•°ç»„ä¸€æ¬¡ã€‚ä¸æ–¹æ³•ä¸€ä¸åŒçš„æ˜¯ï¼Œ     * æ–¹æ³•äºŒé¿å…äº†éœ€è¦ä¿ç•™çš„å…ƒç´ çš„é‡å¤èµ‹å€¼æ“ä½œã€‚     *     * @param nums     * @param val     * @return     */    public int removeElement3(int[] nums, int val) &#123;        int left = 0;        int right = nums.length;        while (left &lt; right) &#123;            if (nums[left] == val) &#123;                nums[left] = nums[right - 1];                right--;            &#125; else &#123;                left++;            &#125;        &#125;        return left;    &#125;    /**     * ä¸é€šè¿‡     * @param nums     * @param val     * @return     */    public int removeElement(int[] nums, int val) &#123;        //ç»“æŸä½ç½®        int e = nums.length;        for (int i = 0; i &lt; e; i++) &#123;            if(nums[i] == val)&#123;                System.arraycopy(nums,i+1,nums,i,nums.length-i-1);                e--;            &#125;        &#125;        return e;    &#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"189. è½®è½¬æ•°ç»„","url":"/java4u/2021/06/08/189.%20%E8%BD%AE%E8%BD%AC%E6%95%B0%E7%BB%84/","content":"189. è½®è½¬æ•°ç»„ç»™ä½ ä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³è½®è½¬ k ä¸ªä½ç½®ï¼Œå…¶ä¸­ k æ˜¯éè´Ÿæ•°ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: nums &#x3D; [1,2,3,4,5,6,7], k &#x3D; 3è¾“å‡º: [5,6,7,1,2,3,4]è§£é‡Š:å‘å³è½®è½¬ 1 æ­¥: [7,1,2,3,4,5,6]å‘å³è½®è½¬ 2 æ­¥: [6,7,1,2,3,4,5]å‘å³è½®è½¬ 3 æ­¥: [5,6,7,1,2,3,4]\nç¤ºä¾‹ 2:\nè¾“å…¥ï¼šnums &#x3D; [-1,-100,3,99], k &#x3D; 2è¾“å‡ºï¼š[3,99,-1,-100]è§£é‡Š:å‘å³è½®è½¬ 1 æ­¥: [99,-1,-100,3]å‘å³è½®è½¬ 2 æ­¥: [3,99,-1,-100]\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 10^5-2^31 &lt;&#x3D; nums[i] &lt;&#x3D; 2^31 - 10 &lt;&#x3D; k &lt;&#x3D; 10^5\nè¿›é˜¶ï¼š\nå°½å¯èƒ½æƒ³å‡ºæ›´å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘æœ‰ ä¸‰ç§ ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ å¯ä»¥ä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸º O(1) çš„ åŸåœ° ç®—æ³•è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ\né¢˜è§£/**     * ä½¿ç”¨é¢å¤–çš„æ•°ç»„     * æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢å¤–çš„æ•°ç»„æ¥å°†æ¯ä¸ªå…ƒç´ æ”¾è‡³æ­£ç¡®çš„ä½ç½®ã€‚ç”¨ n è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ï¼Œæˆ‘ä»¬éå†åŸæ•°ç»„ï¼Œ     * å°†åŸæ•°ç»„ä¸‹æ ‡ä¸º i çš„å…ƒç´ æ”¾è‡³æ–°æ•°ç»„ä¸‹æ ‡ä¸º n(i+k)modn çš„ä½ç½®ï¼Œæœ€åå°†æ–°æ•°ç»„æ‹·è´è‡³åŸæ•°ç»„å³å¯ã€‚     *     * @param nums     * @param k     */    public void rotate2(int[] nums, int k) &#123;        int n = nums.length;        int[] newArr = new int[n];        for (int i = 0; i &lt; n; ++i) &#123;            newArr[(i + k) % n] = nums[i];        &#125;        System.arraycopy(newArr, 0, nums, 0, n);    &#125;    public void rotate(int[] nums, int k) &#123;        //åè½¬æ•°ç»„        int len = nums.length;        int[] roNums = new int[len];        for (int i = 0; i &lt; len; i++) &#123;            roNums[i] = nums[len -i -1];        &#125;        //åè½¬å‰kä¸ªæ•°        for (int j = 0; j &lt; k; j++) &#123;            nums[j] = roNums[k - j - 1];        &#125;        //åè½¬kä½åé¢çš„å‡ ä¸ªæ•°        for (int l = k; l &lt; len; l++) &#123;            nums[l] = roNums[len - l + k -1];        &#125;    &#125;    public void rotate3(int[] nums, int k) &#123;        k %= nums.length;        reverse(nums, 0, nums.length - 1);        reverse(nums, 0, k - 1);        reverse(nums, k, nums.length - 1);    &#125;    public void reverse(int[] nums, int start, int end) &#123;        while (start &lt; end) &#123;            int temp = nums[start];            nums[start] = nums[end];            nums[end] = temp;            start += 1;            end -= 1;        &#125;    &#125;    /**     * ç¯çŠ¶æ›¿æ¢     * æ–¹æ³•ä¸€ä¸­ä½¿ç”¨é¢å¤–æ•°ç»„çš„åŸå› åœ¨äºå¦‚æœæˆ‘ä»¬ç›´æ¥å°†æ¯ä¸ªæ•°å­—æ”¾è‡³å®ƒæœ€åçš„ä½ç½®ï¼Œè¿™æ ·è¢«æ”¾ç½®ä½ç½®çš„å…ƒç´ ä¼šè¢«è¦†ç›–ä»è€Œä¸¢å¤±ã€‚     * å› æ­¤ï¼Œä»å¦ä¸€ä¸ªè§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¢«æ›¿æ¢çš„å…ƒç´ ä¿å­˜åœ¨å˜é‡ temp ä¸­ï¼Œä»è€Œé¿å…äº†é¢å¤–æ•°ç»„çš„å¼€é”€ã€‚     * æˆ‘ä»¬ä»ä½ç½® 0 å¼€å§‹ï¼Œæœ€åˆä»¤temp=nums[0]ã€‚æ ¹æ®è§„åˆ™ï¼Œä½ç½® 0 çš„å…ƒç´ ä¼šæ”¾è‡³ (0+k)modn çš„ä½ç½®ï¼Œ     * ä»¤ x=(0+k)modnï¼Œæ­¤æ—¶äº¤æ¢ temp å’Œ nums[x]ï¼Œå®Œæˆä½ç½® x çš„æ›´æ–°ã€‚ç„¶åï¼Œæˆ‘ä»¬è€ƒå¯Ÿä½ç½® xï¼Œå¹¶äº¤æ¢ temp å’Œ nums[(x+k)modn]ï¼Œ     * ä»è€Œå®Œæˆä¸‹ä¸€ä¸ªä½ç½®çš„æ›´æ–°ã€‚ä¸æ–­è¿›è¡Œä¸Šè¿°è¿‡ç¨‹ï¼Œç›´è‡³å›åˆ°åˆå§‹ä½ç½® 0ã€‚     * å®¹æ˜“å‘ç°ï¼Œå½“å›åˆ°åˆå§‹ä½ç½® 0 æ—¶ï¼Œæœ‰äº›æ•°å­—å¯èƒ½è¿˜æ²¡æœ‰éå†åˆ°ï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥ä»ä¸‹ä¸€ä¸ªæ•°å­—å¼€å§‹é‡å¤çš„è¿‡ç¨‹ï¼Œå¯æ˜¯è¿™ä¸ªæ—¶å€™æ€ä¹ˆæ‰ç®—éå†ç»“æŸå‘¢ï¼Ÿ     * æˆ‘ä»¬ä¸å¦¨å…ˆè€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä» 0 å¼€å§‹ä¸æ–­éå†ï¼Œæœ€ç»ˆå›åˆ°èµ·ç‚¹ 0 çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éå†äº†å¤šå°‘ä¸ªå…ƒç´ ï¼Ÿ     * ç”±äºæœ€ç»ˆå›åˆ°äº†èµ·ç‚¹ï¼Œæ•…è¯¥è¿‡ç¨‹æ°å¥½èµ°äº†æ•´æ•°æ•°é‡çš„åœˆï¼Œä¸å¦¨è®¾ä¸º a åœˆï¼›å†è®¾è¯¥è¿‡ç¨‹æ€»å…±éå†äº† b ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ an=bkï¼Œå³ an ä¸€å®šä¸º n,k çš„å…¬å€æ•°ã€‚     * åˆå› ä¸ºæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡å›åˆ°èµ·ç‚¹æ—¶å°±ç»“æŸï¼Œå› æ­¤ a è¦å°½å¯èƒ½å°ï¼Œæ•… an å°±æ˜¯ n,k çš„æœ€å°å…¬å€æ•° lcm(n,k)ï¼Œå› æ­¤ b å°±ä¸º lcm(n,k)/kã€‚     * è¿™è¯´æ˜å•æ¬¡éå†ä¼šè®¿é—®åˆ° lcm(n,k)/k ä¸ªå…ƒç´ ã€‚ä¸ºäº†è®¿é—®åˆ°æ‰€æœ‰çš„å…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œéå†çš„æ¬¡æ•°ä¸º gcd(n,k)     * å…¶ä¸­gcd æŒ‡çš„æ˜¯æœ€å¤§å…¬çº¦æ•°ã€‚     *     * @param nums     * @param k     */    public void rotate4(int[] nums, int k) &#123;        int n = nums.length;        k = k % n;        int count = gcd(k, n);        for (int start = 0; start &lt; count; ++start) &#123;            int current = start;            int prev = nums[start];            do &#123;                int next = (current + k) % n;                int temp = nums[next];                nums[next] = prev;                prev = temp;                current = next;            &#125; while (start != current);        &#125;    &#125;    /**     * å–xyçš„æœ€å¤§å…¬çº¦æ•°     * @param x   3     * @param y   7     * @return     */    public int gcd(int x, int y) &#123;        return y &gt; 0 ? gcd(y, x % y) : x;    &#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II","url":"/java4u/2021/06/07/122.%20%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BA%20II/","content":"122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IIç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ prices ï¼Œå…¶ä¸­ prices[i] è¡¨ç¤ºæŸæ”¯è‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚\nåœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ&#x2F;æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ æœ€å¤š åªèƒ½æŒæœ‰ ä¸€è‚¡ è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ åŒä¸€å¤© å‡ºå”®ã€‚\nè¿”å› ä½ èƒ½è·å¾—çš„ æœ€å¤§ åˆ©æ¶¦ ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šprices &#x3D; [7,1,5,3,6,4]è¾“å‡ºï¼š7è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 5 - 1 &#x3D; 4 ã€‚     éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 6 - 3 &#x3D; 3 ã€‚     æ€»åˆ©æ¶¦ä¸º 4 + 3 &#x3D; 7 ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šprices &#x3D; [1,2,3,4,5]è¾“å‡ºï¼š4è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 5 - 1 &#x3D; 4 ã€‚     æ€»åˆ©æ¶¦ä¸º 4 ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šprices &#x3D; [7,6,4,3,1]è¾“å‡ºï¼š0è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, äº¤æ˜“æ— æ³•è·å¾—æ­£åˆ©æ¶¦ï¼Œæ‰€ä»¥ä¸å‚ä¸äº¤æ˜“å¯ä»¥è·å¾—æœ€å¤§åˆ©æ¶¦ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º 0 ã€‚\næç¤ºï¼š\n1 &lt;&#x3D; prices.length &lt;&#x3D; 3 * 1040 &lt;&#x3D; prices[i] &lt;&#x3D; 104\né¢˜è§£/** *è€ƒè™‘åˆ°ã€Œä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ã€ï¼Œå› æ­¤æ¯å¤©äº¤æ˜“ç»“æŸååªå¯èƒ½å­˜åœ¨æ‰‹é‡Œæœ‰ä¸€æ”¯è‚¡ç¥¨æˆ–è€…æ²¡æœ‰è‚¡ç¥¨çš„çŠ¶æ€ã€‚ * å®šä¹‰çŠ¶æ€ dp[i][0] è¡¨ç¤ºç¬¬ i å¤©äº¤æ˜“å®Œåæ‰‹é‡Œæ²¡æœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ï¼Œ * dp[i][1] è¡¨ç¤ºç¬¬ i å¤©äº¤æ˜“å®Œåæ‰‹é‡ŒæŒæœ‰ä¸€æ”¯è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ï¼ˆi ä» 0 å¼€å§‹ï¼‰ã€‚ * è€ƒè™‘ dp[i][0] çš„è½¬ç§»æ–¹ç¨‹ï¼Œå¦‚æœè¿™ä¸€å¤©äº¤æ˜“å®Œåæ‰‹é‡Œæ²¡æœ‰è‚¡ç¥¨ï¼Œé‚£ä¹ˆå¯èƒ½çš„è½¬ç§»çŠ¶æ€ä¸ºå‰ä¸€å¤©å·²ç»æ²¡æœ‰è‚¡ç¥¨ï¼Œ * å³ dp[iâˆ’1][0]ï¼Œæˆ–è€…å‰ä¸€å¤©ç»“æŸçš„æ—¶å€™æ‰‹é‡ŒæŒæœ‰ä¸€æ”¯è‚¡ç¥¨ï¼Œå³ dp[iâˆ’1][1]ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¦å°†å…¶å–å‡ºï¼Œ * å¹¶è·å¾— prices[i] çš„æ”¶ç›Šã€‚å› æ­¤ä¸ºäº†æ”¶ç›Šæœ€å¤§åŒ–ï¼Œæˆ‘ä»¬åˆ—å‡ºå¦‚ä¸‹çš„è½¬ç§»æ–¹ç¨‹ï¼š * dp[i][0]=max&#123;dp[iâˆ’1][0],dp[iâˆ’1][1]+prices[i]&#125; * å†æ¥è€ƒè™‘ dp[i][1]ï¼ŒæŒ‰ç…§åŒæ ·çš„æ–¹å¼è€ƒè™‘è½¬ç§»çŠ¶æ€ï¼Œé‚£ä¹ˆå¯èƒ½çš„è½¬ç§»çŠ¶æ€ä¸ºå‰ä¸€å¤©å·²ç»æŒæœ‰ä¸€æ”¯è‚¡ç¥¨ï¼Œå³dp[iâˆ’1][1]ï¼Œ * æˆ–è€…å‰ä¸€å¤©ç»“æŸæ—¶è¿˜æ²¡æœ‰è‚¡ç¥¨ï¼Œå³ dp[iâˆ’1][0]ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¦å°†å…¶ä¹°å…¥ï¼Œå¹¶å‡å°‘ prices[i] çš„æ”¶ç›Šã€‚ * å¯ä»¥åˆ—å‡ºå¦‚ä¸‹çš„è½¬ç§»æ–¹ç¨‹ï¼š * dp[i][1]=max&#123;dp[iâˆ’1][1],dp[iâˆ’1][0]âˆ’prices[i]&#125; * å¯¹äºåˆå§‹çŠ¶æ€ï¼Œæ ¹æ®çŠ¶æ€å®šä¹‰æˆ‘ä»¬å¯ä»¥çŸ¥é“ç¬¬ 0 å¤©äº¤æ˜“ç»“æŸçš„æ—¶å€™ dp[0][0]=0ï¼Œdp[0][1]=âˆ’prices[0]ã€‚ * å› æ­¤ï¼Œæˆ‘ä»¬åªè¦ä»å‰å¾€åä¾æ¬¡è®¡ç®—çŠ¶æ€å³å¯ã€‚ç”±äºå…¨éƒ¨äº¤æ˜“ç»“æŸåï¼ŒæŒæœ‰è‚¡ç¥¨çš„æ”¶ç›Šä¸€å®šä½äºä¸æŒæœ‰è‚¡ç¥¨çš„æ”¶ç›Šï¼Œ * å› æ­¤è¿™æ—¶å€™ dp[nâˆ’1][0] çš„æ”¶ç›Šå¿…ç„¶æ˜¯å¤§äº dp[nâˆ’1][1] çš„ï¼Œæœ€åçš„ç­”æ¡ˆå³ä¸º dp[nâˆ’1][0]ã€‚ * * @param prices * @return */public int maxProfit(int[] prices) &#123;    int n = prices.length;    int[][] dp = new int[n][2];    //æ²¡æœ‰è‚¡ç¥¨æœ€å¤§åˆ©ç›Š    dp[0][0] = 0;    //æœ‰è‚¡ç¥¨æœ€å¤§åˆ©ç›Š    dp[0][1] = -prices[0];    for (int i = 1; i &lt; n; ++i) &#123;        dp[i][0] = Math.max(dp[i - 1][0], dp[i - 1][1] + prices[i]);        dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][0] - prices[i]);    &#125;    return dp[n - 1][0];&#125;/** * è´ªå¿ƒ * è®¡ç®—ä¸€æ®µæ—¶é—´çš„æœ€å¤§åˆ©æ¶¦ï¼Œå³è®¡ç®—æ¯ä¸ªåŒºé—´æœ€å¤§çš„è´¡çŒ®åº¦ï¼Œå³å–æ¯ä¸ªåŒºé—´å¤§äº0çš„è´¡çŒ®åº¦çš„åŠ åˆ * @param prices * @return */public int maxProfit2(int[] prices)&#123;    int sum = 0;    for(int i= 1;i&lt;prices.length;i++)&#123;        sum += Math.max(prices[i]-prices[i-1], 0);    &#125;    return sum;&#125; ","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"350. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›† II","url":"/java4u/2021/06/03/350.%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9A%84%E4%BA%A4%E9%9B%86%20II/","content":"350. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›† IIç»™ä½ ä¸¤ä¸ªæ•´æ•°æ•°ç»„ nums1 å’Œ nums2 ï¼Œè¯·ä½ ä»¥æ•°ç»„å½¢å¼è¿”å›ä¸¤æ•°ç»„çš„äº¤é›†ã€‚è¿”å›ç»“æœä¸­æ¯ä¸ªå…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œåº”ä¸å…ƒç´ åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­éƒ½å‡ºç°çš„æ¬¡æ•°ä¸€è‡´ï¼ˆå¦‚æœå‡ºç°æ¬¡æ•°ä¸ä¸€è‡´ï¼Œåˆ™è€ƒè™‘å–è¾ƒå°å€¼ï¼‰ã€‚å¯ä»¥ä¸è€ƒè™‘è¾“å‡ºç»“æœçš„é¡ºåºã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums1 &#x3D; [1,2,2,1], nums2 &#x3D; [2,2]è¾“å‡ºï¼š[2,2]\nç¤ºä¾‹ 2:\nè¾“å…¥ï¼šnums1 &#x3D; [4,9,5], nums2 &#x3D; [9,4,9,8,4]è¾“å‡ºï¼š[4,9]\næç¤ºï¼š\n1 &lt;&#x3D; nums1.length, nums2.length &lt;&#x3D; 10000 &lt;&#x3D; nums1[i], nums2[i] &lt;&#x3D; 1000\nè¿›é˜¶ï¼š\nå¦‚æœç»™å®šçš„æ•°ç»„å·²ç»æ’å¥½åºå‘¢ï¼Ÿä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿå¦‚æœ nums1 çš„å¤§å°æ¯” nums2 å°ï¼Œå“ªç§æ–¹æ³•æ›´ä¼˜ï¼Ÿå¦‚æœ nums2 çš„å…ƒç´ å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä¸€æ¬¡åŠ è½½æ‰€æœ‰çš„å…ƒç´ åˆ°å†…å­˜ä¸­ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿ\né¢˜è§£/** * mapæ˜ å°„ * ç”±äºåŒä¸€ä¸ªæ•°å­—åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­éƒ½å¯èƒ½å‡ºç°å¤šæ¬¡ï¼Œå› æ­¤éœ€è¦ç”¨å“ˆå¸Œè¡¨å­˜å‚¨æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°ã€‚ * å¯¹äºä¸€ä¸ªæ•°å­—ï¼Œå…¶åœ¨äº¤é›†ä¸­å‡ºç°çš„æ¬¡æ•°ç­‰äºè¯¥æ•°å­—åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°çš„æœ€å°å€¼ã€‚ * é¦–å…ˆéå†ç¬¬ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶åœ¨å“ˆå¸Œè¡¨ä¸­è®°å½•ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªæ•°å­—ä»¥åŠå¯¹åº”å‡ºç°çš„æ¬¡æ•°ï¼Œ * ç„¶åéå†ç¬¬äºŒä¸ªæ•°ç»„ï¼Œå¯¹äºç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªæ•°å­—ï¼Œå¦‚æœåœ¨å“ˆå¸Œè¡¨ä¸­å­˜åœ¨è¿™ä¸ªæ•°å­—ï¼Œåˆ™å°†è¯¥æ•°å­—æ·»åŠ åˆ°ç­”æ¡ˆï¼Œ * å¹¶å‡å°‘å“ˆå¸Œè¡¨ä¸­è¯¥æ•°å­—å‡ºç°çš„æ¬¡æ•°ã€‚ * ä¸ºäº†é™ä½ç©ºé—´å¤æ‚åº¦ï¼Œé¦–å…ˆéå†è¾ƒçŸ­çš„æ•°ç»„å¹¶åœ¨å“ˆå¸Œè¡¨ä¸­è®°å½•æ¯ä¸ªæ•°å­—ä»¥åŠå¯¹åº”å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åéå†è¾ƒé•¿çš„æ•°ç»„å¾—åˆ°äº¤é›†ã€‚ * @param nums1 * @param nums2 * @return */public static int[] intersect(int[] nums1, int[] nums2) &#123;    Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();    for (int i : nums1) &#123;        if (!map.containsKey(i)) &#123;            map.put(i, 1);        &#125;else&#123;            map.put(i, map.get(i)+1);        &#125;    &#125;    List&lt;Integer&gt; list = new ArrayList&lt;&gt;();    for (int j : nums2) &#123;        if(map.containsKey(j))&#123;            Integer integer = map.get(j);            if(integer == 0)&#123;                map.remove(j);                continue;            &#125;            list.add(j);            map.put(j, map.get(j) - 1);        &#125;    &#125;    return list.stream().mapToInt(Integer::intValue).toArray();&#125;/** * ä¼˜åŒ– * 1.å…ˆéå†çŸ­çš„æ•°ç»„æ±‚å‡ºç°æ¬¡æ•°ï¼Œåœ¨éå†é•¿çš„æ•°ç»„æ±‚äº¤é›† * 2.map.getOrDefault() æ ¹æ®keyä»mapå–å€¼ï¼Œæ²¡æœ‰å¾—åˆ°é»˜è®¤å€¼ * 3.Arrays.copyOfRange  ä½¿ç”¨System.arraycopyæ‹·è´æ•°ç»„ * * @param nums1 * @param nums2 * @return */public int[] intersect2(int[] nums1, int[] nums2) &#123;    if (nums1.length &gt; nums2.length) &#123;        return intersect(nums2, nums1);    &#125;    Map&lt;Integer, Integer&gt; map = new HashMap&lt;Integer, Integer&gt;();    for (int num : nums1) &#123;        int count = map.getOrDefault(num, 0) + 1;        map.put(num, count);    &#125;    int[] intersection = new int[nums1.length];    int index = 0;    for (int num : nums2) &#123;        int count = map.getOrDefault(num, 0);        if (count &gt; 0) &#123;            intersection[index++] = num;            count--;            if (count &gt; 0) &#123;                map.put(num, count);            &#125; else &#123;                map.remove(num);            &#125;        &#125;    &#125;    return Arrays.copyOfRange(intersection, 0, index);&#125;/** * ä¼˜åŒ– æ’åºå¥½çš„æ•°ç»„ * ä½¿ç”¨2ä¸ªæŒ‡é’ˆåˆ¤æ–­2ä¸ªæ•°ç»„ä¸­çš„å€¼ï¼Œç›¸ç­‰åŒæ—¶å‘åç§» * ä¸ç›¸ç­‰ï¼Œå°çš„æŒ‡é’ˆå‘åç§» * @param nums1 * @param nums2 * @return */public int[] intersect3(int[] nums1, int[] nums2) &#123;    Arrays.sort(nums1);    Arrays.sort(nums2);    int len1 = nums1.length;    int len2 = nums2.length;    int[] res = new int[len1];    int i = 0;    int j = 0;    int index = 0;    while (i&lt;len1 &amp;&amp; j&lt;len2)&#123;        if(nums1[i]==nums2[j])&#123;            res[index++]=nums1[i];            i++;            j++;        &#125;else if(nums1[i] &lt; nums2[j])&#123;            i++;        &#125;else &#123;            j++;        &#125;    &#125;    return Arrays.copyOfRange(res, 0, index);&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"Dubbo","url":"/java4u/2021/05/15/dubbo/","content":"æ ¸å¿ƒåŠŸèƒ½1)é¢å‘æ¥å£ä»£ç†çš„é«˜æ€§èƒ½RPCè°ƒç”¨:\næä¾›é«˜æ€§èƒ½çš„åŸºäºä»£ç†çš„è¿œç¨‹è°ƒç”¨èƒ½åŠ›ï¼ŒæœåŠ¡ä»¥æ¥å£ä¸ºç²’åº¦ï¼Œä¸ºå¼€å‘è€…å±è”½è¿œç¨‹è°ƒç”¨åº•å±‚ç»†èŠ‚ã€‚\n2)æ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡:\nå†…ç½®å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæ™ºèƒ½æ„ŸçŸ¥ä¸‹æ¸¸èŠ‚ç‚¹å¥åº·çŠ¶å†µï¼Œæ˜¾è‘—å‡å°‘è°ƒç”¨å»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿååé‡ã€‚\n3)æœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°:\næ”¯æŒå¤šç§æ³¨å†Œä¸­å¿ƒæœåŠ¡ï¼ŒæœåŠ¡å®ä¾‹ä¸Šä¸‹çº¿å®æ—¶æ„ŸçŸ¥ã€‚\n4)é«˜åº¦å¯æ‰©å±•èƒ½åŠ›:\néµå¾ªå¾®å†…æ ¸+æ’ä»¶çš„è®¾è®¡åŸåˆ™ï¼Œæ‰€æœ‰æ ¸å¿ƒèƒ½åŠ›å¦‚Protocolã€Transportã€Serializationè¢«è®¾è®¡ä¸ºæ‰©å±•ç‚¹ï¼Œå¹³ç­‰å¯¹å¾…å†…ç½®å®ç°å’Œç¬¬ä¸‰æ–¹å®ç°ã€‚\n5)è¿è¡ŒæœŸæµé‡è°ƒåº¦:\nå†…ç½®æ¡ä»¶ã€è„šæœ¬ç­‰è·¯ç”±ç­–ç•¥ï¼Œé€šè¿‡é…ç½®ä¸åŒçš„è·¯ç”±è§„åˆ™ï¼Œè½»æ¾å®ç°ç°åº¦å‘å¸ƒï¼ŒåŒæœºæˆ¿ä¼˜å…ˆç­‰åŠŸèƒ½ã€‚\n6)å¯è§†åŒ–çš„æœåŠ¡æ²»ç†ä¸è¿ç»´:\næä¾›ä¸°å¯ŒæœåŠ¡æ²»ç†ã€è¿ç»´å·¥å…·ï¼šéšæ—¶æŸ¥è¯¢æœåŠ¡å…ƒæ•°æ®ã€æœåŠ¡å¥åº·çŠ¶æ€åŠè°ƒç”¨ç»Ÿè®¡ï¼Œå®æ—¶ä¸‹å‘è·¯ç”±ç­–ç•¥ã€è°ƒæ•´é…ç½®å‚æ•°ã€‚\næ¶æ„\n\næœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚\næœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚\næœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚\næ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚\næœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚\næœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚\n\né¡¹ç›®å®ä¾‹1user-rpc-service-api é¡¹ç›®ï¼šæœåŠ¡æ¥å£ï¼Œå®šä¹‰ Dubbo Service API æ¥å£ï¼Œæä¾›ç»™æ¶ˆè´¹è€…ä½¿ç”¨\n2user-rpc-service-provider é¡¹ç›®ï¼šæœåŠ¡æä¾›è€…ï¼Œå®ç° user-rpc-service-api é¡¹ç›®å®šä¹‰çš„ Dubbo Service API æ¥å£ï¼Œæä¾›ç›¸åº”çš„æœåŠ¡\n3user-rpc-service-consumer é¡¹ç›®ï¼šæœåŠ¡æ¶ˆè´¹è€…ï¼Œä¼šè°ƒç”¨ user-rpc-service-provider é¡¹ç›®æä¾›çš„ Dubbo Service æœåŠ¡\nåŸç†ï¼ˆ1ï¼‰è¯»å–é…ç½®å°†æœåŠ¡è£…è½½å®¹å™¨ä¸­ï¼Œç„¶åå‡†å¤‡æ³¨å†ŒæœåŠ¡ï¼Œdubboå…ˆè¯»é…ç½®æ–‡ä»¶è§£ææœåŠ¡\n1)dubboæ ‡ç­¾çš„è§£æä¸»è¦ç”¨åˆ°äº†DubboNamespaceHandler è¿™ä¸ªç±»\n\n2ï¼‰æ‰€æœ‰dubboæ ‡ç­¾éƒ½ç»Ÿä¸€ä½¿ç”¨DubboBeanDefinitionParserè¿›è¡Œè§£æï¼Œå°†XMLæ ‡ç­¾è§£æä¸ºBEANå¯¹è±¡ã€‚åœ¨åˆå§‹åŒ–æ—¶å°†BEANå¯¹è±¡è½¬æ¢ä¸ºurlæ ¼å¼ï¼Œè¿›è¡Œä¸åŒåè®®çš„æœåŠ¡æš´éœ²å’Œå¼•ç”¨\n\nï¼ˆ2ï¼‰serviceBeanæ˜¯ä½•æ—¶æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›è€…æš´éœ²ä¸€ä¸ªæœåŠ¡çš„è¯¦ç»†è¿‡ç¨‹\n\né¦–å…ˆServiceConfigç±»æ‹¿åˆ°å¯¹å¤–æä¾›æœåŠ¡çš„å®é™…ç±»ref(å¦‚ï¼šHelloWorldImpl),ç„¶åé€šè¿‡ProxyFactoryç±»çš„getInvokeræ–¹æ³•ä½¿ç”¨refç”Ÿæˆä¸€ä¸ªAbstractProxyInvokerå®ä¾‹ï¼Œ\nåˆ°è¿™ä¸€æ­¥å°±å®Œæˆå…·ä½“æœåŠ¡åˆ°Invokerçš„è½¬åŒ–ã€‚æ¥ä¸‹æ¥å°±æ˜¯Invokerè½¬æ¢åˆ°Exporterçš„è¿‡ç¨‹ã€‚\nDubboå¤„ç†æœåŠ¡æš´éœ²çš„å…³é”®å°±åœ¨Invokerè½¬æ¢åˆ°Exporterçš„è¿‡ç¨‹(å¦‚ä¸Šå›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†)ï¼Œä¸‹é¢æˆ‘ä»¬ä»¥Dubboå’ŒRMIè¿™ä¸¤ç§å…¸å‹åè®®çš„å®ç°æ¥è¿›è¡Œè¯´æ˜ï¼š\nDubboçš„å®ç°ï¼š\nDubboåè®®çš„Invokerè½¬ä¸ºExporterå‘ç”Ÿåœ¨DubboProtocolç±»çš„exportæ–¹æ³•ï¼Œå®ƒä¸»è¦æ˜¯æ‰“å¼€socketä¾¦å¬æœåŠ¡ï¼Œå¹¶æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„å„ç§è¯·æ±‚ï¼Œé€šè®¯ç»†èŠ‚ç”±Dubboè‡ªå·±å®ç°ã€‚\nRMIçš„å®ç°ï¼š\nRMIåè®®çš„Invokerè½¬ä¸ºExporterå‘ç”Ÿåœ¨RmiProtocolç±»çš„exportæ–¹æ³•ï¼Œå®ƒé€šè¿‡Springæˆ–Dubboæˆ–JDKæ¥å®ç°RMIæœåŠ¡ï¼Œé€šè®¯ç»†èŠ‚è¿™ä¸€å—ç”±JDKåº•å±‚æ¥å®ç°ï¼Œè¿™å°±çœäº†ä¸å°‘å·¥ä½œé‡ã€‚\næœåŠ¡æ¶ˆè´¹è€…æ¶ˆè´¹ä¸€ä¸ªæœåŠ¡çš„è¯¦ç»†è¿‡ç¨‹\né¦–å…ˆReferenceConfigç±»çš„initæ–¹æ³•è°ƒç”¨Protocolçš„referæ–¹æ³•ç”ŸæˆInvokerå®ä¾‹(å¦‚ä¸Šå›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†)ï¼Œè¿™æ˜¯æœåŠ¡æ¶ˆè´¹çš„å…³é”®ã€‚\næ¥ä¸‹æ¥æŠŠInvokerè½¬æ¢ä¸ºå®¢æˆ·ç«¯éœ€è¦çš„æ¥å£(å¦‚ï¼šHelloWorld)ã€‚\ndubboå·¥ä½œæµç¨‹\n\næœåŠ¡æä¾›è€…åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šé€šè¿‡è¯»å–ä¸€äº›é…ç½®å°†æœåŠ¡å®ä¾‹åŒ–ã€‚\nProxy å°è£…æœåŠ¡è°ƒç”¨æ¥å£ï¼Œæ–¹ä¾¿è°ƒç”¨è€…è°ƒç”¨ã€‚å®¢æˆ·ç«¯è·å– Proxy æ—¶ï¼Œå¯ä»¥åƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¸€æ ·ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚\nProxy åœ¨å°è£…æ—¶ï¼Œéœ€è¦è°ƒç”¨ Protocol å®šä¹‰åè®®æ ¼å¼ï¼Œä¾‹å¦‚ï¼šDubbo Protocolã€‚\nå°† Proxy å°è£…æˆ Invokerï¼Œå®ƒæ˜¯çœŸå®æœåŠ¡è°ƒç”¨çš„å®ä¾‹ã€‚\nå°† Invoker è½¬åŒ–æˆ Exporterï¼ŒExporter åªæ˜¯æŠŠ InvokeråŒ…è£…äº†ä¸€å±‚ï¼Œæ˜¯ä¸ºäº†åœ¨æ³¨å†Œä¸­å¿ƒä¸­æš´éœ²è‡ªå·±ï¼Œæ–¹ä¾¿æ¶ˆè´¹è€…ä½¿ç”¨ã€‚\nå°†åŒ…è£…å¥½çš„ Exporter æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚\næœåŠ¡æ¶ˆè´¹è€…å»ºç«‹å¥½å®ä¾‹ï¼Œä¼šåˆ°æœåŠ¡æ³¨å†Œä¸­å¿ƒè®¢é˜…æœåŠ¡æä¾›è€…çš„å…ƒæ•°æ®ã€‚å…ƒæ•°æ®åŒ…æ‹¬æœåŠ¡ IP å’Œç«¯å£ä»¥åŠè°ƒç”¨æ–¹å¼(Proxy)ã€‚\næ¶ˆè´¹è€…ä¼šé€šè¿‡è·å–çš„ Proxy è¿›è¡Œè°ƒç”¨ã€‚é€šè¿‡æœåŠ¡æä¾›æ–¹åŒ…è£…è¿‡ç¨‹å¯ä»¥çŸ¥é“ï¼ŒProxy å®é™…åŒ…è£…äº† Invoker å®ä½“ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨Invoker è¿›è¡Œè°ƒç”¨ã€‚\nåœ¨ Invoker è°ƒç”¨ä¹‹å‰ï¼Œé€šè¿‡ Directory è·å–æœåŠ¡æä¾›è€…çš„ Invokeråˆ—è¡¨ã€‚åœ¨åˆ†å¸ƒå¼çš„æœåŠ¡ä¸­æœ‰å¯èƒ½å‡ºç°åŒä¸€ä¸ªæœåŠ¡ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚\né€šè¿‡è·¯ç”±è§„åˆ™äº†è§£ï¼ŒæœåŠ¡éœ€è¦ä»å“ªäº›èŠ‚ç‚¹è·å–ã€‚\nInvoker è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ Cluster è¿›è¡Œå®¹é”™ï¼Œå¦‚æœé‡åˆ°å¤±è´¥ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚\nè°ƒç”¨ä¸­ï¼Œç”±äºå¤šä¸ªæœåŠ¡å¯èƒ½ä¼šåˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ï¼Œå°±è¦é€šè¿‡ LoadBalance æ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚\nInvoker è°ƒç”¨ä¹‹å‰è¿˜éœ€è¦ç»è¿‡ Filterï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿‡æ»¤é“¾ï¼Œç”¨æ¥å¤„ç†ä¸Šä¸‹æ–‡ï¼Œé™æµå’Œè®¡æ•°çš„å·¥ä½œã€‚\nç”Ÿæˆè¿‡æ»¤ä»¥åçš„ Invokerã€‚\nç”¨ Client è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚\nCodec ä¼šæ ¹æ® Protocol å®šä¹‰çš„åè®®ï¼Œè¿›è¡Œåè®®çš„æ„é€ ã€‚\næ„é€ å®Œæˆçš„æ•°æ®ï¼Œé€šè¿‡åºåˆ—åŒ– Serialization ä¼ è¾“ç»™æœåŠ¡æä¾›è€…ã€‚\nRequest å·²ç»åˆ°è¾¾äº†æœåŠ¡æä¾›è€…ï¼Œå®ƒä¼šè¢«åˆ†é…åˆ°çº¿ç¨‹æ± (ThreadPool)ä¸­è¿›è¡Œå¤„ç†ã€‚\nServer æ‹¿åˆ°è¯·æ±‚ä»¥åæŸ¥æ‰¾å¯¹åº”çš„ Exporter(åŒ…å«æœ‰ Invoker)ã€‚\nç”±äº Export ä¹Ÿä¼šè¢« Filter å±‚å±‚åŒ…è£¹\né€šè¿‡ Filter ä»¥åè·å¾— Invoker\næœ€åï¼Œå¯¹æœåŠ¡æä¾›è€…å®ä½“è¿›è¡Œè°ƒç”¨ã€‚\n\nRPC å·¥ä½œåŸç†\nRPCçš„è®¾è®¡ç”±Clientï¼ŒClient stubï¼ŒNetwork ï¼ŒServer stubï¼ŒServeræ„æˆã€‚ å…¶ä¸­Clientå°±æ˜¯ç”¨æ¥è°ƒç”¨æœåŠ¡çš„ï¼ŒCient stubæ˜¯ç”¨æ¥æŠŠè°ƒç”¨çš„æ–¹æ³•å’Œå‚æ•°åºåˆ—åŒ–çš„ï¼ˆå› ä¸ºè¦åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¿…é¡»è¦æŠŠå¯¹è±¡è½¬å˜æˆå­—èŠ‚ï¼‰ï¼ŒNetworkç”¨æ¥ä¼ è¾“è¿™äº›ä¿¡æ¯åˆ°Server stubï¼Œ Server stubç”¨æ¥æŠŠè¿™äº›ä¿¡æ¯ååºåˆ—åŒ–çš„ï¼ŒServerå°±æ˜¯æœåŠ¡çš„æä¾›è€…ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯Serveræä¾›çš„æ–¹æ³•ã€‚\nDubboé«˜çº§ç‰¹æ€§åœ°å€ç¼“å­˜æ³¨å†Œä¸­å¿ƒæŒ‚äº†ï¼ŒæœåŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®ï¼Ÿ\nå¯ä»¥ï¼ŒdubboæœåŠ¡æ¶ˆè´¹è€…ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œä¼šå°†æœåŠ¡æä¾›æ–¹ç¼“å­˜åˆ°æœ¬åœ°ï¼Œä»¥åè°ƒç”¨æ—¶ä¸ä¼šè®¿é—®æ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡æä¾›è€…åœ°å€å‘é€å˜åŒ–æ—¶ï¼Œæ³¨å†Œä¸­å¿ƒæ‰ä¼šé€šçŸ¥æ¶ˆè´¹è€…\nè¶…æ—¶ä¸é‡è¯•è°ƒç”¨æœåŠ¡æ—¶å¦‚æœå‘é€é˜»å¡ã€ç­‰å¾…çš„æƒ…å†µï¼Œæ¶ˆè´¹è€…ä¼šä¸€ç›´ç­‰å¾…åœ¨å³°å€¼æ—¶åˆ»ï¼Œå¤§é‡è¯·æ±‚åŒæ—¶è¯·æ±‚æ¶ˆè´¹è€…ï¼Œè€Œçº¿ç¨‹å¾—ä¸åˆ°é‡Šæ”¾ï¼Œä¼šé€ æˆçº¿ç¨‹çš„å †ç§¯dubboåˆ©ç”¨è¶…æ—¶æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè‡ªåŠ¨æ–­å¼€è¶…æ—¶çš„è¯·æ±‚\nå¤šç‰ˆæœ¬ä½¿ç”¨versionæ§åˆ¶ä½¿ç”¨åŒä¸€ä¸ªæ¥å£çš„ä¸åŒç‰ˆæœ¬\nè´Ÿè½½å‡è¡¡dubboæä¾›4ç§è´Ÿè½½å‡è¡¡æ–¹å¼ï¼š\n\nRandom æ ¹æ®æƒé‡éšæœº\nRoundRobin æŒ‰æƒé‡è½®è¯¢\nLeastActive æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°\nConsistentHash ä¸€è‡´æ€§Hash,ç›¸åŒå‚æ•°çš„è¯·æ±‚å‘åˆ°åŒä¸€ä¸ªæä¾›è€…\n\né›†ç¾¤å®¹é”™é›†ç¾¤å®¹é”™æ¨¡å¼ï¼š\n\nFailover Cluster å¤±è´¥é‡è¯•ã€‚å‡ºç°å¤±è´¥æ—¶ï¼Œé‡è¯•å…¶ä»–æœåŠ¡å™¨ï¼ˆä¸€èˆ¬ç”¨äºè¯»æ“ä½œï¼‰\nFailfast Cluster åªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼ˆä¸€èˆ¬ç”¨å†™æ“ä½œï¼‰\nFailsafe Cluster å‡ºç°å¼‚å¸¸ç›´æ¥å¿½ç•¥ï¼Œè¿”å›ç©ºç»“æœ\nFailback Cluster å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œè®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘\nForking Cluster å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›\n\næœåŠ¡é™çº§mock&#x3D;â€force:return nullâ€  ä¸å†è°ƒç”¨(åœæ‰ä¸é‡è¦çš„æœåŠ¡)mock&#x3D;â€fail:return nullâ€ å¤±è´¥ä¹‹åè¿”å›nullä¸æŠ¥é”™\n","categories":["æ¡†æ¶"],"tags":["å­¦ä¹ ","æºç "]},{"title":"RPC","url":"/java4u/2021/04/23/RPC/","content":"RPCå°±æ˜¯è¦åƒè°ƒç”¨æœ¬åœ°çš„å‡½æ•°ä¸€æ ·å»è°ƒè¿œç¨‹å‡½æ•°\n1.Call IDæ˜ å°„ã€‚æœ¬åœ°è°ƒç”¨ä¸­ï¼Œå‡½æ•°ä½“æ˜¯ç›´æ¥é€šè¿‡å‡½æ•°æŒ‡é’ˆæ¥æŒ‡å®šçš„åœ¨RPCä¸­ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½å¿…é¡»æœ‰è‡ªå·±çš„ä¸€ä¸ªIDã€‚è¿™ä¸ªIDåœ¨æ‰€æœ‰è¿›ç¨‹ä¸­éƒ½æ˜¯å”¯ä¸€ç¡®å®šçš„ã€‚å®¢æˆ·ç«¯åœ¨åšè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œå¿…é¡»é™„ä¸Šè¿™ä¸ªIDã€‚ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åˆ†åˆ«ç»´æŠ¤ä¸€ä¸ª {å‡½æ•° &lt;â€“&gt; Call ID} çš„å¯¹åº”è¡¨ã€‚å½“å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ï¼Œå®ƒå°±æŸ¥ä¸€ä¸‹è¿™ä¸ªè¡¨ï¼Œæ‰¾å‡ºç›¸åº”çš„Call IDï¼Œç„¶åæŠŠå®ƒä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿé€šè¿‡æŸ¥è¡¨ï¼Œæ¥ç¡®å®šå®¢æˆ·ç«¯éœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œç„¶åæ‰§è¡Œç›¸åº”å‡½æ•°çš„ä»£ç \n2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å®¢æˆ·ç«¯æŠŠå‚æ•°å…ˆè½¬æˆä¸€ä¸ªå­—èŠ‚æµï¼Œä¼ ç»™æœåŠ¡ç«¯åï¼Œå†æŠŠå­—èŠ‚æµè½¬æˆè‡ªå·±èƒ½è¯»å–çš„æ ¼å¼ã€‚è¿™ä¸ªè¿‡ç¨‹å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚åŒç†ï¼Œä»æœåŠ¡ç«¯è¿”å›çš„å€¼ä¹Ÿéœ€è¦åºåˆ—åŒ–ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚\n3.ç½‘ç»œä¼ è¾“ã€‚ç½‘ç»œä¼ è¾“å±‚éœ€è¦æŠŠCall IDå’Œåºåˆ—åŒ–åçš„å‚æ•°å­—èŠ‚æµä¼ ç»™æœåŠ¡ç«¯ï¼Œç„¶åå†æŠŠåºåˆ—åŒ–åçš„è°ƒç”¨ç»“æœä¼ å›å®¢æˆ·ç«¯ã€‚åªè¦èƒ½å®Œæˆè¿™ä¸¤è€…çš„ï¼Œéƒ½å¯ä»¥ä½œä¸ºä¼ è¾“å±‚ä½¿ç”¨ã€‚å› æ­¤ï¼Œå®ƒæ‰€ä½¿ç”¨çš„åè®®å…¶å®æ˜¯ä¸é™çš„ï¼Œèƒ½å®Œæˆä¼ è¾“å°±è¡Œã€‚å°½ç®¡å¤§éƒ¨åˆ†RPCæ¡†æ¶éƒ½ä½¿ç”¨TCPåè®®ï¼Œä½†å…¶å®UDPä¹Ÿå¯ä»¥ï¼Œè€ŒgRPCå¹²è„†å°±ç”¨äº†HTTP2ã€‚Javaçš„Nettyä¹Ÿå±äºè¿™å±‚çš„ä¸œè¥¿\n&#x2F;&#x2F; Clientç«¯&#x2F;&#x2F;    int l_times_r &#x3D; Call(ServerAddr, Multiply, lvalue, rvalue)\n\nå°†è¿™ä¸ªè°ƒç”¨æ˜ å°„ä¸ºCall IDã€‚è¿™é‡Œå‡è®¾ç”¨æœ€ç®€å•çš„å­—ç¬¦ä¸²å½“Call IDçš„æ–¹æ³•\nå°†Call IDï¼Œlvalueå’Œrvalueåºåˆ—åŒ–ã€‚å¯ä»¥ç›´æ¥å°†å®ƒä»¬çš„å€¼ä»¥äºŒè¿›åˆ¶å½¢å¼æ‰“åŒ…\næŠŠ2ä¸­å¾—åˆ°çš„æ•°æ®åŒ…å‘é€ç»™ServerAddrï¼Œè¿™éœ€è¦ä½¿ç”¨ç½‘ç»œä¼ è¾“å±‚\nç­‰å¾…æœåŠ¡å™¨è¿”å›ç»“æœ\nå¦‚æœæœåŠ¡å™¨è°ƒç”¨æˆåŠŸï¼Œé‚£ä¹ˆå°±å°†ç»“æœååºåˆ—åŒ–ï¼Œå¹¶èµ‹ç»™l_times_r\n\n&#x2F;&#x2F; Serverç«¯\n\nåœ¨æœ¬åœ°ç»´æŠ¤ä¸€ä¸ªCall IDåˆ°å‡½æ•°æŒ‡é’ˆçš„æ˜ å°„call_id_mapï¼Œå¯ä»¥ç”¨std::map&lt;std::string, std::function&lt;&gt;&gt;\nç­‰å¾…è¯·æ±‚\nå¾—åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œå°†å…¶æ•°æ®åŒ…ååºåˆ—åŒ–ï¼Œå¾—åˆ°Call ID\né€šè¿‡åœ¨call_id_mapä¸­æŸ¥æ‰¾ï¼Œå¾—åˆ°ç›¸åº”çš„å‡½æ•°æŒ‡é’ˆ\nå°†lvalueå’Œrvalueååºåˆ—åŒ–åï¼Œåœ¨æœ¬åœ°è°ƒç”¨Multiplyå‡½æ•°ï¼Œå¾—åˆ°ç»“æœ\nå°†ç»“æœåºåˆ—åŒ–åé€šè¿‡ç½‘ç»œè¿”å›ç»™Client\n\nSCFè°ƒç”¨æ–¹å¼ï¼š    callMap(svcName, data)\nIServiceOutput call(String svcName, BizVisit visit, Object datas, Paging page)\n\nIServiceOutput out = CallerProvider.getCaller(svcName).call(visit, datas, page, false);\n\nMap&lt;String, Object&gt; response = this.invokeService(this.createRequest(visit, data, page));\n\nIClientSV client = CsfServiceFactory.getService(this.getSvcName());\nMap&lt;String, Object&gt; result = (Map)client.service(param);\n\nè·å–è¿”å›å€¼\n\n","categories":["åˆ†å¸ƒå¼"],"tags":["RPC"]},{"title":"OAuth","url":"/java4u/2021/04/22/OAuth/","content":"OAuthæ˜¯ä¸€ä¸ªå…³äºæˆæƒï¼ˆauthorizationï¼‰çš„å¼€æ”¾ç½‘ç»œæ ‡å‡†\nåœºæ™¯ï¼šæ‹çš„ç…§ç‰‡å‘ç»™Googleï¼Œäº‘æ‹ç…§éœ€è¦ç”¨åˆ°Googleä¸Šçš„ç…§ç‰‡ï¼Œéœ€è¦æˆæƒ\nåè¯å®šä¹‰ï¼š\n\nç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œâ€å®¢æˆ·ç«¯â€œï¼Œå³äº‘æ‹ç…§\nHTTP service: æœåŠ¡æä¾›å•†ï¼Œå³Google\nResource Owner:èµ„æºæ‹¥æœ‰è€…ï¼Œå³ç”¨æˆ·\nUser Agent:ç”¨æˆ·ä»£ç†ï¼Œå³æµè§ˆå™¨\nAuthorization server:è®¤è¯æœåŠ¡å™¨\nResource server:èµ„æºæœåŠ¡å™¨\n\nOAuthæ€è·¯ï¼š\n\nåœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡æä¾›å•†ä¹‹é—´è®¾ç½®æˆæƒå±‚ï¼Œå®¢æˆ·ç«¯ä¸ç›´æ¥ç™»é™†æœåŠ¡æä¾›å•†ï¼Œåªç™»é™†æˆæƒå±‚\nå®¢æˆ·ç«¯ç™»é™†æˆæƒå±‚æ‰€ç”¨çš„ä»¤ç‰Œï¼ŒæŒ‡å®šä»¤ç‰Œçš„æƒé™èŒƒå›´å’Œæœ‰æ•ˆæœŸ\n\nè¿è¡Œæµç¨‹ï¼š\n\nï¼ˆAï¼‰ç”¨æˆ·æ‰“å¼€å®¢æˆ·ç«¯ä»¥åï¼Œå®¢æˆ·ç«¯è¦æ±‚ç”¨æˆ·ç»™äºˆæˆæƒã€‚\nï¼ˆBï¼‰ç”¨æˆ·åŒæ„ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚\nï¼ˆCï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä¸Šä¸€æ­¥è·å¾—çš„æˆæƒï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚\nï¼ˆDï¼‰è®¤è¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ä»¥åï¼Œç¡®è®¤æ— è¯¯ï¼ŒåŒæ„å‘æ”¾ä»¤ç‰Œã€‚\nï¼ˆEï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œï¼Œå‘èµ„æºæœåŠ¡å™¨ç”³è¯·è·å–èµ„æºã€‚\nï¼ˆFï¼‰èµ„æºæœåŠ¡å™¨ç¡®è®¤ä»¤ç‰Œæ— è¯¯ï¼ŒåŒæ„å‘å®¢æˆ·ç«¯å¼€æ”¾èµ„æºã€‚\n\nå®¢æˆ·ç«¯æˆæƒæ¨¡å¼\n\næˆæƒç æ¨¡å¼\nç®€åŒ–æ¨¡å¼\nå¯†ç æ¨¡å¼\nå®¢æˆ·ç«¯æ¨¡å¼\n\næˆæƒç æ¨¡å¼ï¼š    é€šè¿‡å®¢æˆ·ç«¯çš„åå°æœåŠ¡å™¨ï¼Œä¸â€æœåŠ¡æä¾›å•†â€çš„è®¤è¯æœåŠ¡å™¨è¿›è¡Œäº’åŠ¨\n\nï¼ˆAï¼‰ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯ï¼Œåè€…å°†å‰è€…å¯¼å‘è®¤è¯æœåŠ¡å™¨ã€‚\nï¼ˆBï¼‰ç”¨æˆ·é€‰æ‹©æ˜¯å¦ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚\nï¼ˆCï¼‰å‡è®¾ç”¨æˆ·ç»™äºˆæˆæƒï¼Œè®¤è¯æœåŠ¡å™¨å°†ç”¨æˆ·å¯¼å‘å®¢æˆ·ç«¯äº‹å…ˆæŒ‡å®šçš„â€é‡å®šå‘URIâ€ï¼ˆredirection URIï¼‰ï¼Œ  åŒæ—¶é™„ä¸Šä¸€ä¸ªæˆæƒç ã€‚\nï¼ˆDï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æˆæƒç ï¼Œé™„ä¸Šæ—©å…ˆçš„â€é‡å®šå‘URIâ€ï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚  è¿™ä¸€æ­¥æ˜¯åœ¨å®¢æˆ·ç«¯çš„åå°çš„æœåŠ¡å™¨ä¸Šå®Œæˆçš„ï¼Œå¯¹ç”¨æˆ·ä¸å¯è§ã€‚\nï¼ˆEï¼‰è®¤è¯æœåŠ¡å™¨æ ¸å¯¹äº†æˆæƒç å’Œé‡å®šå‘URIï¼Œç¡®è®¤æ— è¯¯åï¼Œ  å‘å®¢æˆ·ç«¯å‘é€è®¿é—®ä»¤ç‰Œï¼ˆaccess tokenï¼‰å’Œæ›´æ–°ä»¤ç‰Œï¼ˆrefresh tokenï¼‰ã€‚\n\n","categories":["security"],"tags":["OAuth"]},{"title":"Z å­—å½¢å˜æ¢","url":"/java4u/2021/02/01/6.%20Z%20%E5%AD%97%E5%BD%A2%E5%8F%98%E6%8D%A2/","content":"6. Z å­—å½¢å˜æ¢å°†ä¸€ä¸ªç»™å®šå­—ç¬¦ä¸² s æ ¹æ®ç»™å®šçš„è¡Œæ•° numRows ï¼Œä»¥ä»ä¸Šå¾€ä¸‹ã€ä»å·¦åˆ°å³è¿›è¡Œ Z å­—å½¢æ’åˆ—ã€‚\næ¯”å¦‚è¾“å…¥å­—ç¬¦ä¸²ä¸º â€œPAYPALISHIRINGâ€ è¡Œæ•°ä¸º 3 æ—¶ï¼Œæ’åˆ—å¦‚ä¸‹ï¼š\nP   A   H   NA P L S I I GY   I   R\nä¹‹åï¼Œä½ çš„è¾“å‡ºéœ€è¦ä»å·¦å¾€å³é€è¡Œè¯»å–ï¼Œäº§ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼šâ€PAHNAPLSIIGYIRâ€ã€‚\nè¯·ä½ å®ç°è¿™ä¸ªå°†å­—ç¬¦ä¸²è¿›è¡ŒæŒ‡å®šè¡Œæ•°å˜æ¢çš„å‡½æ•°ï¼š\nstring convert(string s, int numRows);\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šs &#x3D; â€œPAYPALISHIRINGâ€, numRows &#x3D; 3è¾“å‡ºï¼šâ€PAHNAPLSIIGYIRâ€\nç¤ºä¾‹ 2ï¼šè¾“å…¥ï¼šs &#x3D; â€œPAYPALISHIRINGâ€, numRows &#x3D; 4è¾“å‡ºï¼šâ€PINALSIGYAHRPIâ€è§£é‡Šï¼šP     I    NA   L S  I GY A   H RP     I\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šs &#x3D; â€œAâ€, numRows &#x3D; 1è¾“å‡ºï¼šâ€Aâ€\næç¤ºï¼š\n1 &lt;&#x3D; s.length &lt;&#x3D; 1000s ç”±è‹±æ–‡å­—æ¯ï¼ˆå°å†™å’Œå¤§å†™ï¼‰ã€â€™,â€™ å’Œ â€˜.â€™ ç»„æˆ1 &lt;&#x3D; numRows &lt;&#x3D; 1000\né¢˜è§£/** * ä»å·¦åˆ°å³è¿­ä»£å­—ç¬¦ï¼Œå°†Zå‹å­—ç¬¦æ·»åŠ åˆ°å®ƒæ‰€åœ¨çš„è¡Œï¼Œåœ¨ä»ä¸Šåˆ°ä¸‹ï¼Œåˆå¹¶å„ä¸ªè¡Œ * è¡Œå·ä¸Šä¸‹é™ä¸º 0~numRows-1 * åˆ°è¾¾ä¸Šä¸‹é™ï¼Œåå‘é€’å¢æˆ–é€’å‡ * L   C   I   R      list[0] * E T O E S I I G    list[1] * E   D   H   N      list[2] * * @param s * @param numRows * @return */public String convert2(String s, int numRows) &#123;    if (numRows &lt; 2) return s;    List&lt;StringBuilder&gt; rows = new ArrayList&lt;StringBuilder&gt;();    for (int i = 0; i &lt; numRows; i++) rows.add(new StringBuilder());    int i = 0, flag = -1;    for (char c : s.toCharArray()) &#123;        rows.get(i).append(c);        if (i == 0 || i == numRows - 1) flag = -flag;        i += flag;    &#125;    StringBuilder res = new StringBuilder();    for (StringBuilder row : rows) res.append(row);    return res.toString();&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"åŠ å¯†è§£ç ","url":"/java4u/2020/12/18/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/","content":"é€šè¿‡ç‰¹å®šçš„ç®—æ³•ï¼Œå°†æ•°æ®æ˜æ–‡åŠ å¯†æˆå¤æ‚çš„å¯†æ–‡\nä¸€ã€‚ç®€ä»‹å•é¡¹åŠ å¯†å’ŒåŒå‘åŠ å¯†ã€‚å•é¡¹åŠ å¯†æŒ‡é€šè¿‡å¯¹æ•°æ®è¿›è¡Œæ‘˜è¦è®¡ç®—ç”Ÿæˆå¯†æ–‡ï¼Œå¯†æ–‡ä¸å¯é€†æ¨è¿˜åŸï¼Œæ¯”å¦‚æœ‰Base64ã€MD5ã€SHAç­‰\nå•é¡¹åŠ å¯†ä½¿ç”¨åœºæ™¯\nç”¨æˆ·å¯†ç ä¿æŠ¤:åœ¨ä¿å­˜ç”¨æˆ·å¯†ç æ—¶ï¼Œä¸è®°å½•å¯†ç æœ¬èº«ï¼Œåªè®°å½•å¯†ç çš„MD5ç»“æœï¼ˆå³ä½¿æ•°æ®åº“è¢«ç›—ä¹Ÿæ— æ³•åæ¨å‡ºæ˜æ–‡ï¼‰\næ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒï¼šå…ˆåœ¨å‘é€ç«¯è®¡ç®—ä¸€æ¬¡æ–‡ä»¶çš„MD5ï¼Œå¹¶æŠŠç»“æœå‘é€ç»™æ¥æ”¶ç«¯ï¼Œæ¥æ”¶ç«¯åœ¨æ¥å—æ–‡ä»¶åä¹Ÿè®¡ç®—ä¸€æ¬¡MD5ï¼Œä¸¤æ¬¡ç»“æœä¸€è‡´æ–‡ä»¶å®Œæ•´ã€‚\näº‘ç›˜ç§’ä¼ ï¼šäº‘ç›˜ä¸Šä¼ æ—¶è®¡ç®—MD5ï¼Œå¹¶åœ¨è‡ªå·±çš„æ•°æ®åº“ä¸­æœç´¢ä¸€ä¸‹ MD5æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨å·²æœ‰çš„æ–‡ä»¶å°±å¯ä»¥äº†ï¼Œä»è€Œå®ç°äº‘ç›˜ç§’ä¼ ã€‚\næ•°å­—ç­¾åï¼šå‘å¸ƒç¨‹åºæ—¶åŒæ—¶å‘å¸ƒå…¶MD5ï¼Œä¸‹è½½åæ¯”è¾ƒMD5æ˜¯å¦ç›¸åŒï¼Œå°±å¯çŸ¥é“ç¨‹åºæ˜¯å¦è¢«ç¯¡æ”¹ã€‚\n\nåŒå‘åŠ å¯†åˆ™ç›¸åï¼ŒæŒ‡å¯ä»¥æŠŠå¯†æ–‡é€†æ¨è¿˜åŸæˆæ˜æ–‡ï¼Œå…¶ä¸­åŒå‘åŠ å¯†åˆåˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚å¯¹ç§°åŠ å¯†æ˜¯æŒ‡æ•°æ®ä½¿ç”¨è€…å¿…é¡»æ‹¥æœ‰åŒæ ·çš„å¯†é’¥æ‰å¯ä»¥è¿›è¡ŒåŠ å¯†è§£å¯†ï¼Œå°±åƒå¤§å®¶å…±åŒçº¦å®šäº†ä¸€ç»„æš—å·ä¸€æ ·ï¼Œå¯¹ç§°åŠ å¯†çš„æ‰‹æ®µæœ‰DESã€3DESã€AESã€IDEAã€RC4ã€RC5ç­‰è€Œéå¯¹ç§°åŠ å¯†ç›¸å¯¹äºå¯¹ç§°åŠ å¯†è€Œè¨€ï¼Œæ— éœ€æ‹¥æœ‰åŒä¸€ç»„å¯†é’¥ï¼Œå®ƒæ˜¯ä¸€ç§â€œä¿¡æ¯å…¬å¼€çš„å¯†é’¥äº¤æ¢åè®®â€ã€‚éå¯¹ç§°åŠ å¯†éœ€è¦å…¬å¼€å¯†é’¥å’Œç§æœ‰å¯†é’¥ä¸¤ç»„å¯†é’¥ï¼Œå…¬å¼€å¯†é’¥å’Œç§æœ‰å¯†é’¥æ˜¯é…å¯¹èµ·æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨å…¬å¼€å¯†é’¥è¿›è¡Œæ•°æ®åŠ å¯†ï¼Œåªæœ‰å¯¹åº”çš„ç§æœ‰å¯†é’¥æ‰èƒ½è¿›è¡Œè§£å¯†ã€‚æ­¤ç±»çš„åŠ å¯†æ‰‹æ®µæœ‰RSAã€DSAç­‰\n","categories":["åŠ å¯†è§£ç "],"tags":["å­¦ä¹ "]},{"title":"TPC/IP","url":"/java4u/2020/11/09/TCP%20IP/","content":"ä¸€ TCP&#x2F;IPæ¨¡å‹TCP&#x2F;IPå‚è€ƒæ¨¡å‹æ˜¯ä¸€ä¸ªæŠ½è±¡çš„åˆ†å±‚æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„TCP&#x2F;IPç³»åˆ—ç½‘ç»œåè®®éƒ½å½’ç±»åˆ°4ä¸ªæŠ½è±¡çš„â€œå±‚â€ä¸­ã€‚æ¯ä¸€æŠ½è±¡å±‚åˆ›å»ºåœ¨ä½ä¸€å±‚æä¾›çš„æœåŠ¡ä¸Šï¼Œå¹¶ä¸”ä¸ºé«˜ä¸€å±‚æä¾›æœåŠ¡\n\nç”±ä¸Šåˆ°ä¸‹ï¼Œå±‚å±‚åŒ…è£…\n\nåº”ç”¨å±‚ http&#x2F;ftpåè®®\nä¼ è¾“å±‚ TCP&#x2F;UDPåè®® ç»è¿‡TCPå±‚åŠ ä¸ŠTCPé¦–éƒ¨ï¼Œäº§ç”ŸTCPæ®µï¼ˆsegmentï¼‰\nç½‘ç»œå±‚ IPåè®® TCP segmentç»è¿‡IPå±‚å†åŠ ä¸ŠIPé¦–éƒ¨ï¼Œäº§ç”ŸIPæ•°æ®åŒ…ï¼ˆdatagramï¼‰\né“¾è·¯å±‚ æœªå¾…ä¼ é€æ•°æ®åŠ å…¥ä»¥å¤ªç½‘åè®®å¤´ IP datagramé€šè¿‡é“¾è·¯å±‚ï¼Œç»ä»¥å¤ªç½‘é©±åŠ¨ç¨‹åºå¤„ç†åï¼ŒåŠ ä¸Šä»¥å¤ªç½‘é¦–éƒ¨+å°¾éƒ¨ï¼Œäº§ç”Ÿä»¥å¤ªç½‘å¸§ï¼ˆframeï¼‰ï¼Œä»¥å¤ªç½‘å¸§çš„é•¿åº¦åœ¨46~1500ä¹‹é—´\n\n\nå‘é€ç«¯å‘é€æ•°æ®æ—¶ï¼Œæ•°æ®å±‚å±‚å°è£…å‘é€ç»™æ¥æ”¶ç«¯ã€‚æ¥æ”¶ç«¯æ”¶åˆ°æ•°æ®åï¼Œè¦æ‰§è¡Œè·Ÿå‘é€ç«¯ç›¸åçš„è§£å°æ“ä½œï¼ŒæŠŠé¦–å°¾éƒ¨å‰¥ç¦»ï¼Œè·å–ä¼ é€’çš„åŸå§‹æ•°æ®\näºŒ æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚æ•°æ®åŠ å¤´å’Œå°¾ï¼Œå°è£…æˆå¸§ï¼ŒåŒ…å«æºMACåœ°å€å’Œç›®çš„MACåœ°å€\nä¸‰ ç½‘ç»œå±‚1.1 ä»¥IPæ•°æ®æ ¼å¼ä¼ è¾“ï¼Œåœ°å€æ ‡è¯†å°±æ˜¯IPåœ°å€\n1.2 TTLç”Ÿå­˜æ—¶é—´ï¼Œç©¿è¿‡å¤šå°‘ä¸ªè·¯ç”±åè¢«æŠ›å¼ƒ\n2.ARPåŠRARPåè®® æ ¹æ®IPåœ°å€è·å–MACåœ°å€çš„åè®®\n3.ICMPåè®® å½“ä¼ é€IPæ•°æ®åŒ…å‘ç”Ÿé”™è¯¯ï¼ŒICMPä¼šæŠŠé”™è¯¯ä¿¡æ¯å°åŒ…ä¼ é€å›ä¸»æœº\nå›› ä¼ è¾“å±‚ TCP&#x2F;UDPåè®®\n\n\n\nTCP\nUDP\n\n\n\nå¯é æ€§\nå¯é \nä¸å¯é \n\n\nè¿æ¥æ€§\né¢å‘è¿æ¥\næ— è¿æ¥\n\n\næŠ¥æ–‡\né¢å‘å­—èŠ‚æµ\né¢å‘æŠ¥æ–‡\n\n\næ•ˆç‡\nä¼ è¾“æ•ˆç‡ä½\nä¼ è¾“æ•ˆç‡é«˜\n\n\nåŒå·¥æ€§\nå…¨åŒå·¥\nä¸€å¯¹ä¸€&#x2F;ä¸€å¯¹å¤š&#x2F;å¤šå¯¹ä¸€&#x2F;å¤šå¯¹å¤š\n\n\næµé‡æ§åˆ¶\næ»‘åŠ¨çª—å£\næ— \n\n\næ‹¥å¡æ§åˆ¶\næ…¢å¼€å§‹&#x2F;æ‹¥å¡é¿å…\nå¿«é‡ä¼ &#x2F;å¿«æ¢å¤\n\n\nä¼ è¾“é€Ÿåº¦\næ…¢\nå¿«\n\n\nåº”ç”¨åœºæ™¯\nå¯¹æ•ˆç‡è¦æ±‚ä½\\å¯¹å‡†ç¡®æ€§è¦æ±‚é«˜\nå¯¹æ•ˆç‡è¦æ±‚é«˜\n\n\näº” åº”ç”¨å±‚æ¯ä¸€ä¸ªåº”ç”¨å±‚ï¼ˆTCP&#x2F;IPå‚è€ƒæ¨¡å‹çš„æœ€é«˜å±‚ï¼‰åè®®ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨åˆ°ä¸¤ä¸ªä¼ è¾“å±‚åè®®ä¹‹ä¸€ï¼š é¢å‘è¿æ¥çš„TCPä¼ è¾“æ§åˆ¶åè®®å’Œæ— è¿æ¥çš„åŒ…ä¼ è¾“çš„UDPç”¨æˆ·æ•°æ®æŠ¥æ–‡åè®®ã€‚ å¸¸ç”¨çš„åº”ç”¨å±‚åè®®æœ‰ï¼š\nè¿è¡Œåœ¨TCPåè®®ä¸Šçš„åè®®ï¼š\n\nHTTPï¼ˆHypertext Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰ï¼Œä¸»è¦ç”¨äºæ™®é€šæµè§ˆã€‚\nHTTPSï¼ˆHypertext Transfer Protocol over Secure Socket Layer, or HTTP over SSLï¼Œå®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰,HTTPåè®®çš„å®‰å…¨ç‰ˆæœ¬ã€‚\nFTPï¼ˆFile Transfer Protocolï¼Œæ–‡ä»¶ä¼ è¾“åè®®ï¼‰ï¼Œç”±åçŸ¥ä¹‰ï¼Œç”¨äºæ–‡ä»¶ä¼ è¾“ã€‚\nPOP3ï¼ˆPost Office Protocol, version 3ï¼Œé‚®å±€åè®®ï¼‰ï¼Œæ”¶é‚®ä»¶ç”¨ã€‚\nSMTPï¼ˆSimple Mail Transfer Protocolï¼Œç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰ï¼Œç”¨æ¥å‘é€ç”µå­é‚®ä»¶ã€‚\nTELNETï¼ˆTeletype over the Networkï¼Œç½‘ç»œç”µä¼ ï¼‰ï¼Œé€šè¿‡ä¸€ä¸ªç»ˆç«¯ï¼ˆterminalï¼‰ç™»é™†åˆ°ç½‘ç»œã€‚\nSSHï¼ˆSecure Shellï¼Œç”¨äºæ›¿ä»£å®‰å…¨æ€§å·®çš„TELNETï¼‰ï¼Œç”¨äºåŠ å¯†å®‰å…¨ç™»é™†ç”¨ã€‚\n\nè¿è¡Œåœ¨UDPåè®®ä¸Šçš„åè®®ï¼š\n\nBOOTPï¼ˆBoot Protocolï¼Œå¯åŠ¨åè®®ï¼‰ï¼Œåº”ç”¨äºæ— ç›˜è®¾å¤‡ã€‚\nNTPï¼ˆNetwork Time Protocolï¼Œç½‘ç»œæ—¶é—´åè®®ï¼‰ï¼Œç”¨äºç½‘ç»œåŒæ­¥ã€‚\nDHCPï¼ˆDynamic Host Configuration Protocolï¼ŒåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼‰ï¼ŒåŠ¨æ€é…ç½®IPåœ°å€ã€‚\n\nå…¶ä»–ï¼š\n\nDNSï¼ˆDomain Name Serviceï¼ŒåŸŸåæœåŠ¡ï¼‰ï¼Œç”¨äºå®Œæˆåœ°å€æŸ¥æ‰¾ï¼Œé‚®ä»¶è½¬å‘ç­‰å·¥ä½œï¼ˆè¿è¡Œåœ¨TCPå’ŒUDPåè®®ä¸Šï¼‰ã€‚\nECHOï¼ˆEcho Protocolï¼Œå›ç»•åè®®ï¼‰ï¼Œç”¨äºæŸ¥é”™åŠæµ‹é‡åº”ç­”æ—¶é—´ï¼ˆè¿è¡Œåœ¨TCPå’ŒUDPåè®®ä¸Šï¼‰ã€‚\nSNMPï¼ˆSimple Network Management Protocolï¼Œç®€å•ç½‘ç»œç®¡ç†åè®®ï¼‰ï¼Œç”¨äºç½‘ç»œä¿¡æ¯çš„æ”¶é›†å’Œç½‘ç»œç®¡ç†ã€‚\nARPï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰ï¼Œç”¨äºåŠ¨æ€è§£æä»¥å¤ªç½‘ç¡¬ä»¶çš„åœ°å€ã€‚\n\n","categories":["ç½‘ç»œ"],"tags":["TPC/IP"]},{"title":"çº¿ç¨‹æ± ","url":"/java4u/2020/10/27/%E7%BA%BF%E7%A8%8B%E6%B1%A0/","content":"å‰è¨€çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆçº¿ç¨‹æ± ï¼ˆThread Poolï¼‰æ˜¯ä¸€ç§åŸºäºæ± åŒ–æ€æƒ³ç®¡ç†çº¿ç¨‹çš„å·¥å…·ï¼Œç»å¸¸å‡ºç°åœ¨å¤šçº¿ç¨‹æœåŠ¡å™¨ä¸­ï¼Œå¦‚MySQLã€‚\nçº¿ç¨‹è¿‡å¤šä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œå…¶ä¸­åŒ…æ‹¬åˆ›å»ºé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€è°ƒåº¦çº¿ç¨‹çš„å¼€é”€ç­‰ç­‰ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†è®¡ç®—æœºçš„æ•´ä½“æ€§èƒ½ã€‚çº¿ç¨‹æ± ç»´æŠ¤å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…ç›‘ç£ç®¡ç†è€…åˆ†é…å¯å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™ç§åšæ³•ï¼Œä¸€æ–¹é¢é¿å…äº†å¤„ç†ä»»åŠ¡æ—¶åˆ›å»ºé”€æ¯çº¿ç¨‹å¼€é”€çš„ä»£ä»·ï¼Œå¦ä¸€æ–¹é¢é¿å…äº†çº¿ç¨‹æ•°é‡è†¨èƒ€å¯¼è‡´çš„è¿‡åˆ†è°ƒåº¦é—®é¢˜ï¼Œä¿è¯äº†å¯¹å†…æ ¸çš„å……åˆ†åˆ©ç”¨ã€‚\nä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥å¸¦æ¥ä¸€ç³»åˆ—å¥½å¤„ï¼š\n\né™ä½èµ„æºæ¶ˆè€—ï¼šé€šè¿‡æ± åŒ–æŠ€æœ¯é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ï¼Œé™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æŸè€—ã€‚\næé«˜å“åº”é€Ÿåº¦ï¼šä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œæ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºå³å¯ç«‹å³æ‰§è¡Œã€‚\næé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼šçº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šå› ä¸ºçº¿ç¨‹çš„ä¸åˆç†åˆ†å¸ƒå¯¼è‡´èµ„æºè°ƒåº¦å¤±è¡¡ï¼Œé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚\næä¾›æ›´å¤šæ›´å¼ºå¤§çš„åŠŸèƒ½ï¼šçº¿ç¨‹æ± å…·å¤‡å¯æ‹“å±•æ€§ï¼Œå…è®¸å¼€å‘äººå‘˜å‘å…¶ä¸­å¢åŠ æ›´å¤šçš„åŠŸèƒ½ã€‚æ¯”å¦‚å»¶æ—¶å®šæ—¶çº¿ç¨‹æ± ScheduledThreadPoolExecutorï¼Œå°±å…è®¸ä»»åŠ¡å»¶æœŸæ‰§è¡Œæˆ–å®šæœŸæ‰§è¡Œã€‚\n\näºŒã€çº¿ç¨‹æ± æ ¸å¿ƒè®¾è®¡ä¸å®ç°2.1 æ€»ä½“è®¾è®¡ThreadPoolExecutorçš„UMLç±»å›¾\n\nThreadPoolExecutorå®ç°çš„é¡¶å±‚æ¥å£æ˜¯Executorï¼Œé¡¶å±‚æ¥å£Executoræä¾›äº†ä¸€ç§æ€æƒ³ï¼šå°†ä»»åŠ¡æäº¤å’Œä»»åŠ¡æ‰§è¡Œè¿›è¡Œè§£è€¦ã€‚ç”¨æˆ·æ— éœ€å…³æ³¨å¦‚ä½•åˆ›å»ºçº¿ç¨‹ï¼Œå¦‚ä½•è°ƒåº¦çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç”¨æˆ·åªéœ€æä¾›Runnableå¯¹è±¡ï¼Œå°†ä»»åŠ¡çš„è¿è¡Œé€»è¾‘æäº¤åˆ°æ‰§è¡Œå™¨(Executor)ä¸­ï¼Œç”±Executoræ¡†æ¶å®Œæˆçº¿ç¨‹çš„è°ƒé…å’Œä»»åŠ¡çš„æ‰§è¡Œéƒ¨åˆ†ã€‚ExecutorServiceæ¥å£å¢åŠ äº†ä¸€äº›èƒ½åŠ›ï¼šï¼ˆ1ï¼‰æ‰©å……æ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›ï¼Œè¡¥å……å¯ä»¥ä¸ºä¸€ä¸ªæˆ–ä¸€æ‰¹å¼‚æ­¥ä»»åŠ¡ç”ŸæˆFutureçš„æ–¹æ³•ï¼›ï¼ˆ2ï¼‰æä¾›äº†ç®¡æ§çº¿ç¨‹æ± çš„æ–¹æ³•ï¼Œæ¯”å¦‚åœæ­¢çº¿ç¨‹æ± çš„è¿è¡Œã€‚AbstractExecutorServiceåˆ™æ˜¯ä¸Šå±‚çš„æŠ½è±¡ç±»ï¼Œå°†æ‰§è¡Œä»»åŠ¡çš„æµç¨‹ä¸²è”äº†èµ·æ¥ï¼Œä¿è¯ä¸‹å±‚çš„å®ç°åªéœ€å…³æ³¨ä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„æ–¹æ³•å³å¯ã€‚æœ€ä¸‹å±‚çš„å®ç°ç±»ThreadPoolExecutorå®ç°æœ€å¤æ‚çš„è¿è¡Œéƒ¨åˆ†ï¼ŒThreadPoolExecutorå°†ä¼šä¸€æ–¹é¢ç»´æŠ¤è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦ä¸€æ–¹é¢åŒæ—¶ç®¡ç†çº¿ç¨‹å’Œä»»åŠ¡ï¼Œä½¿ä¸¤è€…è‰¯å¥½çš„ç»“åˆä»è€Œæ‰§è¡Œå¹¶è¡Œä»»åŠ¡ã€‚\nThreadPoolExecutorè¿è¡Œæœºåˆ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\nçº¿ç¨‹æ± åœ¨å†…éƒ¨å®é™…ä¸Šæ„å»ºäº†ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå°†çº¿ç¨‹å’Œä»»åŠ¡ä¸¤è€…è§£è€¦ï¼Œå¹¶ä¸ç›´æ¥å…³è”ï¼Œä»è€Œè‰¯å¥½çš„ç¼“å†²ä»»åŠ¡ï¼Œå¤ç”¨çº¿ç¨‹ã€‚çº¿ç¨‹æ± çš„è¿è¡Œä¸»è¦åˆ†æˆä¸¤éƒ¨åˆ†ï¼šä»»åŠ¡ç®¡ç†ã€çº¿ç¨‹ç®¡ç†ã€‚ä»»åŠ¡ç®¡ç†éƒ¨åˆ†å……å½“ç”Ÿäº§è€…çš„è§’è‰²ï¼Œå½“ä»»åŠ¡æäº¤åï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­è¯¥ä»»åŠ¡åç»­çš„æµè½¬ï¼šï¼ˆ1ï¼‰ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œè¯¥ä»»åŠ¡ï¼›ï¼ˆ2ï¼‰ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹æ‰§è¡Œï¼›ï¼ˆ3ï¼‰æ‹’ç»è¯¥ä»»åŠ¡ã€‚çº¿ç¨‹ç®¡ç†éƒ¨åˆ†æ˜¯æ¶ˆè´¹è€…ï¼Œå®ƒä»¬è¢«ç»Ÿä¸€ç»´æŠ¤åœ¨çº¿ç¨‹æ± å†…ï¼Œæ ¹æ®ä»»åŠ¡è¯·æ±‚è¿›è¡Œçº¿ç¨‹çš„åˆ†é…ï¼Œå½“çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ååˆ™ä¼šç»§ç»­è·å–æ–°çš„ä»»åŠ¡å»æ‰§è¡Œï¼Œæœ€ç»ˆå½“çº¿ç¨‹è·å–ä¸åˆ°ä»»åŠ¡çš„æ—¶å€™ï¼Œçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ã€‚\n2.2 ç”Ÿå‘½å‘¨æœŸç®¡ç†çº¿ç¨‹æ± è¿è¡Œçš„çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯ç”¨æˆ·æ˜¾å¼è®¾ç½®çš„ï¼Œè€Œæ˜¯ä¼´éšç€çº¿ç¨‹æ± çš„è¿è¡Œï¼Œç”±å†…éƒ¨æ¥ç»´æŠ¤ã€‚çº¿ç¨‹æ± å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªå˜é‡ç»´æŠ¤ä¸¤ä¸ªå€¼ï¼šè¿è¡ŒçŠ¶æ€(runState)å’Œçº¿ç¨‹æ•°é‡ (workerCount)ã€‚åœ¨å…·ä½“å®ç°ä¸­ï¼Œçº¿ç¨‹æ± å°†è¿è¡ŒçŠ¶æ€(runState)ã€çº¿ç¨‹æ•°é‡ (workerCount)ä¸¤ä¸ªå…³é”®å‚æ•°çš„ç»´æŠ¤æ”¾åœ¨äº†ä¸€èµ·ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\n\nctlè¿™ä¸ªAtomicIntegerç±»å‹ï¼Œæ˜¯å¯¹çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡è¿›è¡Œæ§åˆ¶çš„ä¸€ä¸ªå­—æ®µï¼Œ å®ƒåŒæ—¶åŒ…å«ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯ï¼šçº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)ï¼Œé«˜3ä½ä¿å­˜runStateï¼Œä½29ä½ä¿å­˜workerCountï¼Œä¸¤ä¸ªå˜é‡ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚ç”¨ä¸€ä¸ªå˜é‡å»å­˜å‚¨ä¸¤ä¸ªå€¼ï¼Œå¯é¿å…åœ¨åšç›¸å…³å†³ç­–æ—¶ï¼Œå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¸å¿…ä¸ºäº†ç»´æŠ¤ä¸¤è€…çš„ä¸€è‡´ï¼Œè€Œå ç”¨é”èµ„æºã€‚é€šè¿‡é˜…è¯»çº¿ç¨‹æ± æºä»£ç ä¹Ÿå¯ä»¥å‘ç°ï¼Œç»å¸¸å‡ºç°è¦åŒæ—¶åˆ¤æ–­çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ•°é‡çš„æƒ…å†µã€‚çº¿ç¨‹æ± ä¹Ÿæä¾›äº†è‹¥å¹²æ–¹æ³•å»ä¾›ç”¨æˆ·è·å¾—çº¿ç¨‹æ± å½“å‰çš„è¿è¡ŒçŠ¶æ€ã€çº¿ç¨‹ä¸ªæ•°ã€‚è¿™é‡Œéƒ½ä½¿ç”¨çš„æ˜¯ä½è¿ç®—çš„æ–¹å¼ï¼Œç›¸æ¯”äºåŸºæœ¬è¿ç®—ï¼Œé€Ÿåº¦ä¹Ÿä¼šå¿«å¾ˆå¤šã€‚å…³äºå†…éƒ¨å°è£…çš„è·å–ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ã€è·å–çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡çš„è®¡ç®—æ–¹æ³•å¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼š\n// Packing and unpacking ctlprivate static int runStateOf(int c)     &#123; return c &amp; ~CAPACITY; &#125;private static int workerCountOf(int c)  &#123; return c &amp; CAPACITY; &#125;private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125;\n\n2.3 ä»»åŠ¡æ‰§è¡Œæœºåˆ¶2.3.1 ä»»åŠ¡è°ƒåº¦é¦–å…ˆï¼Œæ‰€æœ‰ä»»åŠ¡çš„è°ƒåº¦éƒ½æ˜¯ç”±executeæ–¹æ³•å®Œæˆçš„ï¼Œè¿™éƒ¨åˆ†å®Œæˆçš„å·¥ä½œæ˜¯ï¼šæ£€æŸ¥ç°åœ¨çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ã€è¿è¡Œçº¿ç¨‹æ•°ã€è¿è¡Œç­–ç•¥ï¼Œå†³å®šæ¥ä¸‹æ¥æ‰§è¡Œçš„æµç¨‹ï¼Œæ˜¯ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œï¼Œæˆ–æ˜¯ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œäº¦æˆ–æ˜¯ç›´æ¥æ‹’ç»è¯¥ä»»åŠ¡ã€‚å…¶æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n\né¦–å…ˆæ£€æµ‹çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯RUNNINGï¼Œåˆ™ç›´æ¥æ‹’ç»ï¼Œçº¿ç¨‹æ± è¦ä¿è¯åœ¨RUNNINGçš„çŠ¶æ€ä¸‹æ‰§è¡Œä»»åŠ¡ã€‚\nå¦‚æœworkerCount &lt; corePoolSizeï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ã€‚\nå¦‚æœworkerCount &gt;&#x3D; corePoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜»å¡é˜Ÿåˆ—ä¸­ã€‚\nå¦‚æœworkerCount &gt;&#x3D; corePoolSize &amp;&amp; workerCount &lt; maximumPoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ã€‚\nå¦‚æœworkerCount &gt;&#x3D; maximumPoolSizeï¼Œå¹¶ä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡, åˆ™æ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†è¯¥ä»»åŠ¡, é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚\n\n2.3.2 ä»»åŠ¡ç¼“å†²ä»»åŠ¡ç¼“å†²æ¨¡å—æ˜¯çº¿ç¨‹æ± èƒ½å¤Ÿç®¡ç†ä»»åŠ¡çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚çº¿ç¨‹æ± çš„æœ¬è´¨æ˜¯å¯¹ä»»åŠ¡å’Œçº¿ç¨‹çš„ç®¡ç†ï¼Œè€Œåšåˆ°è¿™ä¸€ç‚¹æœ€å…³é”®çš„æ€æƒ³å°±æ˜¯å°†ä»»åŠ¡å’Œçº¿ç¨‹ä¸¤è€…è§£è€¦ï¼Œä¸è®©ä¸¤è€…ç›´æ¥å…³è”ï¼Œæ‰å¯ä»¥åšåç»­çš„åˆ†é…å·¥ä½œã€‚çº¿ç¨‹æ± ä¸­æ˜¯ä»¥ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œé€šè¿‡ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—æ¥å®ç°çš„ã€‚é˜»å¡é˜Ÿåˆ—ç¼“å­˜ä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚\né˜»å¡é˜Ÿåˆ—(BlockingQueue)æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚\n2.3.3 ä»»åŠ¡ç”³è¯·ç”±ä¸Šæ–‡çš„ä»»åŠ¡åˆ†é…éƒ¨åˆ†å¯çŸ¥ï¼Œä»»åŠ¡çš„æ‰§è¡Œæœ‰ä¸¤ç§å¯èƒ½ï¼šä¸€ç§æ˜¯ä»»åŠ¡ç›´æ¥ç”±æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œã€‚å¦ä¸€ç§æ˜¯çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ç„¶åæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä»»åŠ¡çš„ç©ºé—²çº¿ç¨‹ä¼šå†æ¬¡å»ä»é˜Ÿåˆ—ä¸­ç”³è¯·ä»»åŠ¡å†å»æ‰§è¡Œã€‚ç¬¬ä¸€ç§æƒ…å†µä»…å‡ºç°åœ¨çº¿ç¨‹åˆå§‹åˆ›å»ºçš„æ—¶å€™ï¼Œç¬¬äºŒç§æ˜¯çº¿ç¨‹è·å–ä»»åŠ¡ç»å¤§å¤šæ•°çš„æƒ…å†µã€‚\nçº¿ç¨‹éœ€è¦ä»ä»»åŠ¡ç¼“å­˜æ¨¡å—ä¸­ä¸æ–­åœ°å–ä»»åŠ¡æ‰§è¡Œï¼Œå¸®åŠ©çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ï¼Œå®ç°çº¿ç¨‹ç®¡ç†æ¨¡å—å’Œä»»åŠ¡ç®¡ç†æ¨¡å—ä¹‹é—´çš„é€šä¿¡ã€‚è¿™éƒ¨åˆ†ç­–ç•¥ç”±getTaskæ–¹æ³•å®ç°ï¼Œå…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\ngetTaskè¿™éƒ¨åˆ†è¿›è¡Œäº†å¤šæ¬¡åˆ¤æ–­ï¼Œä¸ºçš„æ˜¯æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œä½¿å…¶ç¬¦åˆçº¿ç¨‹æ± çš„çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ± ç°åœ¨ä¸åº”è¯¥æŒæœ‰é‚£ä¹ˆå¤šçº¿ç¨‹ï¼Œåˆ™ä¼šè¿”å›nullå€¼ã€‚å·¥ä½œçº¿ç¨‹Workerä¼šä¸æ–­æ¥æ”¶æ–°ä»»åŠ¡å»æ‰§è¡Œï¼Œè€Œå½“å·¥ä½œçº¿ç¨‹Workeræ¥æ”¶ä¸åˆ°ä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å§‹è¢«å›æ”¶ã€‚\n2.3.4 ä»»åŠ¡æ‹’ç»ä»»åŠ¡æ‹’ç»æ¨¡å—æ˜¯çº¿ç¨‹æ± çš„ä¿æŠ¤éƒ¨åˆ†ï¼Œçº¿ç¨‹æ± æœ‰ä¸€ä¸ªæœ€å¤§çš„å®¹é‡ï¼Œå½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeæ—¶ï¼Œå°±éœ€è¦æ‹’ç»æ‰è¯¥ä»»åŠ¡ï¼Œé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œä¿æŠ¤çº¿ç¨‹æ± ã€‚\n2.4 Workerçº¿ç¨‹ç®¡ç†2.4.1 Workerçº¿ç¨‹çº¿ç¨‹æ± ä¸ºäº†æŒæ¡çº¿ç¨‹çš„çŠ¶æ€å¹¶ç»´æŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®¾è®¡äº†çº¿ç¨‹æ± å†…çš„å·¥ä½œçº¿ç¨‹Workerã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„éƒ¨åˆ†ä»£ç ï¼š\nprivate final class Worker extends AbstractQueuedSynchronizer implements Runnable&#123;        /** Thread this worker is running in.  Null if factory fails. */        final Thread thread;        /** Initial task to run.  Possibly null. */        Runnable firstTask;&#125;\n\nWorkerè¿™ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå®ç°äº†Runnableæ¥å£ï¼Œå¹¶æŒæœ‰ä¸€ä¸ªçº¿ç¨‹threadï¼Œä¸€ä¸ªåˆå§‹åŒ–çš„ä»»åŠ¡firstTaskã€‚threadæ˜¯åœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶é€šè¿‡ThreadFactoryæ¥åˆ›å»ºçš„çº¿ç¨‹ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡Œä»»åŠ¡ï¼›firstTaskç”¨å®ƒæ¥ä¿å­˜ä¼ å…¥çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å¯ä»¥æœ‰ä¹Ÿå¯ä»¥ä¸ºnullã€‚å¦‚æœè¿™ä¸ªå€¼æ˜¯éç©ºçš„ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±ä¼šåœ¨å¯åŠ¨åˆæœŸç«‹å³æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±å¯¹åº”æ ¸å¿ƒçº¿ç¨‹åˆ›å»ºæ—¶çš„æƒ…å†µï¼›å¦‚æœè¿™ä¸ªå€¼æ˜¯nullï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡åˆ—è¡¨ï¼ˆworkQueueï¼‰ä¸­çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯éæ ¸å¿ƒçº¿ç¨‹çš„åˆ›å»ºã€‚Workeræ‰§è¡Œä»»åŠ¡çš„æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\nçº¿ç¨‹æ± éœ€è¦ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦åœ¨çº¿ç¨‹é•¿æ—¶é—´ä¸è¿è¡Œçš„æ—¶å€™è¿›è¡Œå›æ”¶ã€‚çº¿ç¨‹æ± ä½¿ç”¨ä¸€å¼ Hashè¡¨å»æŒæœ‰çº¿ç¨‹çš„å¼•ç”¨ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡æ·»åŠ å¼•ç”¨ã€ç§»é™¤å¼•ç”¨è¿™æ ·çš„æ“ä½œæ¥æ§åˆ¶çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªæ—¶å€™é‡è¦çš„å°±æ˜¯å¦‚ä½•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœ¨è¿è¡Œã€‚\nâ€‹Workeræ˜¯é€šè¿‡ç»§æ‰¿AQSï¼Œä½¿ç”¨AQSæ¥å®ç°ç‹¬å é”è¿™ä¸ªåŠŸèƒ½ã€‚æ²¡æœ‰ä½¿ç”¨å¯é‡å…¥é”ReentrantLockï¼Œè€Œæ˜¯ä½¿ç”¨AQSï¼Œä¸ºçš„å°±æ˜¯å®ç°ä¸å¯é‡å…¥çš„ç‰¹æ€§å»ååº”çº¿ç¨‹ç°åœ¨çš„æ‰§è¡ŒçŠ¶æ€ã€‚\n1.lockæ–¹æ³•ä¸€æ—¦è·å–äº†ç‹¬å é”ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä»»åŠ¡ä¸­ã€‚ 2.å¦‚æœæ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™ä¸åº”è¯¥ä¸­æ–­çº¿ç¨‹ã€‚ 3.å¦‚æœè¯¥çº¿ç¨‹ç°åœ¨ä¸æ˜¯ç‹¬å é”çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çš„çŠ¶æ€ï¼Œè¯´æ˜å®ƒæ²¡æœ‰åœ¨å¤„ç†ä»»åŠ¡ï¼Œè¿™æ—¶å¯ä»¥å¯¹è¯¥çº¿ç¨‹è¿›è¡Œä¸­æ–­ã€‚ 4.çº¿ç¨‹æ± åœ¨æ‰§è¡Œshutdownæ–¹æ³•æˆ–tryTerminateæ–¹æ³•æ—¶ä¼šè°ƒç”¨interruptIdleWorkersæ–¹æ³•æ¥ä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼ŒinterruptIdleWorkersæ–¹æ³•ä¼šä½¿ç”¨tryLockæ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦æ˜¯ç©ºé—²çŠ¶æ€ï¼›å¦‚æœçº¿ç¨‹æ˜¯ç©ºé—²çŠ¶æ€åˆ™å¯ä»¥å®‰å…¨å›æ”¶ã€‚\nåœ¨çº¿ç¨‹å›æ”¶è¿‡ç¨‹ä¸­å°±ä½¿ç”¨åˆ°äº†è¿™ç§ç‰¹æ€§ï¼Œå›æ”¶è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n2.4.2 Workerçº¿ç¨‹å¢åŠ å¢åŠ çº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹æ± ä¸­çš„addWorkeræ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯å¢åŠ ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥æ–¹æ³•ä¸è€ƒè™‘çº¿ç¨‹æ± æ˜¯åœ¨å“ªä¸ªé˜¶æ®µå¢åŠ çš„è¯¥çº¿ç¨‹ï¼Œè¿™ä¸ªåˆ†é…çº¿ç¨‹çš„ç­–ç•¥æ˜¯åœ¨ä¸Šä¸ªæ­¥éª¤å®Œæˆçš„ï¼Œè¯¥æ­¥éª¤ä»…ä»…å®Œæˆå¢åŠ çº¿ç¨‹ï¼Œå¹¶ä½¿å®ƒè¿è¡Œï¼Œæœ€åè¿”å›æ˜¯å¦æˆåŠŸè¿™ä¸ªç»“æœã€‚addWorkeræ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼šfirstTaskã€coreã€‚firstTaskå‚æ•°ç”¨äºæŒ‡å®šæ–°å¢çš„çº¿ç¨‹æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œè¯¥å‚æ•°å¯ä»¥ä¸ºç©ºï¼›coreå‚æ•°ä¸ºtrueè¡¨ç¤ºåœ¨æ–°å¢çº¿ç¨‹æ—¶ä¼šåˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºcorePoolSizeï¼Œfalseè¡¨ç¤ºæ–°å¢çº¿ç¨‹å‰éœ€è¦åˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºmaximumPoolSizeï¼Œå…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n2.4.3 Workerçº¿ç¨‹å›æ”¶çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„é”€æ¯ä¾èµ–JVMè‡ªåŠ¨çš„å›æ”¶ï¼Œçº¿ç¨‹æ± åšçš„å·¥ä½œæ˜¯æ ¹æ®å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ç»´æŠ¤ä¸€å®šæ•°é‡çš„çº¿ç¨‹å¼•ç”¨ï¼Œé˜²æ­¢è¿™éƒ¨åˆ†çº¿ç¨‹è¢«JVMå›æ”¶ï¼Œå½“çº¿ç¨‹æ± å†³å®šå“ªäº›çº¿ç¨‹éœ€è¦å›æ”¶æ—¶ï¼Œåªéœ€è¦å°†å…¶å¼•ç”¨æ¶ˆé™¤å³å¯ã€‚Workerè¢«åˆ›å»ºå‡ºæ¥åï¼Œå°±ä¼šä¸æ–­åœ°è¿›è¡Œè½®è¯¢ï¼Œç„¶åè·å–ä»»åŠ¡å»æ‰§è¡Œï¼Œæ ¸å¿ƒçº¿ç¨‹å¯ä»¥æ— é™ç­‰å¾…è·å–ä»»åŠ¡ï¼Œéæ ¸å¿ƒçº¿ç¨‹è¦é™æ—¶è·å–ä»»åŠ¡ã€‚å½“Workeræ— æ³•è·å–åˆ°ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è·å–çš„ä»»åŠ¡ä¸ºç©ºæ—¶ï¼Œå¾ªç¯ä¼šç»“æŸï¼ŒWorkerä¼šä¸»åŠ¨æ¶ˆé™¤è‡ªèº«åœ¨çº¿ç¨‹æ± å†…çš„å¼•ç”¨ã€‚\ntry &#123;        while (task != null || (task = getTask()) != null) &#123;                //æ‰§è¡Œä»»åŠ¡        &#125; finally &#123;            processWorkerExit(w, completedAbruptly);        &#125;&#125;\n\nçº¿ç¨‹å›æ”¶çš„å·¥ä½œæ˜¯åœ¨processWorkerExitæ–¹æ³•å®Œæˆçš„ã€‚äº‹å®ä¸Šï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå°†çº¿ç¨‹å¼•ç”¨ç§»å‡ºçº¿ç¨‹æ± å°±å·²ç»ç»“æŸäº†çº¿ç¨‹é”€æ¯çš„éƒ¨åˆ†ã€‚ä½†ç”±äºå¼•èµ·çº¿ç¨‹é”€æ¯çš„å¯èƒ½æ€§æœ‰å¾ˆå¤šï¼Œçº¿ç¨‹æ± è¿˜è¦åˆ¤æ–­æ˜¯ä»€ä¹ˆå¼•å‘äº†è¿™æ¬¡é”€æ¯ï¼Œæ˜¯å¦è¦æ”¹å˜çº¿ç¨‹æ± çš„ç°é˜¶æ®µçŠ¶æ€ï¼Œæ˜¯å¦è¦æ ¹æ®æ–°çŠ¶æ€ï¼Œé‡æ–°åˆ†é…çº¿ç¨‹ã€‚\n2.4.4 Workerçº¿ç¨‹æ‰§è¡Œä»»åŠ¡åœ¨Workerç±»ä¸­çš„runæ–¹æ³•è°ƒç”¨äº†runWorkeræ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ï¼ŒrunWorkeræ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n1.whileå¾ªç¯ä¸æ–­åœ°é€šè¿‡getTask()æ–¹æ³•è·å–ä»»åŠ¡ã€‚ 2.getTask()æ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ã€‚ 3.å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œé‚£ä¹ˆè¦ä¿è¯å½“å‰çº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œå¦åˆ™è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸­æ–­çŠ¶æ€ã€‚ 4.æ‰§è¡Œä»»åŠ¡ã€‚ 5.å¦‚æœgetTaskç»“æœä¸ºnullåˆ™è·³å‡ºå¾ªç¯ï¼Œæ‰§è¡ŒprocessWorkerExit()æ–¹æ³•ï¼Œé”€æ¯çº¿ç¨‹ã€‚\næ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n","categories":["çº¿ç¨‹æ± "],"tags":["å­¦ä¹ "]},{"title":"WSDL","url":"/java4u/2020/10/16/WSDL/","content":"WSDLï¼ˆç½‘ç»œæœåŠ¡æè¿°è¯­è¨€ï¼ŒWeb Services Description Languageï¼‰æ˜¯ä¸€é—¨åŸºäº XML çš„è¯­è¨€ï¼Œç”¨äºæè¿° Web Services ä»¥åŠå¦‚ä½•å¯¹å®ƒä»¬è¿›è¡Œè®¿é—®\næ–‡æ¡£ç»“æ„      web service æ‰§è¡Œçš„æ“ä½œ       web service ä½¿ç”¨çš„æ¶ˆæ¯         web service ä½¿ç”¨çš„æ•°æ®ç±»å‹       web service ä½¿ç”¨çš„é€šä¿¡åè®®\n&lt;definitions&gt;\t&lt;types&gt;\t\tdefinition of types........\t&lt;/types&gt;\t&lt;message&gt;\t\tdefinition of a message....\t&lt;/message&gt;\t&lt;portType&gt;\t\tdefinition of a port.......\t&lt;/portType&gt;\t&lt;binding type=&quot;glossaryTerms&quot; name=&quot;b1&quot;&gt;      name å±æ€§å®šä¹‰ binding çš„åç§°ï¼Œè€Œ type å±æ€§æŒ‡å‘ç”¨äº binding çš„ç«¯å£ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ &quot;glossaryTerms&quot; ç«¯å£ã€‚\t&lt;soap:binding style=&quot;document&quot;\ttransport=&quot;http://schemas.xmlsoap.org/soap/http&quot; /&gt;    style å±æ€§å¯å–å€¼ &quot;rpc&quot; æˆ– &quot;document&quot;ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨ documentã€‚transport å±æ€§å®šä¹‰äº†è¦ä½¿ç”¨çš„ SOAP åè®®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨ HTTPã€‚\t  &lt;operation&gt;\t\t&lt;soap:operation\t\t soapAction=&quot;http://example.com/getTerm&quot; /&gt;\t\t&lt;input&gt;\t\t  &lt;soap:body use=&quot;literal&quot; /&gt;\t\t&lt;/input&gt;\t\t&lt;output&gt;\t\t  &lt;soap:body use=&quot;literal&quot; /&gt;\t\t&lt;/output&gt;\t  &lt;/operation&gt;\t&lt;/binding&gt;&lt;/definitions&gt;\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;wsdl:definitions xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:wsdl=&quot;http://schemas.xmlsoap.org/wsdl/&quot; xmlns:tns=&quot;http://impl.cxf.aisino.com/&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot; xmlns:ns2=&quot;http://cxf.apache.org/bindings/xformat&quot; xmlns:ns1=&quot;http://cxf.aisino.com/&quot; targetNamespace=&quot;http://impl.cxf.aisino.com/&quot; name=&quot;EInvWebServiceImplService&quot;&gt;\t&lt;wsdl:import namespace=&quot;http://cxf.aisino.com/&quot; location=&quot;http://222.190.120.106:10001/TestGome_SlProj/webService/eInvWS?wsdl=IEInvWebService.wsdl&quot;&gt; &lt;/wsdl:import&gt;\t\t&lt;wsdl:binding name=&quot;EInvWebServiceImplServiceSoapBinding&quot; type=&quot;ns1:IEInvWebService&quot;&gt;\t\t&lt;soap:binding transport=&quot;http://schemas.xmlsoap.org/soap/http&quot; style=&quot;document&quot;/&gt;\t\t&lt;wsdl:operation name=&quot;gomeData&quot;&gt;\t\t\t&lt;soap:operation style=&quot;document&quot; soapAction=&quot;&quot;/&gt;\t\t\t&lt;wsdl:input name=&quot;gomeData&quot;&gt;\t\t\t\t&lt;soap:body use=&quot;literal&quot;/&gt;\t\t\t&lt;/wsdl:input&gt;\t\t\t&lt;wsdl:output name=&quot;gomeDataResponse&quot;&gt;\t\t\t\t&lt;soap:body use=&quot;literal&quot;/&gt;\t\t\t&lt;/wsdl:output&gt;\t\t&lt;/wsdl:operation&gt;\t&lt;/wsdl:binding&gt;\t\t&lt;wsdl:service name=&quot;EInvWebServiceImplService&quot;&gt;\t\t&lt;wsdl:port name=&quot;EInvWebServiceImplPort&quot; binding=&quot;tns:EInvWebServiceImplServiceSoapBinding&quot;&gt;\t\t\t&lt;soap:address location=&quot;http://222.190.120.106:10001/TestGome_SlProj/webService/eInvWS&quot;/&gt;\t\t&lt;/wsdl:port&gt;\t&lt;/wsdl:service&gt;&lt;/wsdl:definitions&gt;\n\n\n","categories":["webservice"],"tags":["WSDL"]},{"title":"14. æœ€é•¿å…¬å…±å‰ç¼€","url":"/java4u/2020/10/12/14.%20%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80/","content":"14. æœ€é•¿å…¬å…±å‰ç¼€ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚\nå¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² â€œâ€ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šstrs &#x3D; [â€œflowerâ€,â€flowâ€,â€flightâ€]è¾“å‡ºï¼šâ€flâ€\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šstrs &#x3D; [â€œdogâ€,â€racecarâ€,â€carâ€]è¾“å‡ºï¼šâ€â€è§£é‡Šï¼šè¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚\næç¤ºï¼š\n1 &lt;&#x3D; strs.length &lt;&#x3D; 2000 &lt;&#x3D; strs[i].length &lt;&#x3D; 200strs[i] ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ\né¢˜è§£/** * æ¨ªå‘æ¯”è¾ƒ * @param strs * @return */public String longestCommonPrefix(String[] strs) &#123;    StringBuilder prefix = new StringBuilder(&quot;&quot;);    for (int i = 0; ; i++) &#123;        int j = 0;        if (j &gt; strs.length - 1 || i &gt; strs[j].length() - 1) break;        char ch = strs[j].charAt(i);        //jä»ç¬¬ä¸€ä¸ªå­—ç¬¦å‘æœ€åä¸€ä¸ªå­—ç¬¦ç§»åŠ¨        //åˆ¤æ–­å­—ç¬¦æ˜¯å¦éƒ½æ˜¯ä¸€è‡´çš„        //å½“jçš„é•¿åº¦å’Œstr.lengthä¸€æ ·è¯´æ˜å®Œæˆéå†ï¼Œå­—ç¬¦éƒ½ä¸€æ ·        while (j &lt;= strs.length - 1 &amp;&amp; i &lt;= strs[j].length() - 1 &amp;&amp; strs[j].charAt(i) == ch) &#123;            j++;        &#125;        if (j == strs.length) &#123;            prefix.append(ch);        &#125; else &#123;            break;        &#125;    &#125;    return prefix.toString();&#125;/** * å°†é¦–ä¸ªå­—ç¬¦ä¸²å½“ä½œåŸºå‡†å…ƒç´ ï¼Œä¸ä¹‹åçš„å­—ç¬¦è¿›è¡Œæ¯”è¾ƒ * è‹¥åé¢çš„å­—ç¬¦ä¸å…¨åŒ…å«åŸºå‡†å…ƒç´ ï¼Œåˆ™å°†åŸºå‡†å…ƒç´ æœ«å°¾å‡1 * ç›´åˆ°å…¨åŒ…å«åŸºå‡†å…ƒç´ ï¼Œåˆ™åŸºå‡†å…ƒç´ å³ä¸ºå…¬å…±å‰ç¼€ * @param strs * @return */public String longestCommonPrefix2(String[] strs) &#123;    if (strs.length == 0) return &quot;&quot;;    String prefix = strs[0];    for (int i = 1; i &lt; strs.length; i++)        while (strs[i].indexOf(prefix) != 0) &#123;            prefix = prefix.substring(0, prefix.length() - 1);            if (prefix.isEmpty()) return &quot;&quot;;        &#125;    return prefix;&#125;/** * æ’åºåæ¯”è¾ƒå¤´å°¾    ä¸é€šè¿‡ * [&quot;abab&quot;,&quot;aba&quot;,&quot;abc&quot;]å¯¹äºé•¿åº¦ä¸€æ ·çš„åœºæ™¯ä¼šå‡ºç°è¯¯åˆ¤ * ä¸”å¯¹äºä¸­é—´çš„å­—ç¬¦éƒ½æ²¡æœ‰åˆ¤æ–­ * @param strs * @return */public String longestCommonPrefix3(String[] strs)&#123;    Arrays.sort(strs, Comparator.comparingInt(String::length));    int index = 0;    while (index &lt; strs[0].length()            &amp;&amp; (strs[0].charAt(index) == strs[strs.length-1].charAt(index)))&#123;        index++;    &#125;    return strs[0].substring(0,index);&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"2. ä¸¤æ•°ç›¸åŠ ","url":"/java4u/2020/10/12/2.%20%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/","content":"2. ä¸¤æ•°ç›¸åŠ ç»™ä½ ä¸¤ä¸ª éç©º çš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å®ƒä»¬æ¯ä½æ•°å­—éƒ½æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ ä¸€ä½ æ•°å­—ã€‚\nè¯·ä½ å°†ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œå¹¶ä»¥ç›¸åŒå½¢å¼è¿”å›ä¸€ä¸ªè¡¨ç¤ºå’Œçš„é“¾è¡¨ã€‚\nä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šl1 &#x3D; [2,4,3], l2 &#x3D; [5,6,4]è¾“å‡ºï¼š[7,0,8]è§£é‡Šï¼š342 + 465 &#x3D; 807. \nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šl1 &#x3D; [0], l2 &#x3D; [0]è¾“å‡ºï¼š[0]\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šl1 &#x3D; [9,9,9,9,9,9,9], l2 &#x3D; [9,9,9,9]è¾“å‡ºï¼š[8,9,9,9,0,0,0,1]\næç¤ºï¼š\næ¯ä¸ªé“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ [1, 100] å†…0 &lt;&#x3D; Node.val &lt;&#x3D; 9é¢˜ç›®æ•°æ®ä¿è¯åˆ—è¡¨è¡¨ç¤ºçš„æ•°å­—ä¸å«å‰å¯¼é›¶\né¢˜è§£//åŠ æ³•ä»æœ€ä½ä½å¼€å§‹ï¼Œéå†é“¾è¡¨å°±æ˜¯ä»è¡¨å¤´å¼€å§‹è¿›è¡Œè®¡ç®—public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123;    //å“¨å…µèŠ‚ç‚¹    ListNode dummyHead = new ListNode(0);    ListNode p = l1, q = l2, curr = dummyHead;    int carry = 0;    while (p != null || q != null) &#123;        int x = (p != null) ? p.val : 0;        int y = (q != null) ? q.val : 0;        int sum = carry + x + y;        carry = sum / 10;        curr.next = new ListNode(sum % 10);        curr = curr.next;        if (p != null) p = p.next;        if (q != null) q = q.next;    &#125;    if (carry &gt; 0) &#123;        curr.next = new ListNode(carry);    &#125;    return dummyHead.next;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","é“¾è¡¨"]},{"title":"64. æœ€å°è·¯å¾„å’Œ","url":"/java4u/2020/10/12/64.%20%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E5%92%8C/","content":"64. æœ€å°è·¯å¾„å’Œç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„ m x n ç½‘æ ¼ grid ï¼Œè¯·æ‰¾å‡ºä¸€æ¡ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šçš„æ•°å­—æ€»å’Œä¸ºæœ€å°ã€‚\nè¯´æ˜ï¼šæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šgrid &#x3D; [[1,3,1],[1,5,1],[4,2,1]]è¾“å‡ºï¼š7è§£é‡Šï¼šå› ä¸ºè·¯å¾„ 1â†’3â†’1â†’1â†’1 çš„æ€»å’Œæœ€å°ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šgrid &#x3D; [[1,2,3],[4,5,6]]è¾“å‡ºï¼š12\næç¤ºï¼š\nm &#x3D;&#x3D; grid.lengthn &#x3D;&#x3D; grid[i].length1 &lt;&#x3D; m, n &lt;&#x3D; 2000 &lt;&#x3D; grid[i][j] &lt;&#x3D; 100\né¢˜è§£/**    * 1 3 1    * 1 5 1    * 4 2 1    * &lt;p&gt;    * 5çš„ä½ç½®ç”± 1-&gt;3-&gt;5 æˆ– 1-&gt;1-&gt;5ç§»åŠ¨è€Œæ¥    * å³ dp[i+1][j+1]=Math.min(dp[i+1][j],dp[i][j+1])+grid[i+1][j+1]    * @param grid    * @return    */   public int minPathSum(int[][] grid) &#123;       int m = grid.length;       int n = grid[0].length;       int[][] minPath = new int[m][n];       minPath[0][0] = grid[0][0];       int asum = minPath[0][0];       int bsum = minPath[0][0];       for (int a = 1; a &lt; n; a++) &#123;           asum += grid[0][a];           minPath[0][a] = asum;       &#125;       for (int b = 1; b &lt; m; b++) &#123;           bsum += grid[b][0];           minPath[b][0] = bsum;       &#125;       for (int i = 0; i &lt; m - 1; i++) &#123;           for (int j = 0; j &lt; n - 1; j++) &#123;               minPath[i + 1][j + 1] = grid[i + 1][j + 1] + Math.min(minPath[i + 1][j], minPath[i][j + 1]);           &#125;       &#125;       return minPath[m - 1][n - 1];   &#125;   //ç›´æ¥åœ¨å…¥å‚çš„æ•°ç»„ä¸Šè¿›è¡Œè®¡ç®—   //ä¸éœ€è¦åˆå§‹åŒ–å’Œæ–°å»ºæ•°ç»„   public int minPathSum2(int[][] grid) &#123;       for (int i = 0; i &lt; grid.length; i++) &#123;           for (int j = 0; j &lt; grid[0].length; j++) &#123;               if (i == 0 &amp;&amp; j == 0) continue;               else if (i == 0) grid[i][j] = grid[i][j - 1] + grid[i][j];               else if (j == 0) grid[i][j] = grid[i - 1][j] + grid[i][j];               else grid[i][j] = Math.min(grid[i - 1][j], grid[i][j - 1]) + grid[i][j];           &#125;       &#125;       return grid[grid.length - 1][grid[0].length - 1];   &#125;   /**    * ä¹‹å‰å†…å­˜å ç”¨è¿‡å¤š    * å…¶å®éå†çš„gridä¹‹å‰çš„æ•°æ®å°±ä¸ä½¿ç”¨äº†    * å¯ä»¥ç›´æ¥è¦†ç›–gridçš„æ•°æ®    * ä½¿ç”¨ä¸€ç»´æ•°ç»„å‹ç¼©    *    * @param grid    * @return    */   public int minPathSum3(int[][] grid) &#123;       int m = grid.length;       int n = grid[0].length;       int[] dp = new int[n];       dp[0] = grid[0][0];       for (int a = 1; a &lt; n; a++) &#123;           dp[a] = dp[a - 1] + grid[0][a];       &#125;       for (int i = 1; i &lt; m; i++) &#123;           for (int j = 0; j &lt; n; j++) &#123;               if (j == 0) &#123;                   dp[j] += grid[i][j];               &#125; else &#123;                   dp[j] = grid[i][j] + Math.min(dp[j], dp[j - 1]);               &#125;           &#125;       &#125;       return dp[n - 1];   &#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"15. ä¸‰æ•°ä¹‹å’Œ","url":"/java4u/2020/10/11/15.%20%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/","content":"15. ä¸‰æ•°ä¹‹å’Œç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ numsï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾— a + b + c &#x3D; 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚\næ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [-1,0,1,2,-1,-4]è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; []è¾“å‡ºï¼š[]\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [0]è¾“å‡ºï¼š[]\næç¤ºï¼š\n0 &lt;&#x3D; nums.length &lt;&#x3D; 3000-10^5 &lt;&#x3D; nums[i] &lt;&#x3D; 10^5\né¢˜è§£public List&lt;List&lt;Integer&gt;&gt; threeSum(int[] nums) &#123;    List&lt;List&lt;Integer&gt;&gt; threeList = new ArrayList&lt;&gt;();    if (nums.length &lt; 3) return threeList;    Arrays.sort(nums);    if (nums[0] &gt; 0 || nums[nums.length - 1] &lt; 0) return threeList;    for (int i = 0; i &lt; nums.length - 2; i++) &#123;//æœ€åç•™2ä¸ªæ•°ç»„åˆ        if (nums[i] &gt; 0) break;//å»é™¤ç‰¹æ®Šæƒ…å†µ        if (i &gt; 0 &amp;&amp; nums[i] == nums[i - 1]) continue;//å»é™¤é‡å¤æƒ…å†µ        int l = i + 1;        int r = nums.length - 1;        while (l &lt; r) &#123;            if (nums[i] + nums[l] + nums[r] == 0) &#123;                threeList.add(new ArrayList&lt;Integer&gt;(Arrays.asList(nums[i], nums[l], nums[r])));                while (l &lt; r &amp;&amp; nums[l] == nums[l + 1]) l++;                while (l &lt; r &amp;&amp; nums[r] == nums[r - 1]) r--;                l++;                r--;                continue;            &#125;            if (nums[i] + nums[l] + nums[r] &lt; 0) &#123;                l++;                continue;            &#125;            if (nums[i] + nums[l] + nums[r] &gt; 0) &#123;                r--;                continue;            &#125;        &#125;    &#125;    return threeList;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"1. ä¸¤æ•°ä¹‹å’Œ","url":"/java4u/2020/10/10/1.%20%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/","content":"1. ä¸¤æ•°ä¹‹å’Œç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target  çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [2,7,11,15], target &#x3D; 9è¾“å‡ºï¼š[0,1]è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] &#x3D;&#x3D; 9 ï¼Œè¿”å› [0, 1] ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [3,2,4], target &#x3D; 6è¾“å‡ºï¼š[1,2]ç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [3,3], target &#x3D; 6è¾“å‡ºï¼š[0,1]\næç¤ºï¼š2 &lt;&#x3D; nums.length &lt;&#x3D; 10^4-10^9 &lt;&#x3D; nums[i] &lt;&#x3D; 10^9-10^9 &lt;&#x3D; target &lt;&#x3D; 10^9åªä¼šå­˜åœ¨ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆ\nè¿›é˜¶ï¼šä½ å¯ä»¥æƒ³å‡ºä¸€ä¸ªæ—¶é—´å¤æ‚åº¦å°äº O(n2) çš„ç®—æ³•å—ï¼Ÿ\né¢˜è§£public int[] twoSum(int[] nums, int target) &#123;    int[] array = new int[2];    int length = nums.length;    if (length &lt; 2) return array;    for (int i = 0; i &lt; length - 1; i++) &#123;        for (int j = length - 1; j &gt; i; j--) &#123;            if ((nums[i] + nums[j]) == target) &#123;                array[0] = i;                array[1] = j;                return array;            &#125;        &#125;    &#125;    return array;&#125;//2éhashï¼Œéå†æ•°ç»„ï¼Œå°†å€¼å­˜å…¥hashmapï¼Œç¬¬2æ¬¡éå†æ•°ç»„æ—¶ï¼ŒæŸ¥è¯¢mapé‡Œæ˜¯å¦æœ‰å¯¹åº”ç»“æœpublic int[] twoSum2(int[] nums, int target) &#123;    Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();    for (int i = 0; i &lt; nums.length; i++) &#123;        map.put(nums[i], i);    &#125;    for (int i = 0; i &lt; nums.length; i++) &#123;        int complement = target - nums[i];        if (map.containsKey(complement) &amp;&amp; map.get(complement) != i) &#123;            return new int[]&#123;i, map.get(complement)&#125;;        &#125;    &#125;    throw new IllegalArgumentException(&quot;No two sum solution&quot;);&#125;//ä¸€éhashï¼Œåœ¨éå†æ•°ç»„çš„åŒæ—¶ï¼ŒæŸ¥è¯¢mapé‡Œæ˜¯å¦æœ‰å¯¹åº”å€¼public int[] twoSum3(int[] nums, int target) &#123;    Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();    for (int i = 0; i &lt; nums.length; i++) &#123;        int complement = target - nums[i];        if (map.containsKey(complement)) &#123;            return new int[]&#123;map.get(complement), i&#125;;        &#125;        map.put(nums[i], i);    &#125;    throw new IllegalArgumentException(&quot;No two sum solution&quot;);&#125;/** * ç­”æ¡ˆä¸æ­£ç¡® * æ’åºä¼šæ‰“ä¹±æ•°ç»„é¡ºåº * è¿”å›çš„æ•°ç»„ä½ç½®å·²ç»æ˜¯æ’åºåçš„ * @param nums * @param target * @return */public int[] twoSum4(int[] nums, int target) &#123;    Arrays.sort(nums);    int l = 0;    int r = nums.length-1;    while (l&lt;r)&#123;        if(nums[l]+nums[r]==target)&#123;            return new int[]&#123;l,r&#125;;        &#125;else if(nums[l]+nums[r]&gt;target)&#123;            r--;        &#125;else&#123;            l++;        &#125;    &#125;    return new int[]&#123;&#125;;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ•°ç»„"]},{"title":"110. å¹³è¡¡äºŒå‰æ ‘","url":"/java4u/2020/08/17/110.%20%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/","content":"110. å¹³è¡¡äºŒå‰æ ‘ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚\næœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼š\nä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1 ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šroot &#x3D; [3,9,20,null,null,15,7]è¾“å‡ºï¼štrue\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šroot &#x3D; [1,2,2,3,3,null,null,4,4]è¾“å‡ºï¼šfalse\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šroot &#x3D; []è¾“å‡ºï¼štrue\næç¤ºï¼š\næ ‘ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ [0, 5000] å†…-10^4 &lt;&#x3D; Node.val &lt;&#x3D; 10^4\né¢˜è§£/** * BFSéå†æ¯å±‚äºŒå‰æ ‘ï¼Œè®°å½•æœ€ä½å’Œæœ€é«˜é«˜åº¦ * éå†å®Œæ¯”è¾ƒé«˜åº¦ï¼ˆä¸è¡Œï¼Œè¿˜éœ€è¦æ¯”è¾ƒæ¯æ£µæ ‘çš„é«˜åº¦ï¼‰ * @param root * @return */public boolean isBalanced(TreeNode root) &#123;    if (root == null) return true;    Queue&lt;TreeNode&gt; qu = new LinkedList&lt;TreeNode&gt;();    int minHigh = 1;    int maxHigh = 0;    int high = 1;    qu.offer(root);    while (!qu.isEmpty()) &#123;        TreeNode node = qu.poll();        if (node.left == null &amp;&amp; node.right == null) &#123;            minHigh = Math.min(high, minHigh);        &#125; else &#123;            //æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µ,é«˜åº¦åŠ ä¸€            if (node.left == null &amp;&amp; node.right != null) &#123;                minHigh = Math.min(high, minHigh);                qu.offer(node.right);            &#125;            if (node.left != null &amp;&amp; node.right == null) &#123;                minHigh = Math.min(high, minHigh);                qu.offer(node.left);            &#125;            if (node.right != null &amp;&amp; node.left != null) &#123;                qu.offer(node.right);                qu.offer(node.left);            &#125;            high++;        &#125;    &#125;    maxHigh = high;    return (maxHigh - minHigh) &lt; 2;&#125;/** * è‡ªé¡¶å‘ä¸‹é€’å½’ * åˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹é«˜åº¦ï¼Œå¹¶åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å¹³è¡¡ * èŠ‚ç‚¹é«˜åº¦ï¼š * height(p) =    0   pä¸ºç©ºèŠ‚ç‚¹ * Max(height(p.left),height(p.right))+1   pä¸ä¸ºç©º * * @param root * @return */public boolean isBalanced2(TreeNode root) &#123;    if (root == null) &#123;        return true;    &#125; else &#123;        return Math.abs(height(root.left) - height(root.right)) &lt;= 1 &amp;&amp; isBalanced2(root.left) &amp;&amp; isBalanced2(root.right);    &#125;&#125;public int height(TreeNode root) &#123;    if (root == null) &#123;        return 0;    &#125; else &#123;        return Math.max(height(root.left), height(root.right)) + 1;    &#125;&#125;/** * è‡ªåº•å‘ä¸Šé€’å½’ * å…ˆåˆ¤æ–­å·¦å³å­æ ‘æ˜¯å¦å‡è¡¡ï¼Œåœ¨åˆ¤æ–­å½“å‰æ ¹èŠ‚ç‚¹æ˜¯å¦å¹³è¡¡ * * @param root * @return */public boolean isBalanced3(TreeNode root) &#123;    return height2(root) &gt;= 0;&#125;public int height2(TreeNode root) &#123;    if (root == null) &#123;        return 0;    &#125;    int leftHeight = height2(root.left);    int rightHeight = height2(root.right);    if (leftHeight == -1 || rightHeight == -1 || Math.abs(leftHeight - rightHeight) &gt; 1) &#123;//åªè¦é«˜åº¦å·®å¤§äº1ï¼Œä¸å¹³è¡¡åˆ™è¿”å›-1        return -1;    &#125; else &#123;        return Math.max(leftHeight, rightHeight) + 1;    &#125;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"337. æ‰“å®¶åŠ«èˆ III","url":"/java4u/2020/08/10/337.%20%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D%20III/","content":"337. æ‰“å®¶åŠ«èˆ IIIå°å·åˆå‘ç°äº†ä¸€ä¸ªæ–°çš„å¯è¡Œçªƒçš„åœ°åŒºã€‚è¿™ä¸ªåœ°åŒºåªæœ‰ä¸€ä¸ªå…¥å£ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º root ã€‚\né™¤äº† root ä¹‹å¤–ï¼Œæ¯æ ‹æˆ¿å­æœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œçˆ¶â€œæˆ¿å­ä¸ä¹‹ç›¸è¿ã€‚ä¸€ç•ªä¾¦å¯Ÿä¹‹åï¼Œèªæ˜çš„å°å·æ„è¯†åˆ°â€œè¿™ä¸ªåœ°æ–¹çš„æ‰€æœ‰æˆ¿å±‹çš„æ’åˆ—ç±»ä¼¼äºä¸€æ£µäºŒå‰æ ‘â€ã€‚ å¦‚æœ ä¸¤ä¸ªç›´æ¥ç›¸è¿çš„æˆ¿å­åœ¨åŒä¸€å¤©æ™šä¸Šè¢«æ‰“åŠ« ï¼Œæˆ¿å±‹å°†è‡ªåŠ¨æŠ¥è­¦ã€‚\nç»™å®šäºŒå‰æ ‘çš„ root ã€‚è¿”å› åœ¨ä¸è§¦åŠ¨è­¦æŠ¥çš„æƒ…å†µä¸‹ ï¼Œå°å·èƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: root &#x3D; [3,2,3,null,3,null,1]è¾“å‡º: 7è§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ 3 + 3 + 1 &#x3D; 7\nç¤ºä¾‹ 2:\nè¾“å…¥: root &#x3D; [3,4,5,1,3,null,1]è¾“å‡º: 9è§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ 4 + 5 &#x3D; 9\næç¤ºï¼š\næ ‘çš„èŠ‚ç‚¹æ•°åœ¨ [1, 10^4] èŒƒå›´å†…0 &lt;&#x3D; Node.val &lt;&#x3D; 10^4\né¢˜è§£/**     *    3     *  2   3     *   3    1     * ä¸é€šè¿‡  æŒ‰å±‚è¿›è¡Œè®¡ç®—çš„æ—¶å€™ï¼Œæ²¡æœ‰è€ƒè™‘çˆ¶å­èŠ‚ç‚¹æ— æ³•åŒæ—¶é€‰ä¸­çš„æƒ…å†µ     * @param root     * @return     */    public int rob(TreeNode root) &#123;        if (root == null) return 0;        Queue&lt;TreeNode&gt; queue = new LinkedList&lt;TreeNode&gt;();        queue.offer(root);        int pre = 0;        int cur = root.val;        int temp;        while (!queue.isEmpty()) &#123;            int sum = 0;            TreeNode node = queue.poll();            if (node.left != null) &#123;                queue.offer(node.left);                sum += node.left.val;            &#125;            if (node.right != null) &#123;                queue.offer(node.right);                sum += node.right.val;            &#125;            temp = cur;            cur = Math.max(pre + sum, cur);            pre = temp;        &#125;        return cur;    &#125;    /**     * é€’å½’     * æ¯”è¾ƒ çˆ·+å­™ ä¸ çˆ¶ èŠ‚ç‚¹çš„å¤§å°     * ä¸é€šè¿‡   æ ‘çš„èŠ‚ç‚¹æ•°å¤šçš„æ—¶å€™ä¼šè¶…æ—¶     * @param root     * @return     */    public int rob2(TreeNode root) &#123;        if (root == null) return 0;        int money = root.val;        if (root.left != null) &#123;            money += (rob2(root.left.left) + rob2(root.left.right));        &#125;        if (root.right != null) &#123;            money += (rob2(root.right.left) + rob2(root.right.right));        &#125;        return Math.max(money, rob2(root.left) + rob2(root.right));    &#125;    /**     * è§£å†³é‡å¤è®¡ç®—ï¼Œä½¿ç”¨mapè®°å½•æ•°æ®     *     * @param root     * @return     */    public int rob3(TreeNode root) &#123;        HashMap&lt;TreeNode, Integer&gt; memo = new HashMap&lt;&gt;();        return robInternal(root, memo);    &#125;    public int robInternal(TreeNode root, HashMap&lt;TreeNode, Integer&gt; memo) &#123;        if (root == null) return 0;        if (memo.containsKey(root)) return memo.get(root);        int money = root.val;        if (root.left != null) &#123;            money += (robInternal(root.left.left, memo) + robInternal(root.left.right, memo));        &#125;        if (root.right != null) &#123;            money += (robInternal(root.right.left, memo) + robInternal(root.right.right, memo));        &#125;        int result = Math.max(money, robInternal(root.left, memo) + robInternal(root.right, memo));        memo.put(root, result);        return result;    &#125;    /**     * æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¤§å°ä¸º 2 çš„æ•°ç»„æ¥è¡¨ç¤º int[] res = new int[2] 0 ä»£è¡¨ä¸å·ï¼Œ1 ä»£è¡¨å·     * ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹èƒ½å·åˆ°çš„æœ€å¤§é’±çš„çŠ¶æ€å¯ä»¥å®šä¹‰ä¸º     * å½“å‰èŠ‚ç‚¹é€‰æ‹©ä¸å·ï¼šå½“å‰èŠ‚ç‚¹èƒ½å·åˆ°çš„æœ€å¤§é’±æ•° = å·¦å­©å­èƒ½å·åˆ°çš„é’± + å³å­©å­èƒ½å·åˆ°çš„é’±     * å½“å‰èŠ‚ç‚¹é€‰æ‹©å·ï¼šå½“å‰èŠ‚ç‚¹èƒ½å·åˆ°çš„æœ€å¤§é’±æ•° = å·¦å­©å­é€‰æ‹©è‡ªå·±ä¸å·æ—¶èƒ½å¾—åˆ°çš„é’± + å³å­©å­é€‰æ‹©ä¸å·æ—¶èƒ½å¾—åˆ°çš„é’± + å½“å‰èŠ‚ç‚¹çš„é’±æ•°     *     * @param root     * @return     */    public int rob4(TreeNode root) &#123;        int[] result = robInternal(root);        return Math.max(result[0], result[1]);    &#125;    public int[] robInternal(TreeNode root) &#123;        if (root == null) return new int[2];        int[] result = new int[2];        int[] left = robInternal(root.left);        int[] right = robInternal(root.right);        result[0] = Math.max(left[0], left[1]) + Math.max(right[0], right[1]);        result[1] = left[0] + right[0] + root.val;        return result;    &#125;class TreeNode &#123;    int val;    TreeNode left;    TreeNode right;    TreeNode(int x) &#123;        val = x;    &#125;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"213. æ‰“å®¶åŠ«èˆ II","url":"/java4u/2020/08/07/213.%20%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D%20II/","content":"213. æ‰“å®¶åŠ«èˆ IIä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ã€‚è¿™ä¸ªåœ°æ–¹æ‰€æœ‰çš„æˆ¿å±‹éƒ½ å›´æˆä¸€åœˆ ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªæˆ¿å±‹å’Œæœ€åä¸€ä¸ªæˆ¿å±‹æ˜¯ç´§æŒ¨ç€çš„ã€‚åŒæ—¶ï¼Œç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ ã€‚\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½  åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä»Šæ™šèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼šnums &#x3D; [2,3,2]è¾“å‡ºï¼š3è§£é‡Šï¼šä½ ä¸èƒ½å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ &#x3D; 2ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ &#x3D; 2ï¼‰, å› ä¸ºä»–ä»¬æ˜¯ç›¸é‚»çš„ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1,2,3,1]è¾“å‡ºï¼š4è§£é‡Šï¼šä½ å¯ä»¥å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ &#x3D; 1ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ &#x3D; 3ï¼‰ã€‚     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ &#x3D; 1 + 3 &#x3D; 4 ã€‚\nç¤ºä¾‹ 3ï¼š\nè¾“å…¥ï¼šnums &#x3D; [1,2,3]è¾“å‡ºï¼š3\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 1000 &lt;&#x3D; nums[i] &lt;&#x3D; 1000\né¢˜è§£/** * å›´æˆåœˆï¼Œè®¡ç®—ä¸åŒ…å«ç¬¬ä¸€é—´æˆ¿é—´å’Œä¸åŒ…å«æœ€åä¸€é—´æˆ¿é—´çš„æœ€å¤§å€¼ * * @param nums * @return */public int rob(int[] nums) &#123;    int len = nums.length;    if (nums == null || len == 0) return 0;    if (len == 1) return nums[0];    int[] dp = new int[len];    return Math.max(myRob(Arrays.copyOfRange(nums, 0, len - 1)),            myRob(Arrays.copyOfRange(nums, 1, len)));&#125;private int myRob(int[] nums) &#123;    int len = nums.length;    if (nums == null || len == 0) return 0;    if (len == 1) return nums[0];    int[] dp = new int[len];    dp[0] = nums[0];    dp[1] = Math.max(nums[0], nums[1]);    if (len &gt; 2) &#123;        for (int i = 2; i &lt; len; i++) &#123;            dp[i] = Math.max(dp[i - 1], dp[i - 2] + nums[i]);        &#125;    &#125;    return dp[len - 1];&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"198. æ‰“å®¶åŠ«èˆ","url":"/java4u/2020/08/05/198.%20%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D/","content":"198. æ‰“å®¶åŠ«èˆä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ã€‚æ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ä½ å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚\nç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½  ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä¸€å¤œä¹‹å†…èƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚\nç¤ºä¾‹ 1ï¼š\nè¾“å…¥ï¼š[1,2,3,1]è¾“å‡ºï¼š4è§£é‡Šï¼šå·çªƒ 1 å·æˆ¿å±‹ (é‡‘é¢ &#x3D; 1) ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ (é‡‘é¢ &#x3D; 3)ã€‚     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ &#x3D; 1 + 3 &#x3D; 4 ã€‚\nç¤ºä¾‹ 2ï¼š\nè¾“å…¥ï¼š[2,7,9,3,1]è¾“å‡ºï¼š12è§£é‡Šï¼šå·çªƒ 1 å·æˆ¿å±‹ (é‡‘é¢ &#x3D; 2), å·çªƒ 3 å·æˆ¿å±‹ (é‡‘é¢ &#x3D; 9)ï¼Œæ¥ç€å·çªƒ 5 å·æˆ¿å±‹ (é‡‘é¢ &#x3D; 1)ã€‚     å·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ &#x3D; 2 + 9 + 1 &#x3D; 12 ã€‚\næç¤ºï¼š\n1 &lt;&#x3D; nums.length &lt;&#x3D; 1000 &lt;&#x3D; nums[i] &lt;&#x3D; 400\né¢˜è§£//åŠ¨æ€è§„åˆ’  dpè¡¨ç¤ºå·åˆ°å½“å‰æˆ¿å±‹è·å–åˆ°çš„æœ€å¤§å€¼//ç”±äºä¸å¯ä»¥åœ¨ç›¸é‚»çš„æˆ¿å±‹é—¯å…¥ï¼Œæ‰€ä»¥ è‡³iæˆ¿å±‹å¯ç›—çªƒçš„æœ€å¤§å€¼ï¼Œè¦ä¹ˆå°±æ˜¯è‡³ i-1 æˆ¿å±‹å¯ç›—çªƒçš„æœ€å¤§å€¼ï¼Œ//è¦ä¹ˆå°±æ˜¯è‡³ i-2 æˆ¿å±‹å¯ç›—çªƒçš„æœ€å¤§å€¼åŠ ä¸Šå½“å‰æˆ¿å±‹çš„å€¼ï¼ŒäºŒè€…ä¹‹é—´å–æœ€å¤§å€¼ï¼Œå³ï¼š//dp[i] = max(dp[i-2]+nums[i], dp[i-1])public static int rob(int[] nums) &#123;    int len = nums.length;    if (len == 0) return 0;    if (len == 1) return nums[0];    int[] dp = new int[len];    dp[0] = nums[0];    dp[1] = Math.max(nums[0], nums[1]);    for (int i = 2; i &lt; len; i++) &#123;        dp[i] = Math.max(dp[i - 1], dp[i - 2] + nums[i]);    &#125;    return dp[len - 1];&#125;/** * æ»šåŠ¨æ•°ç»„ * å½“å‰æœ€å¤§é‡‘é¢ä¸å‰2é—´æˆ¿çš„æœ€å¤§é‡‘é¢æœ‰å…³ï¼Œåªè®°å½•å‰2é—´æˆ¿é‡‘é¢ * * @param nums * @return */public int rob2(int[] nums) &#123;    if (nums == null || nums.length == 0) &#123;        return 0;    &#125;    int length = nums.length;    if (length == 1) &#123;        return nums[0];    &#125;    int first = nums[0], second = Math.max(nums[0], nums[1]);    for (int i = 2; i &lt; length; i++) &#123;        int temp = second;        second = Math.max(first + nums[i], second);        first = temp;    &#125;    return second;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","åŠ¨æ€è§„åˆ’"]},{"title":"104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦","url":"/java4u/2020/07/28/104.%20%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E5%A4%A7%E6%B7%B1%E5%BA%A6/","content":"104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚\näºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚\nè¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚\nç¤ºä¾‹ï¼šç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ\n  3 / \\9  20  /  \\ 15   7\n\nè¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚\né¢˜è§£/** * é€’å½’ï¼Œæ¯”è¾ƒå·¦å­æ ‘å’Œå³å­æ ‘çš„æ·±åº¦ï¼Œé€‰æ‹©å¤§çš„åŠ ä¸Šè‡ªèº«çš„æ·±åº¦1ä¸ºæœ€å¤§æ·±åº¦ * ä¸­æ­¢æ¡ä»¶ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹ * * åœ¨é€’å½’ä¸­ï¼Œå¦‚æœå±‚çº§è¿‡æ·±ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½ä¿å­˜è¿‡å¤šçš„ä¸´æ—¶å˜é‡ï¼Œå¯¼è‡´æ ˆæº¢å‡º * å‡½æ•°è°ƒç”¨çš„å‚æ•°æ˜¯é€šè¿‡æ ˆç©ºé—´æ¥ä¼ é€’çš„ï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¼šå ç”¨çº¿ç¨‹çš„æ ˆèµ„æºã€‚ * è€Œé€’å½’è°ƒç”¨ï¼Œåªæœ‰èµ°åˆ°æœ€åçš„ç»“æŸç‚¹åå‡½æ•°æ‰èƒ½ä¾æ¬¡é€€å‡ºï¼Œè€Œæœªåˆ°è¾¾æœ€åçš„ç»“æŸç‚¹ä¹‹å‰ï¼Œ * å ç”¨çš„æ ˆç©ºé—´ä¸€ç›´æ²¡æœ‰é‡Šæ”¾ï¼Œå¦‚æœé€’å½’è°ƒç”¨æ¬¡æ•°è¿‡å¤šï¼Œå°±å¯èƒ½å¯¼è‡´å ç”¨çš„æ ˆèµ„æºè¶…è¿‡çº¿ç¨‹çš„æœ€å¤§å€¼ï¼Œ * ä»è€Œå¯¼è‡´æ ˆæº¢å‡ºï¼Œå¯¼è‡´ç¨‹åºçš„å¼‚å¸¸é€€å‡ºã€‚ * æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼•å‡ºä¸‹é¢çš„è¯é¢˜ï¼šå¦‚ä½•å°†é€’å½’çš„ä»£ç è½¬åŒ–æˆéé€’å½’çš„å½¢å¼ã€‚ * è¿™é‡Œè¯·è®°ä½ï¼Œ99%çš„é€’å½’è½¬éé€’å½’ï¼Œéƒ½å¯ä»¥é€šè¿‡æ ˆæ¥è¿›è¡Œå®ç°ã€‚ * * @param root * @return */public int maxDepth2(TreeNode root) &#123;    return root == null ? 0 : Math.max(maxDepth2(root.left), maxDepth2(root.right)) + 1;&#125;/** * å¯¹äºŒå‰æ ‘è¿›è¡ŒDFSéå†ï¼Œå°†æ•°æ®å­˜å…¥æ ˆä»£æ›¿é€’å½’ * å…ˆå­˜å…¥å³èŠ‚ç‚¹åœ¨å­˜å…¥å·¦èŠ‚ç‚¹ï¼ˆå…ˆå–å‡ºå·¦èŠ‚ç‚¹åœ¨å–å‡ºå³èŠ‚ç‚¹ï¼‰ * @param root * @return */private List&lt;TreeNode&gt; traversal(TreeNode root) &#123;    List&lt;TreeNode&gt; res = new ArrayList&lt;&gt;();    Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;();    stack.add(root);    while (!stack.empty()) &#123;        TreeNode node = stack.pop();        res.add(node);        if (node.right != null) &#123;            stack.push(node.right);        &#125;        if (node.left != null) &#123;            stack.push(node.left);        &#125;    &#125;    return res;&#125;/** * éé€’å½’çš„DFSï¼Œé€šè¿‡æ ˆå®ç° * ç”¨æ ˆåŒæ—¶å­˜æ”¾èŠ‚ç‚¹ä¸é«˜åº¦æ•°æ®ï¼Œå–å‡ºèŠ‚ç‚¹æ—¶åŒæ—¶å–å‡ºé«˜åº¦ * @param root * @return */public int maxDepth4(TreeNode root) &#123;    if (root == null) return 0;    Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;();    Stack&lt;Integer&gt; level = new Stack&lt;&gt;();    int maxDepth = 0;    stack.push(root);    level.push(1);    while (!stack.isEmpty()) &#123;        //å…ˆå–å‡ºå·¦èŠ‚ç‚¹ï¼ŒåŒæ—¶å–å‡ºèŠ‚ç‚¹é«˜åº¦ï¼Œä¸æœ€å¤§é«˜åº¦æ¯”è¾ƒ        TreeNode node = stack.pop();        Integer temp = level.pop();        maxDepth = Math.max(maxDepth, temp);        if (node.right != null) &#123;            stack.push(node.right);            level.push(temp + 1);        &#125;        if (node.left != null) &#123;            stack.push(node.left);            level.push(temp + 1);        &#125;    &#125;    return maxDepth;&#125;/** * BFSï¼Œå±‚å±‚ç´¯åŠ æ ‘çš„é«˜åº¦ * åœ¨é˜Ÿé¦–å–å‡ºè¯¥å±‚çš„èŠ‚ç‚¹ * åœ¨é˜Ÿå°¾æ”¾å…¥å–å‡ºèŠ‚ç‚¹çš„ç›¸å…³èŠ‚ç‚¹ * ç»ˆæ­¢æ¡ä»¶ï¼šé˜Ÿåˆ—å–å‡ºæ‰€æœ‰èŠ‚ç‚¹ * * @param root * @return */public int maxDepth3(TreeNode root) &#123;    if (root == null) &#123;        return 0;    &#125;    Queue&lt;TreeNode&gt; queue = new LinkedList&lt;TreeNode&gt;();    queue.offer(root);    int ans = 0;    while (!queue.isEmpty()) &#123;        int size = queue.size();  //æ¯ä¸€å±‚çš„ä¸ªæ•°        while (size &gt; 0) &#123;            TreeNode node = queue.poll();            if (node.left != null) &#123;                queue.offer(node.left);            &#125;            if (node.right != null) &#123;                queue.offer(node.right);            &#125;            size--;        &#125;        ans++;    &#125;    return ans;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","äºŒå‰æ ‘"]},{"title":"3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","url":"/java4u/2020/07/24/3.%20%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/","content":"3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: s &#x3D; â€œabcabcbbâ€è¾“å‡º: 3è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œabcâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\nç¤ºä¾‹ 2:\nè¾“å…¥: s &#x3D; â€œbbbbbâ€è¾“å‡º: 1è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œbâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚\nç¤ºä¾‹ 3:\nè¾“å…¥: s &#x3D; â€œpwwkewâ€è¾“å‡º: 3è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œwkeâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œâ€pwkeâ€ æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚\næç¤ºï¼š\n0 &lt;&#x3D; s.length &lt;&#x3D; 5 * 10^4s ç”±è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ç¬¦å·å’Œç©ºæ ¼ç»„æˆ\né¢˜è§£/** * ä½¿ç”¨åŒæŒ‡é’ˆè®°å½•çª—å£å‡ºç°çš„æœ€å¤§å€¼ * @param s * @return */public int lengthOfLongestSubstring(String s) &#123;    int n = s.length();    Set&lt;Character&gt; set = new HashSet&lt;&gt;();    int result = 0, i = 0, j = 0;    while (i &lt; n &amp;&amp; j &lt; n) &#123;        //charAtï¼šè¿”å›æŒ‡å®šä½ç½®å¤„çš„å­—ç¬¦        if (!set.contains(s.charAt(j))) &#123;            set.add(s.charAt(j));            j++;            result = Math.max(result, j - i);        &#125; else &#123;            set.remove(s.charAt(i));            i++;        &#125;    &#125;    return result;&#125;/** * å…¶å®æˆ‘ä»¬å¯ä»¥å®šä¹‰å­—ç¬¦åˆ°ç´¢å¼•çš„æ˜ å°„ï¼Œè€Œä¸æ˜¯ç®€å•é€šè¿‡ä¸€ä¸ªé›†åˆæ¥åˆ¤æ–­å­—ç¬¦æ˜¯å¦å­˜åœ¨ã€‚ * è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬æ‰¾åˆ°é‡å¤çš„å­—ç¬¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³è·³è¿‡è¯¥çª—å£ï¼Œè€Œä¸éœ€è¦å¯¹ä¹‹å‰çš„å…ƒç´ è¿›è¡Œå†æ¬¡è®¿é—®ã€‚ * @param s * @return */public static int lengthOfLongestSubstring3(String s) &#123;    int n = s.length(), result = 0;    Map&lt;Character, Integer&gt; map = new HashMap&lt;&gt;();    for (int right = 0, left = 0; right &lt; n; right++) &#123;        if (map.containsKey(s.charAt(right))) &#123;            //å‡ºç°é‡å¤çš„å­—ç¬¦æ—¶ï¼Œç›´æ¥å°†å·¦æŒ‡é’ˆæŒ‡å‘ä¸Šæ¬¡å‡ºç°è¯¥é‡å¤å­—ç¬¦çš„ä½ç½®            //ä¸éœ€è¦å¯¹ä¹‹å‰çš„å…ƒç´ è¿›è¡Œè®¿é—®            //å·¦æŒ‡é’ˆç›´æ¥è¶Šè¿‡ä¹‹å‰å‡ºç°é‡å¤å­—ç¬¦çš„ä½ç½®            left = Math.max(map.get(s.charAt(right)), left);        &#125;        result = Math.max(result, right - left + 1);        map.put(s.charAt(right), right + 1);    &#125;    return result;&#125;/** * æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª256ä½çš„æ•°ç»„æ¥æ›¿ä»£hashmapï¼Œä»¥è¿›è¡Œä¼˜åŒ–ã€‚ï¼ˆå› ä¸ºASCIIç è¡¨é‡Œçš„å­—ç¬¦æ€»å…±æœ‰128ä¸ªã€‚ * ASCIIç çš„é•¿åº¦æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œ8ä½ï¼Œç†è®ºä¸Šå¯ä»¥è¡¨ç¤º256ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯è®¸å¤šæ—¶å€™åªè°ˆ128ä¸ªï¼‰ * @param s * @return */public int lengthOfLongestSubstring4(String s) &#123;    int n = s.length();    int result = 0;    //å­˜æ”¾æ¯ä¸ªå­—ç¬¦çš„ä½ç½®    int[] charIndex = new int[256];    for (int left = 0, right = 0; right &lt; n; right++) &#123;        char c = s.charAt(right);        //å½“æœ‰å­—ç¬¦é‡å¤ï¼Œç›´æ¥æŠŠå·¦æŒ‡é’ˆè¶Šè¿‡ä¹‹å‰é‡å¤çš„ä½ç½®ï¼ˆright + 1ï¼‰        left = Math.max(charIndex[c], left);        result = Math.max(result, right - left + 1);        //å­˜æ”¾ä½ç½®ä¸åˆå§‹çš„0åŒºåˆ†ï¼Œå¹¶è¶Šè¿‡è‡ªå·±çš„ä½ç½®        charIndex[c] = right + 1;    &#125;    return result;&#125;\n","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","æ»‘åŠ¨çª—å£"]},{"title":"125. éªŒè¯å›æ–‡ä¸²","url":"/java4u/2020/06/19/125.%20%E9%AA%8C%E8%AF%81%E5%9B%9E%E6%96%87%E4%B8%B2/","content":"125. éªŒè¯å›æ–‡ä¸²ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯å›æ–‡ä¸²ï¼Œåªè€ƒè™‘å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œå¯ä»¥å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚\nè¯´æ˜ï¼šæœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†ç©ºå­—ç¬¦ä¸²å®šä¹‰ä¸ºæœ‰æ•ˆçš„å›æ–‡ä¸²ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: â€œA man, a plan, a canal: Panamaâ€è¾“å‡º: trueè§£é‡Šï¼šâ€amanaplanacanalpanamaâ€ æ˜¯å›æ–‡ä¸²\nç¤ºä¾‹ 2:\nè¾“å…¥: â€œrace a carâ€è¾“å‡º: falseè§£é‡Šï¼šâ€raceacarâ€ ä¸æ˜¯å›æ–‡ä¸²\næç¤ºï¼š\n1 &lt;&#x3D; s.length &lt;&#x3D; 2 * 10^5å­—ç¬¦ä¸² s ç”± ASCII å­—ç¬¦ç»„æˆ\né¢˜è§£//æ­£åˆ™æ›¿æ¢æ‰å…¶ä½™å­—ç¬¦ï¼Œåœ¨è¿›è¡Œå›æ–‡éªŒè¯public boolean isPalindrome(String s)&#123;    char[] chars = s.toLowerCase()            .replaceAll(&quot;[^0-9a-z]&quot;, &quot;&quot;)            .toCharArray();    int i = 0;    int j = chars.length-1;    while (i&lt;j)&#123;        if(chars[i]!= chars[j])return false;        i++;        j--;    &#125;    return true;&#125;//å¾ªç¯æ—¶ç›´æ¥è·³è¿‡ä¸æ˜¯å­—æ¯æˆ–æ•°å­—çš„å­—ç¬¦//ä¸éœ€è¦æ­£åˆ™å»å¾ªç¯ä¸€æ¬¡å­—ç¬¦äº†public boolean isPalindrome2(String s) &#123;    char[] chars = s.toCharArray();    int length = s.length();    if (length &lt; 2) return true;    int l = 0;    int r = length - 1;    while (l &lt; r) &#123;        //isLetterOrDigit ç¡®è®¤å­—ç¬¦æ˜¯ä¸€ä¸ªå­—æ¯æˆ–æ•°å­—        while (!Character.isLetterOrDigit(chars[l]) &amp;&amp; l &lt; r) l++;        while (!Character.isLetterOrDigit(chars[r]) &amp;&amp; l &lt; r) r--;        if (Character.toLowerCase(chars[l]) != Character.toLowerCase(chars[r]))            return false;        l++;        r--;    &#125;    return true;&#125;","categories":["æ•°æ®ç»“æ„ä¸ç®—æ³•"],"tags":["leetcode","å­—ç¬¦ä¸²"]}]